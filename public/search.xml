<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>浏览器网络</title>
      <link href="2021/03/05/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BD%91%E7%BB%9C/"/>
      <url>2021/03/05/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<h2 id="Error-ERR-TUNNEL-CONNECTION-FAILED"><a href="#Error-ERR-TUNNEL-CONNECTION-FAILED" class="headerlink" title="Error - ERR_TUNNEL_CONNECTION_FAILED"></a>Error - ERR_TUNNEL_CONNECTION_FAILED</h2><p><code>This site can’t be reached.The webpage at https://www.baidu.com/ might be temporarily down or it may have moved permanently to a new web address.</code></p><blockquote><p>解决：<br>  网络代理引起的<br>  wifi -&gt; open network preferences -&gt; advanced -&gt; proxies -&gt; Automatic Proxy Configuration 勾掉</p></blockquote><a id="more"></a>]]></content>
      
      
      
        <tags>
            
            <tag> browser </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>react-jsx</title>
      <link href="2021/03/03/react-jsx/"/>
      <url>2021/03/03/react-jsx/</url>
      
        <content type="html"><![CDATA[<h2 id="JSX-介绍"><a href="#JSX-介绍" class="headerlink" title="JSX 介绍"></a>JSX 介绍</h2><p>JavaScript XML 缩写为 JSX<br>JSX 作为 JavaScript 语法扩展，支持自定义属性，并具有很强的扩展性<br>React 中使用 JSX 语法，必须引用 ‘babel.js’ 解析 JSX<br><code>&lt;script type=&quot;text/babel&quot;&gt;&lt;/script&gt;</code> 浏览器内置的 JavaScript 解释器不解析标签里的脚本代码，由 <code>babel</code> 解析，避免 react 与原生 javascript 代码混淆</p><a id="more"></a><h2 id="JSX-作为单独文件引入"><a href="#JSX-作为单独文件引入" class="headerlink" title="JSX 作为单独文件引入"></a>JSX 作为单独文件引入</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">dir</span>=<span class="string">"ltr"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- react core code，when deploying, replace 'react.development.js' with 'react.production.min.js' --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/react@16/umd/react.development.js"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- react dom when deploying replace 'react-dom.development.js' with 'react-dom.production.min.js' --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/react-dom@16/umd/react-dom-development.js"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Don't use it in production --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/babel-standalone@5.16.0/babel.min.js"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- import.js 是 babel 编写的 js 代码 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./import.js"</span> <span class="attr">type</span>=<span class="string">"text/babel"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="JSX-表达式"><a href="#JSX-表达式" class="headerlink" title="JSX 表达式"></a>JSX 表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">'arithmetic'</span></span><br><span class="line"><span class="keyword">const</span> span = (</span><br><span class="line">  &lt;span&gt;&#123;name&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure><h3 id="JSX-条件表达式-——-三元运算符"><a href="#JSX-条件表达式-——-三元运算符" class="headerlink" title="JSX 条件表达式 —— 三元运算符"></a>JSX 条件表达式 —— 三元运算符</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> span = (</span><br><span class="line">  &lt;span&gt;&#123;<span class="literal">true</span> ? <span class="number">1</span> : <span class="number">2</span>&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure><h3 id="JSX-对象表达式"><a href="#JSX-对象表达式" class="headerlink" title="JSX 对象表达式"></a>JSX 对象表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userInfo = &#123;</span><br><span class="line">  name: <span class="string">'arithmetic'</span>,</span><br><span class="line">  age: <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> span = (</span><br><span class="line">  &lt;span&gt;&#123;userInfo.name&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure><h3 id="JSX-函数表达式"><a href="#JSX-函数表达式" class="headerlink" title="JSX 函数表达式"></a>JSX 函数表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userInfo = &#123;</span><br><span class="line">  name: <span class="string">'arithmetic'</span>,</span><br><span class="line">  age: <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> userInfo.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> span = (</span><br><span class="line">  &lt;span&gt;&#123;getUserName()&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure><h3 id="JSX-增强函数表达式"><a href="#JSX-增强函数表达式" class="headerlink" title="JSX 增强函数表达式"></a>JSX 增强函数表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userInfo = &#123;</span><br><span class="line">  name: <span class="string">'arithmetic'</span>,</span><br><span class="line">  age: <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAge</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (userInfo.age &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Number</span>(userInfo.age) + <span class="number">1</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Number</span>(userInfo.age) + <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> span = (</span><br><span class="line">  &lt;span&gt;&#123;getAge()&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure><h3 id="JSX-数组表达式"><a href="#JSX-数组表达式" class="headerlink" title="JSX 数组表达式"></a>JSX 数组表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userInfo = &#123;</span><br><span class="line">  name: <span class="string">'arithmetic'</span>,</span><br><span class="line">  age: <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAge</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (userInfo.age &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Number</span>(userInfo.age) + <span class="number">1</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Number</span>(userInfo.age) + <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> lis = [</span><br><span class="line">  &lt;li&gt;name: &#123;userInfo.name&#125;&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">  &lt;li&gt;&#123;getAge()&#125;&lt;/</span>li&gt;</span><br><span class="line">]</span><br><span class="line"><span class="keyword">const</span> ol = (</span><br><span class="line">  &lt;ul&gt;&#123;lis&#125;&lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure><h3 id="JSX-表达式样式"><a href="#JSX-表达式样式" class="headerlink" title="JSX 表达式样式"></a>JSX 表达式样式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> rootDiv = <span class="built_in">document</span>.querySelector(<span class="string">'#root'</span>);</span><br><span class="line"><span class="keyword">const</span> nameStyle = &#123;</span><br><span class="line">  fontFamily: <span class="string">'Arial'</span>,</span><br><span class="line">  color: <span class="string">'#f90'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> ageStyle = &#123;</span><br><span class="line">  fontFamily: <span class="string">'sens-serif'</span>,</span><br><span class="line">  color: <span class="string">'#f99'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> userInfo = &#123;</span><br><span class="line">  name: <span class="string">'arithmetic'</span>,</span><br><span class="line">  age: <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAge</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (userInfo.age &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Number</span>(userInfo.age) + <span class="number">1</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Number</span>(userInfo.age) + <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> lis = [</span><br><span class="line">  &lt;li style=&#123;nameStyle&#125;&gt;name: &#123;userInfo.name&#125;&lt;<span class="regexp">/li&gt;,</span></span><br><span class="line"><span class="regexp">  &lt;li style=&#123;ageStyle&#125;&gt;age: &#123;getAge()&#125;&lt;/</span>li&gt;</span><br><span class="line">]</span><br><span class="line"><span class="keyword">const</span> ol = (</span><br><span class="line">  &lt;ul&gt;&#123;lis&#125;&lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">ReactDOM.render(ol, rootDiv)</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> react </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器工作原理——chrome开发工具</title>
      <link href="2021/02/23/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94chrome%E5%BC%80%E5%8F%91%E8%80%85%E5%B7%A5%E5%85%B7/"/>
      <url>2021/02/23/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94chrome%E5%BC%80%E5%8F%91%E8%80%85%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th>名称</th><th>描述</th></tr></thead><tbody><tr><td>Elements 面板</td><td>可以查看DOM结构、编辑CSS样式、用于测试页面布局和设计页面</td></tr><tr><td>Console 面板</td><td>可以查看 JavaScript 脚本、通过 Console 还能和页面中的 JavaScript 对象交互</td></tr><tr><td>Sources 面板</td><td>1.查看 Web 应用加载的所有文件；<br> 2.编辑CSS和Javascript文件内容；<br>3.将打乱的CSS文件或者Javascript 文件格式化；<br>4.支持 JavaScript 的调试功能；<br>5.设置工作区，将更改的文件保存到本地文件夹中</td></tr></tbody></table>]]></content>
      
      
      
        <tags>
            
            <tag> browser </tag>
            
            <tag> 浏览器工作原理 </tag>
            
            <tag> devTools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器工作原理——async/await（用同步的方式写异步代码）</title>
      <link href="2021/01/18/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94async-await%EF%BC%88%E7%94%A8%E5%90%8C%E6%AD%A5%E7%9A%84%E6%96%B9%E5%BC%8F%E5%86%99%E5%BC%82%E6%AD%A5%E4%BB%A3%E7%A0%81%EF%BC%89/"/>
      <url>2021/01/18/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94async-await%EF%BC%88%E7%94%A8%E5%90%8C%E6%AD%A5%E7%9A%84%E6%96%B9%E5%BC%8F%E5%86%99%E5%BC%82%E6%AD%A5%E4%BB%A3%E7%A0%81%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>fetch 定义在 window 对象中，用来发起远程资源请求，返回一个 Promise 对象，浏览器原生支持。</p><p><em>接口嵌套请求需求：request1 请求成功后再做 request2请求，运用 fetch 实现如下：</em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">'http://request1.com'</span>)</span><br><span class="line">  .then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fetch(<span class="string">'http://request2.com'</span>)</span><br><span class="line">  &#125;).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(response)</span><br><span class="line">  &#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><a id="more"></a><p>async/await 这是 JavaScript 异步编程，提供了在不阻塞主线程的情况下使用同步代码实现异步访问资源的能力，并且使得代码逻辑更加清晰</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> response = <span class="keyword">await</span> fetch(<span class="string">'http://request.com'</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(response, <span class="string">'response'</span>)</span><br><span class="line">    <span class="keyword">let</span> response1 = <span class="keyword">await</span> fetch(<span class="string">'http://request1.com'</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(response1, <span class="string">'response1'</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="生成器（Generator）是如何工作的"><a href="#生成器（Generator）是如何工作的" class="headerlink" title="生成器（Generator）是如何工作的"></a>生成器（Generator）是如何工作的</h2><blockquote><p>生成器函数是一个 <strong>带星号函数</strong>，是可以 <strong>暂停执行和恢复执行</strong> 的。Generator 函数除了可以使用 return 关键字返回外，还可以使用 yield 关键字中断。调用 Generator 函数并非执行函数体内的内容，而是返回一个迭代器对象，通过这个迭代器对象的 next 指针来分步执行 Generator 函数中的内容任务。</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">genDmo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'开始执行第一行'</span>)</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'Generator 2'</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'开始执行第二行'</span>)</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'Generator 2'</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'开始执行第三行'</span>)</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'Generator 2'</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'执行结果'</span>)</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'Generator 2'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'main'</span>)</span><br><span class="line"><span class="keyword">let</span> gen = genDmo();</span><br><span class="line"><span class="built_in">console</span>.log(gen.next().value)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'main 1'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(gen.next().value)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'main 2'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(gen.next().value)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'main 3'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(gen.next().value)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'main 4'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//main</span></span><br><span class="line"><span class="comment">// demo-1.html:19 开始执行第一行</span></span><br><span class="line"><span class="comment">// demo-1.html:34 Generator 2</span></span><br><span class="line"><span class="comment">// demo-1.html:35 main 1</span></span><br><span class="line"><span class="comment">// demo-1.html:22 开始执行第二行</span></span><br><span class="line"><span class="comment">// demo-1.html:36 Generator 2</span></span><br><span class="line"><span class="comment">// demo-1.html:37 main 2</span></span><br><span class="line"><span class="comment">// demo-1.html:25 开始执行第三行</span></span><br><span class="line"><span class="comment">// demo-1.html:38 Generator 2</span></span><br><span class="line"><span class="comment">// demo-1.html:39 main 3</span></span><br><span class="line"><span class="comment">// demo-1.html:28 执行结果</span></span><br><span class="line"><span class="comment">// demo-1.html:40 Generator 2</span></span><br><span class="line"><span class="comment">// demo-1.html:41 main 4</span></span><br></pre></td></tr></table></figure><p>如上执行结果：<br>在生成器函数内部执行一段代码，如果遇到 yield 关键字，JavaScript 引擎则返回关键字后面的内容给外部、并暂停该函数执行；<br>外围函数可以通过 next 方法恢复函数的执行</p><h2 id="Generator-的底层实现机制——协程（Coroutine）"><a href="#Generator-的底层实现机制——协程（Coroutine）" class="headerlink" title="Generator 的底层实现机制——协程（Coroutine）"></a>Generator 的底层实现机制——协程（Coroutine）</h2><p>协程是一种比线程更加轻量级的存在<br>可以看作是跑在线程上的任务，一个线程上可以存在多个协程，但是在线程上同时只能执行一个协程【当前执行的 A 协程，要启动 B 协程，那么 A 协程就要把主线程上的控制权给 B 协程，体现为 A 协程暂停执行，B 协程恢复执行；同样，也可以从 B 协程中启动一个 A 协程】<strong>通常，如果从 A 协程启动 B 协程，我们把 A 协程称为 B 协程的父协程。</strong></p><p>一个线程可以拥有多个协程，<code>协程不是被操作系统内核管理，而是由程序控制，也就是在用户态执行。如此带来的好处是性能得到了很大的提升，不会像线程切换那样消耗资源</code>。</p><ol><li>gen 协程和父协程在主线程上交互执行，并不是并发执行的，它们之前的切换是通过 yield 和 gen.next 来配合完成</li><li>当在 gen 协程中调用了 yield 方法，JavaScript 引擎会保存 gen 协程当前的调用栈信息，并恢复父协程的调用栈信息。同样，当在父协和中执行 gen.next 时，JavaScript 引擎会保存父协程的调用栈信息，并恢复 gen 协程的调用栈信息。</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> response1 = <span class="keyword">yield</span> fetch(<span class="string">'http://response1.com'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'response1'</span>, response1)</span><br><span class="line">  <span class="keyword">let</span> response2 = <span class="keyword">yield</span> fetch(<span class="string">'http://response2.com'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'response2'</span>, response2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> gen = foo()</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getGenPromise</span>(<span class="params">gen</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> gen.next().value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getGenPromise(gen).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'response-1'</span>, response)</span><br><span class="line">  <span class="keyword">return</span> getGenPromise(gen)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'response-2'</span>, response)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol><li>首先执行的是 <code>let gen = foo()</code>，创建 gen 协程</li><li>然后父协程中通过执行 gen.next 把主线程的控制权交给 gen 协程</li><li>gen 协程获取到主线程的控制权后，就调用 fetch 函数创建了一个 Promise 对象 response1，然后通过 yield 暂停 gen 协程的执行，并将 response1 返回给父协程</li><li>父协程恢复执行后，调用 response1.then 方法等待请求结果</li><li>等通过 fetch 发起的请求完成后，会调用 then 中的回调函数，then 中的回调函数拿到结果之后，通过调用 gen.next 放弃主纯种的控制权，将控制权交给 gen 协程继续执行下个请求</li></ol><blockquote><p>通常我们把执行生成器的代码封装成一个函数，并把这个执行生成器代码的函数称为执行器</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> response1 = <span class="keyword">yield</span> fetch(<span class="string">'http://request.com'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'response1'</span>, response1)</span><br><span class="line">  <span class="keyword">let</span> response2 = <span class="keyword">yield</span> fetch(<span class="string">'http://request1.com'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'response2'</span>, response2)</span><br><span class="line">&#125;</span><br><span class="line">co(foo())</span><br></pre></td></tr></table></figure><p>生成器配合执行器，就能实现使用同步方式写出异步代码。</p><h2 id="async-await-使用了-Generator-和-Promise-两种技术"><a href="#async-await-使用了-Generator-和-Promise-两种技术" class="headerlink" title="async/await 使用了 Generator 和 Promise 两种技术"></a>async/await 使用了 Generator 和 Promise 两种技术</h2><p>async/await 技术就是 Promise 和生成器的应用，低层说就是微任务和协程应用</p><ol><li><p>async 是一个通过 <strong>异步执行</strong> 并 <strong>隐式返回 Promise</strong> 任务结果的函数</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(foo())</span><br><span class="line"></span><br><span class="line"><span class="comment">// async 声明的 foo 函数返回一个 Promise 对象，状态是 resolve</span></span><br><span class="line"><span class="built_in">Promise</span> &#123;&lt;resolved&gt;: <span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure></li><li><p>await</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">let</span> a = <span class="keyword">await</span> <span class="number">100</span></span><br><span class="line">  <span class="built_in">console</span>.log(a)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">0</span>)</span><br><span class="line">foo()</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">3</span>)</span><br></pre></td></tr></table></figure></li></ol><p>(1).  执行 console.log(0)，打印出 0<br>(2).  执行 foo 函数，foo 函数由 async 标记，当进入函数时，JavaScript 引擎会保存当前的调用栈信息，然后执行 foo 函数中的 console.log(1)，并打印 1<br>(3).  执行到 await 100 时，JavaScript 引擎会做以下事情：</p><ul><li><p>默认创建一个 Promise 对象，JavaScript 引擎会将该任务提交给微任务队列</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise_ = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">100</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>JavaScript 引擎暂停当前协程的执行，将主线程的控制权交给父协程执行，同时会将 promise_ 对象返回给父协程</p></li><li><p>父协程调用 promise_.then 来监控 promise 状态改变</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> browser </tag>
            
            <tag> 浏览器工作原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器工作原理——使用Promise，告别回调函数</title>
      <link href="2021/01/13/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E4%BD%BF%E7%94%A8Promise%EF%BC%8C%E5%91%8A%E5%88%AB%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0/"/>
      <url>2021/01/13/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E4%BD%BF%E7%94%A8Promise%EF%BC%8C%E5%91%8A%E5%88%AB%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="JavaScript-引入-Promise-的动机"><a href="#JavaScript-引入-Promise-的动机" class="headerlink" title="JavaScript 引入 Promise 的动机"></a>JavaScript 引入 Promise 的动机</h2><p><strong><code>Promise 解决了异步编码风格的问题</code></strong></p><h3 id="异步编程问题：代码逻辑不连续"><a href="#异步编程问题：代码逻辑不连续" class="headerlink" title="异步编程问题：代码逻辑不连续"></a>异步编程问题：代码逻辑不连续</h3><p>页面事件循环系统，页面中的任务都是在主线程上执行的，在执行如下载网络文件任务、获取摄像头等耗时任务，要放在页面主线程之外的进程或线程中去执行，避免耗时任务霸占页面主线程。</p><img src="http://www.plantuml.com/plantuml/svg/XLB1RjD04BtlLuoKAv4QKAySaNe22MuLXssyJgmuwxBU712g54IX8LGDK2b11PfMgX2gL8fQaPeQaP_nxhedVe5nRJMkLQS77xnlvhqtyyPlENoL2jg6kjTUzJZZyh5yxZ8Gh2ufRxYC49VP4gG7mcaq9LXE0ZaU9rSbe8CJFTwEfv_DztVmWW2KjS1C1g8WDEVJf8FwqAOEVz8KZ5fGMLoqBqbkB8w2VjmTwT543Jx4lywYC5JzVQZOjZsdGnsic_TlocjJt8JRUlSBLEZ20k9h-3thi0vED-dfbySNdyQgDqAqLilSbG-9t5HOrsbnIC7yZYjp-Ek9-l4giuMuf7whDX--En--bncVZRRqC5de0tpBhRYwt7GiY_6drVkpLx96Sf6gmJTrC8o2RXGSfi7gtd2M5-MUR3BnI7XrvllfJc_9gBfSMN4xxCwAvreeNA0W-CV0u-0wl8LkRzJFSWoEpCvwoaeOjo1f9GL7gDOGZF4hkMpv1PcBxauytKYsfFlzV5xw3EdtLEzdFdrK_lTdK_sUwAsF-6AEtgg_XsRhs9o69XodxOcZIqFNpgQA3iekikWf8qSRNyU9N5vYC5GRvsaRRYNUtoo8bbvzOY0_tty0"><a id="more"></a><p>上图为一个异步编程编程模型，页面主线程发起一个耗时的任务，并将任务交给另一个进程处理，页面主线程继续执行消息队列中的任务。anotherProcess 处理完这个任务后，会将任务添加渲染进程的消息队列中，并排队等待循环系统处理。排队结束后，循环系统会取出消息队列中的任务进行处理，并触发相关回调操作。</p><p>如上是页面编程的一大特点 <strong>异步回调</strong><br>web 页面的单线程架构决定了异步回调 <strong>异步回调影响到了我们的编码方式</strong></p><p><code>使用 XMLHttpRequest 实现一个下载的需求</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 失败回调</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onReject</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onResolve</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(response)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">xhr.ontimeout = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;onReject(e)&#125;</span><br><span class="line">xhr.onerror = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;onReject(e)&#125;</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;onResolve(xhr.response)&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> URL = <span class="string">'http://test.com'</span></span><br><span class="line">xhr.open(<span class="string">'Get'</span>, URL, <span class="literal">true</span>); <span class="comment">// 设置请未类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置参数</span></span><br><span class="line">xhr.timeout = <span class="number">3000</span></span><br><span class="line">xhr.responseType = <span class="string">'test'</span> <span class="comment">// 设置响应返回的数据格式</span></span><br><span class="line">xhr.setRequestHeader(<span class="string">'X_TEST'</span>,<span class="string">'test'</span>)</span><br><span class="line"></span><br><span class="line">xhr.send()</span><br></pre></td></tr></table></figure><p>上面代码问题在于回调多，导致逻辑不连贯、不线性。接下来封装代码，降低处理异步回调次数</p><h3 id="封装异步代码，让处理流程变得线性"><a href="#封装异步代码，让处理流程变得线性" class="headerlink" title="封装异步代码，让处理流程变得线性"></a>封装异步代码，让处理流程变得线性</h3><img src="http://www.plantuml.com/plantuml/svg/TL1DIm9H5DtFhxZeOa3IWdOFQji-MhgPPkvaCStOcsSe8HHfXWKPjSdC29FQ66qYSQ1VCr_zYzxpcJXQlCtCEUUUS--Xg3FDth4GKXOoe7XGGfV16XpbxJo5VMG5no3g1Z9rQOoKg4NK0cD5ab_EBvVBETtPLvTWsp4gHEKVOr41DGEfIs2Aw1GDjDckPd6KqH9ESBTYwmHC3lyYanMsAaNaympBJ9qo9bAALDWAe9e2pPskdDPCyHGwlIXuFubxzVZZCtpeH-sQ46yxPKXp6_xWI06O4LzTSwNlUK7p2TAciP9adsjHw-m_LkB1ssLutf8ifnE6sUnwmaFmivQ2JxWG2EwxyVlfl54kbviNXeDUq7cLTafLcIaWycx2RYV-kWaQ8t6zK-8rcUR2wOtHz-sTDE3ywcg2ZRoNo1lummj_U1mE-lwmBJlWid6OR5yS8Ceb8EBgVKNy291dIgmnKXABZokPJIRWs9kunuCXav5C9hCuy_S-SjXrh4FaqrmRD1_vz0y0"><p>关注 request（输入内容）和 response (输出内容)，封装异步请求过程</p><ol><li><p>把输入 http 请求的信息封装到一个 request 对象中</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// makeRequest 用于构造 request 对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeRequest</span>(<span class="params">request_url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> request = &#123;</span><br><span class="line">    method: <span class="string">'Get'</span>,</span><br><span class="line">    url: request_url,</span><br><span class="line">    headers: <span class="string">''</span>,</span><br><span class="line">    body: <span class="string">''</span>,</span><br><span class="line">    credentials: <span class="literal">false</span>, <span class="comment">//安全设置</span></span><br><span class="line">    sync: <span class="literal">false</span>,</span><br><span class="line">    responseType: <span class="string">'text'</span>,</span><br><span class="line">    referrer: <span class="string">''</span>,</span><br><span class="line">    timeout: <span class="number">3000</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> request</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>封装请求过程，请求过程细节封装到 XFetch 函数</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * request 输入 http 的信息，如请求头、延时、返回类型等</span></span><br><span class="line"><span class="comment"> * resolve 成功回调函数</span></span><br><span class="line"><span class="comment"> * reject 失败回调函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">XFetch</span>(<span class="params">request, resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">  xhr.ontimeout = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;reject(e)&#125;</span><br><span class="line">  xhr.onerror = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;reject(e)&#125;</span><br><span class="line">  xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xhr.state == <span class="number">200</span>) &#123;</span><br><span class="line">      resolve(xhr.response)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建一个请求</span></span><br><span class="line">  xhr.open(request.method, request.url, request.sync)</span><br><span class="line">  xhr.timeout = request.timeout</span><br><span class="line">  xhr.requestType = request.requestType</span><br><span class="line"></span><br><span class="line">  xhr.send()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>业务代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">XFetch(</span><br><span class="line">  makeRequest(<span class="string">'http://xxx.com'</span>),</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">data</span>) </span>&#123;<span class="built_in">console</span>.log(data)&#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">error</span>)</span>&#123;<span class="built_in">console</span>.log(error)&#125;)</span><br></pre></td></tr></table></figure></li></ol><h3 id="新的问题：回调地域"><a href="#新的问题：回调地域" class="headerlink" title="新的问题：回调地域"></a>新的问题：回调地域</h3><p>多个接口请求相互依赖，就是存在请求之间嵌套，嵌套太多的回调函数，会使自己陷入 <strong>回调地狱</strong>，如下代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">XFetch(</span><br><span class="line">  makeRequest(<span class="string">'http://request1.com'</span>),</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">    XFetch(</span><br><span class="line">      makeRequest(<span class="string">'http://request2.com'</span>),</span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">        XFetch(</span><br><span class="line">          makeRequest(<span class="string">'http://request3.com'</span>),</span><br><span class="line">          <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">            ...</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error)</span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error)</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">error</span>) </span>&#123;<span class="built_in">console</span>.log(error)&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>上面代码中， <strong>嵌套</strong> 调用，内层的任务执行依赖外层，并在上个任务的回调函数内部执行新的业务逻辑，多层嵌套，代码可读性变差；另外执行每个任务都有成功或失败两种结果，体现在代码中就需要对每个任务结果做两次判断，这样每个任务都要进行一次错误处理，使得代码混乱。</p><h2 id="Promise-解决的几个核心关键点-——-消灭嵌套调用和多次错误处理"><a href="#Promise-解决的几个核心关键点-——-消灭嵌套调用和多次错误处理" class="headerlink" title="Promise 解决的几个核心关键点 —— 消灭嵌套调用和多次错误处理"></a>Promise 解决的几个核心关键点 —— 消灭嵌套调用和多次错误处理</h2><p>使用 Promise 重新构造 XFetch</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">XFetch</span>(<span class="params">request</span>)</span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">executor</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">    xhr.open(<span class="string">'Get'</span>, request.url, <span class="literal">true</span>)</span><br><span class="line">    xhr.ontimeout = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;reject(e)&#125;</span><br><span class="line">    xhr.onerror = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;reject(e)&#125;</span><br><span class="line">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.readyState === <span class="number">4</span>) <span class="comment">// 'DONE'</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.state === <span class="number">200</span>) &#123;</span><br><span class="line">          resolve(<span class="keyword">this</span>.responseText, <span class="keyword">this</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> error = &#123;</span><br><span class="line">            code: <span class="keyword">this</span>.status,</span><br><span class="line">            response: <span class="keyword">this</span>.response</span><br><span class="line">          &#125;</span><br><span class="line">          reject(error, <span class="keyword">this</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    xhr.send()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(executor)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如上：</p><ul><li>使用 Promise，调用 XFetch 时，返回一个 Promise 对象</li><li>构建 Promise 对象时，传入 executor 函数，XFetch 主要业务在 executor 中执行</li><li>如果运行在 executor 函数中的业务执行成功了，会调用 resolve 函数；如果执行失败，调用 reject 函数</li><li>在 executor 函数中调用 resolve 函数时，会触发 promise.then 设置的回调函数；而调用 reject 函数时，会触发 promise.catch 设置的回调函数</li></ul><p><strong>使用 Promise 封装后的 XFetch，来解决嵌套调用和多次异常处理的问题</strong><br>产生嵌套函数的主要原因是在发起任务请求时会带上回调函数，任务结束后，下个任务是在回调函数中处理的。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x1 = XFetch(makeRequest(<span class="string">'http://request1.com'</span>))</span><br><span class="line"><span class="keyword">var</span> x2 = x1.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value)</span><br><span class="line">  <span class="keyword">return</span> XFetch(makeRequest(<span class="string">'http://request2.com'</span>))</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> x3 = x2.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value)</span><br><span class="line">  <span class="keyword">return</span> XFetch(makeRequest(<span class="string">'http://request3.com'</span>))</span><br><span class="line">&#125;)</span><br><span class="line">x3.catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>Promise 解决嵌套回调的方式</strong></p><ol><li>Promise 实现了回调函数的延时绑定。</li><li>需要将回调函数 onResolve 的返回值穿透到最外层<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// executor 执行业务逻辑</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">executor</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  resolve()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建 Promise 对象</span></span><br><span class="line"><span class="keyword">var</span> promiseObj1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(executor)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 回调函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onResolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 回调中可以执行下个异步请求，返回 promise 对象</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(value + <span class="number">1</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//promiseObj1.then(onResolve) 延迟执行回调函数，不存在嵌套</span></span><br><span class="line"><span class="keyword">var</span> promiseObj2 = promiseObj1.then(onResolve)</span><br><span class="line"><span class="comment">// 取出上个回调返回的 promise</span></span><br><span class="line">promiseObj2.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ol><p>Promise 通过 <strong>回调函数延迟绑定</strong> 和 <strong>回调函数返回值穿透的技术</strong> 解决<code>循环嵌套</code>的问题</p><p><strong>promise 是怎么处理异常的</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 业务处理代码</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">executor</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> rand = <span class="built_in">Math</span>.random();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(rand)</span><br><span class="line">  <span class="keyword">if</span> (rand &lt; <span class="number">0.5</span>) &#123;</span><br><span class="line">    resolve()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    reject()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p0 = <span class="keyword">new</span> <span class="built_in">Promise</span>(executor)</span><br><span class="line"><span class="keyword">var</span> p1 = p0.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'success-1'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(executor)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> p2 = p1.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'success-2'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(executor)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> p3 = p2.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'success-3'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(executor)</span><br><span class="line">&#125;)</span><br><span class="line">p3.catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'catch error'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span>)</span><br></pre></td></tr></table></figure><p>Promise 对象的错误具有“冒泡”性质，会一直向后传递，直到被 onReject 函数处理或 catch 语句捕获为止</p><h2 id="Promise-与-微任务"><a href="#Promise-与-微任务" class="headerlink" title="Promise 与 微任务"></a>Promise 与 微任务</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">executor</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  resolve(<span class="number">100</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> demo = <span class="keyword">new</span> <span class="built_in">Promise</span>(executor)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onResolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value)</span><br><span class="line">&#125;</span><br><span class="line">demo.then(onResolve)</span><br></pre></td></tr></table></figure><p>代码执行顺序：</p><ol><li>首先执行 new Promise 时，Promise 的构造函数会被执行</li><li>Promise 构造函数会调用参数 executor 函数。executor 中执行 resolve, resolve 内部调用 demo.then 设置的函数 onResolve</li></ol><p><strong>browmise</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Bromise</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> onResolve_ = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">var</span> onReject_ = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span>(<span class="params">onResolve, onReject</span>) </span>&#123;</span><br><span class="line">    onResolve_ = onResolve</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 定时器推迟 onResolve_ 执行</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">      onResolve_(value)</span><br><span class="line">    &#125;,<span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  executor(resolve, <span class="literal">null</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">executor</span>(<span class="params">resolve, reject</span>) </span>&#123; resolve(<span class="number">100</span>)&#125;  <span class="comment">//将Promise改成我们自己的Bromsielet</span></span><br><span class="line">demo = <span class="keyword">new</span> Bromise(executor)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onResolve</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value)</span><br><span class="line">&#125;</span><br><span class="line">demo.then(onResolve)</span><br></pre></td></tr></table></figure><blockquote><p>onResolve_ is not a function 加入定时器让 onResolve 延迟执行<br>上面采用了定时器来推迟 onResolve 的执行，不过使用定时器的效率并不是太高，好在我们有微任务，所以 Promise 又把这个定时器改造成了微任务了，这样既可以让 onResolve_ 延时被调用，又提升了代码的执行效率</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> browser </tag>
            
            <tag> 浏览器工作原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器工作原理——宏任务与微任务</title>
      <link href="2021/01/12/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E5%AE%8F%E4%BB%BB%E5%8A%A1%E4%B8%8E%E5%BE%AE%E4%BB%BB%E5%8A%A1/"/>
      <url>2021/01/12/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E5%AE%8F%E4%BB%BB%E5%8A%A1%E4%B8%8E%E5%BE%AE%E4%BB%BB%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<p>微任务——实时性和效率之间一个有效的权衡<br>Promise 以及以 Promise 为基础开发出来的其它技术是基于微任务的。</p><h2 id="宏任务"><a href="#宏任务" class="headerlink" title="宏任务"></a>宏任务</h2><p>主线程上的任务包括了渲染事件（如解析 DOM、计算布局、绘制）、用户交互事件（如鼠标、滚动、放大缩小等）、JavaScript 脚本执行、网络请求、文件读写等。<br>消息队列和事件循环机制协调主线程上的任务执行，渲染进程内部会维护多个消息队列。如延迟队列、普通消息队列等。<br>消息队列中的任务称为 <strong>宏任务</strong><br>WHATWG 规范中对于事件循环机制的定义：</p><ul><li>先从消息队列中选出一个最老的任务，<code>oldestTask</code>；</li><li>事件循环系统记录任务开始执行的时间，并把 <code>oldestTask</code> 设置为当前正在执行的任务；</li><li>任务完成之后，删除当前正在执行的任务，并从对应的消息队列中删除 <code>oldestTask</code>;</li><li>统计执行完成的时长</li></ul><p>宏任务无法处理对时间精度要求较高的任务</p><a id="more"></a><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'demo'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javaScript"</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">timerCallback2</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="number">2</span>)</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">timerCallback1</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="number">1</span>)</span></span><br><span class="line">      setTimeout(timerCallback2, 0)</span><br><span class="line">    &#125;</span><br><span class="line">    setTimeout(timerCallback1, 0)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://static001.geekbang.org/resource/image/3c/15/3c2b9b474c4df544df61ebd62a7b3715.png" alt="img"><br>setTimeout 函数触发的回调函数都是宏任务，图中渲染引擎将一些系统级任务（图中粉色区域）手入到了两个定时任务中间。如果中间系统级任务处理时间过长，会影响后面一个定时任务执行。宏任务时间粒度大，执行时间间隔是不能精确控制的，对一些高实时性的需求不符合。setTimeout 和 XMLHttpRequest 被添加在宏任务中。</p><h2 id="微任务"><a href="#微任务" class="headerlink" title="微任务"></a>微任务</h2><p><code>异步回调的两种方式</code>：</p><ol><li>把回调函数封装成一个宏任务，添加到消息队列尾部，当循环系统执行到该任务的时候执行回调函数</li><li>执行时机是主函数执行结束之后、当前宏任务结束之前执行回调函数，通常是以微任务形式体现</li></ol><blockquote><p>微任务就是一个需要异步执行的函数，执行时机是在主函数执行结束之后、当前宏任务结束之前</p></blockquote><p>每个宏任务都关联一个微任务队列</p><h3 id="微任务产生的时机和执行微任务队列的时机"><a href="#微任务产生的时机和执行微任务队列的时机" class="headerlink" title="微任务产生的时机和执行微任务队列的时机"></a>微任务产生的时机和执行微任务队列的时机</h3><p>现代浏览器中产生微任务有两种方式：</p><ol><li>使用 MutationObserver 监控 DOM 节点，然后再通过 JavaScript 来修改节点，或者为这个节点添加、删除部分子节点，当 DOM 节点发生变化时，就会产生 DOM 变化记录的微任务</li><li>使用 Promise，当调用 Promise.resolve() 或 Promise.reject() 产生微任务</li></ol><p>通过 DOM 节点变化产生的微任务或使用 Promise 产生的微任务都被 JavaScript 引擎按照顺序保存到微任务列表</p><p>微任务队列是何时被执行的？<br>通常情况下，在当前宏任务中的 JavaScript 快执行完成时，也就是 JavaScript 引擎准备退出全局执行上下文并清空调用栈的时候，JavaScript 引擎会检测全局执行上下文中的微任务队列，然后按照顺序执行队列中的微任务。<br><strong>WHATWG 把执行微任务的时间点称为检查点</strong></p><p>如果在执行微任务的过程中，产生新微任务，同样会将该微任务添加到微任务队列中。V8 引擎一直循环执行微任务队列中的任务，直到队列为空。也就是说在执行微任务的过程中产生的新的微任务并不会推迟到下个宏任务中执行，而是在当前的宏任务中继续执行。</p><p><code>微任务示意图</code>:</p><img src="http://www.plantuml.com/plantuml/svg/AyxEp2j8B4hCLKZEpot8pqlDAmakgSn9LIXAJIv9p4lFIULAJYnAKNYwhl_9xjrFknOgL7Cf8DGg0FKMftg4-FeeA9kPkQ58kPObvfGcbgG69nTb5fI0vDDGv9zrBd-niEV9ZgudExgVJMi76umi_tJVEeYLBsVCVzenNK4vBJKLgWXPcMzfIM99PduUKDxC34Cse2W_DxCu5I5PomN122LAK3LwHQd5-JbbgHgQIWg9nGfG7gQ_Yb9pyyjIdJCoSr8WdWBAmXJhwjgXkniiYz21JKKj5teW0-qlIIpEDi8Psa05S8uHmR07gaOLCI8S7K0zoVbv9QaL9GHZ1khQdCpY4eAn15IR2sKRueyoe4eeqn0z-e01XWWhK8Y20yjAmIknB17gvHSjivxDMGFnrFFTav_DdVz-Jy_JzhQdIzfVDZGyRT_rj7N5quqDQBu60000"><img src="http://www.plantuml.com/plantuml/svg/AyxEp2j8B4hCLKZEpot8pqlDAmakgSn9LIXAJIv9p4lFIULAJYnAKNYwhl_9xjrFknOgL7Cf8DGg0FKMftg4-FeeA9kPkQ58kPObvfGcbgG69nTb5fI0vDDGv9zrBd-niEV9ZgudExgVJMi76umi_tJVEeYLBsVCVzenNK4vBJKLgWXPcMzfIM99PduUKDxC32nRomN123LAHQd5-JbbgHg6caeAYSKAK2xCpUWswUhQmPLOAGGKvUTc5gSgFEsVzhHz5u8xPyNJlPEVTlR2W-R9ZhKGFt7LSg676j3IaiJYR4ESmGTK0ESO4WnCe6fK4KF2uGlKWoPaI33CWNhGX0oHuu7ea3R44TI6o65j20niU6n2Gnl1nnlS0000"><p>在执行 parseHTML 宏任务时，遇到了 JavaScript 脚本，那么暂停 parseHTML，进入到 JavaScript 的执行环境。在 JavaScript 脚本执行过程中，通过 Promise 和 removeChild 创建了两个微任务，并被添加到了微任务列表（从图中看出，微任务队列在执行上下文中）JavaScript 执行结束，准备退出全局执行上下文，进入检查点，JavaScript 引擎检查微任务列表，发现列表中有微任务，依次执行微任务，任务队列清空后，退出全局执行上下文。</p><p>关于微任务、宏任务的几点结论：</p><ol><li>微任务和宏任务绑定，每个宏任务执行都会创建自己的微任务队列</li><li>微任务的执行时长影响到当前宏任务的执行时长。如一个宏任务产生了 100 个微任务，每个微任务执行时长 10 毫秒，那么宏任务被延长了 1秒钟。写代码时要注意控制微任务时长</li><li>在一个宏任务中，分别创建了用于回调的宏任务和微任务，无论什么情况，微任务都早于宏任务执行</li></ol><h2 id="监听DOM变化方法演变"><a href="#监听DOM变化方法演变" class="headerlink" title="监听DOM变化方法演变"></a>监听DOM变化方法演变</h2><p>MutationObserver 是用来监听 DOM 变化的一套方法<br>web 应用需要监听 DOM 变化并及时地做出响应</p><p>早期要观察 DOM 是否变化，唯一能做的就是轮询检测，如使用 setTimeout 或者 setInterval 定时检测 DOM 是否变化。<br>这种方法简单粗暴，而且会遇到两个问题：<br>如果时间间隔设置过长，DOM 变化响应不够及时<br>相反，如果时间间隔设置过短，会浪费无用的工作量检查 DOM，让页面变得低效</p><p><strong>Mutation Event</strong> 采用了 <strong>观察者设置模式</strong> 当DOM 有变化时就立即触发相应的事件，这种方式属于同步回调<br>Mutation Event 解决了实时性的问题，DOM 一旦发生变化，立即调用 javaScript 接口。这种实时性造成了严重的性能问题，每次 DOM 变化，渲染引擎会调用 javaScript 会产生较大的性能开销。比如利用 javaScript 动态创建 50 个节点，会触发 50 次回调，若每次回调执行时 2ms，500 次是 200ms ，如果是一个动画执行，Mutation Event 触发回调会导致动画卡顿</p><p><strong>DOM4 开始，推荐使用 MutationObserver 替代 Mutation Event</strong> MutationObserver API 用来监视 DOM 变化<br>MutationObserver 将 Mutation Event DOM 变化触发的同步回调改为异步回调，多次 DOM 变化时触发一次异步回调，并且用一个数据结构记录这期间所有 DOM 的变化。这样即使频繁地操纵 DOM 也不会造成太大的影响。</p><p>异步 + 减少调用次数缓解性能问题，实时性的问题则交给微任务，在每次 DOM 节点发生变化时，渲染引擎将变化记录封装成，并将微任务添加到队列中。当执行到检查点时，V8 引擎会按照顺序执行微任务</p>]]></content>
      
      
      
        <tags>
            
            <tag> browser </tag>
            
            <tag> 浏览器工作原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器工作原理——消息队列与事件循环</title>
      <link href="2021/01/08/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E4%B8%8E%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/"/>
      <url>2021/01/08/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E4%B8%8E%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/</url>
      
        <content type="html"><![CDATA[<h2 id="线程模型（一）"><a href="#线程模型（一）" class="headerlink" title="线程模型（一）"></a>线程模型（一）</h2><p>有确定好的任务，使用一个单线程来按顺序处理任务</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span> + <span class="number">2</span>; <span class="comment">// task1</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="number">2</span> + <span class="number">3</span>; <span class="comment">// task2</span></span><br><span class="line"><span class="keyword">var</span> c = <span class="number">3</span> + <span class="number">4</span>; <span class="comment">// task3</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a, b, c) <span class="comment">// task4</span></span><br></pre></td></tr></table></figure><blockquote><p>使用单线程处理已知任务 task1 task2 task3 task4</p></blockquote><img src="http://www.plantuml.com/plantuml/svg/AyaioKbLUBvh__CLtLmPcIcf2cdv-IL9-HLSN4dvfNafYKML2a_tD3nTtWrHev1Oh51SabXKmbK093AJCmiIyqeKIXABimqnH8mmH8mnH4mGra0iUDdGyBHz5yYQrBmKBh1Lkhfs40l099Hd1EOPGNd6O9unb6S2vfa0UI0p0000"><a id="more"></a><h2 id="线程模型（二）"><a href="#线程模型（二）" class="headerlink" title="线程模型（二）"></a>线程模型（二）</h2><p>引入 <strong>循环语句</strong> 和 <strong>事件系统</strong>，在线程执行过程中接收并处理新任务。</p><blockquote><p>采用事件循环机制，在线程运行过程中接收并执行新任务</p></blockquote><ol><li>主线程中 <strong>引入循环机制</strong>，即在线程语句加入 for 循环，线程会一直循环执行；</li><li><strong>引入事件</strong>,如在线程运行过程中，等待用户输入，线程暂停，接收到用户输入后，线程激活，继续执行。</li></ol><img src="http://www.plantuml.com/plantuml/svg/AyaioKbLUBvh__CLtSzMB7mwh_jbU_lpAIkUxEf-idlRipcxddPiUx-dvrdVqcTJjZtTkUrPv_8N2tkUJTlmPFVkfrqBkJ8oKr8LqlBpIvBoAxYual9Byr8IYogX1Yea5YiKboGMbRZcfN0bv-UL5ENdA2YbvHTfM5jhAe5aeO9SC5KAkhfsC44hXQSTSvykxtxQCmrY7Dm8a2AO3Yi5YDiWxW6wyFdkvSzthuMu4m00"><h2 id="线程模型（三）"><a href="#线程模型（三）" class="headerlink" title="线程模型（三）"></a>线程模型（三）</h2><p>引入 <strong>消息队列</strong> 接收其它线程发送过来的任务。</p><img src="http://www.plantuml.com/plantuml/svg/AyaioKbLUBPZqxFvar_id_ryHJTNSc9HYiAJ7RkVxzeFv2ea5Yla9cRcXMGKfIQcS45aFVqHafx-42c5QYu51GC5FJqxX78hXHTRMvxjcl2qQy6BlNkVhkjvrZ7XoQxk9xkt0TKQegjzkMV1imNjpvjsFctV3LTbXAxgQUksf-kQeVArN000"><p>使用消息队列管理IO线程传递的任务，队列先进行出，任务添加在队列尾部，从头部取出</p><img src="http://www.plantuml.com/plantuml/svg/TP0_Jy906CRtVeetTT71Ha0IAu75EB38ucOSphP0GxaZnpaOm-2_WC10ug290p3fX8c91Ac4BzCxohVm2aWXmUtoFh_dUP_tcCqS2yJWKxIV_F7hvBsXb0isBY6AYc2GOebW2pEuLW0ka578KNA9pIFY40fRSLtN3tIbikAWbi4Gpid8ZOvOJDVtuzAXXA3g3Tp9S2mtgpEJOsKPC0BKpkKPc7P0sWG7SK4IebSmnm6LeSmGPSVObAf1CAF40JLBw7OYiICUt_nkqtDTNk-g0Ri0Lj1aCWoGdS9pHRycRZwcBsrUUvwLMlcAUM9KZYkRXCX_maamF9k_DKqx3pR-MNPtKyjwYe6e2UbCU6GwSvgd5Z9dJVP0qrABn4Fml-x5iCNh7NyquhscgBMyOSDp-nACh87JduxeL2UttxpgBf7e6i8V-hntjn0hlm00"><p>其它线程想要发送任务让主线程执行，只需要将任务添加到消息队列中就可以了。由于多个线程操作同一个消息队列，所以在添加任务和取出任务时还会加一个同步锁。</p><h2 id="线程模型（四）——-处理其它进程发送过来的任务"><a href="#线程模型（四）——-处理其它进程发送过来的任务" class="headerlink" title="线程模型（四）—— 处理其它进程发送过来的任务"></a>线程模型（四）—— 处理其它进程发送过来的任务</h2><p>如果其它线程想要发送任务给页面主线程，那么需要先通过 IPC 把任务发送给渲染进程的 IO 线程，IO 线程再把任务发送给页面主线程。</p><img src="http://www.plantuml.com/plantuml/svg/TP8_Jy906CRtVeetkEXW8o29XS1275Z4mOqmd6s11kYHunoCOV1VG20Huw164s222HCJ2589NuPUoxUmfVmf1hVB-_oUvvxtSbIXEHdOy8irdyt9kz6jSSMieXOGGNaGSRw0LLcbSCK1d2CncoRuGfMYE8S9x0G4GJWIk9BBGMIH8ZLjHMvr-Fs2S1Ym7DmQz4o7cZ6QM3TxvgQSdA90CH0bdQ4WAJQfODMEivCGkGG71rI48aM47gkIfOfOfGJdm9F2P3SKscCF7RDTdsgQNcrxR7O1kD1mU1rWTLglomOLTlqvUstgbPTvATTJE8a-QrpQ9dZ_4qxiOS8vypoVj6zSMlRt8wjwd8Y81B7uUibO_2n3P2JDcnm0pqSMYK4m-tTirD2hBNCyrdjrLcbCHxMfDh10xmOu-scnLjcu-TRBsWhnRI3w_K3ltIv4grp263yPseVpAv9SWlKVpKv5V-ik9vmRcE-mR1g4s6bqIpdkJyOMaxleBm00"><p>渲染进程专门有一个IO线程用来接收其它线程传进来的消息，IO线程会将这些消息组装成任务发送给渲染主线程</p><h2 id="消息队列中的任务类型"><a href="#消息队列中的任务类型" class="headerlink" title="消息队列中的任务类型"></a>消息队列中的任务类型</h2><p>输入事件（鼠标事件）、微任务、文件读写、WebSocket、javaScript定时器等<br>消息队列中还包含了很多与页面相关的事件，如：javaScript 执行、解析 DOM、样式计算、布局计算、css 动画等</p><blockquote><p>以上事件是在主线程中执行的，所以在编写 web 应用程序时，需要衡量这些事件所占用的时长、并解决单个任务占用主线程过久的问题。</p></blockquote><h2 id="主线程如何安全退出"><a href="#主线程如何安全退出" class="headerlink" title="主线程如何安全退出"></a>主线程如何安全退出</h2><p>chrome 确定退出当前页面时，页面主线程会设置一个退出标志的变量，在每次执行完一个任务时，判断是否设置退出标志。如果有，直接中断所有任务，退出线程。</p><h2 id="页面中使用单线程的缺点——微任务解决效率和实时性问题"><a href="#页面中使用单线程的缺点——微任务解决效率和实时性问题" class="headerlink" title="页面中使用单线程的缺点——微任务解决效率和实时性问题"></a>页面中使用单线程的缺点——微任务解决效率和实时性问题</h2><ol><li>如何处理高优先级的任务<br>在处理监听 DOM 节点变化，根据这些变化处理相应的业务逻辑场景中。通常是采用观察者模式（利用 javaScript 设计监听接口，当变化发生时，渲染引擎同步调用这些接口）<br>问题在于，DOM 变化非常频繁，每次变化都调用直接调用相应 javaScript 接口，那么当前任务执行时间拉长，导致执行效率下降。<br>如果将 DOM 变化做成异步消息事件，添加到消息队列尾部，又会影响到监控的实时性。<h3 id="微任务用来权衡实时性与效率，微任务如何权衡效率与实时性的"><a href="#微任务用来权衡实时性与效率，微任务如何权衡效率与实时性的" class="headerlink" title="微任务用来权衡实时性与效率，微任务如何权衡效率与实时性的"></a>微任务用来权衡实时性与效率，微任务如何权衡效率与实时性的</h3><blockquote><p>消息队列中的任务称为宏任务，每个宏任务中都包含一个微任务队列。</p></blockquote></li></ol><p>在执行宏任务中，DOM 有变化，那么就会将变化添加到微任务列表中，这样就不会影响到宏任务的执行。解决了执行效率问题。<br>当前宏任务执行完成，执行当前宏任务的微任务（DOM 变化的事件都保存在微任务列表中），从而解决了实时性的问题。</p><ol start="2"><li>如何解决单个任务执行过久的问题<br>javaScript 通过回调功能解决单个任务执行过久，造成后面任务等待时间太长，给用户卡顿的感觉。</li></ol><h2 id="浏览器如何运行的"><a href="#浏览器如何运行的" class="headerlink" title="浏览器如何运行的"></a>浏览器如何运行的</h2><p>开发者工具 –&gt; performance 标签 –&gt; 右上角 start porfiling and load page</p>]]></content>
      
      
      
        <tags>
            
            <tag> browser </tag>
            
            <tag> 浏览器工作原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器工作原理——浏览器中的 setTimeout和XMLHttpRequest 是怎么实现的</title>
      <link href="2021/01/08/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94setTimeout%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84/"/>
      <url>2021/01/08/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94setTimeout%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84/</url>
      
        <content type="html"><![CDATA[<h2 id="浏览器中的-setTimeout-是怎么实现的"><a href="#浏览器中的-setTimeout-是怎么实现的" class="headerlink" title="浏览器中的 setTimeout 是怎么实现的"></a>浏览器中的 setTimeout 是怎么实现的</h2><p>浏览器页面是由消息队列和事件循环系统来驱动的。<br>渲染进程中所有运行在主线程上的任务都需要先添加到消息队列中，事件循环系统再按照顺序执行消息队列中的任务。如下：</p><ul><li>接收到 html 文档数据时，渲染引擎会将 <code>解析 DOM 事件</code> 添加到消息队列；</li><li>用户改变窗口大小时，渲染引擎会将 <code>重新布局</code> 事件添加到消息队列中；</li><li>触发 JavaScript 垃圾回收机制时，渲染引擎会将 <code>垃圾回收任务</code> 添加到消息队列；</li><li>执行一段异步 JavaScript 代码时，也会将<code>执行任务</code>添加到消息队列</li></ul><a id="more"></a><p>setTimeout 定时器，用来指定回调函数参数多少毫秒后执行。返回一个整数，作为定时器编号。同时可以通过这个编号取消定时器。<br><code>** setTimeout 需要在指定时间执行回调函数，而消息队列中任务是按顺序先进先出。Chrome 的解决办法是维护了另外一个需要延迟的执行任务的消息队列。这个消息队列中包括了定时器和 Chromium 内部一些需要延迟的任务 **</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// chrominum 中延迟代码的定义</span><br><span class="line">DelayedIncomingQueue delayed_incoming_queue;</span><br></pre></td></tr></table></figure><blockquote><p>模拟代码 —— 创建回调任务，并添加至延迟队列中<br>创建回调任务 delayTask<br>回调函数、发起时间、延迟时间</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">struct DelayTask &#123;</span><br><span class="line">  int64 id;</span><br><span class="line">  CallBackFunction cbf;</span><br><span class="line">  int start_time; // 发起时间</span><br><span class="line">  int delay_time; // 迟延时间</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DelayTask timerTask;</span><br><span class="line">timerTask.cbf = showName;</span><br><span class="line">timerTask.start_time = getCurrentTime(); // 获取当前时间</span><br><span class="line">timerTask.delay_time = 200;  // 设置延迟时间</span><br><span class="line"></span><br><span class="line">// 将任务添加到延迟执行队列中</span><br><span class="line">delay_incoming_queue.push(timerTask)</span><br></pre></td></tr></table></figure><p>如上通过定时器发起的任务就添加至了延迟队列，那么事件循环系统如何触发延迟队列？</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">void ProcessDelayTask() &#123;</span><br><span class="line">  // 从 delay_incoming_queue 中取出到期的任务</span><br><span class="line">  // 今次执行任务</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 主线程从任务队列中读取任务</span><br><span class="line">TaskQueue task_queue;</span><br><span class="line">void ProcessTask();</span><br><span class="line">bool keep_running = true;</span><br><span class="line">void MainThread() &#123;</span><br><span class="line">  for(;;)&#123;</span><br><span class="line">    Task task = task_queue.takeTask(); // 队列中取出任务</span><br><span class="line">    processTask(task); //执行任务</span><br><span class="line"></span><br><span class="line">    ProcessDelayTask(); // 执行延迟队列中的任务</span><br><span class="line"></span><br><span class="line">    if (!keep_running) break; // 如果设置了退出标志，直接退出线程循环</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ProcessDelayTask 函数根据发起时间和延迟时间计算出到期任务，然后依次执行这些任务。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 清除定时器</span></span><br><span class="line">clearTimeout(timer_id)</span><br></pre></td></tr></table></figure><p>取消定时器浏览器实现方式是从 delayed_incoming_queue 延迟队列中，通过 ID 查找对应任务，然后删除。</p><h3 id="使用-setTimeout-的注意事项"><a href="#使用-setTimeout-的注意事项" class="headerlink" title="使用 setTimeout 的注意事项"></a>使用 setTimeout 的注意事项</h3><ol><li>如果当前任务执行时间过久，会影响定时器任务的执行<br>很多因素会导致回调函数执行比设定的预期值要久<br>当前任务执行时间过久从而导致定时器设置的任务被延后执行<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) <span class="title">console</span>.<span class="title">log</span>(<span class="params"><span class="string">'bar'</span></span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  setTimeout(bar, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;<span class="number">5000</span>; i++) <span class="built_in">console</span>.log(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo();</span><br></pre></td></tr></table></figure></li></ol><p>执行 foo 函数所消耗的时长是 500 毫秒，这也就意味着通过 setTimeout 设置的任务会被推迟到 500 毫秒以后再去执行，而设置 setTimeout 的回调延迟时间是 0。</p><ol start="2"><li>如果 setTimeout 存在嵌套调用，那么系统会设置最短时间间隔为 4 毫秒<br>也就是说在定时器函数里面嵌套调用定时器，也会延长定时器的执行时间<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cb</span>(<span class="params"></span>) </span>&#123;setTimeout(cb, <span class="number">0</span>);&#125;</span><br><span class="line">setTimeout(cb, <span class="number">0</span>)</span><br></pre></td></tr></table></figure></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">static const int kMaxTimerNestingLevel = 5;</span><br><span class="line">static constexpr base::TimeDelta kMinimumInterval = base::TimeDelta::FromMilliseconds(4);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">base::TimeDelta interval_milliseconds =</span><br><span class="line">      std::max(base::TimeDelta::FromMilliseconds(1), interval);</span><br><span class="line"></span><br><span class="line">  if (interval_milliseconds &lt; kMinimumInterval &amp;&amp;</span><br><span class="line">      nesting_level_ &gt;= kMaxTimerNestingLevel)</span><br><span class="line">    interval_milliseconds = kMinimumInterval;</span><br><span class="line"></span><br><span class="line">  if (single_shot)</span><br><span class="line">    StartOneShot(interval_milliseconds, FROM_HERE);</span><br><span class="line">  else</span><br><span class="line">    StartRepeating(interval_milliseconds, FROM_HERE);</span><br></pre></td></tr></table></figure><p>定时器被嵌套调用 5 次以上，系统会判断该函数方法被阻塞了，如果定时器的调用时间间隔小于 4 毫秒，那么浏览器会将每次调用的时间间隔设置为 4 毫秒.所以，一些实时性较高的需求就不太适合使用 setTimeout 了</p><ol start="3"><li><p>未激活的页面，setTimeout 执行最小间隔是 1000 毫秒<br>未被激活的页面中定时器最小值大于 1000 毫秒，也就是说，如果标签不是当前的激活标签，那么定时器最小的时间间隔是 1000 毫秒，目的是为了优化后台页面的加载损耗以及降低耗电量</p></li><li><p>延时执行时间有最大值<br>Chrome、Safari、Firefox 都是以 32 个 bit 来存储延时值的，32bit 最大只能存放的数字是 2147483647 毫秒，这就意味着，如果 setTimeout 设置的延迟值大于 2                                                                         147483647 毫秒（大约 24.8 天）时就会溢出，那么相当于延时值被设置为 0 了，这导致定时器会被立即执行。如果将延时值修改为小于 2147483647 毫秒的某个值，那么执行时就没有问题了。</p></li><li><p>使用 setTimeout 设置的回调函数中的 this 不符合直觉</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name= <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> MyObj = &#123;</span><br><span class="line">  name: <span class="number">2</span>,</span><br><span class="line">  showName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="keyword">this</span>.name); &#125;</span><br><span class="line">&#125;</span><br><span class="line">setTimeout(MyObj.showName,<span class="number">1000</span>)</span><br></pre></td></tr></table></figure></li></ol><p>这段代码在编译的时候，执行上下文中的 this 会被设置为全局 window，如果是严格模式，会被设置为 undefined。</p><h2 id="浏览器中的-XMLHttpRequest-是怎么实现的"><a href="#浏览器中的-XMLHttpRequest-是怎么实现的" class="headerlink" title="浏览器中的 XMLHttpRequest 是怎么实现的"></a>浏览器中的 XMLHttpRequest 是怎么实现的</h2><p>XMLHttpRequest 提供了从 Web 服务器获取数据的能力，如果你想要更新某条数据，只需要通过 XMLHttpRequest 请求服务器提供的接口，便可以获取到服务器的数据，然后操作 DOM 更新页面内容，整个过程只需要更新见面的一部分就可以了，不用刷新整个页面，这样既有效率又不会打扰用户。</p><h3 id="同步回调、异步调用"><a href="#同步回调、异步调用" class="headerlink" title="同步回调、异步调用"></a>同步回调、异步调用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> callback = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'this is a callback function'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doWork</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'start do work'</span>)</span><br><span class="line">  cb()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'end do work'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">doWork(callback)</span><br></pre></td></tr></table></figure><p>如上，将函数 callback 作为参数传递给函数 doWork，那么作为参数的函数 callback 就是 <strong>回调函数</strong>。<br>如上，回调函数 callback 是在主函数 doWork 返回之前执行的，这个回调过程称为 <strong>同步回调</strong>。</p><h3 id="异步回调"><a href="#异步回调" class="headerlink" title="异步回调"></a>异步回调</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> callback = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'fingers crossed'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doWork</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'to do homework'</span>)</span><br><span class="line">  setTimeout(cb, <span class="number">1000</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'end do homework'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">doWork(callback)</span><br></pre></td></tr></table></figure><p>如上，doWork 函数中使用了 setTimeout 函数让 cb 在主函数 doWork 执行完后延迟 1 秒执行。callback 没有在函数内部调用。回调函数在主函数外部执行的过程称为 <strong>异步回调</strong></p><h3 id="系统调用栈"><a href="#系统调用栈" class="headerlink" title="系统调用栈"></a>系统调用栈</h3><p>消息队列与主线程循环机制保证了页面有条不紊地运行<br>当循环系统在执行一个任务的时候，都要为这个任务维护一个 <strong>系统调用栈</strong><br>系统调用栈的信息可以通过 <code>chrome://tracing/</code> 抓取<br>也可以通过 Performance 来抓取它的核心调用信息。<br><a href="https://static001.geekbang.org/resource/image/d3/77/d3d66afb1a103103e5c3f86c823efb77.png" target="_blank" rel="noopener">img</a></p><h2 id="XMLHttpRequest-运作机制"><a href="#XMLHttpRequest-运作机制" class="headerlink" title="XMLHttpRequest 运作机制"></a>XMLHttpRequest 运作机制</h2><img src="http://www.plantuml.com/plantuml/svg/RL9DJrD15DtFhxWfctR1IrYsH3ScZIGGyMDXqh1ulZVzY31JvqsjXZInYjg0H0p4Bnh0kEcEQYAGLksVOUOzLlu5xymyj50MxoLppxdtddDoIS1NwfnH9a6VVDVxsybeD-vjW1-1e2oaOb7mW4OHJ1MBHLWb084lmfHxUZAC1wCBz0M_nivR31lvd4d1bo5JvY8xEvlB679GjfXXtwiAweSmFNtTLLluFMhG1WLzrD7jmxEF-whpmJIju52_GczRq0qldGw7QlqBMx8lnYK5KQjK9V0of9150FGnlWvSpPPGhk6d6iz3o3Y6vtcPIuW3PjpULYhKXZ5towL0i92oh9s9H0gWthvNhmUfYXOXfVZNktZOTQ4l6PECoYON3__57kRpnFgIl6vSJU1-Y6kNgOGdLG7N46_2_ONvcrBMxr3CCPBP718Gz3WpIJ-Df2zfKFLPXIA_t621h76MpS4gkZQcF2zjYD00TkFVHajAJVf0TpTHk_hKisgnS9UAnxM0mbG-7n8oUGKcYOkY2tEBDyWb7uRrVrW1aiDZ_UrvycDD3xR8s9Ohfe7QtbI3dPHxnTpq40g0UxFZWQl-gsIqetRtuizhyVgHVjPM_NRozQNkRBcUFp_VkBjHtTxuDQh-xxCNlTnV"><p>** XMLHttpRequest 的用法 ** 使用 XMLHttpRequest 来请求数据</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getWebData</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 新建 XMLHttpRequest 请求对象</span></span><br><span class="line">  <span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 注册相关事件回调函数</span></span><br><span class="line">  <span class="comment">// onreadystatechange 监控请求过程中的状态</span></span><br><span class="line">  xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (xhr.readyState) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'请求初始化'</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'OPENED'</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'HEADERS_RECEIVED'</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'LOADING'</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.state == <span class="number">200</span> || <span class="keyword">this</span>.state == <span class="number">304</span>) <span class="built_in">console</span>.log(<span class="keyword">this</span>.responseText);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'DONE'</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 注册回调函数 ontimeout 用来监控后台请求是否超时</span></span><br><span class="line">  xhr.ontimeout = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;<span class="built_in">console</span>.log(<span class="string">'ontimeout'</span>)&#125;</span><br><span class="line">  xhr.onerror = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;<span class="built_in">console</span>.log(<span class="string">'onerror'</span>)&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 打开请求</span></span><br><span class="line">  xhr.open(<span class="string">'Get'</span>, URL, <span class="literal">true</span>) <span class="comment">// 创建一个 Get 请求，异步</span></span><br><span class="line">  xhr.timeout = <span class="number">3000</span> <span class="comment">// 3000 毫秒后还没有响应则判断为请求失败</span></span><br><span class="line">  xhr.responseText = <span class="string">"text"</span> <span class="comment">// 配置服务器返回的格式，将服务器数据转换为自己想要的格式，这里为 utf-16 的字符串</span></span><br><span class="line">  xhr.setRequestHeader(<span class="string">"X_TEST"</span>,<span class="string">'helen_tests'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 发送请求</span></span><br><span class="line">  xhr.send();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>创建 XMLHttpRequest 对象，来执行实际的网络请求操作 <code>let xhr = new XMLHttpRequest()</code></li><li>为 xhr 对象注册回调函数<br>后台执行任务可以通过回调函数来告诉执行结果<br>XMLHttpRequest 的回调函数主要有以下几种：<ul><li>ontimeout 监控超时请求，如果后台请求超时了，调用该函数</li><li>onerror 监控出错信息，如果后台请求出错，调用该函数</li><li>onreadystatechange 监控后台请求过程中的状态。如：监控 http 头加载完成的信息、http 响应体消息、数据加载完成消息等。</li></ul></li><li>配置基本的请求信息<br><code>xhr.open</code> 配置基础的请求信息，包括：请求地址、请求方法、请求方式<br>配置其它可选信息 xhr.timeout = 3000 配置超时信息<br>其它可选配置信息 xhr.responseText = “text” 下表为返回数据类型<table><thead><tr><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>“”</td><td>将 responseText 设置为空字符串，默认类型 UTF-16 字符串</td></tr><tr><td>“text”</td><td>返回 UTF-16字符串文本</td></tr><tr><td>“json”</td><td>response 是一个 JavaScript 对象</td></tr><tr><td>“document”</td><td>response 是一个 DOM 对象</td></tr><tr><td>“blob”</td><td>response 是一个包含二进制数据的 Blob 对象</td></tr><tr><td>“arraybuffer”</td><td>response 是一个包含二进制数据的 JavaScript ArrayBuffer</td></tr><tr><td>如果 xhr.responseText = json 那么系统会自动将服务器返回的数据转换为 JavaScript 对象格式</td><td></td></tr><tr><td>其它可选配置 xhr.setRequestHeader 来添加自己专用的请求头属性</td><td></td></tr></tbody></table></li><li>发起请求<br>经过 2、3 步，一切准备就绪后 xhr.send() 发起请求<br>渲染进程会将请求发送给网络进程，然后网络进程负责资源下载，等网络进程接收到数据之后，就会利用 IPC 来通知渲染进程；渲染进程接收到消息之后，会将 xhr 的回调函数封装成任务并添加到消息队列中，等主线程循环系统执行到该任务的时候，会根据相关状态调用回调函数。<ul><li>网络请求超时：xhr.ontimeout</li><li>请求出错：xhr.onerror</li><li>正常接收： xhr.onreadystatechange 返馈相应状态</li></ul></li></ol><h3 id="XMLHttpRequest-使用过程中的“坑”"><a href="#XMLHttpRequest-使用过程中的“坑”" class="headerlink" title="XMLHttpRequest 使用过程中的“坑”"></a>XMLHttpRequest 使用过程中的“坑”</h3><ol><li>跨域问题<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest(); <span class="comment">//  1.  新建 XMLHttpRequest 网络请求对象</span></span><br><span class="line"><span class="keyword">var</span> url = <span class="string">'http://img-ads.csdn.net/2018/201811150919211586.jpg '</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理请求过程中的状态(onreadystatechange 监控后台请求过程中的状态)</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handler</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (xhr.readyState) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'请求初始化'</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'OPENED'</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'HEADERS_RECEIVED'</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'LOADING'</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">this</span>.state === <span class="number">200</span> || <span class="keyword">this</span>.state === <span class="number">304</span>) <span class="built_in">console</span>.log(<span class="keyword">this</span>.responseText);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'DONE'</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callOtherDomain</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (xhr) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 2. 注册相关回调</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    xhr.onreadystatechange = handler</span><br><span class="line">    xhr.ontimeout = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;<span class="built_in">console</span>.log(<span class="string">'request timeout'</span>)&#125;</span><br><span class="line">    xhr.onerror = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;<span class="built_in">console</span>.log(<span class="string">'error'</span>)&#125;</span><br><span class="line">    <span class="comment">// 3. 配置基础请求信息</span></span><br><span class="line">    xhr.open(<span class="string">'GET'</span>, url, <span class="literal">true</span>)</span><br><span class="line">    xhr.timeout = <span class="number">3000</span></span><br><span class="line">    xhr.responseText = <span class="string">'json'</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 发送请求</span></span><br><span class="line">    xhr.send()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">callOtherDomain()</span><br></pre></td></tr></table></figure></li></ol><blockquote><p>Access to XMLHttpRequest at ‘<a href="https://time.geekbang.org/&#39;" target="_blank" rel="noopener">https://time.geekbang.org/&#39;</a> from origin ‘<a href="http://localhost:4000&#39;" target="_blank" rel="noopener">http://localhost:4000&#39;</a> has been blocked by CORS policy: No ‘Access-Control-Allow-Origin’ header is present on the requested resource.<br>由于跨域导致访问失败</p></blockquote><ol start="2"><li>HTTPS 混合内容的问题<br>HTTPS 混合内容是 HTTPS 页面中包含了不符合 HTTPS 安全要求的内容，比如包含了 HTTP 资源，通过 HTTP 加载的图像、视频、样式表、脚本等，都属于混合内容。<blockquote><p>Mixed Content: The page at ‘<a href="https://www.ximalaya.com/waiyu/18797993/243864198&#39;" target="_blank" rel="noopener">https://www.ximalaya.com/waiyu/18797993/243864198&#39;</a> was loaded over HTTPS, but requested an insecure XMLHttpRequest endpoint ‘<a href="http://img-ads.csdn.net/2018/201811150919211586.jpg&#39;" target="_blank" rel="noopener">http://img-ads.csdn.net/2018/201811150919211586.jpg&#39;</a>. This request has been blocked; the content must be served over HTTPS.<br>通过 HTML 文件加载的混合资源，虽然给出警告，但大部分类型还是能加载的。而使用 XMLHttpRequest 请求时，浏览器认为这种请求可能是攻击者发起的，会阻止此类危险的请求。</p></blockquote></li></ol><p>XMLHttpRequest 发起请求，是由浏览器的其他进程或者线程去执行，然后再将执行结果利用 IPC 的方式通知渲染进程，之后渲染进程再将对应的消息添加到消息队列中</p>]]></content>
      
      
      
        <tags>
            
            <tag> browser </tag>
            
            <tag> 浏览器工作原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器工作原理——JavaScript数据存储</title>
      <link href="2020/12/10/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94Javascript%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/"/>
      <url>2020/12/10/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94Javascript%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/</url>
      
        <content type="html"><![CDATA[<p>JavaScript 内存机制</p><ul><li><input disabled type="checkbox"> JavaScript 内存中的存储</li><li><input disabled type="checkbox"> 处理垃圾回收</li><li><input disabled type="checkbox"> v8 中执行</li></ul><h2 id="1-JavaScript-是什么类型的语言"><a href="#1-JavaScript-是什么类型的语言" class="headerlink" title="1. JavaScript 是什么类型的语言"></a>1. JavaScript 是什么类型的语言</h2><p><strong>静态语言</strong> 在使用之前就需要确认其变量数据类型。如 C 语言<br><strong>动态语言</strong> 在运行过程中需要检查数据类型的语言。如 JavaScript<br><strong>弱类型语言</strong> 运行过程中支持隐式转换的语言。C 和 JavaScript 都支持隐式转换，都是弱类型语言<br><strong>强类型语言</strong> 运行过程中不支持隐式转换的语言。如 Ruby<br>【具体可参考以下象限图】<br><img src="https://static001.geekbang.org/resource/image/36/f0/36f0f5bdce0a6d8c36cbb8a76931cff0.png" alt="img"></p><a id="more"></a><h2 id="2-JavaScript-7-种数据类型"><a href="#2-JavaScript-7-种数据类型" class="headerlink" title="2. JavaScript 7 种数据类型"></a>2. JavaScript 7 种数据类型</h2><blockquote><p>JavaScript 是弱类型动态语言，不需要在使用前定义变量类型，运行过程中同一变量可以存不同数据类型</p></blockquote><table><thead><tr><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>Number</td><td>可以是整数或带小数点的浮点数，采用 IEEE 754 双精确度（64 位）格式存储，计算浮点数时，需要注意 0.1+0.2=0.30000000000000004</td></tr><tr><td>String</td><td>0或0个以上字符由，’’或””包裹。原字符串不是对象类型，为方便使用，JavaScript引擎会自动转成对象类型，有 length 属性</td></tr><tr><td>Boolean</td><td>任何类型都会转成布尔类型，false,0,’’,NaN, null, undefined 转换为 false; 其它转换为 true。</td></tr><tr><td>Undefined</td><td>变量未声明或声明未赋值 typeof a === ‘undefined’(a 是不存在的变量)</td></tr><tr><td>Null</td><td>空值，清除某个值时可赋值为 null</td></tr><tr><td>Object</td><td>Function,Array,Date 等，都为对象类型。JavaScript 中的对象可以看作是属性的集合</td></tr><tr><td>Symbol</td><td>符号类型，是唯一的并且不可修改，常作为 Object 的 key。通过 Symbol() 函数产生</td></tr></tbody></table><p>几点注意事项：</p><ul><li>typeof Null 返回 Object，这个是 JavaScript bug，为兼容老代码一直未修复；</li><li>isNaN(Number(‘hello’)) // true 检查无意义的运算，NaN 无效的数字。</li><li>非严格模式下，null === undefined 是 true，严格模式下 false。</li><li>isFinite(2/0) 检查是 2/0 否为有限数</li><li>Object 是引用类型，其它为原始类型。</li></ul><h2 id="3-内存空间"><a href="#3-内存空间" class="headerlink" title="3. 内存空间"></a>3. 内存空间</h2><p>JavaScript 执行过程中，主要有三种内存空间，分别是代码空间、栈空间、堆空间。</p><img src="http://www.plantuml.com/plantuml/svg/IquiIb5usjRwTEsCPoiMFftNhQ2SbfQc4CrbasHdavoVarzabPHJcchtPFVYvmiQdw_SzNBwbaSDKu3eQV_wPvtBNopiWKZPw8DLszde9zbnwG81aWdfHQcfUNRF5dH0zB_Vq_5YG_FpAIk08k_tT4ACKm2wu6dJ2gYHExgUxEX-DgqTdwb5gIbsJnUqGSn4KHWB0000"><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">var</span> b = <span class="string">'memory space'</span>;</span><br><span class="line">  <span class="keyword">var</span> c = &#123;<span class="attr">name</span>: <span class="string">'helen'</span>&#125;</span><br><span class="line">  <span class="keyword">var</span> d = c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="http://www.plantuml.com/plantuml/svg/oqqiKCX81HBLN0fF-sUyREz_Eg5NmTOEncdOmwLWQ6XW21JYKj3JqmFJG04Ja9hglCJSL2i5zOpKdDGyzLgkMYwkufB4v6o55nkQdqzPyMn11yXOXUJ4eXG5fRJyV8MdxNkVJTtmh7FvYuKzJtPqFTdH_MnQkvA2ifbP6bYbWa8kq2b0bH3Rd_UjVxgeMK4vBGqchO3JaM2G218qX7AIG9pSrDpyeag5ueB4v5IeUBA2bguTsDDm0P0ke9-W_1Hq1Iae2e2-H7BfY_MzppPF9T6bjLmG30cPfwqhdcvi81GgE8C4NuYabUObbsJcvu5S2fA6yJKq5Qg1iLaBTmt43foU8S8lwB6c6wrSKfIO1mpvejIyabXTEnGVSDK20000"><p>**<br>对象类型是存储在 heap，stack 中保存对象引用地址，JavaScript 通过栈中的引用地址访问。</p><blockquote><p>原始类型保存的栈中，对象类型保存在堆中。堆中只保存对象类型的引用地址，JavaScript引擎通过栈的引用地址进行访问</p></blockquote><p>JavaScript 引擎是需要用栈来维护程序执行期间上下文的状态，如果栈空间太大，所有的数据都存放在栈里，会影响上下文的切换效率，进而影响到整个程序的执行效率。<br>如上 demo，foo 函数结束后，foo 函数执行上下文会被回收，指针移动到全局执行上下文。<br>所以通常情况下 <strong>栈如果设置过大，会影响切换效率，所以栈是用存放一些原始类型的小数据</strong>，引用类型数据占用空间较大，故这类数据会存在在堆中，<strong>堆空间大，存放数据多。但分配内存和回收内存占时间长</strong><br>JavaScript 中，<code>原始类型的赋值会完全复制变量的值，而引用类型的赋值是复制引用地址</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">'helen'</span></span><br><span class="line">  <span class="keyword">let</span> test1 = <span class="number">1</span></span><br><span class="line">  <span class="keyword">let</span> test2 = <span class="number">2</span></span><br><span class="line">  <span class="keyword">var</span> innerBar = &#123;</span><br><span class="line">    setName: <span class="function"><span class="keyword">function</span>(<span class="params">newName</span>) </span>&#123;</span><br><span class="line">      name = newName</span><br><span class="line">    &#125;,</span><br><span class="line">    getName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(test1)</span><br><span class="line">      <span class="keyword">return</span> name</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> innerBar</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = foo()</span><br><span class="line">bar.setName(<span class="string">'zhang'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(bar.getName())</span><br></pre></td></tr></table></figure><ol><li>当 JavaScript 引擎执行 foo 函数时，会先编译，创建空执行上下文；</li><li>编译内部函数 setName 时，由于内部函数引用外部函数变量，于是堆内存空间创建一个 “closure(foo)” 保存变量 name;</li><li>编译内部函数 getName 时，函数内部引用了外部函数变量 test1，于堆内存中的 “closure(foo)” 保存变量 test1</li><li>foo 函数执行结束后，返回的 getName, setName 与 closure(foo) 存在引用关系。<blockquote><p>产生闭包的核心有两步：一是需要预扫描内部函数；二是把内部函数引用 的外部变量保存在堆内存中</p></blockquote></li></ol><p>JavaScript 中变量没有数据类型，只有值有数据类型</p><h2 id="4-垃圾回收"><a href="#4-垃圾回收" class="headerlink" title="4. 垃圾回收"></a>4. 垃圾回收</h2><h3 id="4-1-垃圾回收策略-——-手动回收"><a href="#4-1-垃圾回收策略-——-手动回收" class="headerlink" title="4-1. 垃圾回收策略 —— 手动回收"></a>4-1. 垃圾回收策略 —— <strong>手动回收</strong></h3><p>C/C++ 是使用手动回收策略，何时分配内存、何时销毁内存都是由代码控制</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在堆中分配内存</span></span><br><span class="line"><span class="keyword">char</span>* p = (<span class="keyword">char</span>*)<span class="built_in">malloc</span>(<span class="number">2048</span>);  <span class="comment">//在堆空间中分配2048字节的空间，并将分配后的引用地址保存到p中</span></span><br><span class="line"><span class="comment">//使用p指向的内存</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//....</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用结束后，销毁这段内存</span></span><br><span class="line"><span class="built_in">free</span>(p)；</span><br><span class="line">p = <span class="literal">NULL</span>；</span><br></pre></td></tr></table></figure><p>C 语言，使用 malloc 函数分配内存，然后再使用。如果不再需要这块数据，使用 free 函数来释放内存。如果这段数据不再需要，又没有主动调用 free 函数销毁，就会发生 <strong>内存泄漏</strong></p><h3 id="4-2-垃圾回收策略-——-自动回收"><a href="#4-2-垃圾回收策略-——-自动回收" class="headerlink" title="4-2. 垃圾回收策略 —— 自动回收"></a>4-2. 垃圾回收策略 —— <strong>自动回收</strong></h3><p>Java、JavaScript、Python 等语言，产生的垃圾数据是由垃圾回收器来释放的，不需要手动释放。</p><h3 id="4-2-1-调用栈中的数据是如何回收的"><a href="#4-2-1-调用栈中的数据是如何回收的" class="headerlink" title="4-2-1. 调用栈中的数据是如何回收的"></a>4-2-1. 调用栈中的数据是如何回收的</h3><h2 id="编译器和解释器"><a href="#编译器和解释器" class="headerlink" title="编译器和解释器"></a>编译器和解释器</h2><p>执行程序前，需要将代码翻译成机器能的语言。根据语言的执行流程，可分为编译型语言和解释型语言。<br><strong>编译型语言</strong> 在程序执行之前，需要经过编译器编译的过程，并且编译之后会直接保留机器能懂的二进制文件，这样每次运行程序时，都可以直接运行该二进制文件，这样每次运行程序时，都可以直接运行该二进制文件，而不需要每次重新编译。</p><pre class="mermaid">  graph LR;  源代码 -->|词法分析<br>语法分析| 抽象语法树AST;  抽象语法树AST -->|词义分析| 中间代码;  中间代码 -->|代码优化| 二进制文件;  二进制文件 -->|直接执行|执行</pre><p><strong>解释型语言</strong> 在每次运行时都要通过解释器对程序进行动态解释和执行</p><pre class="mermaid">  graph LR;  源代码 -->|词法分析<br>语法分析| 抽象语法树AST;  抽象语法树AST -->|词义分析| 字节码;  字节码 -->|解释执行| 执行;</pre><h2 id="JavaScript-是属于解释型语言，-V8-是如何执行一段-JavaScript-代码的？"><a href="#JavaScript-是属于解释型语言，-V8-是如何执行一段-JavaScript-代码的？" class="headerlink" title="JavaScript 是属于解释型语言， V8 是如何执行一段 JavaScript 代码的？"></a>JavaScript 是属于解释型语言， V8 是如何执行一段 JavaScript 代码的？</h2><pre class="mermaid">  graph LR;  源代码 --> |语法分析<br>词法分析| 抽象语法树AST  源代码 --> |语法分析<br>词法分析| 执行上下文  抽象语法树AST --> |Ignition 解释器| 字节码  字节码 --> |TurboFan 编译器| 机器码</pre><h3 id="抽象语法树-AST"><a href="#抽象语法树-AST" class="headerlink" title="抽象语法树 AST"></a>抽象语法树 AST</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'helen'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">123</span></span><br><span class="line">&#125;</span><br><span class="line">name = <span class="string">'zhang'</span>;</span><br><span class="line">foo();</span><br></pre></td></tr></table></figure><p>以上代码经过 JavaScript-ast 处理后，生成 ast 结构：</p><img src="http://www.plantuml.com/plantuml/svg/VL1D2y8m3BtlL-IelQbdOVXr5WMl4cVSXcqwqWpKNsyx2og2j-JbVOHN1aLHr_BPOLSOs8gl1LrX31nGMZnPMb5bKL1Rpn7-nRqas1p1tHaTvQKXIuaFcvwhf8MBzwFnuB2mlhhk5PKSiGu2s97smjzWj9bCPybaVUk4GeWsNmoOvxIFu4U3NF_JBD7QzoshudDvGgdxn0r5IR6LLpDF"><h4 id="AST-的使用"><a href="#AST-的使用" class="headerlink" title="AST 的使用"></a>AST 的使用</h4><ol><li>Babel 的工作原理就是先将 ES6 源码转换成 AST，然后再将 ES6 语法的 AST 转换为 ES5 语法的 AST，最后利用 AST 生成 JavaScript 源码。</li><li>用来检查 JavaScript 编写规范的插件 ESLint，检查流程也是需要将源码转换为 AST，然后再利用 AST 来检查代码规范化的问题。</li></ol><h4 id="AST-的生成"><a href="#AST-的生成" class="headerlink" title="AST 的生成"></a>AST 的生成</h4><ol><li>分词（tokenize）又称词法分析。将源码拆解为 token。<br><code>var name = &#39;helen&#39;</code> 拆解为以下四个 token<ul><li>keyword 关键字 var</li><li>name 标识符 identifier</li><li>argument 赋值运算符 =</li><li>literal 字符串 helen</li></ul></li><li>解析（parse）语法分析。将 token 根据语法规则转为 AST。若源码存在语法错误，终止，抛出“语法错误”</li></ol><h3 id="生成字节码"><a href="#生成字节码" class="headerlink" title="生成字节码"></a>生成字节码</h3><p>解释器 ignition 将 AST 生成字节码，并解释执行字节码。<br>早期 v8 没有字节码，是直接将 AST 转换为机器码，机器码执行效率非常高。<br>随着 Chrome 在手机上运行，特别是 512M 内存的手机上，V8 需要消耗大量内存存放转换后的机器码。字节码就是为解决内存问题而生的。<br><strong>字节码是介于 AST 和机器码之间的一种代码。与特定类型的机器码无关，字节码需要通过解释器 ignition 转换为机器码后才能执行</strong></p><h3 id="执行代码"><a href="#执行代码" class="headerlink" title="执行代码"></a>执行代码</h3><p>解释器 ignition 生成字节码，并逐条解释执行字节码。<br>Ignition 执行过程中，如果发现有热点代码（HotSpot）（重复执行多次的代码），那么后台的编译器（TurboFan）会把该段热点的字节码编译为高效的机器码，再次执行这段代码时，只需要执行编译后的机器码。大大提高了执行效率。<br>字节码配合解释器和编译器的技术称为 <strong>即时编译（JIT）</strong> 即，解释器在解释执行代码同时发现热点代码，TurboFan 把热点字节码转换为机器码，并保存转换后的机器码，以便下次使用。</p><h4 id="即时编译（JIT）JavaScript-ignition-TurboFan-工作过程"><a href="#即时编译（JIT）JavaScript-ignition-TurboFan-工作过程" class="headerlink" title="即时编译（JIT）JavaScript + ignition + TurboFan 工作过程"></a>即时编译（JIT）JavaScript + ignition + TurboFan 工作过程</h4><pre class="mermaid"> graph TD; JavaScriptCode -->|tokenize<br>parse| 抽象代码树AST 抽象代码树AST-->|ignition|字节码Bytecode 字节码Bytecode --> HotSpot{hot} HotSpot --> |yes| 编译器TurboFan HotSpot --> |no| 解释器Ignition 编译器TurboFan--> 机器码MachineCode 机器码MachineCode --> 输出结果 解释器Ignition --> |逐条解释执行|输出结果</pre><h2 id="JavaScript-性能优化"><a href="#JavaScript-性能优化" class="headerlink" title="JavaScript 性能优化"></a>JavaScript 性能优化</h2><p>优化中心在单次脚本执行时间和脚本的网络下载上，主要关注三点：</p><ol><li>提升单次脚本的执行速度，避免 JavaScript 的长任务霸占主线程，这样可以使页面快速响应交互；</li><li>避免大的内联脚本，因为解析 HTML 的过程中，解析和编译会占用主线程；</li><li>减少 JavaScript 文件的容量，因为更小的文件会提升下载速度，并且占用更低的内存。</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> browser </tag>
            
            <tag> 浏览器工作原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>虚拟DOM和性能优化</title>
      <link href="2020/12/02/react-%E8%99%9A%E6%8B%9FDOM%E5%92%8C%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
      <url>2020/12/02/react-%E8%99%9A%E6%8B%9FDOM%E5%92%8C%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<p>React 执行效率高的原因在于它的<code>虚拟DOM机制</code></p><h2 id="虚拟-DOM"><a href="#虚拟-DOM" class="headerlink" title="虚拟 DOM"></a>虚拟 DOM</h2><p>前端性能优化的重要一条：<strong>尽量减少对DOM操作</strong><br>DOM 是对结构化广西的抽象表达，web 环境中，DOM 是对 html 文本的抽象描述，每个 html 元素对应一个 DOM 节点，html 元素的层级关系也体现在了 DOM 树上。在 DOM 进行增删改操作，都会引起浏览器对网页的重新布局和重新渲染，这个过程很耗时。<br><strong>软件开发中遇到的所有问题都可以通过增加一层抽象解决</strong> 虚拟 DOM 是 DOM 效率低下的抽象。虚拟 DOM 是用 javascript 描述的DOM 元素。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">'foo'</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  type: <span class="string">'div'</span>,</span><br><span class="line">  props: &#123;</span><br><span class="line">    className: <span class="string">'foo'</span>,</span><br><span class="line">    children: <span class="string">'hello'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="diff-算法"><a href="#diff-算法" class="headerlink" title="diff 算法"></a>diff 算法</h2><p>react 的调合过程（Reconciliation）react 采用声明式的 API 描述 UI 结构，组件状态或属性更新，组件的 react 方法会返回一个新的虚拟 DOM 对象表述新的 ui 结构。 Diff 算法中，比较新的虚拟 DOM 和 旧的虚拟 DOM，再将 diff 的结果更新到真实 DOM 上。<br>React 基于两个假设，降低算法的时间复杂度，进行比较：</p><ol><li>如果两个元素的类型不同，那么它们将生成两个不同的树</li><li>为列表中元素设置 key 属性，key 标识对应元素在多次 render 过程中是否发生变化<br>react 从根结点比较两棵树的差异，根结点不同，两棵树不同，具体如下：<h3 id="当根结点是不同类型时"><a href="#当根结点是不同类型时" class="headerlink" title="当根结点是不同类型时"></a>当根结点是不同类型时</h3>根结点变化，react 会认为新的树和旧的树完全不同，不会继续比较其它属性和子节点，直接拆掉整个树重建。重建后的 DOM 树会整体更新到真实的 DOM 树中。需要操作大量 DOM 更新效率低。<br>虚拟 DOM 结点类型分为两类：</li><li>像 <code>div/p</code> 等 DOM 元素类型；</li><li>react 组件类型，如 react 自定义组件。<br>旧的 react 组件实例在 componentWillUnMount 中调用，新的组件实例在 componentWillMount 和 componentDidMount 中调用。<br>包裹组件的 dom 元素变量，a 组件改变 b 组件，或组件中的元素变化，都是结点类型发生变化。<h3 id="当根结点相同的-DOM-类型时"><a href="#当根结点相同的-DOM-类型时" class="headerlink" title="当根结点相同的 DOM 类型时"></a>当根结点相同的 DOM 类型时</h3>根节点相同，属性不同，react 只更新需拟 DOM 树和真实 DOM 树对应的节点。<h3 id="当根结点是相同组件类型时"><a href="#当根结点是相同组件类型时" class="headerlink" title="当根结点是相同组件类型时"></a>当根结点是相同组件类型时</h3>如果两个根节点是相同类型的组件，对应的组件实例不会被销毁，只会执行更新操作。并且在 componentWillReceiveProps 和 componentWillUpdate 中调用组件，更新变化的属性。<br>比较完根节点，react 会以同样的方式递归比较子节点，当然子节点又是它子节点的根节点。如此递归，走到比较完两棵树上的所有节点，计算出差异更新到 DOM 树。<br>对于列表，react 提供了 key 的属性，key 是为了帮助 react 提高 diff 算法效率的。每次渲染后，只要 key 不变，react 认为是只一节点。如下 code，<code>&lt;li key=&#39;first&#39;&gt;first&lt;/li&gt;</code> 与 <code>&lt;li key=&#39;second&#39;&gt;second&lt;/li&gt;</code> 两个元素 key 值没有变，只是位置变化，react 判断出为新增节点。从而避免了大量渲染。<strong>不要用 index 索引做 key 值，一旦数组开头新增，大量 key 失败，从而引用大量重新渲染</strong><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">'third'</span>&gt;</span>third<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">'first'</span>&gt;</span>first<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">'second'</span>&gt;</span>second<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h2><ol><li><p>使用生产环境版本库<br><code>npm run start</code> 使用的是开发环境版本的 react 库<br><code>npm run build</code> 构建生产环境 react 库，其它第三方也执行生产环境版本构建(生产环境 NODE_ENV = ‘production’)<br>一般第三方库都会根据 process.env.NODE_ENV 这个变量决定开发环境和生产环境执行<br>如果是自己编写 Webpack 的构建配置，在生产环境构建时，需要在 Webpack 的配置项中包含以下插件配置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">    <span class="string">'process.env'</span>: &#123;</span><br><span class="line">      NODE_ENV: <span class="built_in">JSON</span>.stringify(<span class="string">'production'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="keyword">new</span> UglifyJSPlugin()</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li><li><p>避免不必要的组件渲染<br>重写 shouldComponentUpdate 方法避免不必要的组件渲染</p><img src="http://www.plantuml.com/plantuml/svg/KoekIIn9LSWlKYWeoYyeLaZEICnBJrLIKD3LjLDGAahDIqajKkA2CL14hHIUhftmV7VBaztRe9gVpLdrj7_6qvvfQ1eGwfBpSmloyrBpIi8pStA2KfDJCyjI0q1waKrxFgi5QY3CD68CGBSAwW80"></li><li><p>使用 key</p></li></ol><h2 id="性能检测工具"><a href="#性能检测工具" class="headerlink" title="性能检测工具"></a>性能检测工具</h2><ol><li>React Develop Tools for Chrome 检测页面使用的 react 代码版本是生产环境版本，如果地址栏 react icon 是黑色，代表当前为生产版本 react，红色则为开发环境 react</li><li>chrome performance tab 观察组件挂载、更新、卸载过程及各阶段的时间<ul><li>确保运行在开发模式下</li><li>打开 Chrome 开发者工具，切换到 performance 窗口，单击 Record 按钮开始统计。</li><li>在页面执行需要分析的操作，最好不要超过 20 秒，否则导致 chrome 卡死。</li><li>单击 stop 按钮结束统计，user timing 查看统计结果</li></ul></li><li>why-did-you-update<br>用来比较 state 和 props 的变化，从而发现组件 render 方法不必要的调用<ul><li>安装 <code>npm i why-did-you-update --save-dev</code></li><li>使用<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">if</span>(process.env_NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; whyDidYouUpdate &#125; = <span class="built_in">require</span>(<span class="string">'why-did-you-update'</span>)</span><br><span class="line">  whyDidYouUpdate(React)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> react </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>react + fetch + mockjs</title>
      <link href="2020/12/02/mock%E6%95%B0%E6%8D%AE/"/>
      <url>2020/12/02/mock%E6%95%B0%E6%8D%AE/</url>
      
        <content type="html"><![CDATA[<h2 id="浏览器使用-mockjss"><a href="#浏览器使用-mockjss" class="headerlink" title="浏览器使用 mockjss"></a>浏览器使用 mockjss</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://mockjs.com/dist/mock.js"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line">Mock.mock(&#123;</span><br><span class="line"><span class="javascript">  <span class="string">'list|1-10'</span>: [&#123;</span></span><br><span class="line"><span class="javascript">      <span class="string">'id|+1'</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="javascript">      <span class="string">'name'</span>: <span class="string">'@string'</span>,</span></span><br><span class="line"><span class="javascript">      <span class="string">'age|1-100'</span>: <span class="number">100</span>,</span></span><br><span class="line"><span class="javascript">      <span class="string">'skill|1-2'</span>:[</span></span><br><span class="line"><span class="javascript">        <span class="string">'Soccer'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'Volleyball'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'Swimming'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'Hiking'</span></span></span><br><span class="line">      ]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><ol><li><p><code>mockjs</code> 生成随机数据、拦截 Ajax 请求。<a href="https://github.com/nuysoft/Mock/wiki/Getting-Started" target="_blank" rel="noopener">文档见</a></p><ul><li>安装<blockquote><p>npm install –save-dev mockjs</p></blockquote></li></ul></li><li><p><code>fetch</code> http 请求方式，是 XMLHttpRequest 的一种替代方案，它的 api 是基于 Promise 设计的 nodejs 中使用需要引入 node-fetch.</p></li><li><p><code>fetch-mock</code> 拦截 fetch 请求</p><ul><li>安装<blockquote><p>npm install –save-dev fetch-mock</p></blockquote><a id="more"></a><h2 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h2></li></ul></li><li><p>目录结构</p><img src="http://www.plantuml.com/plantuml/svg/AqxCAU6gvb9Gg0u14WeAsWgPUIcf5NfPnL1kOa41CYSJp0AoCHJcvYTduv04Yu3aKGHI4aiIeJmG7sXwUcfUYKzcSGb4MIrNBG00"><p>按照以上目录结构整理代码，以下是 demo</p></li></ol><ul><li><p><code>/index.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mock <span class="keyword">from</span> <span class="string">'./mock/index'</span></span><br><span class="line">mock.start();</span><br></pre></td></tr></table></figure></li><li><p><code>/mock/index.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mock <span class="keyword">from</span> <span class="string">'./mock'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> mock</span><br></pre></td></tr></table></figure></li><li><p><code>/mock/mock.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> fetchMock <span class="keyword">from</span> <span class="string">'fetch-mock'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;agents&#125; <span class="keyword">from</span> <span class="string">'./data/agentList'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  start() &#123;</span><br><span class="line">    fetch.get(<span class="string">'/agentList'</span>, ()=&gt;&#123;</span><br><span class="line">      <span class="keyword">return</span> agents</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>data 中 mock 假数据 <code>/mock/data/index.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mock <span class="keyword">from</span> <span class="string">'mockjs'</span>;</span><br><span class="line"><span class="keyword">const</span> Random = mock.Random;</span><br><span class="line"><span class="keyword">let</span> agents = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) &#123;</span><br><span class="line">  agents.push(Mock.mock&#123;</span><br><span class="line">    key: Random.guid()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> &#123; agents &#125;</span><br></pre></td></tr></table></figure></li><li><p>fetch 调用 api <code>/api/agentList.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getAgentList = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">'/agentList'</span>).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> response.json();</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>组件中调用 <code>/app.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 省略其它代码</span></span><br><span class="line">componentDitMount() &#123;</span><br><span class="line">  getAgentList().then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      data</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
            <tag> mockjs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>react 组件</title>
      <link href="2020/11/29/react-component/"/>
      <url>2020/11/29/react-component/</url>
      
        <content type="html"><![CDATA[<h2 id="组件的-state"><a href="#组件的-state" class="headerlink" title="组件的 state"></a>组件的 state</h2><ol><li>state 设计的几点原则；</li><li>正确修改 state;<h2 id="组件通信"><a href="#组件通信" class="headerlink" title="组件通信"></a>组件通信</h2></li><li>组件在 componentDidMount 中与服务器通信</li><li>父子组件与兄弟组件通信</li></ol><a id="more"></a><h2 id="组件的-state-1"><a href="#组件的-state-1" class="headerlink" title="组件的 state"></a>组件的 state</h2><h3 id="适合的-state"><a href="#适合的-state" class="headerlink" title="适合的 state"></a>适合的 state</h3><ul><li><p>state 代表一个组件 UI 呈现的完整状态集</p><ul><li>渲染组件时所用到的数据的来源</li><li>用作组件 UI 展现形式的判断依据<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">pop</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// construct 用于初始化组件的 state及绑定事件</span></span><br><span class="line">  construct(props) &#123;</span><br><span class="line">    <span class="comment">// 调用父类的 construct 方法，即调用 react.Component 的构造方法。用于完成 react 组件的初始化工作，保证 props 传入组件</span></span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      isShow: <span class="literal">false</span>, <span class="comment">// 展现形式的判断依据</span></span><br><span class="line">      pop: <span class="string">'弹层'</span> <span class="comment">// 渲染时所用到的数据</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;isShow, pop&#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      isShow ? <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;pop&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span> : <span class="literal">null</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>state 代表一个组件 UI 呈现的最小状态集，state 中所有的状态都用于反映组件 ui 变化，没有任何多余的状态，也不应该存在通过其他状态计算而来的中间状态。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">purchaseCart</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  construct(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="comment">// 错误的 state 案例</span></span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      purchaseList: [],</span><br><span class="line">      totalCost: <span class="number">0</span> <span class="comment">// 根据 purchaseList 中 的 price 计算得来的，属性于中间多余属性。</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="demo-显示当前组件并每秒钟更新"><a href="#demo-显示当前组件并每秒钟更新" class="headerlink" title="demo 显示当前组件并每秒钟更新"></a><code>demo 显示当前组件并每秒钟更新</code></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">timer</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  construct(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      date: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.timer = <span class="literal">null</span>; <span class="comment">// 非 props 或 state，是一个普通属性</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDitMount() &#123;</span><br><span class="line">    <span class="comment">// timer 不用于渲染</span></span><br><span class="line">    <span class="keyword">this</span>.timer = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        date: newDate()</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentWillUnMount() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.timer) &#123;</span><br><span class="line">      clearInterval(<span class="keyword">this</span>.timer)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;&#123;<span class="keyword">this</span>.state.date.toString()&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>触发沉浸的属性是 props 和 state，props 来自父级，只读属性，不能修改。如果需要修改须在父级 setState 修改，state 维护组件内部属性。</p></blockquote><ol><li>变量是否从 props 中获取，若是，则不是一个状态；</li><li>变量是否在组件的整个生命周期中保持不变，若是，则不是一个状态；</li><li>状态是否是从在组件 render 中使用，未使用，则不是一个状态，适合用普通属性。</li></ol><h3 id="正确修改-state"><a href="#正确修改-state" class="headerlink" title="正确修改 state"></a>正确修改 state</h3><p>state 需要通过 setState 修改，<code>this.state.name = &#39;helen&#39;</code> 不会触发 render 渲染</p><blockquote><p>不要依赖当前的 state 计算下一个 state，<code>state 更新是异步的</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">object.assign(&#123;</span><br><span class="line">  previousState,</span><br><span class="line">  &#123;<span class="attr">quantity</span>: <span class="keyword">this</span>.state.quantity + <span class="number">1</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">quantity</span>: <span class="keyword">this</span>.state.quantity + <span class="number">1</span>&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>如上 React出于性能原因，会把多次的 state 修改合并成一次，也就是说组件的 state 并不是调用 setState 时立即修改的，而是把要修改的状态合并到一个队列中一次执行。应付造成，quantity 只加了一次，而不是设计的加 2。正确的修改方式如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.setState(<span class="function">(<span class="params">preState, props</span>) =&gt;</span> &#123;</span><br><span class="line">  quantity: preState.quantity + <span class="number">1</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>preState 当前更新状态的前一个状态，props 当前最新的 props</p><p>state 更新是一个合并的过程，调用 setState 修改组件时，只需要传入发生改变的 state，react 会把修改的 state 与原 state 合并，未修改的保持不变</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.state = &#123;...this.state, &#123;<span class="attr">title</span>: <span class="string">'modify title'</span>&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="react-官方建议把-state-当作不可变对象"><a href="#react-官方建议把-state-当作不可变对象" class="headerlink" title="react 官方建议把 state 当作不可变对象"></a>react 官方建议把 state 当作不可变对象</h3><p>state 中包含的所有状态都应该是不可变对象，state 中的某个状态发生变化时，应该重新创建这个状态对象，并非是修改原来的状态。将状态类型分为三种情况创建新的状态对象：</p><ol><li><p>状态类型是数字、字符串、布尔值、null、undefined<br>直接给修改状态赋新值</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.setState(&#123;</span><br><span class="line">  quantity: <span class="number">1</span>,</span><br><span class="line">  title: <span class="string">'react'</span>,</span><br><span class="line">  success: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>状态类型是数组</p><blockquote><p>状态发生变化时重新创建状态对象，数组方法中，push, pop, shift, unshift, splice 都是 <code>在原数组的基础上修改的</code>，concat、slice、filter 是<code>返回一个新数组</code>。</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* books 是要修改的状态，类型为数组 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 preState、concat 创建新数组</span></span><br><span class="line"><span class="comment">// 箭头之后的圆括号用来实现换行（MDN）</span></span><br><span class="line"><span class="keyword">this</span>.setState(<span class="function">(<span class="params">preState</span>) =&gt;</span> (&#123;</span><br><span class="line">  books: preState.books.concat([<span class="string">'react guide'</span>])</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6 spread syntax</span></span><br><span class="line"><span class="keyword">this</span>.setState(<span class="function">(<span class="params">preState</span>) =&gt;</span> (&#123;</span><br><span class="line">  books: [...preState.books, <span class="string">'react guide'</span>]</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure></li></ol><p>用 <code>slice</code> 从数组中截取一部分元素作为新状态；用<code>filter</code> 过滤部分元素作作为新状态</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.setState(<span class="function">(<span class="params">preState</span>) =&gt;</span> (&#123;</span><br><span class="line">  books: preState.books.slice(<span class="number">1</span>,<span class="number">3</span>)</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.setState(<span class="function"><span class="params">preState</span> =&gt;</span> (&#123;</span><br><span class="line">  books: preState.books.filter(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> item !== <span class="string">'react'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><ol start="3"><li>状态类型是不包含字符串、数组的普通对象<br>避免修改原对象的方法，使用返回一个新对象的方法<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 ES6 Object.assgin 方法</span></span><br><span class="line"><span class="keyword">this</span>.setState(<span class="function"><span class="params">preState</span> =&gt;</span> (&#123;</span><br><span class="line">  owner: <span class="built_in">Object</span>.assgin(&#123;&#125;, preState.owner, &#123;<span class="attr">name</span>: <span class="string">'helen'</span>&#125;)</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用对象扩展语法 object spread properties</span></span><br><span class="line"><span class="keyword">this</span>.setState(<span class="function"><span class="params">preState</span> =&gt;</span> (&#123;</span><br><span class="line">  owner: &#123;...preState.owner, &#123;<span class="attr">name</span>: <span class="string">'helen'</span>&#125;&#125;</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure></li></ol><p>react 推荐组件状态不可变的原因在于，返回新对象可以避免原有对象组件状态不小心情况下修改，导致错误，方便管理、调试。还有出于性能考虑，当组件对象不可变时，在组件的 shouldComponentUpdate 方法中仅需要对比前后对象的引用便可以判断是否发迹，避免不必要的 render.</p><h2 id="组件与服务器通信"><a href="#组件与服务器通信" class="headerlink" title="组件与服务器通信"></a>组件与服务器通信</h2><ol><li><p>组件挂载阶段通信<br>componentDidMount、componentWillUnMount、constructor 应该在这三个生命周期的哪个中与服务器通信呢？</p><ul><li>constructor 用于初始化组件的 state 以及绑定事件处理等工作，在这里与服务器通信初始化与获取数据后赋值相互污染</li><li>componentWillMount 这个方法是组件挂载到 DOM 前调用，且只会调用一次，这个方法中调用 this.setState 不会引起组件重新渲染，虽然 componentWillMount 在 componentDidMount 前执行，但两个重合周期的执行时间差微乎其微。另一种说法，当组件在服务器端渲染时，componentWillMount 会被调用两次，一次服务端，一次浏览器。在 componentWillMount 里面通信，会发送多余的数据请求</li><li>componentDidMount 组件挂载到了 Dom，Dom 也已经渲染完成，调用 api 最安全，也是官方推荐与服务器通信的生命周期。可以保证获取到数据时，组件已经挂载到了Dom, 这时直接操作 Dom 也是安全的</li></ul></li><li><p>组件更新阶段通信<br>props 中的某一依据发生变化，这里组件需要重新获取数据更新。componentWillReceiveProps 在 props 引起的组件更新过程中调用。方法参数 nextProps 是父组件传递给当前组件的新的 props. setState 并不会触发 componentWillReceiveProps。</p><h2 id="组件通信-1"><a href="#组件通信-1" class="headerlink" title="组件通信"></a>组件通信</h2></li><li><p>父子组件通信<br>父子组件间的通信是由 props 完成的</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父组件</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> UserList <span class="keyword">from</span> <span class="string">'./component/UserList'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">//... 省略</span></span><br><span class="line">  <span class="comment">// props 将 users 传递给子组件 UserList</span></span><br><span class="line">  handleName(name) &#123;</span><br><span class="line">   <span class="comment">// 调用修改用户信息接口</span></span><br><span class="line">   <span class="comment">// console.log(name)</span></span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;UserList users = &#123;<span class="keyword">this</span>.state.users&#125;&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">UserList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  modifyName(event) &#123;</span><br><span class="line">     <span class="keyword">const</span> &#123; value &#125; = event.target</span><br><span class="line">     <span class="comment">// 子组件通过 props 调用父组件方法</span></span><br><span class="line">      <span class="keyword">this</span>.props.handleName(value)</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment">// 返回代表该组件的 ui react 元素</span></span><br><span class="line">   render() &#123;</span><br><span class="line">     <span class="keyword">const</span> &#123; users = [] &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">     <span class="keyword">return</span> [</span><br><span class="line">         users.map(<span class="function"><span class="params">item</span> =&gt;</span> (</span><br><span class="line">           &lt;div key=&#123;item.key&#125;&gt;</span><br><span class="line">             &lt;input value=&#123;item.name&#125; onChange=&#123;<span class="keyword">this</span>.modifyName.bind(<span class="keyword">this</span>)&#125; /&gt;</span><br><span class="line">           &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">         ))</span></span><br><span class="line"><span class="regexp">     ]</span></span><br><span class="line"><span class="regexp">   &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>兄弟组件通信</p></li><li><p>context</p></li><li><p>延伸</p><h2 id="组件的-ref-属性"><a href="#组件的-ref-属性" class="headerlink" title="组件的 ref 属性"></a>组件的 ref 属性</h2></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> react </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器工作原理——浏览器中的Javascript执行机制</title>
      <link href="2020/11/18/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94Javascript%E6%89%A7%E8%A1%8C%E6%9C%BA%E5%88%B6/"/>
      <url>2020/11/18/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94Javascript%E6%89%A7%E8%A1%8C%E6%9C%BA%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<ul><li><input disabled type="checkbox"> JavaScript 代码是按顺序执行吗？先编译、后执行。编译出执行上下文与可执行代码。<ul><li>变量提升</li></ul></li><li><input disabled type="checkbox"> 为什么 JavaScript 代码会出现栈溢出<ul><li>调用栈 —— 用来管理函数调用关系的一种数据结构。<code>Maximum call stack size exceeded</code></li></ul></li><li><input disabled type="checkbox"> var 与 let 和 const，var 缺陷是什么<ul><li>var 会引起变量提升，变量提升产生变量污染、消耗一部分无用的内存。可以通过 let 和 const 解决，ECMAScript6 中，提出的 let 和 const 有块级作用域的概念。很好的解决了变量提升的问题</li></ul></li><li><input disabled type="checkbox"> 作用域链与闭包<ul><li>作用域变量的有效性和生命周期</li><li>闭包嵌套函数，内部引用外出变量，外部函数执行结束后，不能完全退栈。内部函数存在外部函数的变量引用</li><li>this 与变量不同，内部函数不能继承外部函数的 this。解决办法有三种：<ol><li>this 转换为作用域，将 this 赋值给变量，内部函数访问 this 赋值的变量；</li><li>箭头函数继承上一级的 this</li><li>采用 call/apply/bind 其一，进行对象冒充</li><li>传参<a id="more"></a></li></ol></li></ul></li></ul><h2 id="1-变量提升（Hoisting）"><a href="#1-变量提升（Hoisting）" class="headerlink" title="1. 变量提升（Hoisting）"></a>1. 变量提升（Hoisting）</h2><blockquote><p><del>Javascript 代码执行过程中，Javascript 引擎把变量声明部分和函数声明部分提升到代码开头的行为</del><code>JavaScript 代码在编译过程中，被 JavaScript 引擎放入内存的行为</code>，叫做 <strong>变量提升</strong>。</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(name)</span><br><span class="line">fn();</span><br><span class="line">fn_var();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> name; <span class="comment">// 声明</span></span><br><span class="line">name = <span class="number">123</span>; <span class="comment">// 赋值部分</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'完整的函数声明'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fn_var = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'匿名函数赋值给变量'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// 完整的函数声明</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    VM791:3 Uncaught TypeError: fn_var is not a function</span></span><br><span class="line"><span class="comment">    at &lt;anonymous&gt;:3:1</span></span><br><span class="line"><span class="comment">    (anonymous) @ VM791:3</span></span><br><span class="line"><span class="comment">  */</span></span><br></pre></td></tr></table></figure><blockquote><p>分析：<br>  console.log(name) 打印出 undefined 变量提升后，会给变量设置默认值 undefined。<br>  fn() 执行后打印 完整的函数声明<br>  fn_var() <code>Uncaught TypeError: fn_var is not a function</code> 因为 fn_var 是变量，提升后相当于 <code>fn_var = undefined</code>，所以报错，fn_var 不是一个函数。</p></blockquote><h3 id="1-1-JavaScript-代码的执行流程"><a href="#1-1-JavaScript-代码的执行流程" class="headerlink" title="1-1.  JavaScript 代码的执行流程"></a>1-1.  JavaScript 代码的执行流程</h3><pre class="mermaid">  graph LR;  JavaScriptCode --> 编译;  编译 --> 执行;</pre><h3 id="1-2-分析代码了解代码执行环境"><a href="#1-2-分析代码了解代码执行环境" class="headerlink" title="1-2. 分析代码了解代码执行环境"></a>1-2. 分析代码了解代码执行环境</h3><blockquote><p><strong>执行上下文</strong> javaScript 执行一段代码时的 <strong>运行环境</strong>。<br>执行上下文中存在一个变量环境的对象（Variable Environment)，variable Environment 中保存了变量提升的内容</p></blockquote><h4 id="demo-1-1-分析以下代码"><a href="#demo-1-1-分析以下代码" class="headerlink" title="demo-1-1 分析以下代码"></a>demo-1-1 分析以下代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">"variable promotion"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showName</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name);</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> name = <span class="string">"variable promotion case"</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(name);</span><br><span class="line">&#125;</span><br><span class="line">showName()</span><br><span class="line"></span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"><span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><p>如上代码，<code>编译后会将会将提升的变量 name=undefined; function showName(){...}保存在变量环境中</code>，如下图</p><img src="http://www.plantuml.com/plantuml/svg/AqfDBadCIyz9LL02miHYXUJyt8BCdDIWrEBId1A5QYu5XUAInEHiXQUjAvvkR7ZMkVp5mfudExgUxEX-DgqTf26r8ZMvj2GpFyyvFwyajQB4Fyqz9pyfCGUiLq6X2671q_uPBzlxd_UjVxgeMGaicPTVagfGb9cUKQAGduQcm4eXBp4trROqBoKrBJClDSKw9ayXhJGl6MILGd56VhaVK5f3irfFJwyMtQONwtkVRPuADKX1sIpD6AW2f0h5DUkXljcz-Fc2Hh3dIrABInIKqomDiBWE96U5PB4rK0rEl-j6AvSK9UOL5oGMfUQLnEhQWRLprG80"><h4 id="demo-1-2-分析以下代码"><a href="#demo-1-2-分析以下代码" class="headerlink" title="demo-1-2.  分析以下代码"></a>demo-1-2.  分析以下代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">showName();</span><br><span class="line"><span class="keyword">var</span> showName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>VM4235:1 Uncaught TypeError: showName is not a function</p></blockquote><ul><li>编译阶段：全局执行上下文环境变量 <code>showName = undefined</code> 写入内存，可执行代码 <code>showName()</code></li><li>执行阶段：代码按顺序执行，先执行第一行 <code>showName()</code>，环境变量中存在 showName，值是 undefined，并不是一个函数。所以报错 <code>showName is not a function</code></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">showName();</span><br><span class="line"><span class="keyword">var</span> showName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>打印出 2</p></blockquote><ul><li>编译阶段：第一行 <code>showName()</code> 放入可执行代码；第二行声明变量 showName 放入全局执行上下文 <code>showName = undefined</code>；第 五 行 <code>覆盖 showName 赋值 function 引用</code></li><li>执行阶段变量环境中找到 <code>函数 showName</code>，打印结果 2，showName 再次赋值 <code>function() {console.log(1)}</code>的引用。下次再执行 showName() 打印结果是 1</li></ul><h2 id="2-执行上下文与调用栈"><a href="#2-执行上下文与调用栈" class="headerlink" title="2. 执行上下文与调用栈"></a>2. 执行上下文与调用栈</h2><p>代码执行之前进行编译创建执行上下文的三种情况：</p><ol><li>当 JavaScript 执行全局代码的时候，会编译全局代码并创建 <strong>全局执行上下文</strong>。整个页面的生命周期内，全局执行上下文只有一份；</li><li>当调用一个函数时，函数体内的代码会被编译，并创建 <strong>函数执行上下文</strong>，一般情况下，函数执行结束后，创建的函数执行上下文被销毁；</li><li>当使用 eval 函数的时候，eval 代码也会被编译，并创建执行上下文。</li></ol><p><strong><code>调用栈用来管理函数调用关系的一种数据结构。</code></strong></p><h3 id="JavaScript-调用栈"><a href="#JavaScript-调用栈" class="headerlink" title="JavaScript 调用栈"></a>JavaScript 调用栈</h3><p>栈容器、入栈、出栈、栈中元素后进先出。<br>JavaScript 引擎创建执行上下文，然后压入 <strong>调用栈</strong></p><img src="http://www.plantuml.com/plantuml/svg/ioakgSn9jUDAB2hABrUevb800f_Cl5Jd_9py8eMIeiIyueB4ejIy4gvQBXjzgEBYaiJaR8Nan9oSO30BfAqeDRaaCIyz9rL1wMdxtcTJDpphNFvYOS-J7LrFTdG_czQk13KSGztJ_Xals_kVzwr_kgXP2RkI5-jxdssUYb1IYsPVwugd6nk8i0-i3hzzO2NOxCFgAGKzFGMijdDnrG80"><p><strong><code>调用栈是 JavaScript 引擎追踪函数执行的一个机制。多个函数被调用时，通过调用栈可以追踪到哪个函数正在被执行以及各个函数之间的调用关系</code></strong></p><h3 id="2-1-demo-分析代码"><a href="#2-1-demo-分析代码" class="headerlink" title="2-1-demo. 分析代码"></a>2-1-demo. 分析代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'helen zhang'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showName</span>(<span class="params">callName</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(callName)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callShowName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> callName = <span class="string">'call '</span> + name</span><br><span class="line">  showName(callName)</span><br><span class="line">&#125;</span><br><span class="line">callShowName();</span><br></pre></td></tr></table></figure><img src="http://www.plantuml.com/plantuml/svg/RL2zJiCm4Dxp52Spj1sQ5q2meAuiZC1mDIQ9SC_8Taj55Ga9eOWVqGd42WjiqAqBRzC4U0jCr5QsY2pTuE_llZCM-GamzoOHW1RS8YLI02kBp-hXmwJgR1S7ehf-_Nw-Mynl5lFRwh5WW0PMMAq4uAYFW755HaaHIvMqEKgvjoHrc2FbJH4-god6nuCeSXzRhJyOKY45mNdgZ5kRJKbNR-NieiazaQgFiZSMV6YLtb5anTW6CUNqwQUOVjs_bo-NjMI4EiE-53qQPLhHGD1A46uMB7L0nqFYDbEqlbkxCudZEFSXl-iIPhLpNdToOttqxlw6rKZc5BLRuB2xxMiZ2C_sZznOEyf_0G00"><blockquote><p>分析：</p></blockquote><ol><li>JavaScript 引擎编译代码时创建 <strong>全局执行上下文</strong>；<br>执行第一行代码时声明变量 name，并赋初值 undefined；<br>执行第二行代码时，声明 function showName，将变量 name 和 函数 showName 放入变量环境。<br>callShowName() 放入执行代码</li><li>执行代码 callShowName()，创建 <strong>函数执行上下文</strong>。<br>执行 callName 赋值 ‘undefined’<br>showName() 放入执行代码</li><li>执行 showName(), 创建 <strong>函数执行上下文</strong><br>console.log(callShowName) 打印 callShowName</li></ol><p>以上创建的两个执行上下文是通过 <strong>栈数据结构</strong> 来管理的。</p><h3 id="chrome-开发者工具查看调用栈"><a href="#chrome-开发者工具查看调用栈" class="headerlink" title="chrome 开发者工具查看调用栈"></a>chrome 开发者工具查看调用栈</h3><ol><li>javascript 代码打断点（debugger）</li><li>执行时进入断点</li><li>开发者工具右侧 call stack 查看调用栈</li></ol><p><img src="https://static001.geekbang.org/resource/image/c0/a2/c0d303a289a535b87a6c445ba7f34fa2.png" alt="chrome 调用栈"><br>anonymous 全局函数入口<br>中间是 addAll 函数<br>顶部是 add 函数<br>在分析复杂代码结构时，或检查 bug 时，调用栈非常有用<br>runStack 当前调用函数</p><p><strong><code>console.trace() 输出函数调用关系</code></strong><br><img src="https://static001.geekbang.org/resource/image/ab/ce/abfba06cd23a7704a6eb148cff443ece.png" alt="console.trace"></p><h2 id="3-栈溢出（stack-overflow"><a href="#3-栈溢出（stack-overflow" class="headerlink" title="3. 栈溢出（stack overflow)"></a>3. 栈溢出（stack overflow)</h2><p><code>调用栈有大小的</code>，超出后 JavaScript 引擎会报错<code>超出最大栈调用大小（Maximum call stack size exceeded）</code>，<strong>栈溢出</strong></p><blockquote><p>递归没有任何终止条件的函数，会一直创建执行上下文，并反复压入栈中，栈容量有限，超过最大数量后会出现 <code>Maximum call stack size exceeded</code></p></blockquote><h3 id="解决栈溢出"><a href="#解决栈溢出" class="headerlink" title="解决栈溢出"></a>解决栈溢出</h3><p>递归调用的形式改造成其他形式，或者使用加入定时器的方法来把当前任务拆分为其他很多小任务来解决栈溢出</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runStack</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (n === <span class="number">0</span>) <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">  <span class="keyword">return</span> setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    runStack( n- <span class="number">2</span>)</span><br><span class="line">  &#125;,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">runStack(<span class="number">50000</span>)</span><br></pre></td></tr></table></figure><hr><hr><p>var 声明的变量会有 <strong>变量提升</strong> 的特性，与直觉不否。是 JavaScript 的一个重要的设计缺陷。<br>  由于 JavaScript 需要保持向下兼容，所以变量提升特性还会继续存在</p><blockquote><p>下文中 探讨</p></blockquote><ul><li>为什么在 JavaScript 中会存在变量提升<br>javaScript 语言最初用最快速、最简单的方式设计，所以没有块级作用域，把块级作用域内部的变量提升。</li><li>变量提升所带来的问题</li><li>作用域配合 let 和 const 关键字修复变量提升带来的问题</li></ul><hr><hr><h2 id="4-通过-let-const-JavaScript块级作用域-解决变量提升的问题"><a href="#4-通过-let-const-JavaScript块级作用域-解决变量提升的问题" class="headerlink" title="4. 通过 let/const + JavaScript块级作用域 解决变量提升的问题"></a>4. 通过 <code>let/const + JavaScript块级作用域</code> 解决变量提升的问题</h2><h3 id="4-1-作用域（scope）"><a href="#4-1-作用域（scope）" class="headerlink" title="4-1.  作用域（scope）"></a>4-1.  作用域（scope）</h3><blockquote><p><strong>作用域</strong> 程序中定义变量的区域，该位置决定了变量的生命周期。通俗的理解，作用域是变量与函数的可访问范围，即作用域控制着变量和函数的可见性和生命周期。</p></blockquote><p>ES6 之前两种作用域：</p><ol><li><strong>全局作用域</strong> 中的对象在代码中任何地方都能访问，其生命周期为整个页面的生命周期；</li><li><strong>函数作用域</strong> 函数内部定义的变量或者函数，只能在函数内部访问。<pre><code>其生命周期从函数调用到函数执行结束。函数执行结束，函数内部定义的变量销毁。</code></pre></li></ol><p><code>ES6 之后引入了 let/const 声明关键字，使得 JavaScript 也能像其它语言一样拥有块级作用域了。</code><br><strong>块级作用域</strong> —— 即使用一对大括号包裹的代码，如：函数、判断语句、循环语句等</p><h3 id="4-2-变量提升存在问题-——-容易在无意识的情况下变量覆盖"><a href="#4-2-变量提升存在问题-——-容易在无意识的情况下变量覆盖" class="headerlink" title="4-2.  变量提升存在问题 —— 容易在无意识的情况下变量覆盖"></a>4-2.  变量提升存在问题 —— 容易在无意识的情况下变量覆盖</h3><p>第一部分变量提升中说了经过编译，提升变量会存入变量环境（存入内容），现在借 demo-1-1 代码继续分析，变量提升带来的问题</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">"variable promotion"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showName</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name);</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> name = <span class="string">"variable promotion case"</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(name);</span><br><span class="line">&#125;</span><br><span class="line">showName()</span><br><span class="line"></span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"><span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><img src="http://www.plantuml.com/plantuml/svg/Aov9JCvMK0B2QYu5XQBKv9B4lFISL0Mbr8hKvDAIpFmyXUJyl9BKYXA5_3I5z9pyfCGS9ON4OYZJ6Ie7qeoY_Md_Z9Vj_S_xrZzTrAm4bLPGI4uiIb5GoalCJRLLAaiioanC0gejAChFpGVPf6GTawTGd95VxWTKeA5fhGJMLOjkz8lrlSysJuKQpGLHGCZXQQLvoM0ncF5WFy14SVe2ffgWRqhpKbBJClDIKt2u6MOGDhUZkq8tMhcaA36lk22nA3Ml95RN3ZMikMe1"><p><code>全局执行上下文压入栈以后，JavaScript 引擎开始执行全局代码。先给 name 变量赋值，再调用函数showName</code><br><strong>调用函数时，javascript 引擎编译该函数，为其创建执行上下文，再将执行上下文压入栈</strong><br>函数执行上下文压入栈后，JavaScript 引擎再从上到下执行showName函数代码，执行到第一个 console.log(name)取编译时的初值 undefined 打印出 undefined，第二个 console.log(name) 时，因没有块级作用域，所以打印出 variable promotion case</p><h3 id="4-3-变量提升存在问题-——-变量未能及时销毁"><a href="#4-3-变量提升存在问题-——-变量未能及时销毁" class="headerlink" title="4-3.  变量提升存在问题 —— 变量未能及时销毁"></a>4-3.  变量提升存在问题 —— 变量未能及时销毁</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">variableDestruction</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)&#123;&#125;</span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line">variableDestruction();</span><br></pre></td></tr></table></figure><p>JavaScript 编译以上代码，生成全局上下文(环境变量 function variableDestruction(){…})，然后压入栈内存中。JavaScript 执行可执行代码 <code>variableDestruction()</code>，创建函数执行上下文(环境变量 i=undefined)，再将函数执行上下文 压入栈内存。javascript 引擎继续执行可执行代码 i 赋值、遍历、打印结果是 5。<strong>因为没有块级作用域，导致遍历结果后没有销毁变量i,所以打印结果是 5</strong></p><h3 id="4-4-用let-const-JavaScript块级作用域解决变量提升的问题"><a href="#4-4-用let-const-JavaScript块级作用域解决变量提升的问题" class="headerlink" title="4-4.  用let/const + JavaScript块级作用域解决变量提升的问题"></a>4-4.  用<code>let/const + JavaScript块级作用域</code>解决变量提升的问题</h3><p>ECMAScript6 以前没有如{}，判断语句，循环语句的块级作用域，<strong>ES6 引入 let 和 const 关键字</strong>，用 let 和 const 声明的变量是有块级作用的概念的<br>let 声明的变量可以被修改，const 声明的变量不可以。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">variableDestruction</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;&#125;</span><br><span class="line">  <span class="built_in">console</span>.log(i)</span><br><span class="line">&#125;</span><br><span class="line">variableDestruction();</span><br></pre></td></tr></table></figure><blockquote><p>Uncaught ReferenceError: i is not defined 说明块级作用域生效，i 在 块级作用域以外不能访问。也就是在函数作用域内没有变量提升。</p></blockquote><h2 id="5-ES6-怎么兼容变量提升和块级作用域的"><a href="#5-ES6-怎么兼容变量提升和块级作用域的" class="headerlink" title="5. ES6 怎么兼容变量提升和块级作用域的"></a>5. ES6 怎么兼容变量提升和块级作用域的</h2><p>从上下文的角度分析：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">let</span> b = <span class="number">2</span>;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">let</span> b = <span class="number">3</span>, d = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">var</span> c = <span class="number">4</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(a)</span><br><span class="line">    <span class="built_in">console</span>.log(b)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(b)</span><br><span class="line">  <span class="built_in">console</span>.log(c)</span><br><span class="line">  <span class="built_in">console</span>.log(d)</span><br><span class="line">&#125;</span><br><span class="line">foo()</span><br></pre></td></tr></table></figure><p><strong>1.  编译并创建执行上下文</strong></p><img src="http://www.plantuml.com/plantuml/svg/AqfDBadCIyz9LKZBSyxFAqcjA558B5PGIilFLtZQllVPr0tFEfU_MDZpP4VNantTpwQrAobKSoae5C6rvQHMP2OdvhZcbMKMvUVbfkP1zBzOt_jiyzJdVUkVBcg6Q55GI4uiIb5GIh8jpKj9JSlCIqrH0WhNefXMbbYKcPYKaufktDF-6I_R-x4PbuWmpZecBndTy5e0"><blockquote><p>解析</p></blockquote><ul><li>函数内部 var 声明的变量，编译时存入 <strong>变量环境</strong></li><li>let 声明的变量，编译时存入 <strong>词法环境（Lexical Environment）</strong></li><li>函数内部的块级作用域内部，通过 let 声明的变量编译阶段未放到词法环境中</li></ul><p><strong>2.  执行代码</strong></p><img src="http://www.plantuml.com/plantuml/svg/AqfDBadCIyz9LKZBSyxFAqcjA558B5PGIilFLtZQllVPr0tFEfU_MDZpP4VNantTpwQrAobKSoae5C6rvQHMP2OdvhZcbMKMvUVbfkP1zBzOt_jiyzJdVUkVBcg6Q55GI4uiIb5GIh8rKW8fWMf4adawT_hpNSkVx9tpVCgAf_Fdn-GbsPRcfQIcPUQbfiJafI0uoFgTSlAJiy6680iew4OhbnGbvXKN91O1dHIhQmUt3qEjhguTmYsrA9uhIopAJ4pAIKNttTF-6I_R-x7vBj7Mq3ecBndXLcibiAbS2jX22cWrDZkuQW40"><p>创建完词法块级作用域后，<br>继续执行可执行代码 <code>console.log(a)</code>，具体是延着词法环境栈向下查找，有就返回给 JavaScript 引擎，如果词法环境中没有继续在变量环境中找(如上图箭头)。结果打印 1；<br><code>console.log(b)</code> 打印词法环境中的 <code>b=3</code>;块级词法环境出栈。<br><code>console.log(b)</code>, 打印块级词法环境 <code>b=2</code>;<br><code>console.log(c)</code>打印变量环境中<code>c=4</code>;<br><code>console.log(d)</code> 打印 undefined <strong>因为吧，定义d的作用域已经出栈了</strong></p><h3 id="Uncaught-ReferenceError-Cannot-access-‘myname’-before-initialization"><a href="#Uncaught-ReferenceError-Cannot-access-‘myname’-before-initialization" class="headerlink" title="Uncaught ReferenceError: Cannot access ‘myname’ before initialization"></a>Uncaught ReferenceError: Cannot access ‘myname’ before initialization</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myname= <span class="string">'helen'</span>;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(myname);</span><br><span class="line">  <span class="keyword">let</span> myname= <span class="string">'zhang'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><code>分析：</code></strong> 块级作用域中，myname 声明提升到了 console.log(myname) 之前，但赋初值 undefined 未初提升。所以 <code>can not access myname before initialization</code>。<strong>所以 let 声明的变量，声明会被提升，但赋初值不被提升。var 声明的变量，赋默认值都会被提升。function 声明、赋值都会被提升。</strong></p><blockquote><p>变量提升是在变量环境中完成的，而块级作用域是通过词法环境的栈结构实现的，两个结合，JavaScript 就实现了 变量提升与块级作用域了</p></blockquote><h2 id="6-作用域链"><a href="#6-作用域链" class="headerlink" title="6. 作用域链"></a>6. 作用域链</h2><blockquote><p>作用域是程序中定义变量的位置，这个位置决定了变量的可见性或说生命周期<br>  作用域链可以理解为变量的查找路径</p></blockquote><p><strong><code>outer —— 每个执行上下文的变量环境中用于指向外部的执行上下文的引用。</code></strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'helen'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">'zhang'</span>;</span><br><span class="line">  bar();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="http://www.plantuml.com/plantuml/svg/Aov9JCvMK0B2QYu5XQBKv9B4lFISL8NqdFoan1pd_BoIr8eIXSHY1QMdhIkURcnuigFhoOxkPzFQd_UjVxge6Q9DGI4viIW5giSrhoopA3ylDpKFggz_nilsVeZocBoynDnKM_MCr9pKF7MOPcHxbV9BIrAB56mLyafpSfH01a1CzGS9WrNN8YnKUh6-zzdcgL2dS47a46QbvUSZUm38LNZQllVPr0tFEfU_MDW3zmgA9x2wjoe3Q28Uzu8T2ZGVuKe5E5T1LzSEDJYj59xrj3-TC14IecYEmV0Zq1pytanAB4Bs9f1BgZS9U0ne8hB7O5nAFGOq1zDZN0h8_j6DLYufIimhBaWi0YQdMA1zY3ZbKa2EO4oLA2xZgWK0"><blockquote><p>函数调用时，使用了外部变量，通过 function 关键字声明的函数，会延着执行上下文环境向上查找变量，这个路径就是叫做作用域链<br><strong>JavaScript 执行过程中，其作用域链是由词法作用域决定的。</strong></p></blockquote><h3 id="6-1-词法作用域"><a href="#6-1-词法作用域" class="headerlink" title="6-1. 词法作用域"></a>6-1. 词法作用域</h3><p><strong>词法作用域</strong> 是指作用域是由代码中函数声明的位置来决定的，所以词法作用域是静态的作用域，通过它就能预测代码在执行过程中如何查找标识。</p><blockquote><p>词法作用域是代码编译阶段就决定好的，和函数是怎么调用没有关系</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">'a'</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="string">'b'</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">afn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a, b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bfn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> b = <span class="string">'bb'</span></span><br><span class="line">  cfn()</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">cfn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(b)</span><br><span class="line">    dfn()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dfn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(b)</span><br><span class="line">  afn();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bfn()</span><br><span class="line"><span class="comment">// bb</span></span><br><span class="line"><span class="comment">// b</span></span><br><span class="line"><span class="comment">// a b</span></span><br></pre></td></tr></table></figure><blockquote><p>分析：<br>  编译：全局变量环境中（a=undefined;b=undefined;function afn(){…};function bfn(){…};function dfn(){…}）<br>  执行：a=’a’;b=’b’;执行bfn()<br>  编译：bfn函数变量环境（b=undefined; function cfn(){…}）<strong>cfn 函数声明的位置在 bfn 函数内部</strong><br>  执行：b=’bb’；函数 cfn 中打印变量 b 为 bb，调用 dfn 函数，<strong>dfn 函数声明的位置在全局上下文中，打印变量 b 为全局上下文环境中的变量 b，结果为 b</strong>，接着在 dfn 中调用 afn，同样 afn 是在全局上下文环境中声明，所以打印全局上下文中的变量 a</p></blockquote><h3 id="6-2-块级作用域的变量查找"><a href="#6-2-块级作用域的变量查找" class="headerlink" title="6-2. 块级作用域的变量查找"></a>6-2. 块级作用域的变量查找</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> myName = <span class="string">"极客世界"</span></span><br><span class="line">  <span class="keyword">let</span> test1 = <span class="number">100</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> myName = <span class="string">"Chrome浏览器"</span></span><br><span class="line">    <span class="built_in">console</span>.log(test)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> myName = <span class="string">"极客邦"</span></span><br><span class="line">  <span class="keyword">let</span> test = <span class="number">2</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">let</span> test = <span class="number">3</span></span><br><span class="line">    bar()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> myName = <span class="string">"极客时间"</span></span><br><span class="line"><span class="keyword">let</span> myAge = <span class="number">10</span></span><br><span class="line"><span class="keyword">let</span> test = <span class="number">1</span></span><br><span class="line">foo() <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><img src="http://www.plantuml.com/plantuml/svg/bLHDIm916BxxAuRfu4d8FavXK56dg5kNx31keucxCp6EOOHWHTYtbzG2BUgGdlgW3oJepuYpwhzesW_PTLSi5fQTuNdUvtsUzsNJ72af0EMp5m20OOKZab0n44SDyPhNJ-hT-_DsyxJTFDFBXSxbitWu12WD4YgD8NM14ewptA02e22s2Q0eNlSAHHCP9V4CKNYI4X13p76AKnebskuAqd0agD_kYwS7lVBPgxm7eLNCsGlDSCoiMqMbcKqmRPno3jdkyuN-Lh9bjTsv18w4nsUYii4qZuJXdei_rUVdNAvbNwBmhPTUXXgNY2NBnIZtVbPQ-QhRTk_WCTZArpn0gRFQjptCg9y2D0nFGDklGPBLWAXLEb_rzdUrSzKGTtTMCfDmI1HoO2EYa8Y_HY77QXBM44kYc8eNoKwIKQ9Xmlqyk3DgDykTqZdqmcH18oJe6kxa_pEpzPGjHZMiVnIxzMDnqp3RdaTCnTcaWbIRQIjDMEUSj-90skxr_4q-BDTptAolKYMrR2g0GObmNyBwSA53wsES8PBUHamckH6QTJJhcAjy-GpBI_OkjsJwRBoNwVeV178_"><blockquote><p>分析:<br> console.log(test)</p></blockquote><ol><li>if 块级词法环境中查找 —— 无</li><li>bar 函数词法作用域中查找 —— 无</li><li>bar 函数变量环境中查找 —— 无</li><li><strong>bar 在全局作用域中声明的，outer 执行上下文引用指向全局执行上下文，</strong> 首先在全局执行上下文词法环境中查找 —— 找到了，打印 1；若无在，全局执行上下文变量环境中查找</li></ol><h2 id="7-闭包"><a href="#7-闭包" class="headerlink" title="7. 闭包"></a>7. 闭包</h2><blockquote><p><strong>在 JavaScript 中，根据词法作用域的规则，内部函数总是可以访问其外部函数中声明的变量，当通过调用一个外部函数返回一个内部函数后，即使该函数已经执行结束了，但是内部函数引用外部函数的变量依然保存在内存中，我们把这些变量的集合称为<code>闭包</code>。</strong></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> myName = <span class="string">'极客时间'</span></span><br><span class="line">  <span class="keyword">let</span> test1 = <span class="number">1</span></span><br><span class="line">  <span class="keyword">const</span> test2 = <span class="number">2</span></span><br><span class="line">  <span class="keyword">var</span> innerBar = &#123;</span><br><span class="line">    getName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(test1)</span><br><span class="line">      <span class="keyword">return</span> myName</span><br><span class="line">    &#125;</span><br><span class="line">    setName: <span class="function"><span class="keyword">function</span>(<span class="params">newName</span>) </span>&#123;</span><br><span class="line">      myName = newName</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> innerBar</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bar = foo()</span><br><span class="line">bar.setName(<span class="string">'极客邦'</span>)</span><br><span class="line">bar.getName()</span><br><span class="line"><span class="built_in">console</span>.log(bar.getName())</span><br></pre></td></tr></table></figure><p><img src="https://static001.geekbang.org/resource/image/40/a8/40b8840480a5df4f43ad5f4e7907e3a8.png" alt="img"></p><blockquote><p>分析：<br> foo 函数调用结束后，foo 函数中定义的 getName 函数，依然引用了 foo 函数中的变量 test1 和 myName 造成 foo 函数无法完全退栈。就行成了一个闭包</p></blockquote><p><strong>函数内部方法包含外部引用，函数无法完全退栈，内部方法引用外部函数的变量依然保存在内存中，就形成了一个闭包</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">closure(foo)</span><br><span class="line">  name: <span class="string">'极客邦'</span></span><br><span class="line">  test1: <span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="7-1-闭包怎么回收"><a href="#7-1-闭包怎么回收" class="headerlink" title="7-1.  闭包怎么回收"></a>7-1.  闭包怎么回收</h3><p>闭包使用不正确会造成内存泄漏，如果引用闭包的函数是个全局变量，闭包会一直存在直到页面关闭；如果不在使用就会造成内存泄漏。引用闭包的函数是个局部变量，等函数销毁后，在下次 JavaScript 引擎执行垃圾回收时，判断闭包这块内容不被使用，那么 Javascript 引擎垃圾回收器会回收这块内存。使用闭包原则 <strong>如果闭包会一直使用，那么它可以作为全局变量存在；如果使用频率不高，占用内存又大，就尽量让它成为一个局部变量</strong></p><h2 id="8-JavaScript-中的-this-是什么"><a href="#8-JavaScript-中的-this-是什么" class="headerlink" title="8. JavaScript 中的 this 是什么"></a>8. JavaScript 中的 this 是什么</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'variable name'</span>;</span><br><span class="line"><span class="keyword">var</span> bar = &#123;</span><br><span class="line">  name: <span class="string">'the variable name of bar'</span>,</span><br><span class="line">  printName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> bar.printName</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> _printName = foo()</span><br><span class="line">_printName()</span><br></pre></td></tr></table></figure><p>执行以上代码片断，打印的结果为 <code>variable name</code>。按照其它语言的编程习惯，这里想打印的是 <code>bar.name</code> 即 <code>the variable name of bar</code></p><blockquote><p>分析：<br>  全局上下文中有两个变量 bar 和 name<br>  bar 有两个属性，name 和 function printName<br>  JavaScript 中的作用域链是由词法作用域决定的，而词法作用域是由代码结构决定的。<br>  所以 function(){console.log(name)} 这个函数是在全局上下文环境中定义的，foo 函数中取的是全局执行上下文中定义的函数<br>  全局上下文环境中取 name 变量，打印的结果为 ‘variable name’</p></blockquote><p><strong><code>可以通过使用 javaScript this 机制获取对象内部属性</code></strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bar = &#123;</span><br><span class="line">  name: <span class="string">'the variable name of bar'</span>,</span><br><span class="line">  printName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">bar.printName() <span class="comment">// the variable name of bar</span></span><br></pre></td></tr></table></figure><img src="http://www.plantuml.com/plantuml/svg/AqfDBadCIyz9LNZMkVp5mfudExgUxEX-DgrTePfBGI4viIX5uMd_Z9Vj_S_xrZzTrAoWR6QM1fDuiRxtsUQfM2JoIqjIYr14IZ8oYnMKquoDkMe1"><p><strong>this 是和执行上下文绑定的</strong>，即每个执行上下文中都有一个 this</p><h3 id="8-1-全局执行上下文-this"><a href="#8-1-全局执行上下文-this" class="headerlink" title="8-1.  全局执行上下文 this"></a>8-1.  全局执行上下文 this</h3><p>浏览器环境，全局执行上下文 this 指向 window 对象，window 是 this 和 作用域链的唯一交点，作用域链最低端包含了 window 对象</p><h3 id="8-2-函数执行上下文-this"><a href="#8-2-函数执行上下文-this" class="headerlink" title="8-2.  函数执行上下文 this"></a>8-2.  函数执行上下文 this</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line">foo() <span class="comment">// window</span></span><br></pre></td></tr></table></figure><p>在全局执行环境中调用函数，其执行上下文中的 this 指向 window 对象。this 指向可以被设置</p><h3 id="8-3-设置执行上下文-this-的几种方式"><a href="#8-3-设置执行上下文-this-的几种方式" class="headerlink" title="8-3.  设置执行上下文 this 的几种方式"></a>8-3.  设置执行上下文 this 的几种方式</h3><ol><li><p>通过函数的 call 方法，对象冒充，改变 this 指向</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'zhang'</span></span><br><span class="line"><span class="keyword">var</span> bar = &#123;</span><br><span class="line">  name: <span class="string">'helen'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">&#125;</span><br><span class="line">foo()</span><br><span class="line">foo.call(bar)</span><br></pre></td></tr></table></figure><blockquote><p>分析：<br> 代码编译结果 <code>name=undefined;bar=undefined;function foo(){...}</code><br> 代码执行：<code>name=&#39;zhang&#39;;bar={name: helen}</code> 执行 <code>foo()</code> this 指向 window，取全局环境中的 name ，打印 ‘zhang’<br> 执行 <code>foo.call(bar)</code> 对象冒充，使得 foo 函数中的 this 指向 bar 对象，打印 ‘helen’</p></blockquote><p>除了用 call 改变 this 指向问题，还可以使用 <strong>bind</strong>、<strong>apply</strong>，具体就是使用上的区别</p></li><li><p>通过 <strong>对象调用</strong> 改变 this 指向</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'zhang'</span></span><br><span class="line"><span class="keyword">var</span> myObj = &#123;</span><br><span class="line">  name: <span class="string">'helen'</span>,</span><br><span class="line">  showName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">myObj.showName() <span class="comment">// 'helen'</span></span><br></pre></td></tr></table></figure><p><strong><code>使用对象调用对象内部方法，this 指向对象本身</code></strong> 也可以理解为 <code>myObj.showName.call(myObj)</code></p><blockquote><p>this 指向取决于调用者，全局环境调用 this 指向 window，对象调用，this 指向调用对象</p></blockquote></li><li><p>通过构造函数中设置</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ConstructorObj</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = <span class="string">'helen'</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> ConstructorObj() <span class="comment">// ConstructorObj &#123;name: "helen"&#125;</span></span><br></pre></td></tr></table></figure><p>可以理解为以下代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建临时空对象</span></span><br><span class="line"><span class="keyword">var</span> temporaryObject = &#123;&#125;</span><br><span class="line"><span class="comment">// 调用 ConstructorObj.call(temporaryObject) this 指向 ConstructorObj 执行上下文</span></span><br><span class="line">ConstructorObj.call(temporaryObject)</span><br><span class="line"><span class="comment">// 执行 ConstructorObj 函数，ConstructorObj 函数执行上下文中 this 指向 temporaryObject</span></span><br><span class="line"><span class="comment">// return temporaryObject</span></span><br><span class="line"><span class="keyword">return</span> temporaryObject</span><br></pre></td></tr></table></figure></li></ol><h3 id="8-4-this-的设计缺陷及应对方案"><a href="#8-4-this-的设计缺陷及应对方案" class="headerlink" title="8-4.  this 的设计缺陷及应对方案"></a>8-4.  this 的设计缺陷及应对方案</h3><ol><li><p>嵌套函数中的 this 不会从外层函数中继承</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bar = &#123;</span><br><span class="line">    name: <span class="string">'hellen'</span>,</span><br><span class="line">    fn: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name) <span class="comment">// hellen</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.name) <span class="comment">// undefined</span></span><br><span class="line">        &#125;</span><br><span class="line">        bar()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">bar.fn()</span><br></pre></td></tr></table></figure><p><code>function bar(){}</code> this 指向 window 并没有继承 object bar</p><blockquote><p>解决办法（一） <strong>this 转换为作用域</strong></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bar = &#123;</span><br><span class="line">    name: <span class="string">'hellen'</span>,</span><br><span class="line">    fn: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name) <span class="comment">// hellen</span></span><br><span class="line">        <span class="keyword">var</span> _this = <span class="keyword">this</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(_this.name) <span class="comment">// hellen</span></span><br><span class="line">        &#125;</span><br><span class="line">        bar()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">bar.fn()</span><br></pre></td></tr></table></figure><blockquote><p>解决办法（二）：<strong>箭头函数 继承 this</strong><br> 箭头函数不会创建自身执行上下文，箭头函数 this 取决于其外部函数</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bar = &#123;</span><br><span class="line">  name: <span class="string">'helen'</span>,</span><br><span class="line">  fn: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name); <span class="comment">// helen</span></span><br><span class="line">    <span class="keyword">var</span> bar = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.name); <span class="comment">// helen</span></span><br><span class="line">    &#125;</span><br><span class="line">    bar()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">bar.fn()</span><br></pre></td></tr></table></figure></li><li><p>普通函数中的 this 默认指向全局对象 window<br><strong>JavaScript 严格模式下，全局调用一个函数 this 指向 undefined</strong></p></li></ol><h2 id="9-关于-this-的-demo-分析"><a href="#9-关于-this-的-demo-分析" class="headerlink" title="9 关于 this 的 demo 分析"></a>9 关于 this 的 demo 分析</h2><p>需求：异步修改用户信息</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> userInfo = &#123;</span><br><span class="line">  name:<span class="string">"jack.ma"</span>,</span><br><span class="line">  age:<span class="number">13</span>,</span><br><span class="line">  sex:<span class="string">'male'</span>,</span><br><span class="line">  updateInfo:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//模拟xmlhttprequest请求延时</span></span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.name = <span class="string">"pony.ma"</span></span><br><span class="line">      <span class="keyword">this</span>.age = <span class="number">39</span></span><br><span class="line">      <span class="keyword">this</span>.sex = <span class="string">'female'</span></span><br><span class="line">    &#125;,<span class="number">100</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">userInfo.updateInfo()</span><br><span class="line"><span class="built_in">console</span>.log(userInfo)</span><br></pre></td></tr></table></figure><blockquote><p>分析：<br>  执行结果并不是修改用户信息，而是在全局 window 创建了 name/age/sex 属性并赋上相应的值<br>  具体原因正是函数中 this 的不继承性</p></blockquote><h3 id="解决办法："><a href="#解决办法：" class="headerlink" title="解决办法："></a>解决办法：</h3><ol><li><p>增加变量 <code>_this</code> 保存父级 this（userInfo 这个对象），这种方式会产生一个闭包</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> userInfo = &#123;</span><br><span class="line">  name:<span class="string">"jack.ma"</span>,</span><br><span class="line">  age:<span class="number">13</span>,</span><br><span class="line">  sex:<span class="string">'male'</span>,</span><br><span class="line">  updateInfo:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="keyword">this</span></span><br><span class="line">    <span class="comment">//模拟xmlhttprequest请求延时</span></span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      _this.name = <span class="string">"pony.ma"</span></span><br><span class="line">      _this.age = <span class="number">39</span></span><br><span class="line">      _this.sex = <span class="string">'female'</span></span><br><span class="line">    &#125;,<span class="number">100</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">userInfo.updateInfo()</span><br><span class="line"><span class="built_in">console</span>.log(userInfo) <span class="comment">//&#123;name: "jack.ma", age: 13, sex: "male", updateInfo: ƒ&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>call/apply/bind 对象冒充</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> userInfo = &#123;</span><br><span class="line">  name:<span class="string">"jack.ma"</span>,</span><br><span class="line">  age:<span class="number">13</span>,</span><br><span class="line">  sex:<span class="string">'male'</span>,</span><br><span class="line">  updateInfo:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//模拟xmlhttprequest请求延时</span></span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.name = <span class="string">"pony.ma"</span></span><br><span class="line">      <span class="keyword">this</span>.age = <span class="number">40</span></span><br><span class="line">      <span class="keyword">this</span>.sex = <span class="string">'female'</span></span><br><span class="line">    &#125;.call(<span class="keyword">this</span>),<span class="number">100</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">userInfo.updateInfo()</span><br><span class="line"><span class="built_in">console</span>.log(userInfo) <span class="comment">//&#123;name: "jack.ma", age: 13, sex: "male", updateInfo: ƒ&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>箭头函数，箭头函数不会自己创建 this，可以从上级执行上下文环境中继承 this</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> userInfo = &#123;</span><br><span class="line">  name:<span class="string">"jack.ma"</span>,</span><br><span class="line">  age:<span class="number">13</span>,</span><br><span class="line">  sex:<span class="string">'male'</span>,</span><br><span class="line">  updateInfo:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//模拟xmlhttprequest请求延时</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.name = <span class="string">"pony.ma"</span></span><br><span class="line">      <span class="keyword">this</span>.age = <span class="number">41</span></span><br><span class="line">      <span class="keyword">this</span>.sex = <span class="string">'female'</span></span><br><span class="line">    &#125;,<span class="number">100</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">userInfo.updateInfo()</span><br><span class="line"><span class="built_in">console</span>.log(userInfo) <span class="comment">//&#123;name: "jack.ma", age: 13, sex: "male", updateInfo: ƒ&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>传参</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> userInfo = &#123;</span><br><span class="line">  name:<span class="string">"jack.ma"</span>,</span><br><span class="line">  age:<span class="number">13</span>,</span><br><span class="line">  sex:<span class="string">'male'</span>,</span><br><span class="line">  updateInfo:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//模拟xmlhttprequest请求延时</span></span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params">_this</span>)</span>&#123;</span><br><span class="line">      _this.name = <span class="string">"pony.ma"</span></span><br><span class="line">      _this.age = <span class="number">42</span></span><br><span class="line">      _this.sex = <span class="string">'female'</span></span><br><span class="line">    &#125;(<span class="keyword">this</span>),<span class="number">100</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">userInfo.updateInfo()</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> browser </tag>
            
            <tag> 浏览器工作原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器工作原理——页面渲染</title>
      <link href="2020/11/18/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93/"/>
      <url>2020/11/18/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93/</url>
      
        <content type="html"><![CDATA[<p>按照渲染的时间顺序，流水线可分为如下几个阶段：</p><ul><li>构建 DOM 树</li><li>样式计算</li><li>布局阶段</li><li>分层</li><li>绘制</li><li>分块</li><li>光栅化</li><li>合成。</li></ul><a id="more"></a><ol><li>将 HTML 转换为浏览器能够理解的结构 —— DOM 树<pre class="mermaid">graph TDdocument[document] --> html[html]html-->head[head]html-->body[body]head-->link[link]body-->p[p]body-->div[div]p-->span[span]p-->渲染流程(渲染流程)span-->重点介绍(重点介绍)div-->p1[p]p1-->green(green)</pre></li><li>样式计算（Recalculate Style）<br>计算出 DOM 节点中每个元素的具体样式，分三步完成：</li></ol><ul><li>渲染引擎接收到 css 文本时，会执行一个转换操作，将 CSS 文本转换为浏览器可以理解的结构 —— styleSheets。document.styleSheets 可以查看样式 表包含的多种样式。</li><li>属性值的标准化操作。将属性值 2em/blue/bold 转换为渲染引擎容易理解的、标准化的计算值。</li><li>根据 css 的继承规则和层叠规则，计算出 Dom 树每个节点的具体样式。css 继承每个 dom 节点都包含父节点样式。<br><img src="https://static001.geekbang.org/resource/image/88/b2/88a3aac427cc7c09361eac01a85fc7b2.png" alt="chrome开发者工具-styleSheets"><br>图中，可以看出，样式表的继承关系， user agent styleSheets 是浏览器内置的默认样式<br>可以在 chrome 开发者工具 ——&gt; 选择 element，再选择 computed 子标签</li></ul><ol start="3"><li>布局<br>计算出 DOM 树中可见元素的几何位置，<strong>布局</strong>。额外构建一棵只包含可见元素布局树。<img src="http://www.plantuml.com/plantuml/svg/AqfDBadCIyz9LKXFpKijIYn9zKcip2yj2IbAJLMmiNa-PVwpZWbFTpG_tTZmRC54Epk5QYu5XIAu9XT_Nw2gbFnSEpiKSUVyt8BIajIKu9BA790voL2-GZ580AYubWkBVRfs2j59-IcLiLnv-IMf2ZcfQIKA-MamiRJyl1BTuiogL2i58uE22gxKl1G5a3ekYBokhbrq0RhE0anjoVav-KLMHUb96WOw1Zf6fgQQs4nAoIo3cbMKcPu1CGmiXcuSc5-U2b9afM1kO81aFj1ie0q6oEONW0n_jcFJi_cJdsrjVBwYcmjiAjH6GtJdGyGein9i1j22ejGK0000">布局树中忽略 head,display:none 的隐藏元素。</li></ol><p><strong>总结：</strong> html 页面内容被提交给渲染引擎，渲染引擎首先将 html 解析为浏览器可以理解的 DOM，接着根据 css 样式表计算出 DOM 树的所有节点的样式；最后计算出元素的几何坐标，将信息保存在 dom 树中。</p><ol start="4"><li>图层<br>渲染引擎还需要为特定的节点生成专用的图层，并生成一查对应的图层树（LayerTree），chrome 开发者工具，选择 layer 标签，可查看页面分层情况。</li></ol><ul><li>拥有层叠上下文的元素会被提升为单独的一层。其中包含明确的定位属性元素，透明和滤境属性。<br>z-index/position:fixed/filter/opacity</li><li>需要剪裁（clip）的地方也会被创建为图层 overflow: auto</li></ul><ol start="5"><li><p>图层绘制<br>渲染引擎实现图层绘制，会把一个图层的绘制拆分成很多小的 <strong>绘制指令</strong>，然后再把这些指令按照顺序组成一个待绘制列表，最终输出的是一个绘制列表。<br>绘制列表用来记录绘制的顺序和绘制指令的列表。<br>可以打开 chrome 开发者工具 -&gt; Layers 标签 -&gt; Document 查看绘制列表，拖动绘制列表，可以查看绘制过程。如下图：<br><img src="https://static001.geekbang.org/resource/image/30/70/303515c26fcd4eaa9b9966ad7f190370.png" alt="chrome 开发者工具查看layers绘制点"></p></li><li><p>栅格化（raster）操作<br>绘制列表用来记录绘制只是用来记录绘制顺序和绘制指令的列表，实际绘制操作由渲染引擎中的合成线程来完成。<strong>合成线程会将图层划分为图块（tile)</strong><br>合成线程会将视口（viewport）附近的图块来优先生成位图，实际生成位图的操作由栅格化来执行。栅格化，将图块生成位图。<br>渲染进程把生成图块的指令发送给GPU，然后在GPU中执行生成图块的位图，并保存在 GPU 内存中。</p></li><li><p>合成和显示<br>所有图块都被光栅化后，合成线程会生成一个绘制图块的命令 —— DrawQuad，DrawQuad 命令提交给浏览器进程。<br>浏览器进程中有一个叫 viz 的组件，用来接收合成线程发过来的 DrawQuad 命令，然后根据 DrawQuad 命令，将其页面绘制到内存中，最后再将内存显示在屏幕上。现在接收到的 html、css、JavaScript 就完美的显示在页面上了。</p></li></ol><h2 id="页面渲染"><a href="#页面渲染" class="headerlink" title="页面渲染"></a>页面渲染</h2><img src="http://www.plantuml.com/plantuml/svg/PL5DJy905BptLsou4w973fv8l6Z4g2VImz9kPAKVctqBf1gF618rOZH60mPkSk6WYGaHaJ_J3tw6svPgIszl9xCpyzumh3NnAK65O74Vp8UhvI2ON1VGXO9GZHDWjWK4rMtTKVD8iRY3EB5qmglSrWX06JM4QPGqWD8PRcFGE6L2kLGKbhZuimz_z92uOCZ-ZsmjMvT4TpOFlfO9oyJKEcvmWlM88fDK3lRLU3eIZa7Mynvsx9RuVn2-dfaKY70P9h7m-Zs_rq-vW6E91W4AwJWeRIuNhZ5E6EO42MeGKCj8iqsJYgoqF-xwus_lvYdUr7yVnyjY47_BaaI_5iD8O6XkgJbeEuwTlk9kzGIbczhK3MC6ZoEvdRkuzGO_KNSP84Tnbw_UzDaRJb0exbrrvSkTJTLiUvztgxUUzp995LZdTWUo3URk69grwRayLeNZpc4Bww7inaz9qYam0plABm00"><h2 id="重排、重绘、合成"><a href="#重排、重绘、合成" class="headerlink" title="重排、重绘、合成"></a>重排、重绘、合成</h2><h3 id="重排-——-更新元素的几何属性"><a href="#重排-——-更新元素的几何属性" class="headerlink" title="重排 —— 更新元素的几何属性"></a>重排 —— 更新元素的几何属性</h3><p>通过 JavaScript 或者 CSS 修改元素的几何位置属性（改变宽高）那么浏览器会触发重新布局并解析之后的几个子阶段，这个过程叫 <strong>重排</strong>，<code>重排需要更新完整的渲染流水线，开销也是最大的</code></p><h3 id="重绘-——-更新元素的绘制属性"><a href="#重绘-——-更新元素的绘制属性" class="headerlink" title="重绘 —— 更新元素的绘制属性"></a>重绘 —— 更新元素的绘制属性</h3><p>像修改 background 等属性，未改变元素的几何属性，不会触发布局阶段，直接进入绘制阶段，执行之后的子阶段，这个过程叫 <strong>重绘</strong>，<code>省去了布局和分层阶段，比重排执行效率高</code></p><p>减少重排重绘, 方法很多：</p><ol><li>使用 class 操作样式，而不是频繁操作 style</li><li>避免使用 table 布局</li><li>批量dom 操作，例如 createDocumentFragment，或者使用框架，例如 React</li><li>Debounce window resize 事件</li><li>对 dom 属性的读写要分离</li><li>will-change: transform 做优化</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> browser </tag>
            
            <tag> 浏览器工作原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo-插件系列</title>
      <link href="2020/11/17/hexo-%E6%8F%92%E4%BB%B6%E7%B3%BB%E5%88%97/"/>
      <url>2020/11/17/hexo-%E6%8F%92%E4%BB%B6%E7%B3%BB%E5%88%97/</url>
      
        <content type="html"><![CDATA[<h2 id="hexo-filter-sequence"><a href="#hexo-filter-sequence" class="headerlink" title="hexo-filter-sequence"></a>hexo-filter-sequence</h2><p>用于画时序图的，使用比较麻烦，<a href="https://github.com/bubkoo/hexo-filter-sequence" target="_blank" rel="noopener">参考1</a><a href="https://helenzhanglp.github.io/2019/01/31/hexo-%E5%9D%91/">参考2</a> 如果要画时序图，可以采用下面两种插件替换</p><h2 id="hexo-tag-plantuml"><a href="#hexo-tag-plantuml" class="headerlink" title="hexo-tag-plantuml"></a>hexo-tag-plantuml</h2><p>画各种图形，种类多。<a href="https://plantuml.com/zh/sequence-diagram" target="_blank" rel="noopener">使用方法具体参考文档</a><br>安装方法，<a href="https://github.com/two/hexo-tag-plantuml" target="_blank" rel="noopener">见 github</a></p><h2 id="hexo-filter-mermaid-diagrams"><a href="#hexo-filter-mermaid-diagrams" class="headerlink" title="hexo-filter-mermaid-diagrams"></a>hexo-filter-mermaid-diagrams</h2><p>可以用来画流程图、时序图等，但文档不全。<a href="https://github.com/webappdevelp/hexo-filter-mermaid-diagrams" target="_blank" rel="noopener">安装参考</a><br>使用方法见以下 demo.</p><a id="more"></a><pre class="mermaid">graph LR;    用户界面交互-->状态;    状态-->UI渲染;    UI渲染-->|用户界面与数据保持一致|数据;</pre>]]></content>
      
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器工作原理——从输入URL 到页面展示，这中间发生了什么</title>
      <link href="2020/11/17/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E4%BB%8E%E8%BE%93%E5%85%A5URL-%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%B1%95%E7%A4%BA%EF%BC%8C%E8%BF%99%E4%B8%AD%E9%97%B4%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/"/>
      <url>2020/11/17/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E4%BB%8E%E8%BE%93%E5%85%A5URL-%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%B1%95%E7%A4%BA%EF%BC%8C%E8%BF%99%E4%B8%AD%E9%97%B4%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/</url>
      
        <content type="html"><![CDATA[<h2 id="1-用户输入"><a href="#1-用户输入" class="headerlink" title="1. 用户输入"></a>1. 用户输入</h2><pre class="mermaid">graph TD;    A[用户输入] --> B{判断用户输入关键字}    B --> C[用户搜索]    B --> D[加协议合成完整的 URL]    D --> |用户可以在beforeunload事件上取消导航 或 执行退出来的数据清理|E{beforeunload<br>询问用户是否离开页面}    E --> |用户同意继续后续流程|F[等待提交文档页面进入加载状态]    E --> |beforeunload取消导航|G[留在当前页面]</pre><a id="more"></a><h2 id="2-URL-请求过程"><a href="#2-URL-请求过程" class="headerlink" title="2. URL 请求过程"></a>2. URL 请求过程</h2><p>浏览器会通过进程间通信（IPC) 把 url 请求发送至网络进程。接下来网络进程发起真正的 url 请求流程。</p><pre class="mermaid">graph TD;  A[网络进程] --> B{本地缓存}  B --> C[缓存]  B --> D[网络请求]  C --> browser[浏览器主进程]  D --> |1.获取服务品IP端口号<br>2.如果是https协议需要建立TLS链接|DNS[DNS解析]  DNS --> TCP[建立 tcp 连接]  TCP --> |浏览器构建请求头请求行cookie等数据|b[向服务器发起构建请求]  b --> |响应头响应行响应体|s[服务端解析请求生成响应数据]  s --> D</pre><p>1.网络进程首先要找缓存，如果有缓存，直接返回资源给浏览器进程；<br>2.没有缓存资源，则进程 dns 解析，拿到 ip 和 端口。若 https 请求，还需要建立 TLS 连接；<br>3.建立 tcp 链接，浏览器构建请求行、请求头，并把和该域名相关的 cookie 等数据加入请求头；</p><h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><p>接收到服务器的响应头后，网络进程开始解析响应头，如果发现返回的状态码 301 或 302，说明需要浏览器重定向到其它 url, 这里网络进程会从响应头的 location 字段中读取重定向的地址，再次发起请求。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 302 Found</span><br><span class="line">Server: Tengine</span><br><span class="line">Date: Tue, 17 Nov 2020 09:05:14 GMT</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 258</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Location: http://www.taobao.com/</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 307 Internal Redirect</span><br><span class="line">Location: https://www.taobao.com/</span><br><span class="line">Non-Authoritative-Reason: HSTS</span><br></pre></td></tr></table></figure><p><code>content-type</code> 返回的数据类型，<code>text/html</code> 返回的是 html 类型，浏览器会继续渲染。如果 <code>content-type: application/octet-stream</code> 类型，那么显示的数据是字节流类型的。请求会被提交给<strong>浏览器的下载管理器，同时 url 结束导航</strong></p><h2 id="3-准备渲染进程"><a href="#3-准备渲染进程" class="headerlink" title="3. 准备渲染进程"></a>3. 准备渲染进程</h2><h3 id="同一站点（same-site）"><a href="#同一站点（same-site）" class="headerlink" title="同一站点（same-site）"></a>同一站点（same-site）</h3><p>根域名加上协议，还包括根域名下的所有子域名和不同端口。都为<strong>同一站点</strong></p><h3 id="process-per-site-instance"><a href="#process-per-site-instance" class="headerlink" title="process-per-site-instance"></a>process-per-site-instance</h3><p>默认一个标签对应一个渲染进程，如果从一个页面打开另一个新页面，而新页面和当前页面属于同一站点的话，那么新页面复用父页面的渲染进程。</p><h2 id="4-提交文档"><a href="#4-提交文档" class="headerlink" title="4. 提交文档"></a>4. 提交文档</h2><p>提交文档是指浏览器进程将网络进程接收到的 HTML 数据提交给渲染进程。</p><pre class="mermaid">graph TDnetwortProcess[网络进程] --> |数据管道<br>提交文档|renderProcess[渲染进程]renderProcess-->|确认提交|browserProcess[浏览器进程<br>更新包括安全状态<br>地址栏的 url<br>前进后退的历史状态<br>更新 web 页面]</pre><h2 id="5-渲染阶段"><a href="#5-渲染阶段" class="headerlink" title="5. 渲染阶段"></a>5. 渲染阶段</h2><h2 id="时序图"><a href="#时序图" class="headerlink" title="时序图"></a>时序图</h2><img src="http://www.plantuml.com/plantuml/svg/TLFTIXj15BwVfnYy5zfw8UH2QEj51P6muWFCxfx6GJEpdPrjx5rI1DEVg86sf3484R6XKAEGOgbA7gRkxEGjEhjfR2VTNCsUl--SxtndNRw3vrp1Ao48N2QKuK1m3y9m3WL4IEhHW3298nDUOK4aBUycOVusPFvb8ebT8RRNo4jQ8f8BA-20JmLuDb8Wm9ZW0FD15CSJM0aUPy-fA2zpBoe3a-kHMwOIV2kd0cwHb62L4zz431Hs-Gv2RagHWQnmiPNFBZIv6ywg0oyY2Et1113VWJ3WB8HdvXl4pF0Jxh-QwYeoFZEQPXGcXEnj4152IkKnyrCswpmI7lp5lbS3pozDYr30gjLFFlHK_KeTTfB1YHwsZ2VL0yVz6rt_YgOgyBn1iUJwryYYze8AU5Hjw-4UNYa-nNS_zfFRPdBTqSEZfFVEHEw6NSIu12neQLCYzVr0Vwd7dtlgU3U-_gdxL-hoTNmw-5MjeR6Xk-zJ8pvigauZVjirkV51SrIj9UrT8ppVee2IRs_KnmlLEC-saCAZ_wN9PftSLm4lF7Y8LVsJUH_zUHVnVGVT7wZM_gXJrMUrqLuZFc-R_cXIdCDwLh_yqyrnZZ5jrMqpovXrwTEdDcwUVodvxgp2-ab-0m00">]]></content>
      
      
      
        <tags>
            
            <tag> browser </tag>
            
            <tag> 浏览器工作原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器工作原理——chrome 打开一个页面执行的进程</title>
      <link href="2020/11/13/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94chrome%E6%89%93%E5%BC%80%E4%B8%80%E4%B8%AA%E9%A1%B5%E9%9D%A2%E6%89%A7%E8%A1%8C%E7%9A%84%E8%BF%9B%E7%A8%8B/"/>
      <url>2020/11/13/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94chrome%E6%89%93%E5%BC%80%E4%B8%80%E4%B8%AA%E9%A1%B5%E9%9D%A2%E6%89%A7%E8%A1%8C%E7%9A%84%E8%BF%9B%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<blockquote><h2 id="知识点："><a href="#知识点：" class="headerlink" title="知识点："></a>知识点：</h2><blockquote><h3 id="进程和线程"><a href="#进程和线程" class="headerlink" title="进程和线程"></a><a href="#进程和线程">进程和线程</a></h3><pre><code>进程和线程相关以及合并处理</code></pre><h3 id="单进程浏览器时代"><a href="#单进程浏览器时代" class="headerlink" title="单进程浏览器时代"></a><a href="#单进程浏览器时代">单进程浏览器时代</a></h3><pre><code>单进程浏览器时代的问题在于插件、渲染进程、主线程都处于同一进程，会引发安全、稳定性和流畅性的问题</code></pre><h3 id="多进程浏览器时代"><a href="#多进程浏览器时代" class="headerlink" title="多进程浏览器时代"></a><a href="多进程浏览器时代">多进程浏览器时代</a></h3></blockquote></blockquote><p>浏览器多进程架构<br>基于 Chrome 分析浏览器多进程架构<br><strong>Chrome 启动一个页面需要启动多少进程——<code>启动 Chrome 任务管理器查看</code></strong></p><blockquote><p>chrome 选项 -&gt; more tools -&gt; task manager<br><img src="https://static001.geekbang.org/resource/image/ce/9e/ce7f8cfe212bec0f53360422e3b03a9e.png" alt="img"></p></blockquote><a id="more"></a><p>网络流程、<br>页面渲染过程、<br>javascript 执行流程<br>网络安全理论</p><h2 id="1-进程和线程"><a href="#1-进程和线程" class="headerlink" title="1. 进程和线程"></a><a name="进程和线程">1. 进程和线程</a></h2><p>多线程并行处理任务<br>线程由进程启动管理，不能单独存在</p><h3 id="1-1-进程"><a href="#1-1-进程" class="headerlink" title="1-1. 进程"></a>1-1. 进程</h3><p>一个进程是一个程序的运行实例<br>进程 —— 启动一个程序的时候，操作系统会为该程序创建一块内存，用于 <strong>存放代码</strong> 及 <strong>运行中的数据</strong> 和 <strong>一个执行任务的主线程</strong>。</p><h3 id="1-2-并行处理"><a href="#1-2-并行处理" class="headerlink" title="1-2. 并行处理"></a>1-2. 并行处理</h3><p>同一时间处理多个任务</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span>+<span class="number">2</span></span><br><span class="line">b = <span class="number">2</span>*<span class="number">1</span></span><br><span class="line">c = <span class="number">3</span>%<span class="number">2</span></span><br></pre></td></tr></table></figure><p>以上代码分四个任务，前三个任务是分别计算 a,b,c，第四个任务是计算结果。如果采用单线程，则按顺序执行四个任务。多线程分两步，一是三个线程同时执行前三个任务；第二步执行第四个任务。多线程 <strong>并行处理提升性能</strong></p><blockquote><p>线程是依附于进程的，而进程中使用多线程并行处理提升运算效率</p></blockquote><h3 id="1-3-进程和线程之间的关系"><a href="#1-3-进程和线程之间的关系" class="headerlink" title="1-3. 进程和线程之间的关系"></a>1-3. 进程和线程之间的关系</h3><ol><li>进程中做任意一线程执行出错，会导致整个线程崩溃</li><li>线程之间共享进程中的数据</li><li>当一个进程关闭后，操作系统会回收进程所占用的内存<br>当一个进程关闭之后，操作系统会回收进程所申请的所有资源；即使其中任意线程因为操作不当导致内存泄漏，当进程退出时，这些内存也会被正确回收。</li><li>进程之间的内容相互隔离<br>进程隔离是为了保护系统中进程互不干扰的技术。每个进程只能访问自己占有的数据，避免出现进程A写入数据到进程B。进程之间的数据严格隔离，如果一个进程崩溃或挂起，不会影响到其他进程。如果进程之间需要进行数据通信，需要使用用于进程间通信（IPC）机制</li></ol><h2 id="2-单进程浏览器时代"><a href="#2-单进程浏览器时代" class="headerlink" title="2. 单进程浏览器时代"></a><a name="单进程浏览器时代">2. 单进程浏览器时代</a></h2><blockquote><p>浏览器的所有功能模块（像网络、插件、javascript 运行环境、渲染引擎和页面）运行在同一个进程里。多个功能模块运行在一个进程中，导致浏览器不稳定、不安全、不流畅。</p></blockquote><h3 id="2-1-不稳定"><a href="#2-1-不稳定" class="headerlink" title="2-1. 不稳定"></a>2-1. 不稳定</h3><p>2007 年以前的浏览器大多是单进程，一些如 web 视频、web 游戏等功能需要借助插件实现。插件易出问题并且运行在浏览器进程中，一个插件崩溃，会导致整个浏览器崩溃。渲染引擎同样不稳定，一些复杂的 JavaScript 代码会使得渲染引擎模块崩溃。进而使得浏览器崩溃。</p><h3 id="2-2-不安全"><a href="#2-2-不安全" class="headerlink" title="2-2. 不安全"></a>2-2. 不安全</h3><p>不安全同样是因为需要实现高级功能的插件引起的，插件用 C/C++ 编写，可获取操作系统的任意资源，当页面运行一个恶意插件时，它便可以释放病毒、窃取帐号密码从而引发安全问题<br>页面脚本同样可以通过浏览器的漏洞获取系统权限，这些脚本获取系统权限后，同样可以做些恶意的事情</p><h3 id="2-3-不流畅"><a href="#2-3-不流畅" class="headerlink" title="2-3. 不流畅"></a>2-3. 不流畅</h3><p>单进程浏览器中，页面的渲染模块、JavaScript 执行环境以及插件都运行在同一个线程中，也就意味着同一时刻只能有一个模块可以执行。<br>一个无限循环的脚本 会占整个线程，会导致其它运行在该线程中的模块没有机会执行，整个浏览器失去响应，变卡顿。<br>页面内存泄漏，当运行一个复杂点的页面再关闭，会存在内存不能完全回收，时间越长，内存占用越高，浏览器会越慢</p><h2 id="3-多进程浏览器时代"><a href="#3-多进程浏览器时代" class="headerlink" title="3. 多进程浏览器时代"></a><a name="多进程浏览器时代">3. 多进程浏览器时代</a></h2><h3 id="3-1-早期的多进程浏览器时代"><a href="#3-1-早期的多进程浏览器时代" class="headerlink" title="3-1. 早期的多进程浏览器时代"></a>3-1. 早期的多进程浏览器时代</h3><img src="http://www.plantuml.com/plantuml/svg/ZP71Ji9048RlVOeDNlI29nDJ2GSzwOdeKJpKTejDcfPigpw0H451ggYne1AY2HmK5KKRQ_Lbsjtbv2jOMcAeOdHlC_ddtt--uLLPXhmkgOe6OhXywDfFzBr6MdjfPJmbhsSa1QIGoaDDcuW1JWFPe3TeWJ5H56TaIO5nWTFMeC0mVCJFwk1wvSjl4Ie2H54_5FI6_HX5rI50KcPD1whuNJ0rBR9Ws9U-6xHHn1sJjEzTw-RZjPXMNAj4jnnwQtlR9cbSazgfQ-sIQWuVt-5IUrYo_-oLJt2bv3fdvC4cTXsVR_LC8yoWgzb_9NYiqyTB5gILn6gIDY_nXP6ON4q6PQWBomLkWrlYaPJL0Iuq_T2UaSTvWpW7lKRNgxsHmWx3HFd6u_7ezooOJytvb3aaW5caRcfHTc2P0Vx3tJ9jvZspvLfscD5lZm_qN_m3gPynuTzCHIo2GlBdOBYSQ-rHnw7T77xnTmlqoVvI8on8kq6CxNxCFuJuz8rSlGo394VrFezgBeGHcLyPXIPAWEsZYHxh5z4d"><p><strong><center>【2008 年 Chrome 进程框架图】</center></strong></p><p>Chrome 页面运行在渲染进程中，页面中的插件运行在插件进程中，进程之间通过 IPC 机制进行通信</p><h4 id="3-1-1-针对单进程浏览器不稳定、不流畅、不安全"><a href="#3-1-1-针对单进程浏览器不稳定、不流畅、不安全" class="headerlink" title="3-1-1. 针对单进程浏览器不稳定、不流畅、不安全"></a>3-1-1. 针对单进程浏览器不稳定、不流畅、不安全</h4><ol><li>解决不稳定<br>单进程浏览器不稳定的原因有两个：一是插件崩溃导致的，在多进程浏览器中，插件由插件进程中。进程之间相互隔离，不会影响到其它进程。渲染引擎引起的不稳定同理。</li><li>解决不安全<br>渲染页面是在沙箱中进行的，不能在硬盘上写入任何数据，也不能在敏感位置读取数据，恶意程序不能通过沙箱破坏系统，解决了 <strong>不安全</strong> 的问题。</li><li>解决不流畅<br>Javascript 渲染进程中，阻塞渲染进程，并不会影响到浏览器其它页面，脚本运行在自己的渲染进程中，死循环影响的仅仅是当前页面的渲染进程，解决了 <strong>不流畅</strong> 的问题。内存泄漏，只需要关闭当前页面，资源就能被系统回收。</li></ol><h3 id="3-2-目前的多进程框架"><a href="#3-2-目前的多进程框架" class="headerlink" title="3-2. 目前的多进程框架"></a>3-2. 目前的多进程框架</h3><img src="http://www.plantuml.com/plantuml/svg/RPBDJjj058NtUOehsBGBO55LGXIne9MgTeM4w0QpC8dpKymOsMvPL4ZG8198Ga8e9OK428KsRGcXLG3NZidBp8oTLL-XW-qOB6AlvjoPE-UxPsGXhF8e9WhGn_x-Q3JwJ4mWOJ32At4X0Xz20AeK4zIu83iBWB0aYknGGa8AzD5y4HjNTdlVgcKuz6X2V1TB89YGfR2WA8_xW5TWmT4ywS4DJaiagGB8YLXS1IdQuy08sCr3k_crUrl1hcR_jR8SmksAtLZ1MWwtziZ-aLidpHzKJtA8D5fsgaaly_RtDFbI8yLifthPgHoJ_2unVvFjN0ySxGyztFPnP05513b04v0SStS4eX1r01xk6O7xdQszLNgaaNOI6mRPg79eT7QCNAn1N9qNXyAAClIMVyyhOJcne7B8DizexXXhklMfHjFN9D_0nYdMJx1UP7rSej6XsJ4EqSsYjPuchHswlGdZRCPpm9ZXjTyCl1g7uCqmT98cBJNSOP9opMwSkkwmLcT8Iw4UoVDo192WBahod4_tT3WAqquPm3AtBAFijl4aDpYlSBbAzGBPEB9DqolZlncodiDccG5YRHbhFscjIYgxlYq_lllcRZzQNhRRMrRcpFgL8IcTLaxPYmWq-dp11dJFpCmTnBWiBIh1Y7m8_qQi6G6Ks_Mt5Gze9ylcJaitredUXNVoSPFn958lU8cVLwt2MbSjPEdk5SqNyCq-gPV8nvfLNoSRXtRIz7pU6NqvCTLpqamFU6DhOBGaNR6hronMSdvWRLx0anVmV78Iw4wQ7fIzhU6uBCqBjxjXwXMu89rKYjbtkh11MaQ9fA_ycJbF8VYc1wRxLPb7oWBFT7LcO2puAa9BeVy0"><p>因为每个进程都会包含基本框架副本，多进程浏览器会 <strong>占用更高资源</strong>，这就意味着浏览器会消耗更多内存资源。更复杂的体系架构，模块之间会有耦合高，扩展性差。现在的框架难适应新的需求。</p><h2 id="面向服务的架构-Services-Oriented-Architecture-SOA"><a href="#面向服务的架构-Services-Oriented-Architecture-SOA" class="headerlink" title="面向服务的架构(Services Oriented Architecture,SOA)"></a>面向服务的架构(Services Oriented Architecture,SOA)</h2><p>也就是说 Chrome 会朝向现代操作系统所采用的“面向服务的架构”方向发展，原来的各种模块会被重构成独立的服务（Service），每个服务都在独立的进程中运行。访问服务必须采用接口，通过 ipc 来通信，从而构建一个更内聚，松耦合、易于维护和扩展的系统，更好的实现 Chrome 简单、稳定、高速、安全的目标。</p>]]></content>
      
      
      
        <tags>
            
            <tag> browser </tag>
            
            <tag> 浏览器工作原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器工作原理——http</title>
      <link href="2020/11/12/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94http/"/>
      <url>2020/11/12/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94http/</url>
      
        <content type="html"><![CDATA[<p>XHR -&gt; Request Headers -&gt; view source</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET /shakespeare/jsd/exchange_rates/current HTTP/1.1</span><br><span class="line">Host: www.jianshu.com</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Accept: application/json</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.121 Safari/537.36</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Referer: https://www.jianshu.com/p/6dbcc3aff98b</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line">Cookie: __yadk_uid=b5C1W8FTbvn2CMErMOWLRvRBfqtcfZyR; _ga=GA1.2.1361763253.1581860875; __gads=ID=e22e0402239bcdd8-22e9450047c200f4:T=1593494469:RT=1593494469:S=ALNI_MbgAdC1pDH1wBUKwaWC6teLb00cyg; read_mode=day; default_font=font2; locale=zh-CN; UM_distinctid=175537082be1a1-08e93312a69e19-4d112a29-38400-175537082bf1b5; CNZZDATA1278917561=2017572215-1603418142-https%253A%252F%252Fwww.jianshu.com%252F%7C1603447023; sensorsdata2015jssdkcross=%7B%22distinct_id%22%3A%2216e7305e1e716c-046300c902b66b-123b6a5d-1024000-16e7305e1e881a%22%2C%22%24device_id%22%3A%2216e7305e1e716c-046300c902b66b-123b6a5d-1024000-16e7305e1e881a%22%2C%22props%22%3A%7B%22%24latest_referrer%22%3A%22https%3A%2F%2Fwww.baidu.com%2Flink%22%2C%22%24latest_traffic_source_type%22%3A%22%E8%87%AA%E7%84%B6%E6%90%9C%E7%B4%A2%E6%B5%81%E9%87%8F%22%2C%22%24latest_search_keyword%22%3A%22%E6%9C%AA%E5%8F%96%E5%88%B0%E5%80%BC%22%7D%7D; _gid=GA1.2.1053313438.1605150552; _m7e_session_core=559108e9b8dcd6adff1770cd4662ce96; signin_redirect=https://www.jianshu.com/p/6dbcc3aff98b; Hm_lvt_0c0e9d9b1e7d617b3e6842e85b9fb068=1604707994,1604975982,1605150555,1605156601; _gat=1; Hm_lpvt_0c0e9d9b1e7d617b3e6842e85b9fb068=1605170209</span><br></pre></td></tr></table></figure><a id="more"></a><p>HTTP 是一种允许浏览器向服务器发起资源的请求的协议，是 Web 的基础。</p><h2 id="浏览器发起-HTTP-请求流程"><a href="#浏览器发起-HTTP-请求流程" class="headerlink" title="浏览器发起 HTTP 请求流程"></a>浏览器发起 HTTP 请求流程</h2><ol><li><p>构建请求</p><blockquote><p>GET /shakespeare/jsd/exchange_rates/current HTTP/1.1</p></blockquote></li><li><p>查找缓存<br>浏览器缓存是在本地保存资源副本，以供下次请求时直接使用的技术。如果浏览器资源的副本存在，请求被拦截，返回副本，结束请求。从而缓解服务器压力，提升性能。对于网站来说，缓存是实现资源加载最重要的部分。</p></li><li><p>准备 IP 和 端口 并等待 TCP 队列<br>如果浏览器请求缓存资源失败，就会进入网络请求。<br>怎么通过 url 获取 ip 地址和端口号呢？ip 地址是数字标识，从请求里面可获取，如下请求 ip 地址为 47.92.108.93：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Request URL: https://www.jianshu.com/shakespeare/jsd/exchange_rates/current</span><br><span class="line">Request Method: GET</span><br><span class="line">Status Code: 200 OK</span><br><span class="line">Remote Address: 47.92.108.93:443</span><br><span class="line">Referrer Policy: no-referrer-when-downgrade</span><br></pre></td></tr></table></figure></li></ol><p>ip 数字难记。我们一般记的是域名，如上请求 <code>jianshu.com</code>，需要使用 <strong>域名系统</strong> （Domain Name System，DNS）将域名和ip进行映射。浏览器有<code>DNS</code>数据缓存服务。<strong><code>总结下来：第一步浏览器从 DNS 缓存数据里面查找 ip，如果没有再请求 DNS 返回域名对应的 ip</code></strong><br>端口号在没有指定的情况下是 80 端口，像上面的案例中，端口号为 443。</p><blockquote><p>chrome 机制，同一个域名最多只建立 6 个 tcp 链接，多于 6 个请求会进入排队等待状态，走到进行中的请求完成。</p></blockquote><ol start="4"><li><p>建立 TCP 连接<br>三次握手，传输数据，断开链接</p></li><li><p>发送 HTTP 请求<br>建立 TCP 链接后浏览器和服务器便可以通信了。</p></li></ol><ul><li>发送请求行，包括请求方法、请求的 URI(Uniform Resource Identifier)统一资源标识、HTTP 版本协议<blockquote><p>GET /shakespeare/jsd/exchange_rates/current HTTP/1.1</p></blockquote></li></ul><p>上面的案例是 get 请求，除此之外还有 post 请求，即发送一些数据给服务器，浏览器会把需要发送给服务器的数据通过<code>请求体</code>发送。<br>发送请求行之后，浏览器还要以<code>请求头</code>形式发送一些其他信息，把浏览器的基本信息告诉给服务器。</p><blockquote><p>User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.121 Safari/537.36<br>Host: <a href="http://www.jianshu.com" target="_blank" rel="noopener">www.jianshu.com</a><br>Cookie: __yadk_uid=b5C1W8FTbvn2CMErMOWLRvRBfqtcfZyR; _ga=GA1.2.1361763253.1581860875;</p></blockquote><h2 id="服务器处理-HTTP-请求"><a href="#服务器处理-HTTP-请求" class="headerlink" title="服务器处理 HTTP 请求"></a>服务器处理 HTTP 请求</h2><ol><li>返回请求<br>可以通过命令 <code>curl -i https://www.jianshu.com/p/6dbcc3aff98b</code> 查看返回的请求数据，如响应行，响应头，响应体等数据<br><code>curl -I jianshu.com</code> -I 只获取响应头和响应行数据。</li></ol><p>Response Headers</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: Tengine</span><br><span class="line">Date: Thu, 12 Nov 2020 08:36:49 GMT</span><br><span class="line">Content-Type: application/json; charset=utf-8</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">X-Frame-Options: DENY</span><br><span class="line">X-XSS-Protection: 1; mode=block</span><br><span class="line">X-Content-Type-Options: nosniff</span><br><span class="line">ETag: W/&quot;4a327be29535622a46f3b610df2a02c1&quot;</span><br><span class="line">Cache-Control: max-age=0, private, must-revalidate</span><br><span class="line">Set-Cookie: locale=zh-CN; path=/</span><br><span class="line">Set-Cookie: _m7e_session_core=559108e9b8dcd6adff1770cd4662ce96; domain=.jianshu.com; path=/; expires=Thu, 12 Nov 2020 14:36:49 -0000; secure; HttpOnly</span><br><span class="line">X-Request-Id: 503c9b5a-3190-4e2a-9060-ead15564caa1</span><br><span class="line">X-Runtime: 0.007053</span><br><span class="line">Strict-Transport-Security: max-age=31536000; includeSubDomains; preload</span><br><span class="line">Content-Encoding: gzip</span><br></pre></td></tr></table></figure><p><strong>响应行</strong> <code>HTTP/1.1 200 OK</code> 协议版本与状态码。我们这里的状态码是 200 表示处理成功，遇到其它无法处理或处理出错的会有其它的状态码，如：没有找到返回页面 404。301 状态码表示重定向，需要重定向的网址包含在 <strong>响应头</strong> Location 字段中。<br>服务器随响应向浏览器发送 <strong>响应头</strong> 信息。包括了：<br><code>Date: Thu, 12 Nov 2020 08:36:49 GMT</code> 返回数据的时间；<br><code>Content-Type: application/json; charset=utf-8</code> 返回数据的类型；<br><code>Set-Cookie: _m7e_session_core=559108e9b8dcd6adff1770cd4662ce96; domain=.jianshu.com; path=/; expires=Thu, 12 Nov</code> 服务器在客户端保存的 cookie。</p><ol start="2"><li>断开链接<br>通常情况下，服务向浏览器返回数据后，会断开链接。<code>Connection: keep-alive</code> 表示 TCP 连接在发送后保持打开状态，浏览器可以通过同一个 TCP 发送请求。<strong>保持 TCP 连接可以省去下次请求建立连接的时间，提升资源加载速度</strong></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> browser </tag>
            
            <tag> 浏览器工作原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器工作原理——数据的传输过程</title>
      <link href="2020/11/11/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E6%95%B0%E6%8D%AE%E7%9A%84%E4%BC%A0%E8%BE%93%E8%BF%87%E7%A8%8B/"/>
      <url>2020/11/11/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E6%95%B0%E6%8D%AE%E7%9A%84%E4%BC%A0%E8%BE%93%E8%BF%87%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>First Print 简称 FP，是指页面加载到首次开始绘制的时长。网络的加载速度是影响 FP 的重要因素。网络协议 HTTP、WebSocket 都是基于 TCP/IP 的。那么 web 世界中，TCP/IP 是如何工作的呢？</p><h2 id="数据的传输过程"><a href="#数据的传输过程" class="headerlink" title="数据的传输过程"></a>数据的传输过程</h2><p>互联网中数据是通过数据包传递。如果数据量很大时会拆成很多小的数据包传输。</p><h3 id="1-数据包如何送达主机"><a href="#1-数据包如何送达主机" class="headerlink" title="1.  数据包如何送达主机"></a>1.  数据包如何送达主机</h3><p>数据包在互联网上进行传输需要符合网际协议（Internet Protocol, IP）标准。</p><div id="sequence-0"></div><a id="more"></a><h3 id="2-主机如何将数据转交给应用"><a href="#2-主机如何将数据转交给应用" class="headerlink" title="2.  主机如何将数据转交给应用"></a>2.  主机如何将数据转交给应用</h3><p>通过用户数据协议（User Datagram Protocol）把指定的数据包发送给指定的程序。UDP 通过端口号把数据包分发给正确的程序。</p><div id="sequence-1"></div><h3 id="3-数据是如何被完整地送达应用程序"><a href="#3-数据是如何被完整地送达应用程序" class="headerlink" title="3.  数据是如何被完整地送达应用程序"></a>3.  数据是如何被完整地送达应用程序</h3><p>UDP 存在两个问题：</p><ol><li>传输过程中容易丢包；</li><li>大文件拆分成多个小文件传输，这些文件会经过不同的路由器，在不同的时间送达接收端。UDP 不知道如何组装这些数据包，把这些数据包还原成完整的文件。</li></ol><p>TCP(Transmission Control Protocol,传输控制协议)。面向链接、可靠、基于字节流的传输层通信协议。</p><p>TCP 的优点在于：</p><ol><li>对于丢包的情况会提供重传机制；</li><li>TCP 引入数据包排序机制，保证乱序数据包组合成一个完整的文件。</li></ol><div id="sequence-2"></div><p>TCP 的生命周期包括：<code>建立连接</code>、<code>传输数据</code>、<code>断开链接</code></p><ul><li><code>建立连接阶段</code>。这个阶段是通过“三次握手”来建立客户端和服务器之间的连接。TCP 提供面向连接的通信传输。面向连接是指在数据通信开始之前先做好两端之间的准备工作。所谓三次握手，是指在建立一个 TCP 连接时，客户端和服务器总共要发送三个数据包以确认连接的建立。</li><li><code>传输数据阶段</code>。在该阶段，接收端需要对每个数据包进行确认操作，也就是接收端在接收到数据包之后，需要发送确认数据包给发送端。所以当发送端发送了一个数据包之后，在规定时间内没有接收到接收端反馈的确认消息，则判断为数据包丢失，并触发发送端的重发机制。同样，一个大的文件在传输过程中会被拆分成很多小的数据包，这些数据包到达接收端后，接收端会按照 TCP 头中的序号为其排序，从而保证组成完整的数据。</li><li><code>断开连接阶段</code>。数据传输完毕之后，就要终止连接了，涉及到最后一个阶段“四次挥手”来保证双方都能断开连接。<script src="https://cdnjs.cloudflare.com/ajax/libs/webfont/1.6.27/webfontloader.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/snap.svg/0.4.1/snap.svg-min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.6/sequence-diagram-min.js"></script><textarea id="sequence-0-code" style="display: none">Note left of 主机A: 主机A\n上层数据包交给\n网络层Note left of 主机A: 主机A\n网络层带ip头与数据包\n交给底层主机A-->主机B:主机A通过底层将数据包与ip头交给主机BNote right of 主机B: 主机B\n网络层数据包\n交给上层Note right of 主机B: 数据包到达\n主机B上层</textarea><textarea id="sequence-0-options" style="display: none">{"theme":"simple"}</textarea><script>  var code = document.getElementById("sequence-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("sequence-0-options").value));  var diagram = Diagram.parse(code);  diagram.drawSVG("sequence-0", options);</script><textarea id="sequence-1-code" style="display: none">上层-->传输层:主机A\n上层将数据包给到\n传输层传输层-->网络层:主机A传输层\n将数据包与UDP头\n给到网络层网络层-->底层:主机A\n将数据包、UDP外加IP头\n给到低层底层->底层:主机A底层\n将数据、UDP头、IP 头\n给到主机B底层-->网络层:网络层解开ip，\n将数据与UDP给到传输层网络层-->传输层:传输层解开 udp 头，\n识别端口号将数据\n给到上层应用上层->上层:主机B某应用\n最终拿到数据</textarea><textarea id="sequence-1-options" style="display: none">{"theme":"simple"}</textarea><script>  var code = document.getElementById("sequence-1-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("sequence-1-options").value));  var diagram = Diagram.parse(code);  diagram.drawSVG("sequence-1", options);</script><textarea id="sequence-2-code" style="display: none">上层-->传输层:主机A\n上层将数据包给到\n传输层传输层-->网络层:主机A传输层\n将数据包与TCP头\n给到网络层网络层-->底层:主机A\n将数据包、TCP外加IP头\n给到低层底层->底层:主机A底层\n将数据、TCP头、IP 头\n给到主机B底层-->网络层:网络层解开ip，\n将数据与TCP给到传输层网络层-->传输层:传输层解开 TCP 头，\n识别端口号将数据\n给到上层应用上层->上层:主机B某应用\n最终拿到数据</textarea><textarea id="sequence-2-options" style="display: none">{"theme":"simple"}</textarea><script>  var code = document.getElementById("sequence-2-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("sequence-2-options").value));  var diagram = Diagram.parse(code);  diagram.drawSVG("sequence-2", options);</script></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> browser </tag>
            
            <tag> 浏览器工作原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器兼容问题</title>
      <link href="2020/11/10/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E9%97%AE%E9%A2%98/"/>
      <url>2020/11/10/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h3 id="windows-safari-浏览器对于-UTC-amp-amp-GMT-时间转换存在兼容性问题。"><a href="#windows-safari-浏览器对于-UTC-amp-amp-GMT-时间转换存在兼容性问题。" class="headerlink" title="windows safari 浏览器对于 UTC &amp;&amp; GMT 时间转换存在兼容性问题。"></a>windows safari 浏览器对于 UTC &amp;&amp; GMT 时间转换存在兼容性问题。</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line"><span class="comment">// Tue Nov 10 2020 11:58:59 GMT+0800 (China Standard Time)</span></span><br></pre></td></tr></table></figure><p>GMT(Greenwich Mean Time) 格林尼治标准时间<br>GMT+0800(China Standard Time) 北京时间</p><p>UTC(Universal Time Coordinated)协调世界时。当前的世界标准时间。<br>UTC 标准时间格式 <code>2019-11-11T00:00:00.000Z</code></p><ol><li><code>T</code>代表使用 UTC 时间。</li><li><code>Z</code>是 UTC 的偏移量，表示 UTC 时间与本地时间的差别，即时差。<ul><li>Z 表示 0 时区，写 Z 或不写时表示不偏移。即 GMT/0 时区。</li><li>需要偏移时，将Z替换为真实的偏移量。偏移量可用以下形式表示: ±[hh]:[mm]、±[hh][mm]、±[hh]。</li><li>目前有39个UTC偏移量（当伊朗试行夏令时时只有38个）</li></ul></li><li>时间数值表示在限定 UTC 格式和偏移量的情况下，偏移时区的本地时间。</li></ol><p>UNIX TIME，也叫做 POSIX 时间或纪元时间（Epoch Time)，记录时间流逝，也叫时间戳。定义为从1970-01-01T00:00:00开始流逝的秒数，不考虑闰秒。之后的时间是正数，之前的是负数。</p><p>需要补充，转换方法</p>]]></content>
      
      
      
        <tags>
            
            <tag> grocery </tag>
            
            <tag> browser </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript 数组</title>
      <link href="2020/11/06/Javascript-%E6%95%B0%E7%BB%84/"/>
      <url>2020/11/06/Javascript-%E6%95%B0%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<h2 id="数组重组方法"><a href="#数组重组方法" class="headerlink" title="数组重组方法"></a>数组重组方法</h2><h3 id="1-数组转换成字符串"><a href="#1-数组转换成字符串" class="headerlink" title="1.  数组转换成字符串"></a>1.  数组转换成字符串</h3><ul><li><p>Array.prototype.toString() 将数组转换成 <strong>以逗号分隔的字符串</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="string">"cookie"</span>, <span class="string">"local storage"</span>, <span class="string">"session storage"</span>, <span class="string">"web storage"</span>];</span><br><span class="line">arr.toString();</span><br><span class="line"><span class="comment">// "cookie,local storage,session storage,web storage"</span></span><br></pre></td></tr></table></figure></li><li><p>Array.prototype.join([separator]) 将数组转换成 <strong>指定分隔符的字符串</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arr.join(<span class="string">'/'</span>)</span><br><span class="line"><span class="comment">// "cookie/local storage/session storage/web storage"</span></span><br></pre></td></tr></table></figure><ul><li><code>注意：</code> 如果数组只有一个元素，则该连接字符不显示<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr1 = [<span class="string">'category'</span>]</span><br><span class="line">arr1.join(<span class="string">'/'</span>)</span><br><span class="line"><span class="comment">// "category"</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="2-创建新数组"><a href="#2-创建新数组" class="headerlink" title="2.  创建新数组"></a>2.  创建新数组</h3><ul><li>Array.prototype.concat() 合并两个以上数组，最终拿到生成后的新数组，生成的新数组是需要合并的数组的浅拷贝。<ul><li><code>注意：</code>如果将引用类型复制到数组中,引用类型改变，新的数组数组发生改变，反之一样。因为他们指向同一个引用对象。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr_reference_type = [[<span class="string">'concat'</span>],<span class="string">'array prototype function'</span>];</span><br><span class="line"><span class="keyword">var</span> arr_concat = arr.concat(arr_reference_type);</span><br><span class="line"><span class="built_in">console</span>.log(arr_concat);</span><br><span class="line"><span class="comment">// ["cookie", "local storage", "session storage", "web storage", ["concat"], "array prototype function"]</span></span><br><span class="line"><span class="comment">// 修改 arr_reference_type</span></span><br><span class="line">arr_reference_type[<span class="number">0</span>].push(<span class="string">'slice'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(arr_concat);</span><br><span class="line"><span class="comment">// ["cookie", "local storage", "session storage", "web storage", ["concat", "slice"], "array prototype function"]</span></span><br></pre></td></tr></table></figure></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS3 单位</title>
      <link href="2020/10/22/CSS-css3-%E5%8D%95%E4%BD%8D/"/>
      <url>2020/10/22/CSS-css3-%E5%8D%95%E4%BD%8D/</url>
      
        <content type="html"><![CDATA[<h3 id="CSS3-中新增的单位"><a href="#CSS3-中新增的单位" class="headerlink" title="CSS3 中新增的单位"></a>CSS3 中新增的单位</h3><ul><li>ch 字符 0（零的宽度）；</li><li>rem 根元素（html元素）的 font-size；<blockquote><p>font size of the root element<br>Equal to the computed value of ‘font-size’ on the root element. when specified on the font-size property of the root element, the rem units refer to the property’s initial value.<br>This means that 1rem equals the the font-size html element (which for most browsers has a default value of 16px)</p></blockquote></li></ul><ol><li>字体或宽、高等单位，值根据 html 元素 font-size 计算得出</li><li>动态修改 html 的 font-size，实现适配</li><li>IOS6 和 Android 2.1 以上基本适配</li><li>1rem = html’s font size(大多数浏览器是 16px)</li></ol><ul><li>em 是一个相对单位，非固定值。相对于其父 font-size 计算</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>每天 30 词</title>
      <link href="2020/10/22/EN-words/"/>
      <url>2020/10/22/EN-words/</url>
      
        <content type="html"><![CDATA[<p>词根 deep<br>deep adj.深的、低沉的、深奥的<br>deepen vt.使加深；使强烈；使低沉/vi.变沉；更低沉<br>deepen the reform 深化改革<br>the need to conceal the mourning deepened grief<br>掩盖悲痛的需要加深了痛楚</p><a id="more"></a><p>cottage n.村舍、小屋<br>cot 婴儿床<br>I was halfway back to cottage<br>我在回小屋的半路上<br>We’ve got you a lovely little cottage on Spencer Hill<br>我们在斯宾塞山给你准备了一个舒适的小屋</p><p>gardener n.园丁，花匠，园艺爱好者<br>garden n.花园</p><p>The lawn hasn’t been moved. I’ve had it. We are getting a real gardener.<br>草坪根本没有修剪，我受够。我们需要一个专业的园丁<br>They can hire a gardener to do the work<br>他们可以聘请园丁来做这项工作</p><p>词根 cent 唱<br>incentive n.刺激；鼓励；激励</p><p>Awards provide an incentive for young people to improve their skills<br>奖励为年轻人提高他们的技能提供了动力</p><p>词根 avi 鸟<br>aviation n.航空，航空学，飞机制造业</p><p>With the development of aviation, the relations between nations become closer<br>随着飞机制造业的发展，国家间的关系变得更亲近了</p><p>词根 nerv 神经<br>nerve n.神经、勇敢、胆量；厚颜</p><p>have nerve 有勇气<br>get on one’s nerves 惹某人心烦<br>lose one’s nerve 失去勇气</p><p>there are close one million nerve fibers that connect the eyeball to the brain<br>连接眼球和大脑的细胞有接近 100 万个<br>Mum’s chatter often gets on his nerves<br>妈妈的唠叨经常让他心烦</p><p>词根 loc 地点<br>locate vi 定位、定居 vt 探明、找出、安置<br>locate in 在某一点设置；在…定居；坐落于<br>The university is located in a quite community<br>这所大学坐落于安静的社区</p><p>saint n.圣人；圣徒</p><p>After he died, the Church declared him a saint.<br>在他去世后，他生前所在教堂宣布他为圣徒</p><p>collaboration n.合作；勾结；通敌</p><p>There is substantial collaboration with neighboring departments<br>相邻的几个院系进行了通力合作</p><p>boarder 住宿生</p><p>词根 cell 密室，狭窄的空间<br>The box of papers had been stored in a cellar at the family home.<br>那盒文件已经存放在家里的地窖里</p><p>awkward adj.笨拙的；尴尬的；难操纵的</p><p>We are in some sort of an awkward position.<br>我们处于某种尴尬的境地</p><p>词根 broch 刺；缝<br>brochure n. 小册子</p><p>Please send me a copy of your company brochure.<br>请寄给我一份贵公司的宣传册</p><p>vain adj. 徒劳的；自负的；</p><p>be vain of<br>be vain about 为…自负<br>in vain 徒劳、无效</p><p>a lot of effort is made in vain.<br>很多努力都白费了<br>I was singing in a vain effort to cheer him up.<br>我唱歌试图让他高兴起来，结果白费力气</p><p>battalion n.军队；军营</p><p>He joined the second battalion of the Grenadier Guards.<br>他加入了英国近卫步兵第一团第二营</p><p>campus culture 校园文化<br>enterprise image 企业形象<br>heterogenous culture 异质文化<br>run out of 用完；耗尽<br>part with 放弃，交出，卖掉<br>look to 指望、依靠、展望<br>out of stock 无现货<br>May Fourth Movement 五四运动<br>air conditioner 空调<br>die out 逐渐消亡；灭绝<br>emancipate people’s minds 解放思想<br>strike off 砍掉；把…除名<br>member of a standing committee 常务委员</p><p>词根 tein 保持<br>protein n.蛋白质</p><p>protein-rich food 富含蛋白质的食物<br>Participating restaurants must promise to offer at least one children’s meal that has fewer than 600 calories, no soft drinks and at least two items from the following food groups: fruits, vegetables, whole grains, lean protein or low-fat dairy<br>参与的餐厅必须承诺提供至少一种儿童食物，这种儿童食物热量少于 600 卡路里，不包含饮料并且至少从以下食物组合中选择两项：水果，蔬菜，全谷类食物，瘦肉蛋白或低脂乳品</p><p>词根 mens 计算、测量<br>dimension n.尺寸；面积；方面；特点；规模；范围<br>The forest fire rapidly assumed great dimensions because of the high wind<br>因为风大，森林大火面积迅速扩大</p><p>horizon n.地平线；眼界，见识</p><p>broaden one’s horizon 开阔眼界<br>on the horizon 即将发生</p><p>The sun poked over the horizon<br>太阳从地平线升起</p><p>try vt.试图；试验；审判 vi.尝试，努力；n.努力<br>He was tried taking a bribe 他因受贿被审讯</p><p>damp adj.潮湿的，微湿的；n.潮湿；vt.抑制<br>damp down 减弱，抑制</p><p>He knew how to damp the flaming fire down.<br>他知道怎么抑制燃烧的火焰<br>Today is damp, cold and miserable<br>今天寒冷、潮湿、难以忍受</p><p>buckle n.搭扣，扣环/vt.扣住；使弯曲；vt.用搭扣扣紧；（被）压垮、压弯<br>buckle up 系上安全带<br>buckle down 开始认真从事；倾全力<br>The plane will take off soon, please buckle up your seat belts.<br>飞机马上起飞，请系紧您的安全带</p><p>ingredient n.组成部分，成分；原料；要素、因素</p><p>handful n.一把，少数，一小撮<br>a handful of 一把；少量的<br>In 1993, few corporations had a web page, and slightly a handful allowed one to order product or services online.<br>1993 年时，很少有公司拥有自己的网站。而只有几个公司允许人们通过网络下单或购买服务<br>She scooped up a handful of sand and let it trickle through her fingers.<br>她抓了一把沙子，然后让它们从指缝间慢慢漏掉</p><p>deficit n.赤字，亏空，亏损<br>a budget deficit 预算赤字<br>attention deficit hyperactivity disorder 多动症评估<br>This year’s profits have balanced last year’s trade deficit.<br>今年的盈利已经弥补了去年的贸易逆差</p><p>pool vt.共有；n.水塘；游泳池；共有物<br>pool out efforts 共同努力<br>together out efforts 共同努力<br>The girl has no choice but to dive into the pool<br>女孩别无选择，只能跳进水塘里</p><p>bold adj.大胆的<br>bold goals attract bold people 大胆的目标吸引大胆的人<br>She knew she had to make a bold move to fully to her new future.<br>她知道她必须采取大胆行动，全身心投入新的未来</p><p>restrain v.阻止；控制</p><p>compendium n.事实、概要<br>Compendium of Materia Medica 本草纲目</p><p>demo 人民；cracy 统治<br>democracy  n.民主，民主制；民主国家</p><p>As I would not be a slave, so I would not be a master. This expresses my idea of democracy.<br>我不想当奴隶，我也不愿做别人的主人。这是我对民主诠释。</p><p>guard n.守卫；护卫队、vi.保卫、监视<br>guard against 防止；提防<br>on guard 警惕；站岗<br>catch someone off guard 使人措手不及；<br>He said the Coast Guard should have a plan to respond to problems that may arise.<br>他说海岸护卫队应该有计划回复可能遇到的问题<br>These is no one to guard these isolated farms against attack.<br>没有人守卫那些孤立的农场抵御袭击</p><p>fall vi.落下；突然；来到/n.秋天；崩溃<br>fall back on 借助于，依靠<br>fall behind 落后，落在…后面<br>fall for 受…的骗；迷恋</p><p>session n.会议、一场<br>Several bills were enacted at the end of this session of Parliament<br>这场国会结束时，好几个提案制定成法律。</p><p>confident adj.坚信的，自信的<br>In recent years the capital’s culinary scene has developed to the point that it is now confident of its ability to please the tastes of any international visitor.<br>近几年，首都的餐饮业已经发展到有能力满足任何国际游客的品味。</p><p>vers = to turn<br>conversion n.转换、变换<br>The warehouse was undergoing conversion into apartments<br>这座仓库正在被改建成公寓</p><p>tain = to hold<br>container n.集装箱；容器<br>She trickled the water into container<br>她将水慢慢注入容器里</p>]]></content>
      
      
      
        <tags>
            
            <tag> 英文 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>macos 常用命令</title>
      <link href="2020/10/22/bash/"/>
      <url>2020/10/22/bash/</url>
      
        <content type="html"><![CDATA[<h3 id="macos-解压文件-rar"><a href="#macos-解压文件-rar" class="headerlink" title="macos 解压文件 .rar"></a>macos 解压文件 .rar</h3><p>commands 参数</p><blockquote><p><code>e</code>             Extract files without archived paths # 解压缩文件到当前目录<br>  <code>l[t[a],b]</code>     List archive contents [technical[all], bare]  # 列出压缩文件<br>  <code>p</code>             Print file to stdout #打印文件标准输出设备<br>  <code>t</code>             Test archive files # 测试压缩文件<br>  <code>v[t[a],b]</code>     Verbosely list archive contents [technical[all],bare] # 详细列出压缩文件信息<br>  <code>x</code>             Extract files with full path # 用绝对路径解压缩文件</p></blockquote>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ unrar x x.rar</span><br></pre></td></tr></table></figure>  <a id="more"></a><h3 id="macos-文件重命名-更多相关"><a href="#macos-文件重命名-更多相关" class="headerlink" title="macos 文件重命名 更多相关"></a>macos 文件重命名 <a href="https://www.cnblogs.com/liujiacai/p/8313548.html" target="_blank" rel="noopener">更多相关</a></h3>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mv 切图图片资源/ static</span><br></pre></td></tr></table></figure><h3 id="macos-复制文件"><a href="#macos-复制文件" class="headerlink" title="macos 复制文件"></a>macos 复制文件</h3>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp webpack.config.js webpack.dev.config.js</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 杂货 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue N 问</title>
      <link href="2020/10/21/Vue/"/>
      <url>2020/10/21/Vue/</url>
      
        <content type="html"><![CDATA[<h3 id="vue-的特点"><a href="#vue-的特点" class="headerlink" title="vue 的特点"></a>vue 的特点</h3><ul><li><p>轻量级框架</p><blockquote><p>自动追踪依赖模板表达式和计算属性，提供 MVVM (Mode-View-ViewMode) 双向绑定和可组合的组件系统，API 简单、灵活、易上手</p></blockquote></li><li><p>双向数据绑定</p><blockquote><p>双向数据绑定是 vue.js 的核心，其专注于 View 层。ViewMode 负责连接 View 和 Mode，保证视图和数据一致。 ViewMode 要做的是：MODE Listen and Data Bindings</p></blockquote></li><li><p>指令</p><blockquote><p>vue.js 与 页面交互主要通过指令完成，指令的作用是当表达式值改变时，相应将其形为应用到 DOM 上</p></blockquote></li><li><p>组件化</p></li><li><p>客户端路由</p></li><li><p>状态管理</p></li></ul><a id="more"></a><hr><h3 id="使用-npm-方式搭建-vue-单页面应用"><a href="#使用-npm-方式搭建-vue-单页面应用" class="headerlink" title="使用 npm 方式搭建 vue 单页面应用"></a>使用 npm 方式搭建 vue 单页面应用</h3><ol><li><p>验证 npm 是否正确安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$   npm -v  <span class="comment">#查看 npm 版本</span></span><br></pre></td></tr></table></figure></li><li><p>安装 vue</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$   npm install vue</span><br></pre></td></tr></table></figure></li><li><p>安装 vue-cli 脚手架</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$   npm install --global vue-cli</span><br></pre></td></tr></table></figure></li><li><p>初始化一个基于 webpack 的新模板</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$   vue init webpack my-project</span><br></pre></td></tr></table></figure></li><li><p>启动项目，验证搭建结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$   <span class="built_in">cd</span> my-project</span><br><span class="line">$   npm install  <span class="comment">#安装依赖包</span></span><br><span class="line">$   npm run dev</span><br></pre></td></tr></table></figure><p><strong><code>看到下图，恭喜你，环境搭建成功</code></strong></p></li></ol><p><img src="https://www.runoob.com/wp-content/uploads/2017/01/56219E04-D156-43EC-AC59-BFE7E38A62C3.jpg" alt="vue init page"></p><hr>]]></content>
      
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS Margin auto</title>
      <link href="2020/10/19/CSS-Margin-auto/"/>
      <url>2020/10/19/CSS-Margin-auto/</url>
      
        <content type="html"><![CDATA[<p>众所周知，margin: auto 可以使<code>块级元素</code>水平居中。这里要探讨的是为什么会居中，原理是什么？翻看了<a href="https://wiki.developer.mozilla.org/zh-CN/docs/Web/CSS/margin" target="_blank" rel="noopener">MDN</a>，相关描述只有一句，“让浏览器自己选择一个外边距”。</p><p>自动占满可用空间，可用空间平均分配，占满后元素居中，如下图。<br><img src="/images/css/margin-auto-1.jpg" alt="margin:auto"></p><a id="more"></a><h2 id="margin-auto-position-absolute-实现居中"><a href="#margin-auto-position-absolute-实现居中" class="headerlink" title="margin: auto + position: absolute 实现居中"></a>margin: auto + position: absolute 实现居中</h2><p>首先声明：只标题代码是无法实现居中的，下面进行一次解析</p><ol><li>以下两张图片，说明了，当元素设置 position: absolute，就相当于复制其定位元素的可用空间，但当前元素的可用空间仍为当时元素 content width + padding + border + margin<br><img src="/images/css/margin-auto-2.jpg" alt="margin:auto"></li></ol><hr><p><img src="/images/css/margin-auto-3.jpg" alt="margin:auto"></p><ol start="2"><li>left: 0; right: 0; 相当于可用空间扩展为其定位元素的可用空间(也就是上图中的 200px 或 1280px)</li><li>margin: auto 进行平均分配可用空间，实现居中<br><img src="/images/css/margin-auto-4.jpg" alt="margin:auto"></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS position absolute</title>
      <link href="2020/10/12/CSS-position-absolute/"/>
      <url>2020/10/12/CSS-position-absolute/</url>
      
        <content type="html"><![CDATA[<blockquote><p>position: absolute 与 float 一样，使用后<strong>脱离文档流</strong>；具有<strong>破坏性</strong>和<strong>包裹性</strong>；使用会创建 BFC(Block_formatting_context)。<br>absolute 相对于最近的非 ‘static’ 元素定位；如果该元素不存在，则相对于 initial container block 定位</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"width: 300px; height: 100px; background: #efefef;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"width: 100px; height: 50px; background: #390;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/images/css/position-absolute-1.jpg" alt="position-absolute-1"></p><a id="more"></a><h3 id="1-具有破坏性-子元素加入-position-absolute-至父元素高度塌陷"><a href="#1-具有破坏性-子元素加入-position-absolute-至父元素高度塌陷" class="headerlink" title="1. 具有破坏性 子元素加入 position: absolute; 至父元素高度塌陷"></a>1. <strong><code>具有破坏性</code></strong> 子元素加入 position: absolute; 至父元素高度塌陷</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"width: 300px; height: 100px; background: #efefef;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"width: 100px; height: 50px; background: #390; position: absolute"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/images/css/position-absolute-2.jpg" alt="position-absolute-2"></p><h3 id="2-具有包裹性-父元素使用-position-absolute，父元素包裹子元素"><a href="#2-具有包裹性-父元素使用-position-absolute，父元素包裹子元素" class="headerlink" title="2. 具有包裹性 父元素使用 position: absolute，父元素包裹子元素"></a>2. <strong><code>具有包裹性</code></strong> 父元素使用 position: absolute，父元素包裹子元素</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"width: 300px; height: 100px; background: #efefef; position: absolute"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"width: 100px; height: 50px; background: #390;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/images/css/position-absolute-3.jpg" alt="position-absolute-3"></p><h3 id="3-创建-BFC-Block-formatting-context-https-helenzhanglp-github-io-2019-02-20-CSS-BFC-使用-position-absolute，会形成块级作用域，行内元素可使用-width-height-等属性。"><a href="#3-创建-BFC-Block-formatting-context-https-helenzhanglp-github-io-2019-02-20-CSS-BFC-使用-position-absolute，会形成块级作用域，行内元素可使用-width-height-等属性。" class="headerlink" title="3. 创建 [BFC(Block_formatting_context)](https://helenzhanglp.github.io/2019/02/20/CSS-BFC/) 使用 position: absolute，会形成块级作用域，行内元素可使用 width/height 等属性。"></a>3. <strong><code>创建 [BFC(Block_formatting_context)](https://helenzhanglp.github.io/2019/02/20/CSS-BFC/)</code></strong> 使用 position: absolute，会形成块级作用域，行内元素可使用 width/height 等属性。</h3><p><a href="https://github.com/HelenZhangLP/demo/blob/master/postionAbsoluteFixedBlock/index.html" target="_blank" rel="noopener">以下 demo 代码</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>navigator1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>navigator2<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>navigator3<span class="tag">&lt;<span class="name">i</span>&gt;</span>vip icon<span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">i</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">margin</span>: -<span class="number">2px</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#f90</span>;</span><br><span class="line">  <span class="attribute">text-indent</span>: -<span class="number">9999px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">28px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">11px</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(http://img.mukewang.com/<span class="number">545304730001307300280011</span>.gif) no-repeat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/demo/positionAbsoluteFixedBlock/position-absolute-block-1.jpg" alt="position-absolute-block-1"><br>上图是一个注释掉<code>position: absolute</code>后的错误示例，如 <code>&lt;i&gt;</code> 非块级元素，<code>text-indent: -9999px</code> 不生效，<code>margin: -2px 0 0 1px</code>在垂直方向同样不生效。注释文本撑开，显示vip图片，若无<code>vip icon</code>，背影图同样不显示，因为 <code>width/height</code> 对非块级元素不生效。<code>放开position: absolute 注释后，BFC 化后，实现效果如下图</code><br><img src="/images/demo/positionAbsoluteFixedBlock/position-absolute-block-2.jpg" alt="position-absolute-block-2"></p><h3 id="4-demo-图标与提示文本对齐，效果如下图"><a href="#4-demo-图标与提示文本对齐，效果如下图" class="headerlink" title="4. demo-图标与提示文本对齐，效果如下图"></a>4. demo-图标与提示文本对齐，效果如下图</h3><p><img src="/images/css/position-absolute-4.jpg" alt="图标与文本对齐"></p><blockquote><ol><li>利用 float</li></ol></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"regist-remark regist-warn"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"icon-warn"</span> <span class="attr">style</span>=<span class="string">"float: left"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">i</span> <span class="attr">style</span>=<span class="string">"font-style: normal;"</span>&gt;</span>邮箱格式不准确<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><ol start="2"><li>利用 position</li></ol></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"regist-remark regist-warn"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"icon-warn"</span> <span class="attr">style</span>=<span class="string">"position: absolute; margin-left: -20px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>邮箱格式不准确</span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="5-demo-利用-position-absolute-在提示文字溢出显出区域时，不折行或隐藏，正常整行显示。"><a href="#5-demo-利用-position-absolute-在提示文字溢出显出区域时，不折行或隐藏，正常整行显示。" class="headerlink" title="5. demo-利用 position: absolute, 在提示文字溢出显出区域时，不折行或隐藏，正常整行显示。"></a>5. demo-利用 position: absolute, 在提示文字溢出显出区域时，不折行或隐藏，正常整行显示。</h3><h3 id="6-demo-利用-position-absolute，实现遮罩层"><a href="#6-demo-利用-position-absolute，实现遮罩层" class="headerlink" title="6. demo-利用 position: absolute，实现遮罩层"></a>6. demo-利用 position: absolute，实现遮罩层</h3><blockquote><p>position: absolute 在文档流之外创建了一个层<br>  left: 0 + right: 0; 新创建的层拉伸至与定位层等宽，相当于 width: 100%;<br>  同理： left: 0 + right: 50% = width: 50%;（可用于一半遮罩）<br>  top: 0 + bottom: 0; 新创建的层拉伸至与定位层等高，相当于 height: 100%;</p></blockquote><p>  <strong><code>注意：</code></strong> 这种方法适用于 <code>IE7+</code> 以上浏览器</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#000</span>;</span><br><span class="line">  <span class="attribute">opacity</span>: .<span class="number">5</span>;</span><br><span class="line">  filter: alpha(opacity=50); // 兼容 IE 浏览器</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS 你不知道的百分比</title>
      <link href="2020/09/21/CSS-%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84%E7%99%BE%E5%88%86%E6%AF%94/"/>
      <url>2020/09/21/CSS-%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84%E7%99%BE%E5%88%86%E6%AF%94/</url>
      
        <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.offsetHeight</span><br><span class="line"><span class="comment">// 0</span></span><br></pre></td></tr></table></figure><ul><li><p>宽设置百分比</p><blockquote><p>根据父元素的宽，浏览器端，根元素 html、body 宽为屏可视区的宽</p></blockquote></li><li><p>高设置百分比</p><blockquote><p>根据父元素的高运算，如上 code ，浏览器 body 未设置高，所以设置百分比要特别注意。</p></blockquote></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span>, <span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>padding 设置百分比<blockquote><p>根据父元素宽运算</p></blockquote></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS 动画实现滚动</title>
      <link href="2020/04/23/CSS-%E5%AE%9E%E4%BD%93%E6%BB%9A%E5%8A%A8/"/>
      <url>2020/04/23/CSS-%E5%AE%9E%E4%BD%93%E6%BB%9A%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="CSS-动画实现滚动"><a href="#CSS-动画实现滚动" class="headerlink" title="CSS 动画实现滚动"></a>CSS 动画实现滚动</h3><blockquote><p>animation: animation-name（动画名称） animation-duration（动画完成一个周期花费的秒、毫秒）</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.marquee</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">1070px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">  <span class="attribute">animation</span>: roll-animation <span class="number">50s</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 规定动画</span><br><span class="line"><span class="keyword">@keyframes</span> animation-roll &#123;</span><br><span class="line">  <span class="selector-tag">from</span>: &#123;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">50px</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">to</span>: &#123;</span><br><span class="line">    <span class="attribute">z-index</span>: -<span class="number">100px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>android 问题</title>
      <link href="2020/04/21/android-%E9%97%AE%E9%A2%98/"/>
      <url>2020/04/21/android-%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h3 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h3><blockquote><p>安卓启动 10.0.2.2 =&gt; localhost</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> 疑难 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>package.json</title>
      <link href="2020/04/17/package-json/"/>
      <url>2020/04/17/package-json/</url>
      
        <content type="html"><![CDATA[<p>###　browserslist <a href="https://cli.vuejs.org/zh/guide/browser-compatibility.html#browserslist" target="_blank" rel="noopener">参考文档</a></p><h4 id="browserlist-具体描述-参考文档"><a href="#browserlist-具体描述-参考文档" class="headerlink" title="browserlist 具体描述 参考文档"></a>browserlist 具体描述 <a href="https://github.com/browserslist/browserslist" target="_blank" rel="noopener">参考文档</a></h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">"browserslist": [</span><br><span class="line">  "&gt; 1%",</span><br><span class="line">  <span class="string">"last 2 versions"</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript-正则-常用正则case</title>
      <link href="2020/03/10/Javascript-%E6%AD%A3%E5%88%99-%E5%B8%B8%E7%94%A8%E6%AD%A3%E5%88%99case/"/>
      <url>2020/03/10/Javascript-%E6%AD%A3%E5%88%99-%E5%B8%B8%E7%94%A8%E6%AD%A3%E5%88%99case/</url>
      
        <content type="html"><![CDATA[<h3 id="1、-Demo-1-——-身份证验证"><a href="#1、-Demo-1-——-身份证验证" class="headerlink" title="1、 Demo(1) —— 身份证验证"></a>1、 Demo(1) —— 身份证验证</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 15 位数字/18 位数字/17 位数字 + （X|x）</span></span><br><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/(^\d&#123;15&#125;$)|(^\d&#123;18&#125;$)|(^\d&#123;17&#125;(\d|X|x)$)/</span></span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="2、-Demo-2"><a href="#2、-Demo-2" class="headerlink" title="2、 Demo(2)"></a>2、 Demo(2)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> value = <span class="string">'&lt;html&gt;   $%^##sbd&lt;/html&gt;'</span></span><br><span class="line"><span class="comment">// 替换 html 代码</span></span><br><span class="line">name = value.replace(<span class="regexp">/[&lt;&gt;\w+/]/g</span>, <span class="string">''</span>);</span><br><span class="line"><span class="comment">// "   $%^##"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 替换是否存在表情</span></span><br><span class="line">name = name.replace(<span class="regexp">/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]/g</span>, <span class="string">''</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多个空格替换为一个空格</span></span><br><span class="line">name = name.replace(<span class="regexp">/\s+/g</span>, <span class="string">' '</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 特殊符号</span></span><br><span class="line"><span class="keyword">const</span> regEn = <span class="regexp">/[`~@#$%^&amp;*()_+&lt;&gt;?:"&#123;&#125;,./;'[]]/g</span>;</span><br><span class="line"><span class="keyword">const</span> regCn = <span class="regexp">/[·#￥（——）：；“”‘、|《》？、【】[]]/g</span>;</span><br><span class="line"></span><br><span class="line">name = name.replace(regEn, <span class="string">''</span>);</span><br><span class="line">name = name.replace(regCn, <span class="string">''</span>);</span><br></pre></td></tr></table></figure><h3 id="3、-Demo-3-——-手机号中间四位替换为"><a href="#3、-Demo-3-——-手机号中间四位替换为" class="headerlink" title="3、  Demo(3) —— 手机号中间四位替换为 ****"></a>3、  Demo(3) —— 手机号中间四位替换为 ****</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">'13381895220'</span></span><br><span class="line">str.replace(<span class="regexp">/^(.&#123;3&#125;)(.&#123;4&#125;)(.&#123;4&#125;)$/</span>, <span class="string">"$1****$3"</span>) <span class="comment">// "133****5220"</span></span><br></pre></td></tr></table></figure><h3 id="4、-Demo-4-——-首字母大写"><a href="#4、-Demo-4-——-首字母大写" class="headerlink" title="4、  Demo(4) —— 首字母大写"></a>4、  Demo(4) —— 首字母大写</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> value = <span class="string">'front-end development engineer'</span></span><br><span class="line">value.replace(<span class="regexp">/^./</span>,value[<span class="number">0</span>].toUpperCase()) <span class="comment">// "Front-end development engineer"</span></span><br><span class="line"></span><br><span class="line">value.split(<span class="string">' '</span>).map(<span class="function"><span class="params">item</span> =&gt;</span> item.replace(<span class="regexp">/^./</span>, item[<span class="number">0</span>].toUpperCase())).join(<span class="string">" "</span>)</span><br><span class="line"><span class="comment">// "Front-end Development Engineer"</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> RegExp </tag>
            
            <tag> 技术 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>开发工具-Fiddler</title>
      <link href="2020/03/06/%E5%B7%A5%E5%85%B7-Fiddler/"/>
      <url>2020/03/06/%E5%B7%A5%E5%85%B7-Fiddler/</url>
      
        <content type="html"><![CDATA[<h3 id="安装教程推荐"><a href="#安装教程推荐" class="headerlink" title="安装教程推荐"></a><a href="https://www.cnblogs.com/yyhh/p/5140852.html" target="_blank" rel="noopener">安装教程推荐</a></h3><h3 id="坑一，配置后手机移动端不能正确连接抓包"><a href="#坑一，配置后手机移动端不能正确连接抓包" class="headerlink" title="坑一，配置后手机移动端不能正确连接抓包"></a>坑一，配置后手机移动端不能正确连接抓包</h3><blockquote><p>1、fiddler 配置完成后要重启后才生效<br>2、重启打开后，File-Capture Traffic</p></blockquote><h3 id="坑二，Inspector-syntaxView-乱码"><a href="#坑二，Inspector-syntaxView-乱码" class="headerlink" title="坑二，Inspector - syntaxView 乱码"></a>坑二，Inspector - syntaxView 乱码</h3><blockquote><p>工具栏选中 <code>Decode</code></p></blockquote><a id="more"></a><h3 id="坑三，-SecureClientPipeDirect-failed-System-Security-Authentication-Authenticatio"><a href="#坑三，-SecureClientPipeDirect-failed-System-Security-Authentication-Authenticatio" class="headerlink" title="坑三，!SecureClientPipeDirect failed: System.Security.Authentication.Authenticatio"></a>坑三，!SecureClientPipeDirect failed: System.Security.Authentication.Authenticatio</h3><blockquote><p>以 ios 为例，<code>设置 - 通用 - 关于本机 - 证书信任设置 - DO_NOT_TRUST_FiddlerRoot</code></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> develop tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>代码管理工具 - git</title>
      <link href="2020/03/03/%E5%B7%A5%E5%85%B7-%E4%BB%A3%E7%A0%81%E7%AE%A1%E7%90%86-git/"/>
      <url>2020/03/03/%E5%B7%A5%E5%85%B7-%E4%BB%A3%E7%A0%81%E7%AE%A1%E7%90%86-git/</url>
      
        <content type="html"><![CDATA[<h3 id="Generating-Your-SSH-Public-Key"><a href="#Generating-Your-SSH-Public-Key" class="headerlink" title="Generating Your SSH Public Key"></a>Generating Your SSH Public Key</h3><blockquote><p>$ ssh-keygen</p></blockquote><h3 id="id-rsa-pub-存储位置"><a href="#id-rsa-pub-存储位置" class="headerlink" title="id_rsa.pub 存储位置"></a>id_rsa.pub 存储位置</h3><blockquote><p><code>windows</code> /c/Users/Administrator/.ssh/id_rsa.pub<br><code>mac</code> ~/.ssh/id_rsa.pub</p></blockquote><h3 id="git-删除分支"><a href="#git-删除分支" class="headerlink" title="git 删除分支"></a>git 删除分支</h3><ol><li>git 删除本地分支 <code>git branch -d branch-name</code>(如果删除不了 -D 强制删除)</li><li>git 删除远程分支 <code>git push origin --delete branch-name</code></li></ol>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node 版管理</title>
      <link href="2020/02/17/Node-%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86/"/>
      <url>2020/02/17/Node-%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h3 id="nvm-node-版本管理工具"><a href="#nvm-node-版本管理工具" class="headerlink" title="nvm node 版本管理工具"></a>nvm node 版本管理工具</h3><h4 id="安装-use-the-following-cURL-command-脚本-具体参考-https-github-com-nvm-sh-nvm）"><a href="#安装-use-the-following-cURL-command-脚本-具体参考-https-github-com-nvm-sh-nvm）" class="headerlink" title="安装 use the following cURL command 脚本 [具体参考](https://github.com/nvm-sh/nvm）"></a>安装 use the following cURL command 脚本 [具体参考](<a href="https://github.com/nvm-sh/nvm）" target="_blank" rel="noopener">https://github.com/nvm-sh/nvm）</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install script use the following cURL command</span></span><br><span class="line">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.2/install.sh | bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># attempts to add the source lines from the snippet below to the correct profile file (~/.bash_profile, ~/.zshrc, ~/.profile, or ~/.bashrc).</span></span><br><span class="line"><span class="built_in">export</span> NVM_DIR=<span class="string">"<span class="variable">$([ -z "$&#123;XDG_CONFIG_HOME-&#125;" ] &amp;&amp; printf %s "$&#123;HOME&#125;/.nvm" || printf %s "$&#123;XDG_CONFIG_HOME&#125;/nvm")</span>"</span></span><br><span class="line">[ -s <span class="string">"<span class="variable">$NVM_DIR</span>/nvm.sh"</span> ] &amp;&amp; \. <span class="string">"<span class="variable">$NVM_DIR</span>/nvm.sh"</span></span><br></pre></td></tr></table></figure><a id="more"></a><blockquote><p>与 n 相同，nvm 同样是管理 node 版本的。</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Node </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小灰算法-数组排序</title>
      <link href="2020/01/15/%E5%B0%8F%E7%81%B0%E7%AE%97%E6%B3%95-%E6%95%B0%E7%BB%84/"/>
      <url>2020/01/15/%E5%B0%8F%E7%81%B0%E7%AE%97%E6%B3%95-%E6%95%B0%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<h2 id="排序算法"><a href="#排序算法" class="headerlink" title="排序算法"></a>排序算法</h2><p>不知道自己在干嘛，总之看这个很累，看完了，再看 <code>Array.prototy.sort()</code> 源码实现。还是一言难尽呐！不过，不管怎么样，既然看都看了，笔记还是写写。</p><a id="more"></a><h3 id="冒泡排序（bubble-sort）"><a href="#冒泡排序（bubble-sort）" class="headerlink" title="冒泡排序（bubble sort）"></a>冒泡排序（bubble sort）</h3><p>冒泡排序是一种基础的交换排序。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">9</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">14</span>,<span class="number">22</span>]</span><br></pre></td></tr></table></figure><h4 id="基础冒泡"><a href="#基础冒泡" class="headerlink" title="基础冒泡"></a>基础冒泡</h4><blockquote><p>相邻元素两两比较，相邻元素左边大于右边交换位置；否则位置不变。</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bubbleSort</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> num = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; arr.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j=<span class="number">0</span>; j &lt; arr.length - <span class="number">1</span> - i; j++) &#123;</span><br><span class="line">      num ++</span><br><span class="line">      <span class="keyword">if</span> (arr[j] &gt; arr[j+<span class="number">1</span>]) &#123;</span><br><span class="line">        <span class="keyword">var</span> temp = arr[j]</span><br><span class="line">        arr[j] = arr[j+<span class="number">1</span>]</span><br><span class="line">        arr[j+<span class="number">1</span>] = temp</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(num) <span class="comment">// 共 9 次</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="冒泡优化"><a href="#冒泡优化" class="headerlink" title="冒泡优化"></a>冒泡优化</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bubbleSortV2</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> num = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;arr.length<span class="number">-1</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> isSorted = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j=<span class="number">0</span>; j&lt;arr.length<span class="number">-1</span>-i; j++) &#123;</span><br><span class="line">      num ++</span><br><span class="line">      <span class="keyword">if</span> (arr[j] &gt; arr[j+<span class="number">1</span>]) &#123;</span><br><span class="line">        <span class="keyword">var</span> temp = arr[j]</span><br><span class="line">        arr[j] = arr[j+<span class="number">1</span>]</span><br><span class="line">        arr[j+<span class="number">1</span>] = temp</span><br><span class="line">        isSorted = <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(isSorted) <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><blockquote><p>其实这个方法执行下的结果并不正确，我再三跟书的案例确认下。代码一毛一样，那么下面要怎么着。这个方法执行的前提是数组前后两部分，后一部分有序，前半部分无序而且前半部分阳大的数小于后半部分最小数。如：[3,2,4,1,2,5,6,7,8]</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bubbleSortV3</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> num = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;arr.length<span class="number">-1</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> isSorted = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">var</span> sortBorder = arr.length - <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>; j&lt;sortBorder; j++) &#123;</span><br><span class="line">      num ++</span><br><span class="line">      <span class="keyword">if</span> (arr[j] &gt; arr[j+<span class="number">1</span>]) &#123;</span><br><span class="line">        <span class="keyword">var</span> temp = arr[j]</span><br><span class="line">        arr[j] = arr[j+<span class="number">1</span>]</span><br><span class="line">        arr[j+<span class="number">1</span>] = temp;</span><br><span class="line">        isSorted = <span class="literal">false</span>;</span><br><span class="line">        sortBorder = j;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(isSorted) <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(num) <span class="comment">// 共 11 次</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="鸡尾酒排序"><a href="#鸡尾酒排序" class="headerlink" title="鸡尾酒排序"></a>鸡尾酒排序</h4><blockquote><p>与冒泡相同，都是通过交换排序的。冒泡从左到右比较元素，进行单向位置交换。鸡尾酒元素比较和交换是<code>双向</code>。<br>鸡尾酒排序书中举了个特殊的例子 [8,2,3,4,5,6,7,1]，其大意是，只有问部分无序，确要比较 7 轮 。。。</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cocktail</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> isSorted = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">var</span> temp = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; <span class="built_in">parseInt</span>(arr.length/<span class="number">2</span>); i++) &#123;</span><br><span class="line">    <span class="comment">// 由左到右交换，最大数排在最后面</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; arr.length - <span class="number">1</span> - i; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (arr[j] &gt; arr[j+<span class="number">1</span>]) &#123;</span><br><span class="line">        temp = arr[j]</span><br><span class="line">        arr[j] = arr[j+<span class="number">1</span>]</span><br><span class="line">        arr[j+<span class="number">1</span>] = temp;</span><br><span class="line">        isSorted = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSorted) <span class="keyword">break</span>;</span><br><span class="line">    </span><br><span class="line">    isSorted = <span class="literal">true</span>;</span><br><span class="line">    temp = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 由右向左交换，最小数排在最前面</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> k=arr.length-i<span class="number">-1</span>; k &gt; i; k--) &#123;</span><br><span class="line">      <span class="keyword">if</span> (arr[k] &lt; arr[k<span class="number">-1</span>]) &#123;</span><br><span class="line">        temp = arr[k]</span><br><span class="line">        arr[k] = arr[k<span class="number">-1</span>]</span><br><span class="line">        arr[k<span class="number">-1</span>] = temp;</span><br><span class="line">        isSorted = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSorted) <span class="keyword">break</span>;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h3><h4 id="基础快速排序"><a href="#基础快速排序" class="headerlink" title="基础快速排序"></a>基础快速排序</h4><h4 id="基准元素选择"><a href="#基准元素选择" class="headerlink" title="基准元素选择"></a>基准元素选择</h4><h4 id="单边循环"><a href="#单边循环" class="headerlink" title="单边循环"></a>单边循环</h4>]]></content>
      
      
      
        <tags>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript-正则</title>
      <link href="2020/01/13/Javascript-%E6%AD%A3%E5%88%99/"/>
      <url>2020/01/13/Javascript-%E6%AD%A3%E5%88%99/</url>
      
        <content type="html"><![CDATA[<h2 id="RegExp"><a href="#RegExp" class="headerlink" title="RegExp"></a>RegExp</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> reg = <span class="regexp">/[\u4e00-\u9fa5]/</span></span><br><span class="line"><span class="built_in">console</span>.dir(reg)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * /[\u4e00-\u9fa5]/</span></span><br><span class="line"><span class="comment">    dotAll: false</span></span><br><span class="line"><span class="comment">    flags: ""</span></span><br><span class="line"><span class="comment">    global: false</span></span><br><span class="line"><span class="comment">    ignoreCase: false</span></span><br><span class="line"><span class="comment">    lastIndex: 0</span></span><br><span class="line"><span class="comment">    multiline: false</span></span><br><span class="line"><span class="comment">    source: "[\u4e00-\u9fa5]"</span></span><br><span class="line"><span class="comment">    sticky: false</span></span><br><span class="line"><span class="comment">    unicode: false</span></span><br><span class="line"><span class="comment"> * /</span></span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="RegExp-prototype-dotAll-在正则表达式中是否使用-s-修饰符，s-修饰符可以匹配任意单个字符。只读属性，属于单个正则表达式实例。"><a href="#RegExp-prototype-dotAll-在正则表达式中是否使用-s-修饰符，s-修饰符可以匹配任意单个字符。只读属性，属于单个正则表达式实例。" class="headerlink" title="RegExp.prototype.dotAll 在正则表达式中是否使用 s 修饰符，s 修饰符可以匹配任意单个字符。只读属性，属于单个正则表达式实例。"></a>RegExp.prototype.dotAll 在正则表达式中是否使用 <code>s</code> 修饰符，<code>s</code> 修饰符可以匹配任意单个字符。只读属性，属于单个正则表达式实例。</h3><p><code>***暂留，我承认我没有搞明白***</code></p><h3 id="RegExp-prototype-flags-返回由当前正则表达式对象的标志组成的字符串，是一个只读属性"><a href="#RegExp-prototype-flags-返回由当前正则表达式对象的标志组成的字符串，是一个只读属性" class="headerlink" title="RegExp.prototype.flags 返回由当前正则表达式对象的标志组成的字符串，是一个只读属性"></a>RegExp.prototype.flags 返回由当前正则表达式对象的标志组成的字符串，是一个只读属性</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> reg = <span class="regexp">/[\u4e00-\u9fa5]/</span>sg</span><br><span class="line"><span class="built_in">console</span>.dir(reg)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * /[\u4e00-\u9fa5]/gs</span></span><br><span class="line"><span class="comment">    dotAll: (...)</span></span><br><span class="line"><span class="comment">    flags: "gs"</span></span><br><span class="line"><span class="comment">    global: (...)</span></span><br><span class="line"><span class="comment">    ignoreCase: (...)</span></span><br><span class="line"><span class="comment">    lastIndex: 0</span></span><br><span class="line"><span class="comment">    multiline: (...)</span></span><br><span class="line"><span class="comment">    source: (...)</span></span><br><span class="line"><span class="comment">    sticky: (...)</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h3 id="RegExp-prototype-global-正则表达式是否使用了-g-标志，是找到所有匹配，而不是第一个匹配后停止，是一个只读属性"><a href="#RegExp-prototype-global-正则表达式是否使用了-g-标志，是找到所有匹配，而不是第一个匹配后停止，是一个只读属性" class="headerlink" title="RegExp.prototype.global 正则表达式是否使用了 g 标志，是找到所有匹配，而不是第一个匹配后停止，是一个只读属性"></a>RegExp.prototype.global 正则表达式是否使用了 <code>g</code> 标志，是找到所有匹配，而不是第一个匹配后停止，是一个只读属性</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> reg = <span class="regexp">/[gimuy]*$/g</span></span><br><span class="line"><span class="built_in">console</span>.dir(reg)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * /[gimuy]*$/g</span></span><br><span class="line"><span class="comment">    dotAll: false</span></span><br><span class="line"><span class="comment">    flags: "g"</span></span><br><span class="line"><span class="comment">    global: true</span></span><br><span class="line"><span class="comment">    ignoreCase: (...)</span></span><br><span class="line"><span class="comment">    lastIndex: 0</span></span><br><span class="line"><span class="comment">    multiline: (...)</span></span><br><span class="line"><span class="comment">    source: (...)</span></span><br><span class="line"><span class="comment">    sticky: (...)</span></span><br><span class="line"><span class="comment">    unicode: (...)</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h3 id="RegExp-prototype-ignoreCase-正则表达式是否使用了-i-标志，是否忽略大小写，只读属性"><a href="#RegExp-prototype-ignoreCase-正则表达式是否使用了-i-标志，是否忽略大小写，只读属性" class="headerlink" title="RegExp.prototype.ignoreCase 正则表达式是否使用了 i 标志，是否忽略大小写，只读属性"></a>RegExp.prototype.ignoreCase 正则表达式是否使用了 <code>i</code> 标志，是否忽略大小写，只读属性</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> reg = <span class="regexp">/[\u4e00-\u9faf]/gi</span></span><br><span class="line"><span class="built_in">console</span>.dir(reg)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * /[\u4e00-\u9faf]/gi</span></span><br><span class="line"><span class="comment">      dotAll: false</span></span><br><span class="line"><span class="comment">      flags: "gi"</span></span><br><span class="line"><span class="comment">      global: true</span></span><br><span class="line"><span class="comment">      ignoreCase: true</span></span><br><span class="line"><span class="comment">      lastIndex: 0</span></span><br><span class="line"><span class="comment">      multiline: false</span></span><br><span class="line"><span class="comment">      source: "[\u4e00-\u9faf]"</span></span><br><span class="line"><span class="comment">      sticky: false</span></span><br><span class="line"><span class="comment">      unicode: false</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h3 id="RegExp-prototype-multiline-正则表达式中使用-m-属性，多行匹配，只读属性"><a href="#RegExp-prototype-multiline-正则表达式中使用-m-属性，多行匹配，只读属性" class="headerlink" title="RegExp.prototype.multiline 正则表达式中使用 m 属性，多行匹配，只读属性"></a>RegExp.prototype.multiline 正则表达式中使用 <code>m</code> 属性，多行匹配，只读属性</h3><blockquote><p>“m” 标志意味着一个多行输入字符串被看作多行<br>使用 “m”，”^” 和 “$” 将会从只匹配正则字符串的开头或结尾，变为匹配字符串中任一行的开头或结尾。</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> reg = <span class="regexp">/[\u4e00-\u9faf]/gim</span></span><br><span class="line"><span class="built_in">console</span>.dir(reg)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * /[\u4e00-\u9faf]/gim</span></span><br><span class="line"><span class="comment">      dotAll: false</span></span><br><span class="line"><span class="comment">      flags: "gim"</span></span><br><span class="line"><span class="comment">      global: true</span></span><br><span class="line"><span class="comment">      ignoreCase: true</span></span><br><span class="line"><span class="comment">      lastIndex: 0</span></span><br><span class="line"><span class="comment">      multiline: true</span></span><br><span class="line"><span class="comment">      source: "[\u4e00-\u9faf]"</span></span><br><span class="line"><span class="comment">      sticky: false</span></span><br><span class="line"><span class="comment">      unicode: false</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h3 id="RegExp-prototype-exec-在一个指定字符串中执行一个搜索匹配。返回匹配数组或-null。"><a href="#RegExp-prototype-exec-在一个指定字符串中执行一个搜索匹配。返回匹配数组或-null。" class="headerlink" title="RegExp.prototype.exec() 在一个指定字符串中执行一个搜索匹配。返回匹配数组或 null。"></a>RegExp.prototype.exec() 在一个指定字符串中执行一个搜索匹配。返回匹配数组或 null。</h3><blockquote><p>regexObj.exec(str)</p></blockquote><p><strong>* notice *</strong></p><ul><li><input disabled type="checkbox"> 设置了 global 或 sticky 标志位后 RegExp 对象是<code>有状态</code>的；</li><li><input disabled type="checkbox"> 会将上次成功匹配的位置记录在 lastIndex 属性中。</li><li><input disabled type="checkbox"> 如此 exec() 可用来对单个字符串中的多次匹配结果进行逐条遍历。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reg = <span class="regexp">/[\u4e00-\u9fa5]/</span></span><br><span class="line">reg.exec(<span class="string">'1233 我是张丽萍 abc'</span>)</span><br><span class="line"><span class="comment">// ["我", index: 5, input: "1233 我是张丽萍 abc", groups: undefined]</span></span><br></pre></td></tr></table></figure><h4 id="“我”-index-5-input-“1233-我是张丽萍-abc”-groups-undefined-返回值解析"><a href="#“我”-index-5-input-“1233-我是张丽萍-abc”-groups-undefined-返回值解析" class="headerlink" title="[“我”, index: 5, input: “1233 我是张丽萍 abc”, groups: undefined] 返回值解析"></a>[“我”, index: 5, input: “1233 我是张丽萍 abc”, groups: undefined] 返回值解析</h4><table><thead><tr><th>索引</th><th>值</th><th>描述</th></tr></thead><tbody><tr><td>0</td><td>我</td><td>匹配的全部字符串</td></tr><tr><td>1</td><td>index:5</td><td>匹配字符串开始索引</td></tr><tr><td>2</td><td>1233 我是张丽萍 abc</td><td>匹配原始字符串</td></tr><tr><td>3</td><td>groups:undefined</td><td>分组捕获的结果</td></tr></tbody></table><p>加全局匹配标识符，会记录上次匹配的位置，可以循环遍历。<code>注意不要在遍历条件中写入正则表达式，如果一直匹配，会造成死循环</code>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/(\w+)(\s)/g</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">'abc abc abc'</span></span><br><span class="line">reg.exec(str)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  [ 'abc ', 'abc', ' ', index: 0, input: 'abc abc abc', groups: undefined ]</span></span><br><span class="line"><span class="comment">&gt; reg.exec(str)</span></span><br><span class="line"><span class="comment">[ 'abc ', 'abc', ' ', index: 4, input: 'abc abc abc', groups: undefined ]</span></span><br><span class="line"><span class="comment">&gt; reg.exec(str)</span></span><br><span class="line"><span class="comment">null</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h4 id="返回值"><a href="#返回值" class="headerlink" title="返回值 []"></a>返回值 []</h4><ul><li>[0] 匹配的字符串（[‘abc ‘]）</li><li>[1],…[n] 分组捕获（[‘abc’, ‘ ‘]）</li><li>index 匹配到的字符位于原始字符串的基于0的索引值 （index: 0）</li><li>input 原始字符串</li></ul><hr><ul><li><input disabled type="checkbox"> <code>\w</code> 匹配任意来自基本拉丁字母表中的字母数字字符，还包括下划线。等价于 [A-Za-z0-9_]</li><li><input disabled type="checkbox"> <code>\w+</code> 匹配数字、字母、下划线 x 1 或多次。等价于 {1,}</li><li><input disabled type="checkbox"> <code>(\w+)</code> 匹配数字、字母、下划线至少一次，并且捕获匹配项</li><li><input disabled type="checkbox"> <code>\s</code> 匹配空白符，包括空格、制表符、换页符、其它 Unicode 空格</li></ul><h4 id="字符集合-character-sets"><a href="#字符集合-character-sets" class="headerlink" title="字符集合(character sets)"></a>字符集合(character sets)</h4><p>[xyz] [x-z] 匹配是 xyz 的字符集</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/[x-z]/.exec(<span class="string">'zxyd'</span>)</span><br><span class="line"><span class="comment">// ["z", index: 0, input: "zxyd", groups: undefined]</span></span><br><span class="line">/[^x-z]/g.exec(<span class="string">'xyzabdxyz'</span>)</span><br><span class="line"><span class="comment">// ["a", index: 3, input: "xyzabdxyz", groups: undefined]</span></span><br></pre></td></tr></table></figure><p>[^xyz] [^x-z] 匹配非 xyz 的字符集</p><h4 id="分组（grouping）"><a href="#分组（grouping）" class="headerlink" title="分组（grouping）"></a>分组（grouping）</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 分组匹配 */</span></span><br><span class="line">regGroups = <span class="regexp">/(\d+)([\u4e00-\u9fa5]+)(\w)/</span></span><br><span class="line">regGroups.exec(<span class="string">'1233我是张丽萍abc'</span>)</span><br><span class="line"><span class="comment">// ["1233我是张丽萍a", "1233", "我是张丽萍", "a", index: 0, input: "1233我是张丽萍abc", groups: undefined]</span></span><br></pre></td></tr></table></figure><h4 id="“1233我是张丽萍a”-“1233”-“我是张丽萍”-“a”-index-0-input-“1233我是张丽萍abc”-groups-undefined"><a href="#“1233我是张丽萍a”-“1233”-“我是张丽萍”-“a”-index-0-input-“1233我是张丽萍abc”-groups-undefined" class="headerlink" title="[“1233我是张丽萍a”, “1233”, “我是张丽萍”, “a”, index: 0, input: “1233我是张丽萍abc”, groups: undefined]"></a>[“1233我是张丽萍a”, “1233”, “我是张丽萍”, “a”, index: 0, input: “1233我是张丽萍abc”, groups: undefined]</h4><table><thead><tr><th>索引</th><th>值</th><th>描述</th></tr></thead><tbody><tr><td>0</td><td>1233我是张丽萍a</td><td>匹配的全部字符串</td></tr><tr><td>1</td><td>1233</td><td>分组匹配的结果 RegExp.$1</td></tr><tr><td>2</td><td>我是张丽萍</td><td>分组匹配的结果 RegExp.$2</td></tr><tr><td>3</td><td>a</td><td>分组匹配的结果 RegExp.$3</td></tr><tr><td>4</td><td>index</td><td>匹配到的字符位于原始字符串的基于0的索引值</td></tr><tr><td>5</td><td>groups:undefined</td><td>分组捕获的结果</td></tr></tbody></table><h4 id="字符类别-Character-Classes"><a href="#字符类别-Character-Classes" class="headerlink" title="字符类别(Character Classes)"></a>字符类别(Character Classes)</h4><table><thead><tr><th>字符</th><th>含义</th></tr></thead><tbody><tr><td><code>\d</code> <code>[0-9]</code></td><td>匹配任意阿拉伯字符串</td></tr></tbody></table><h4 id="边界（Boundaries）"><a href="#边界（Boundaries）" class="headerlink" title="边界（Boundaries）"></a>边界（Boundaries）</h4><table><thead><tr><th>字符</th><th>含义</th></tr></thead><tbody><tr><td>^</td><td>匹配输入<code>开始</code>位置，如果设置 flag multiline，该标识会匹配每个断行（line-break）符后的<code>开始</code>位置</td></tr><tr><td>$</td><td></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> RegExp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript 字符串</title>
      <link href="2020/01/09/Javascript-%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
      <url>2020/01/09/Javascript-%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
      
        <content type="html"><![CDATA[<blockquote><p><code>需求删除最后一个为 &amp; 的字符</code></p></blockquote><h3 id="String-prototype-replace-返回一个部分或全部匹配由替代模式所取代的新的字符串。"><a href="#String-prototype-replace-返回一个部分或全部匹配由替代模式所取代的新的字符串。" class="headerlink" title="String.prototype.replace() 返回一个部分或全部匹配由替代模式所取代的新的字符串。"></a>String.prototype.replace() 返回一个部分或全部匹配由替代模式所取代的新的字符串。</h3><blockquote><p>str.replace(regexp|substr, newSubStr|function)</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">'zhangliping&amp;'</span></span><br><span class="line"><span class="comment">// regexp = /&amp;$/</span></span><br><span class="line">str.replace(<span class="regexp">/&amp;$/</span>, <span class="string">""</span>) <span class="comment">// zhangliping</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * --- 引申 ---</span></span><br><span class="line"><span class="comment"> * 删除字符串全部的 &amp;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">str.replace(<span class="regexp">/&amp;$/g</span>, <span class="string">""</span>) <span class="comment">// 全局替换</span></span><br><span class="line">str.replace(<span class="regexp">/^&amp;/</span>,<span class="string">""</span>) <span class="comment">// 替换开头</span></span><br><span class="line">str.replace(<span class="regexp">/[?&amp;]$/</span>, <span class="string">""</span>) <span class="comment">//替换结尾的 ? 或 &amp;</span></span><br><span class="line"></span><br><span class="line">formatParamets() &#123;</span><br><span class="line">  <span class="keyword">const</span> url = <span class="built_in">window</span>.location.href; <span class="comment">// 获取当前浏览器的URL</span></span><br><span class="line">  <span class="keyword">const</span> params = &#123;&#125;; <span class="comment">// 存储最终JSON结果对象</span></span><br><span class="line">  url.replace(<span class="regexp">/([^?&amp;]+)=([^?&amp;]+)/g</span>, (match, p1, p2) =&gt; &#123;</span><br><span class="line">    params[p1] = <span class="built_in">decodeURIComponent</span>(p2); <span class="comment">// 解析字符为中文</span></span><br><span class="line">    <span class="keyword">return</span> p2 + <span class="string">'='</span> + p1;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> params;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="分割字符串"><a href="#分割字符串" class="headerlink" title="分割字符串"></a>分割字符串</h2><h3 id="String-prototype-slice-方法取字符串的一部分，返回新字符串，原字符串不动"><a href="#String-prototype-slice-方法取字符串的一部分，返回新字符串，原字符串不动" class="headerlink" title="String.prototype.slice() 方法取字符串的一部分，返回新字符串，原字符串不动"></a>String.prototype.slice() 方法取字符串的一部分，返回新字符串，原字符串不动</h3><blockquote><p>str.slice(beginIndex[, endIndex])</p></blockquote><ul><li>beginIndex 从该索引（以 0 这基数）处开始提取原字符串。如果为负数，会被当做 strlength + beginLength</li><li>endIndex 可选，以 0 基数，endIndex 处结束提取字符串。省略则视为默认 strlength。或为负数，endIndex = strlength - endIndex</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">'zhangliping&amp;'</span></span><br><span class="line"><span class="comment">// 取默认值，str.slice() 不传参</span></span><br><span class="line">str.slice() <span class="comment">// zhangliping&amp; beginIndex 默认值 0， endIndex 默认值 strlength</span></span><br><span class="line"><span class="comment">// beginIndex &gt;= strlength, endIndex 取默认值</span></span><br><span class="line">str.slice(<span class="number">-1</span>) <span class="comment">// '&amp;' beginIndex = strlength - 1，截取到字符串长度</span></span><br><span class="line"><span class="comment">// start &lt; 0 &amp;&amp; abs(start) &gt; strlength, length 取默认值</span></span><br><span class="line">str.slice(<span class="number">-100</span>) <span class="comment">// 'zhangliping&amp;'</span></span><br><span class="line"><span class="comment">// beginIndex 取默认值 0，endIndex &gt;= strlength</span></span><br><span class="line">str.slice(<span class="number">13</span>) <span class="comment">// ''</span></span><br><span class="line"><span class="comment">// beginIndex &lt; 0，endIndex 取默认值</span></span><br><span class="line">str.slice(<span class="number">0</span>, <span class="number">12</span>) <span class="comment">// zhangliping&amp;</span></span><br><span class="line"><span class="comment">// beginIndex 取默认值 0，endIndex &lt; 0</span></span><br><span class="line">str.slice(<span class="number">0</span>, <span class="number">-1</span>) <span class="comment">// 'zhangliping' endIndex = strlength - 1 截取最后一位</span></span><br><span class="line"><span class="comment">// beginIndex 取默认值 0，endIndex == 0</span></span><br><span class="line">str.slice(<span class="number">0</span>, <span class="number">0</span>) <span class="comment">// ''</span></span><br></pre></td></tr></table></figure><h3 id="String-prototype-substring-返回从开始位置到结束位置的一个子集。"><a href="#String-prototype-substring-返回从开始位置到结束位置的一个子集。" class="headerlink" title="String.prototype.substring() 返回从开始位置到结束位置的一个子集。"></a>String.prototype.substring() 返回从开始位置到结束位置的一个子集。</h3><blockquote><p>str.substring(indexStart[, indexEnd])</p></blockquote><ul><li>indexStart 需要截取的第一个字符的索引，该索引位置的字符作为返回字符串的首字母</li><li>indexEnd 0 到字符串长度之间的整数，以该数字为索引的字符不包含截取位置内</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">'zhangliping&amp;'</span>;</span><br><span class="line"><span class="comment">// str.substring() indexStart 默认值 0； indexEnd 默认值 strlength</span></span><br><span class="line">str.substring() <span class="comment">// 'zhangliping&amp;'</span></span><br><span class="line"><span class="comment">// indexStart &gt; strlength</span></span><br><span class="line">str.substring(<span class="number">5</span>) <span class="comment">// ''</span></span><br><span class="line"><span class="comment">// indexStart &lt; 0 &amp;&amp; abs(indexStart) &gt; strlength</span></span><br><span class="line">str.substring(<span class="number">-15</span>) <span class="comment">// indexStart = 0</span></span><br><span class="line"><span class="comment">// indexStart &lt; 0 &amp;&amp; abs(indexStart) &lt; strlength</span></span><br><span class="line">str.substring(<span class="number">-1</span>) <span class="comment">// indexStart = 0</span></span><br><span class="line"><span class="comment">// indexStart = 0 indexEnd &gt; strlength</span></span><br><span class="line">str.substring(<span class="number">0</span>, <span class="number">15</span>) <span class="comment">// 'zhangliping&amp;'</span></span><br><span class="line">str.substring(<span class="number">0</span>, str.length<span class="number">-1</span>);<span class="comment">// zhangliping</span></span><br></pre></td></tr></table></figure><h3 id="String-proptotype-substr-返回一个字符串从指定位置开始"><a href="#String-proptotype-substr-返回一个字符串从指定位置开始" class="headerlink" title="String.proptotype.substr() 返回一个字符串从指定位置开始"></a>String.proptotype.substr() 返回一个字符串从指定位置开始</h3><blockquote><p>被认作是遗留的函数，非 Javascript 核心语言的一部分。目前没有严格被废弃。但将来可能被移除<br>str.substr(start[, length])</p></blockquote><ul><li>不会改变原字符串</li><li>start 与 slice 的第一个参数相同从该索引（以 0 这基数）处开始提取原字符串，若为负数，看作 strlength（字符串长度） + start。</li><li><ul><li>Microsoft’ JScript 不支持负 start 索引 **</li></ul></li><li>length 提取的字符数</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">'zhangliping'</span>;</span><br><span class="line"><span class="comment">// str.substr() 不传参</span></span><br><span class="line">str.substr() <span class="comment">// 'zhangliping' start 默认值 0， length 默认值字符串长度</span></span><br><span class="line"><span class="comment">// start &gt;= strlength length 取默认值</span></span><br><span class="line">str.substr(<span class="number">13</span>) <span class="comment">// ''</span></span><br><span class="line"><span class="comment">// start &lt; 0 length 取默认值</span></span><br><span class="line">str.substr(<span class="number">-14</span>) <span class="comment">// 'zhangliping' 取出全部字符串</span></span><br><span class="line"><span class="comment">// start 取默认值 0，length &gt;= strlength</span></span><br><span class="line">str.substr(<span class="number">-4</span>) <span class="comment">// start = strlength - 4 从 index = 8 开始截取</span></span><br><span class="line"><span class="comment">// start &lt; 0 &amp;&amp; abs(start) &gt; strlength, length 取默认值</span></span><br><span class="line">str.substr(<span class="number">0</span>, <span class="number">14</span>) <span class="comment">// 'zhangliping'</span></span><br><span class="line"><span class="comment">// start 取默认值 0， length &lt;= strlength</span></span><br><span class="line">str.substr(<span class="number">0</span>, <span class="number">-1</span>) <span class="comment">// ''</span></span><br><span class="line"><span class="comment">// 截取字符串最后一位</span></span><br><span class="line">str.substr(<span class="number">0</span>, strlength - <span class="number">1</span>) <span class="comment">// 'zhangliping'</span></span><br></pre></td></tr></table></figure><h3 id="slice-substr-substring-对比"><a href="#slice-substr-substring-对比" class="headerlink" title="slice/substr/substring 对比"></a>slice/substr/substring 对比</h3><table><thead><tr><th>方法名</th><th>参数一</th><th>参数二</th></tr></thead><tbody><tr><td>slice</td><td>beginIndex — 开始位置索引，以 0 为基数</td><td>endIndex — 截取至 endIndex - 1 位置</td></tr><tr><td>substr</td><td>start — 同上</td><td>length - 截取字符长度</td></tr><tr><td>substring</td><td>indexStart — 同上</td><td>indexEnd — 截取至 indexEnd - 1 的位置</td></tr></tbody></table><table><thead><tr><th>方法名</th><th>参数一abs(负数)并大于等于字符串长度</th><th>参数一负数并小于字符串长度</th><th>参数一大于 strlength</th><th>参数二abs(负数)并大于等于字符串长度</th><th>参数一负数并小于字符串长度</th><th>参数二大于 strlength</th></tr></thead><tbody><tr><td>slice</td><td>beginIndex = 0</td><td>beginIndex = strlength - beginIndex</td><td>返回空串</td><td>endIndex = 0</td><td>endIndex = strlength - endIndex</td><td>endIndex = strlength</td></tr><tr><td>substr</td><td>同上</td><td>同上</td><td>同上</td><td>同上</td><td></td><td>length = strlength</td></tr><tr><td>substring</td><td>indexStart = 0</td><td>indexStart = 0</td><td>同上</td><td>indexEnd = 0</td><td>indexEnd = 0</td><td>indexEnd = strlength</td></tr></tbody></table><blockquote><ol><li>slice、substring、sub 都是字符串截取方法；<ol start="2"><li>substring 参数不能为负数，如果有负数，则视为 0；</li><li>substr 与 slice 同参数可以为负数。当为负数时，实际取的值是当前参数与字符串相加的和，第一个参数相加之和大于 0，时结果为 0；第二个参数相加之和大于 0 时，取字符串长度。substring 与 slice 两个参数都为索引，substr 第二个参数为截取字符串长度。 substr 在淘汰的过程中，慎用。</li></ol></li></ol></blockquote><h2 id="查找字符串方法"><a href="#查找字符串方法" class="headerlink" title="查找字符串方法"></a>查找字符串方法</h2><h3 id="includes-区分大小写查找字符串，返回-Boolean-值。（ES6-新增方法）"><a href="#includes-区分大小写查找字符串，返回-Boolean-值。（ES6-新增方法）" class="headerlink" title="includes() 区分大小写查找字符串，返回 Boolean 值。（ES6 新增方法）"></a>includes() 区分大小写查找字符串，返回 Boolean 值。（ES6 新增方法）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">'Mr Brownlow, fortunately, was able to persuade him to abandon this wild idea'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(str.includes(<span class="string">'persuade'</span>)) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="indexOf-和-lastIndexOf-同样是区分大小写匹配字符串，存在返回索引值，否则返回-1。"><a href="#indexOf-和-lastIndexOf-同样是区分大小写匹配字符串，存在返回索引值，否则返回-1。" class="headerlink" title="indexOf() 和 lastIndexOf() 同样是区分大小写匹配字符串，存在返回索引值，否则返回 -1。"></a>indexOf() 和 lastIndexOf() 同样是区分大小写匹配字符串，存在返回索引值，否则返回 -1。</h3><h3 id="match-检索返回一个匹配正则表达式的结果"><a href="#match-检索返回一个匹配正则表达式的结果" class="headerlink" title="match() 检索返回一个匹配正则表达式的结果"></a>match() 检索返回一个匹配正则表达式的结果</h3><blockquote><p>str.match(regexp)<br><code>参数</code>：一个正则表达式对象。<br>若参数为非正则表达式对象，会隐式地使用 <code>new RegExp(obj)</code> 转换为 RegExp<br>若没给参数，参数默认为包含空字符串数组，如 <code>[&quot;&quot;]</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">'abc abc'</span></span><br><span class="line"><span class="keyword">let</span> reg = <span class="regexp">/(\w+)/g</span></span><br><span class="line">str.match(reg)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  [ 'abc', 'abc' ]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">reg = <span class="regexp">/(\w+)/</span></span><br><span class="line">str.match(reg)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> [ 'abc', 'abc', index: 0, input: 'abc abc', groups: undefined ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><blockquote><p><code>返回值：</code><br>使用 g 标志，返回表达式匹配的所有结果，不返回匹配捕获组(<code>[ &#39;abc&#39;, &#39;abc&#39; ]</code>)<br>不使用 g 标志，返回第一个完整匹配及其相关的捕获组（input 搜索字符串；groups 捕获数组或 <code>undefined</code>; index 匹配结果开始位置）。</p></blockquote><h2 id="字符串补齐方法"><a href="#字符串补齐方法" class="headerlink" title="字符串补齐方法"></a>字符串补齐方法</h2><h3 id="padStart-targetLength-padString-在字符串前面加入指定字符padString，达到-targetLength-指定长度"><a href="#padStart-targetLength-padString-在字符串前面加入指定字符padString，达到-targetLength-指定长度" class="headerlink" title="padStart(targetLength[,padString]) 在字符串前面加入指定字符padString，达到 targetLength 指定长度"></a>padStart(targetLength[,padString]) 在字符串前面加入指定字符padString，达到 targetLength 指定长度</h3><h3 id="padEnd-targetLength-padString-在字符串后面加入指定字符-padString，达到-targetLength-指定长度"><a href="#padEnd-targetLength-padString-在字符串后面加入指定字符-padString，达到-targetLength-指定长度" class="headerlink" title="padEnd(targetLength,[,padString]) 在字符串后面加入指定字符 padString，达到 targetLength 指定长度"></a>padEnd(targetLength,[,padString]) 在字符串后面加入指定字符 padString，达到 targetLength 指定长度</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 隐藏电话号码后四位</span></span><br><span class="line"><span class="keyword">var</span> tel = <span class="string">'13381892220'</span>;</span><br><span class="line"><span class="keyword">var</span> secretTel = tel.substr(<span class="number">3</span>, tel.length - <span class="number">8</span>).padEnd(tel.length<span class="number">-4</span>, <span class="string">'*'</span>).padStart(tel.length, <span class="string">'*'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(secretTel) <span class="comment">// ****189****</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> String </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Array sort 源码解析</title>
      <link href="2020/01/08/Array%20sort%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
      <url>2020/01/08/Array%20sort%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h2 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h2><h3 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h3><blockquote><p>ToUint32 将指定的值转换为 32 位，不带正负号的整数</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ArraySort</span>(<span class="params">comparefn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> custom_compare = IS_FUNCTION(comparefn);</span><br><span class="line">  <span class="keyword">var</span> length = ToUint32(<span class="keyword">this</span>.length);</span><br><span class="line">  QuickSort(<span class="keyword">this</span>, <span class="number">0</span>, length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">QuickSort</span>(<span class="params">a, from, to</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Insertion sort is faster for short arrays.</span></span><br><span class="line">  <span class="keyword">if</span> (to - <span class="keyword">from</span> &lt;= <span class="number">22</span>) &#123;</span><br><span class="line">    InsertionSort(a, <span class="keyword">from</span>, to);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>mid 运算 (max - min) &gt;&gt; 1 + min</code>，compare 对比数组中的中间数与遍历的当前元素，Compare 会返回 0，大于或小于的数字</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InsertionSort</span>(<span class="params">a, from, to</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="keyword">from</span> + <span class="number">1</span>; i &lt; to; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> element = a[i];</span><br><span class="line">    <span class="comment">// Pre-convert the element to a string for comparison if we know</span></span><br><span class="line">    <span class="comment">// it will happen on each compare anyway.</span></span><br><span class="line">    <span class="keyword">var</span> key =</span><br><span class="line">        (custom_compare || %_IsSmi(element)) ? element : ToString(element);</span><br><span class="line">    <span class="comment">// place element in a[from..i[</span></span><br><span class="line">    <span class="comment">// binary search</span></span><br><span class="line">    <span class="keyword">var</span> min = <span class="keyword">from</span>;</span><br><span class="line">    <span class="keyword">var</span> max = i;</span><br><span class="line">    <span class="comment">// The search interval is a[min..max[</span></span><br><span class="line">    <span class="keyword">while</span> (min &lt; max) &#123;</span><br><span class="line">      <span class="keyword">var</span> mid = min + ((max - min) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">var</span> order = Compare(a[mid], key);</span><br><span class="line">      <span class="keyword">if</span> (order == <span class="number">0</span>) &#123;</span><br><span class="line">        min = max = mid;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (order &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        min = mid + <span class="number">1</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        max = mid;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// place element at position min==max.</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = i; j &gt; min; j--) &#123;</span><br><span class="line">      a[j] = a[j - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    a[min] = element;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>x,y 进行大小比较，x 为数组中间的元素，y 相对比的元素（即 数组中的某一个元素）</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Compare</span>(<span class="params">x,y</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Assume the comparefn, if any, is a consistent comparison function.</span></span><br><span class="line">  <span class="comment">// If it isn't, we are allowed arbitrary behavior by ECMA 15.4.4.11.</span></span><br><span class="line">  <span class="keyword">if</span> (x === y) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (custom_compare) &#123;</span><br><span class="line">    <span class="comment">// Don't call directly to avoid exposing the builtin's global object.</span></span><br><span class="line">    <span class="keyword">return</span> comparefn.call(<span class="literal">null</span>, x, y);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (%_IsSmi(x) &amp;&amp; %_IsSmi(y)) &#123;</span><br><span class="line">    <span class="keyword">return</span> %SmiLexicographicCompare(x, y);</span><br><span class="line">  &#125;</span><br><span class="line">  x = ToString(x);</span><br><span class="line">  y = ToString(y);</span><br><span class="line">  <span class="keyword">if</span> (x == y) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> x &lt; y ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ArraySort</span>(<span class="params">comparefn</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// In-place QuickSort algorithm.</span></span><br><span class="line">  <span class="comment">// For short (length &lt;= 22) arrays, insertion sort is used for efficiency.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> custom_compare = IS_FUNCTION(comparefn);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Compare</span>(<span class="params">x,y</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Assume the comparefn, if any, is a consistent comparison function.</span></span><br><span class="line">    <span class="comment">// If it isn't, we are allowed arbitrary behavior by ECMA 15.4.4.11.</span></span><br><span class="line">    <span class="keyword">if</span> (x === y) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (custom_compare) &#123;</span><br><span class="line">      <span class="comment">// Don't call directly to avoid exposing the builtin's global object.</span></span><br><span class="line">      <span class="keyword">return</span> comparefn.call(<span class="literal">null</span>, x, y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (%_IsSmi(x) &amp;&amp; %_IsSmi(y)) &#123;</span><br><span class="line">      <span class="keyword">return</span> %SmiLexicographicCompare(x, y);</span><br><span class="line">    &#125;</span><br><span class="line">    x = ToString(x);</span><br><span class="line">    y = ToString(y);</span><br><span class="line">    <span class="keyword">if</span> (x == y) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> x &lt; y ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">InsertionSort</span>(<span class="params">a, from, to</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="keyword">from</span> + <span class="number">1</span>; i &lt; to; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> element = a[i];</span><br><span class="line">      <span class="comment">// Pre-convert the element to a string for comparison if we know</span></span><br><span class="line">      <span class="comment">// it will happen on each compare anyway.</span></span><br><span class="line">      <span class="keyword">var</span> key =</span><br><span class="line">          (custom_compare || %_IsSmi(element)) ? element : ToString(element);</span><br><span class="line">      <span class="comment">// place element in a[from..i[</span></span><br><span class="line">      <span class="comment">// binary search</span></span><br><span class="line">      <span class="keyword">var</span> min = <span class="keyword">from</span>;</span><br><span class="line">      <span class="keyword">var</span> max = i;</span><br><span class="line">      <span class="comment">// The search interval is a[min..max[</span></span><br><span class="line">      <span class="keyword">while</span> (min &lt; max) &#123;</span><br><span class="line">        <span class="keyword">var</span> mid = min + ((max - min) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">var</span> order = Compare(a[mid], key);</span><br><span class="line">        <span class="keyword">if</span> (order == <span class="number">0</span>) &#123;</span><br><span class="line">          min = max = mid;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (order &lt; <span class="number">0</span>) &#123;</span><br><span class="line">          min = mid + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          max = mid;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// place element at position min==max.</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> j = i; j &gt; min; j--) &#123;</span><br><span class="line">        a[j] = a[j - <span class="number">1</span>];</span><br><span class="line">      &#125;</span><br><span class="line">      a[min] = element;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">QuickSort</span>(<span class="params">a, from, to</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Insertion sort is faster for short arrays.</span></span><br><span class="line">    <span class="keyword">if</span> (to - <span class="keyword">from</span> &lt;= <span class="number">22</span>) &#123;</span><br><span class="line">      InsertionSort(a, <span class="keyword">from</span>, to);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 取中间的 index</span></span><br><span class="line">    <span class="keyword">var</span> pivot_index = $floor($random() * (to - <span class="keyword">from</span>)) + <span class="keyword">from</span>;</span><br><span class="line">    <span class="comment">// 取中的 element</span></span><br><span class="line">    <span class="keyword">var</span> pivot = a[pivot_index];</span><br><span class="line">    <span class="comment">// Pre-convert the element to a string for comparison if we know</span></span><br><span class="line">    <span class="comment">// it will happen on each compare anyway.</span></span><br><span class="line">    <span class="keyword">var</span> pivot_key =</span><br><span class="line">      (custom_compare || %_IsSmi(pivot)) ? pivot : ToString(pivot);</span><br><span class="line">    <span class="comment">// Issue 95: Keep the pivot element out of the comparisons to avoid</span></span><br><span class="line">    <span class="comment">// infinite recursion if comparefn(pivot, pivot) != 0.</span></span><br><span class="line">    a[pivot_index] = a[<span class="keyword">from</span>];</span><br><span class="line">    a[<span class="keyword">from</span>] = pivot;</span><br><span class="line">    <span class="keyword">var</span> low_end = <span class="keyword">from</span>;   <span class="comment">// Upper bound of the elements lower than pivot.</span></span><br><span class="line">    <span class="keyword">var</span> high_start = to;  <span class="comment">// Lower bound of the elements greater than pivot.</span></span><br><span class="line">    <span class="comment">// From low_end to i are elements equal to pivot.</span></span><br><span class="line">    <span class="comment">// From i to high_start are elements that haven't been compared yet.</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="keyword">from</span> + <span class="number">1</span>; i &lt; high_start; ) &#123;</span><br><span class="line">      <span class="keyword">var</span> element = a[i];</span><br><span class="line">      <span class="keyword">var</span> order = Compare(element, pivot_key);</span><br><span class="line">      <span class="keyword">if</span> (order &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        a[i] = a[low_end];</span><br><span class="line">        a[low_end] = element;</span><br><span class="line">        i++;</span><br><span class="line">        low_end++;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (order &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        high_start--;</span><br><span class="line">        a[i] = a[high_start];</span><br><span class="line">        a[high_start] = element;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;  <span class="comment">// order == 0</span></span><br><span class="line">        i++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    QuickSort(a, <span class="keyword">from</span>, low_end);</span><br><span class="line">    QuickSort(a, high_start, to);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> old_length = ToUint32(<span class="keyword">this</span>.length);</span><br><span class="line">  <span class="keyword">if</span> (old_length &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">  %RemoveArrayHoles(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> length = ToUint32(<span class="keyword">this</span>.length);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Move undefined elements to the end of the array.</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; length; ) &#123;</span><br><span class="line">    <span class="keyword">if</span> (IS_UNDEFINED(<span class="keyword">this</span>[i])) &#123;</span><br><span class="line">      length--;</span><br><span class="line">      <span class="keyword">this</span>[i] = <span class="keyword">this</span>[length];</span><br><span class="line">      <span class="keyword">this</span>[length] = <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      i++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  QuickSort(<span class="keyword">this</span>, <span class="number">0</span>, length);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// We only changed the length of the this object (in</span></span><br><span class="line">  <span class="comment">// RemoveArrayHoles) if it was an array.  We are not allowed to set</span></span><br><span class="line">  <span class="comment">// the length of the this object if it is not an array because this</span></span><br><span class="line">  <span class="comment">// might introduce a new length property.</span></span><br><span class="line">  <span class="keyword">if</span> (IS_ARRAY(<span class="keyword">this</span>)) &#123;</span><br><span class="line">    <span class="keyword">this</span>.length = old_length;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="SO，把以上源码粗略的看下来。总结如下："><a href="#SO，把以上源码粗略的看下来。总结如下：" class="headerlink" title="** SO，把以上源码粗略的看下来。总结如下：**"></a>** SO，把以上源码粗略的看下来。总结如下：**</h4><ol><li>先回复我第一个疑问，sort 排序，回调中有两个参数，一个是从0到当前遍历的元素中的中间的元素，另外一个是当前遍历元素；</li><li>对比以上两个元素，返回结果赋值给order，order 的结果决定 min 的计算方法；</li><li>min 初始值为 0，计算 min 决定对比元素插入的位置。</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>日记-2019-12-25</title>
      <link href="2019/12/25/%E6%97%A5%E8%AE%B0-2019-12-25/"/>
      <url>2019/12/25/%E6%97%A5%E8%AE%B0-2019-12-25/</url>
      
        <content type="html"><![CDATA[<h2 id="less"><a href="#less" class="headerlink" title="less"></a>less</h2><blockquote><p>/deep/ 使用时，一定在 scoped 域中使用</p></blockquote><h2 id="http-options"><a href="#http-options" class="headerlink" title="http options"></a>http options</h2><blockquote><p>OPTIONS 发起预检请求，用于获取目标资源所支持的通信选项，使用 OPTIONS 方法对服务器发起请求，检测服务器支持哪些 HTTP 方法， 以下响应报文中， allow-methods 表明服务器支持 POST 方法</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Credentials: true</span><br><span class="line">Access-Control-Allow-Headers: business-type, content-type</span><br><span class="line">Access-Control-Allow-Methods: POST</span><br><span class="line">Access-Control-Allow-Origin: http://localhost</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Length: 0</span><br><span class="line">Date: Wed, 25 Dec 2019 07:11:38 GMT</span><br><span class="line">Server: openresty/1.15.8.1</span><br><span class="line">Vary: Origin</span><br><span class="line">Vary: Access-Control-Request-Method</span><br><span class="line">Vary: Access-Control-Request-Headers</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂货 </tag>
            
            <tag> grocery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>发布订阅者</title>
      <link href="2019/08/28/%E6%A8%A1%E5%BC%8F-%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
      <url>2019/08/28/%E6%A8%A1%E5%BC%8F-%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E8%80%85%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="1-观察者模式"><a href="#1-观察者模式" class="headerlink" title="1. 观察者模式"></a>1. 观察者模式</h1><p>对象间的一对多依赖关系，一个对象状态发生改变，依赖于它的对象都将得到通知，并自动更新。 观察者模式属于行为模式，行为模式。行为模式关注的是对象之间的通讯，观察者模式是观察者与被观察者之间的通讯。</p><h1 id="2-订阅-发布模式"><a href="#2-订阅-发布模式" class="headerlink" title="2. 订阅-发布模式"></a>2. 订阅-发布模式</h1><p>在现在的发布订阅模式中，称为发布者的消息发送者不会将消息直接发送给订阅者。发面者和订阅者之间存在第三个组件，称为调度中心或事件通道。调度中心或事件通道，维持着发布者和订阅者间的联系，过滤所有发布者传入的消息并相应地分发给订阅者。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PubSub</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.subscribers = [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    subscribe(topic, callback) &#123;</span><br><span class="line">        <span class="keyword">let</span> callbacks = <span class="keyword">this</span>.subscribers[topic];</span><br><span class="line">        <span class="keyword">if</span> (!callbacks) &#123;</span><br><span class="line">            <span class="keyword">this</span>.subscribers[topic] = [callback];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            callbacks.push(callback);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    publish(topic, ...args) &#123;</span><br><span class="line">        <span class="keyword">let</span> callbacks = <span class="keyword">this</span>.subscribers[topic] || [];</span><br><span class="line">        callbacks.forEach(<span class="function"><span class="params">callback</span> =&gt;</span> callback(...args));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建事件调度中心，为订阅者和发布者提供调度服务</span></span><br><span class="line"><span class="keyword">let</span> pubSub = <span class="keyword">new</span> PubSub();</span><br><span class="line"><span class="comment">// A订阅了SMS事件（A只关注SMS本身，而不关心谁发布这个事件）</span></span><br><span class="line">pubSub.subscribe(<span class="string">'SMS'</span>, <span class="built_in">console</span>.log);</span><br><span class="line"><span class="comment">// B订阅了SMS事件</span></span><br><span class="line">pubSub.subscribe(<span class="string">'SMS'</span>, <span class="built_in">console</span>.log);</span><br><span class="line"><span class="comment">// C发布了SMS事件（C只关注SMS本身，不关心谁订阅了这个事件）</span></span><br><span class="line">pubSub.publish(<span class="string">'SMS'</span>, <span class="string">'I published `SMS` event'</span>);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.observers = [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    add(observer) &#123;</span><br><span class="line">        <span class="keyword">this</span>.observers.push(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    notify(...args) &#123;</span><br><span class="line">        <span class="keyword">this</span>.observers.forEach(<span class="function"><span class="params">observer</span> =&gt;</span> observer.update(...args));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    update(...args) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(...args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建观察者ob1</span></span><br><span class="line"><span class="keyword">let</span> ob1 = <span class="keyword">new</span> Observer();</span><br><span class="line"><span class="comment">// 创建观察者ob2</span></span><br><span class="line"><span class="keyword">let</span> ob2 = <span class="keyword">new</span> Observer();</span><br><span class="line"><span class="comment">// 创建目标sub</span></span><br><span class="line"><span class="keyword">let</span> sub = <span class="keyword">new</span> Subject();</span><br><span class="line"><span class="comment">// 目标sub添加观察者ob1 （目标和观察者建立了依赖关系）</span></span><br><span class="line">sub.add(ob1);</span><br><span class="line"><span class="comment">// 目标sub添加观察者ob2</span></span><br><span class="line">sub.add(ob2);</span><br><span class="line"><span class="comment">// 目标sub触发SMS事件（目标主动通知观察者）</span></span><br><span class="line">sub.notify(<span class="string">'I fired `SMS` event'</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript-对象</title>
      <link href="2019/08/28/Javascript-%E5%AF%B9%E8%B1%A1/"/>
      <url>2019/08/28/Javascript-%E5%AF%B9%E8%B1%A1/</url>
      
        <content type="html"><![CDATA[<p>今天遇到了一个小问题，’blur’ 事件失焦时，vue 并没有把接口请求回来的data回填到页面。 现在来分析分析：</p><ul><li><input disabled type="checkbox"> blur 的锅，no ，it isn’t！因为吧，失焦事件的回调函数执行了；</li><li><input checked disabled type="checkbox"> 异步请求回调成功后赋值失败，打完断点发现吧，没这回事。赋值成功。 嘿嘿，不卖关子了！上代码</li></ul><a id="more"></a> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">"姓名："</span> <span class="attr">prop</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">"form.name"</span> @<span class="attr">input</span>=<span class="string">"handlerAccount"</span> @<span class="attr">blur</span>=<span class="string">"checkSame"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">data() &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    form: &#123;&#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">methods: &#123;</span><br><span class="line">  checkSame() &#123;</span><br><span class="line">    <span class="keyword">this</span>.form.account = <span class="string">'test1'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这里先简单的说说，vue 实现双像绑定用的是 Obeject.defineProperty() 来监听属性变动， 需要监听的数据对象进行递归遍历，包括子属性对象的属性，都加上 setter和getter，data 中的 form 没有 account 属性，checkSame 方法直接给 form 添加新属性，通过 <code>this.form.account</code> 添加的属性没有 setter 和 setter和getter 方法，不具备监听。所以双向绑定也就无从谈起了。修改方法有以下两种：</p></blockquote><hr><hr><ul><li>修改方式 – 初始化每个需要双向绑定的属性及对象属性</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化每个需要双向绑定的属性及对象属性</span></span><br><span class="line">data() &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    form: &#123;</span><br><span class="line">      account: <span class="string">""</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">methods: &#123;</span><br><span class="line">  checkSame() &#123;</span><br><span class="line">    <span class="keyword">this</span>.form.account = <span class="string">'test1'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>通过 Object.assign 给 form 添加新属性</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过 Object.assign 给 form 添加新属性</span></span><br><span class="line">data() &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    form: &#123;</span><br><span class="line">      account: <span class="string">""</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">methods: &#123;</span><br><span class="line">  checkSame() &#123;</span><br><span class="line">    <span class="keyword">this</span>.form = <span class="built_in">Object</span>.assign(&#123;&#125;, &#123;</span><br><span class="line">      account: <span class="string">'test1'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>我所见过的 npm 库</title>
      <link href="2019/07/24/%E6%88%91%E6%89%80%E8%A7%81%E8%BF%87%E7%9A%84-npm-%E5%BA%93/"/>
      <url>2019/07/24/%E6%88%91%E6%89%80%E8%A7%81%E8%BF%87%E7%9A%84-npm-%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<h1 id="postcss-pxtorem"><a href="#postcss-pxtorem" class="headerlink" title="postcss-pxtorem"></a>postcss-pxtorem</h1><h1 id="dotenv"><a href="#dotenv" class="headerlink" title="dotenv"></a>dotenv</h1><p>NodeJs 运行时加载不同的配置，<code>process.env.DB_HOST</code> 获取环境变量，程序启动时，从文件加载环境变量时就需要用到 dotenv 库。</p><h2 id="用法-创建-env"><a href="#用法-创建-env" class="headerlink" title="用法 创建 .env"></a>用法 创建 .env</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> .env</span></span><br><span class="line">DB_HOST = localhost</span><br><span class="line">DB_USER = root</span><br><span class="line">DB_PASS = 123456</span><br></pre></td></tr></table></figure><p>NODE 中运行</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dotenv = <span class="built_in">require</span>(<span class="string">'dotenv'</span>)</span><br><span class="line">dotenv.config()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 程序中使用环境变量</span></span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">'db'</span>)</span><br><span class="line">db.connect(&#123;</span><br><span class="line">  host: process.env.DB_HOST,</span><br><span class="line">  username: process.env.DB_USER,</span><br><span class="line">  password: process.env.DB_PASS</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="debug-专门控制日志输出的库"><a href="#debug-专门控制日志输出的库" class="headerlink" title="debug 专门控制日志输出的库"></a>debug 专门控制日志输出的库</h1><p>判断 DEBUG 环境变量，调整运行环境控制日志是否输出。DEBUG 对环境变量进行解析，允许我们选择性的控制输出哪些日志模块，解决控制台日志堆积的问题。</p>]]></content>
      
      
      
        <tags>
            
            <tag> npm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>async await promise</title>
      <link href="2019/07/24/Javascript-async-await-promise/"/>
      <url>2019/07/24/Javascript-async-await-promise/</url>
      
        <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">'async1 start'</span> )</span><br><span class="line">    <span class="keyword">await</span> async2()</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">'async1 end'</span> )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">'async2'</span> )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log( <span class="string">'script start'</span> )</span><br><span class="line"></span><br><span class="line">setTimeout( <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">'setTimeout'</span> )</span><br><span class="line">&#125;, <span class="number">0</span> )</span><br><span class="line"></span><br><span class="line">async1();</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>( <span class="function"><span class="keyword">function</span> (<span class="params"> resolve </span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">'promise1'</span> )</span><br><span class="line">    resolve();</span><br><span class="line">&#125; ).then( <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">'promise2'</span> )</span><br><span class="line">&#125; )</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log( <span class="string">'script end'</span> )</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h2><p>解决采用 callback 机制产生的如回调地狱一样的潜在问题，允许采用近乎同步的逻辑写异步代码</p><h2 id="async-await-异步编程的终级解决方案"><a href="#async-await-异步编程的终级解决方案" class="headerlink" title="async/await 异步编程的终级解决方案"></a>async/await 异步编程的终级解决方案</h2><blockquote><p>JavaScript 的 async/await 实现，也离不开 Promise，async 用于申明一个方法是异步的，await 用于等待一个异步方法执行完成。await 只能出现在 async 函数中。</p></blockquote><h2 id="async-如何处理它的返回值的"><a href="#async-如何处理它的返回值的" class="headerlink" title="async 如何处理它的返回值的"></a>async 如何处理它的返回值的</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"hello async"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回值</span></span><br><span class="line"><span class="built_in">Promise</span> &#123;&lt;resolved&gt;: <span class="string">"hello async"</span>&#125;</span><br><span class="line">__proto__: <span class="built_in">Promise</span></span><br><span class="line">[[PromiseStatus]]: <span class="string">"resolved"</span></span><br><span class="line">[[PromiseValue]]: <span class="string">"hello async"</span></span><br></pre></td></tr></table></figure><p>所以 async 函数返回的是一个 Promise 对象，async 会把 return 变量通过 Promise.resolve() 封装成 Promise 对象。可以用 then() 链处理 Promise 对象。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"hello async"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn().then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;<span class="built_in">console</span>.log(res)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回值</span></span><br><span class="line">hello <span class="keyword">async</span></span><br><span class="line"><span class="built_in">Promise</span> &#123;&lt;resolved&gt;: <span class="literal">undefined</span>&#125;__proto__: <span class="built_in">Promise</span>[[PromiseStatus]]: <span class="string">"resolved"</span>[[PromiseValue]]: <span class="literal">undefined</span></span><br></pre></td></tr></table></figure><h2 id="await"><a href="#await" class="headerlink" title="await"></a>await</h2><blockquote><p>async 函数返回 Promise, await 可以用于等待 async 异步的完成，异步操作返回的都是 promise, await 按顺序执行。</p></blockquote><p><a href="https://github.com/HelenZhangLP/demo/tree/master/node/node-demo/demo-1" target="_blank" rel="noopener">更多案例</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 语法糖 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>axios 源码解读</title>
      <link href="2019/07/23/axios-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/"/>
      <url>2019/07/23/axios-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">├── /dist/                     # 项目输出目录</span><br><span class="line">├── /lib/                      # 项目源码目录</span><br><span class="line">│ ├── /cancel/                 # 定义取消功能</span><br><span class="line">│ ├── /core/                   # 一些核心功能</span><br><span class="line">│ │ ├── Axios.js               # axios的核心主类</span><br><span class="line">│ │ ├── dispatchRequest.js     # 用来调用http请求适配器方法发送请求</span><br><span class="line">│ │ ├── InterceptorManager.js  # 拦截器构造函数</span><br><span class="line">│ │ └── settle.js              # 根据http响应状态，改变Promise的状态</span><br><span class="line">│ ├── /helpers/                # 一些辅助方法</span><br><span class="line">│ ├── /adapters/               # 定义请求的适配器 xhr、http</span><br><span class="line">│ │ ├── http.js                # 实现http适配器</span><br><span class="line">│ │ └── xhr.js                 # 实现xhr适配器</span><br><span class="line">│ ├── axios.js                 # 对外暴露接口</span><br><span class="line">│ ├── defaults.js              # 默认配置</span><br><span class="line">│ └── utils.js                 # 公用工具</span><br><span class="line">├── package.json               # 项目信息</span><br><span class="line">├── index.d.ts                 # 配置TypeScript的声明文件</span><br><span class="line">└── index.js                   # 入口文件</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> http </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue.config.js</title>
      <link href="2019/07/22/vue-config-js/"/>
      <url>2019/07/22/vue-config-js/</url>
      
        <content type="html"><![CDATA[<h1 id="全面解读-vue-config-js"><a href="#全面解读-vue-config-js" class="headerlink" title="全面解读 vue.config.js"></a>全面解读 <code>vue.config.js</code></h1><blockquote><p><a href="https://cli.vuejs.org/zh/config/" target="_blank" rel="noopener">参考</a></p></blockquote><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line">&gt; <span class="built_in">module</span>.exports = &#123;</span><br><span class="line">&gt;   <span class="comment">// 基本路径，默认被部署在根路径，如果需要部署在子路径，publicPath 设置为 /example/</span></span><br><span class="line">&gt;   publicPath: process.env.NODE_ENV === <span class="string">"development"</span> ? <span class="string">"/"</span> : <span class="string">"/mallActivity/"</span>,</span><br><span class="line">&gt;   outputDir: <span class="string">'dist'</span>, <span class="comment">// 运行 vue-cli-service build 时生成生产环境构建文件的目录</span></span><br><span class="line">&gt;   assetsDir: <span class="string">'assets'</span>, <span class="comment">//生成文件的静态资源目录</span></span><br><span class="line">&gt;   <span class="comment">// productionSourceMap：&#123; type:Bollean,default:true &#125; 生产源映射</span></span><br><span class="line">&gt;   <span class="comment">// 如果您不需要生产时的源映射，那么将此设置为false可以加速生产构建</span></span><br><span class="line">&gt;   productionSourceMap: <span class="literal">false</span>,</span><br><span class="line">&gt;   css: &#123;</span><br><span class="line">&gt;     loaderOptions: &#123; <span class="comment">// CSS 加载器</span></span><br><span class="line">&gt;       stylus: &#123;</span><br><span class="line">&gt;         javascriptEnabled: <span class="literal">true</span></span><br><span class="line">&gt;       &#125;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt;   &#125;,</span><br><span class="line">&gt;   chainWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">&gt;     <span class="keyword">const</span> types = [<span class="string">'vue-modules'</span>, <span class="string">'vue'</span>, <span class="string">'normal-modules'</span>, <span class="string">'normal'</span>]</span><br><span class="line">&gt;     types.forEach(<span class="function"><span class="params">type</span> =&gt;</span> addStyleResource(config.module.rule(<span class="string">'stylus'</span>).oneOf(type)))</span><br><span class="line">&gt;   &#125;,</span><br><span class="line">&gt;   devServer: &#123;</span><br><span class="line">&gt;     proxy: &#123; <span class="comment">// 在开发环境下将 API 请求代理到 API 服务器</span></span><br><span class="line">&gt;       <span class="string">'/mock'</span>: &#123;</span><br><span class="line">&gt;         target: <span class="string">'http://10.8.5.180:80'</span>,</span><br><span class="line">&gt;         pathRewrite: &#123;</span><br><span class="line">&gt;           <span class="string">'^/mock'</span>: <span class="string">'/mock'</span></span><br><span class="line">&gt;         &#125;</span><br><span class="line">&gt;       &#125;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt;   &#125;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt; <span class="function"><span class="keyword">function</span> <span class="title">addStyleResource</span> (<span class="params">rule</span>) </span>&#123;</span><br><span class="line">&gt;   rule.use(<span class="string">'style-resource'</span>)</span><br><span class="line">&gt;     .loader(<span class="string">'style-resources-loader'</span>)</span><br><span class="line">&gt;     .options(&#123;</span><br><span class="line">&gt;       patterns: [</span><br><span class="line">&gt;         path.resolve(__dirname, <span class="string">'./src/assets/stylus/golbal.styl'</span>)</span><br><span class="line">&gt;       ]</span><br><span class="line">&gt;     &#125;)</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cookie 与 Web Storage</title>
      <link href="2019/06/14/%E6%B5%8F%E8%A7%88%E5%99%A8-cookie-webStorage/"/>
      <url>2019/06/14/%E6%B5%8F%E8%A7%88%E5%99%A8-cookie-webStorage/</url>
      
        <content type="html"><![CDATA[<p>先了解下浏览器缓存存储过程的序列图：</p><div id="sequence-0"></div>`If-None-Match:"4f80f-13c-3a1xb12a"` 服务器用来判断请求资源是否有更新，如果没有更新就返回 304 状态码，浏览器继续使用缓存数据。如有更新，服务器直接返回资源给浏览器。<p>Web Storage 将少量数据存储于客户端磁盘的技术。实际业务中将不希望从数据库的少量数据通过 web storage 存储，如：用户登录态、用户当前的部分操作如购物车数量增加等。</p><h2 id="Web-Storage-使用前验证兼容性"><a href="#Web-Storage-使用前验证兼容性" class="headerlink" title="Web Storage 使用前验证兼容性"></a>Web Storage 使用前验证兼容性</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((<span class="keyword">typeof</span> Storage) == <span class="string">'undefined'</span>) <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">// localStorage || sessionStorage 程序代码</span></span><br></pre></td></tr></table></figure><p><code>注意：</code></p><ul><li>由于部分 IE 和 Firefox 浏览器在测试的时候需要上传到服务器或 localhost 上执行，建议本地安装 http-server 测试。</li></ul><a id="more"></a><h2 id="window-localStorage"><a href="#window-localStorage" class="headerlink" title="window.localStorage"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/localStorage" target="_blank" rel="noopener">window.localStorage</a></h2><p>只读的 localStorage 属性<code>允许你访问一个 Document 源（origin）的对象 Storage</code>；其存储的数据能在跨浏览器会话保留，不会随浏览器关闭而消失，数据可分页、跨窗口访问。</p><p>localStorage 类似 sessionStorage<br>但其区别在于：存储在 localStorage 的数据可以长期保留；而当页面会话结束——也就是说，当页面被关闭时，存储在 sessionStorage 的数据会被清除 。</p><p><code>注意:</code></p><ul><li>无论数据存储在 localStorage 还是 sessionStorage ，它们都特定于页面的协议。</li><li>localStorage 中的键值对总是以字符串的形式存储。 (需要注意, 和 javascript 对象相比, 键值对总是以字符串的形式存储意味着数值类型会自动转化为字符串类型。</li><li>localStorage API 与 javascript 一样基于同源策略（Same-Origin Policy），网页之间的相互调用仅限于相同的网站，同源才能获取同一个 localStorage。（同源策略：相同协议，相同域名IP，相同端口）</li></ul><h3 id="window-localStorage-存取的三种方式"><a href="#window-localStorage-存取的三种方式" class="headerlink" title="window.localStorage 存取的三种方式"></a>window.localStorage 存取的三种方式</h3><ol><li><p>window.localStorage 的对象方法 setItem 与 getItem</p><blockquote><p>window.localStorage.setItem(key, value)<br>var value = window.localStorage.getItem(key)</p></blockquote></li><li><p>数组索引</p><blockquote><p>window.localStorage[‘key’] = value<br>var value = window.localStorage[‘key’]</p></blockquote></li><li><p>属性</p><blockquote><p>window.localStorage.key = value<br>var value = window.localStorage.key</p></blockquote></li></ol><h3 id="window-localStorage-清除的几种方式"><a href="#window-localStorage-清除的几种方式" class="headerlink" title="window.localStorage 清除的几种方式"></a>window.localStorage 清除的几种方式</h3><ol><li>浏览器开发者工具 - application - localStorage - 选中删除项，点击管理工具上的删除</li><li><code>window.localStorage.removeItem(key)</code></li><li><code>delete window.localStorage.key</code></li><li><code>delete window.localStorage[key]</code></li><li>清除全部数据 <code>window.localStorage.clear()</code></li></ol><h2 id="window-sessionStorage"><a href="#window-sessionStorage" class="headerlink" title="window.sessionStorage"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/sessionStorage" target="_blank" rel="noopener">window.sessionStorage</a></h2><p>用于保存临时数据，防止用户不小心刷新数据丢失，如大的表单提交。<br>sessionStorage 属性<code>允许你访问一个 session Storage 对象</code>。它与 localStorage 相似，不同之处在于 localStorage 里面存储的数据没有过期时间设置，而存储在 sessionStorage 里面的数据在页面会话结束时会被清除。页面会话在浏览器打开期间一直保持，并且重新加载或恢复页面仍会保持原来的页面会话。在新标签或窗口打开一个页面时会在顶级浏览上下文中初始化一个新的会话，这点和 session cookies 的运行方式不同。</p><blockquote><p>存储在 sessionStorage 或 localStorage 中的数据特定于该页面的协议。</p></blockquote><h3 id="window-sessionStorage-存取的三种方式"><a href="#window-sessionStorage-存取的三种方式" class="headerlink" title="window.sessionStorage 存取的三种方式"></a>window.sessionStorage 存取的三种方式</h3><ol><li><p>window.sessionStorage 的对象方法 setItem 与 getItem</p><blockquote><p>window.sessionStorage.setItem(key, value)<br>var value = window.sessionStorage.getItem(key)</p></blockquote></li><li><p>数组索引</p><blockquote><p>window.sessionStorage[‘key’] = value<br>var value = window.sessionStorage[‘key’]</p></blockquote></li><li><p>属性</p><blockquote><p>window.sessionStorage.key = value<br>var value = window.sessionStorage.key</p></blockquote></li></ol><h3 id="window-sessionStorage-清除的几种方式"><a href="#window-sessionStorage-清除的几种方式" class="headerlink" title="window.sessionStorage 清除的几种方式()"></a>window.sessionStorage 清除的几种方式()</h3><ol><li>浏览器开发者工具 - application - sessionStorage - 选中删除项，点击管理工具上的删除</li><li><code>window.sessionStorage.removeItem(key)</code></li><li><code>delete window.sessionStorage.key</code></li><li><code>delete window.sessionStorage[key]</code></li><li>清除全部数据 <code>window.sessionStorage.clear()</code></li><li>关闭浏览器或当前窗口</li></ol><h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cookie" target="_blank" rel="noopener">Cookie</a></h2><p>Cookie 是一个请求首部，其中含有先前由服务器通过 Set-Cookie 首部投放并存储到客户端的 HTTP cookies。<br>这个首部可能会被完全移除，例如在浏览器的隐私设置里面设置为禁用cookie。</p><blockquote><ul><li>Cookie 数据始终在同源的http请求中携带（即使不需要），就会在浏览器和服务器间来回传递，安全性低。而 Web Storage 不会把数据发给服务器，仅存在本地</li><li>以键值对应组合保存数据</li></ul></blockquote><h2 id="Web-Storage-与-Cookie-对比表"><a href="#Web-Storage-与-Cookie-对比表" class="headerlink" title="Web Storage 与 Cookie 对比表"></a>Web Storage 与 Cookie 对比表</h2><table class="table table-striped"><thead><tr><th></th><th>属性</th><th>访问对象</th><th>过期时间</th><th>存储大小</th></tr></thead><tbody><tr><td>window.localStorage</td><td>/</td><td>Document 源（origin）的对象 Storage(local storage)</td><td>永久存储数据，浏览器关闭后数据不丢失，除非主动执行删除指令删除</td><td>HTML5 规范中，容量由客户端程序（浏览器）决定，通常 1mb~5mb</td></tr><tr><td>window.sessionStorage</td><td>/</td><td>session storage 对象</td><td>页面关闭，会话结束，session 清除</td><td>HTML5 规范中，容量由客户端程序（浏览器）决定，通常 1mb~5mb</td></tr><tr><td>Cookie</td><td>标识用户用户身份而存储在用户本地终端上的数据（通常经过加密）</td><td>/</td><td>Expires/Max-Age 之前有效</td><td>4kb</td></tr></tbody></table><script src="https://cdnjs.cloudflare.com/ajax/libs/webfont/1.6.27/webfontloader.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/snap.svg/0.4.1/snap.svg-min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.6/sequence-diagram-min.js"></script><textarea id="sequence-0-code" style="display: none">title: 浏览器缓存序列图Note left of 浏览器:发起 http 请求浏览器->Cache: GET /index HTTP/1.1Note right of Cache: 缓存是空的，\n继续请求 web 服务器Cache->Web 服务器:GET /index HTTP/1.1Note left of Web 服务器: 缓存本地Web 服务器->Cache: HTTP/1.1 200 OK \n Cache-Control: \n Max-age=2000Cache->浏览器: HTTP/1.1 200 OK \n Cache-Control: \n Max-age=2000 \n Age:0Note left of 浏览器: 1000 秒后再次发起请求浏览器->Cache: GET /index HTTP/1.1Cache->Cache: /index.html \n Max-age=2000 \n Age=1000Note right of Cache: 缓存生命周期内的Cache->浏览器: HTTP/1.1 200 OK \n Cache-Control: \n Max-age=2000 \n Age:1000Note left of 浏览器: 2100 秒后再次发起请求浏览器->Cache: GET /index HTTP/1.1Note right of Cache: /index.html \n Max-age=2000 \n Age=2100 \n 缓存过期，向服务器请求Cache->Web 服务器: GET /index HTTP/1.1 \n If-None-MatchWeb 服务器->Cache: HTTP/1.1 304 Not ModifiedNote left of Web 服务器:服务器 304，\n 缓存内容没有改动Cache->浏览器: HTTP/1.1 304 \n Not Modified \n Cache-Control: \n Max-age=2000 \n Age:0</textarea><textarea id="sequence-0-options" style="display: none">{"theme":"simple"}</textarea><script>  var code = document.getElementById("sequence-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("sequence-0-options").value));  var diagram = Diagram.parse(code);  diagram.drawSVG("sequence-0", options);</script>]]></content>
      
      
      
        <tags>
            
            <tag> browser </tag>
            
            <tag> window </tag>
            
            <tag> web storage </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>http 请求状态码</title>
      <link href="2019/06/12/http-%E8%AF%B7%E6%B1%82%E7%8A%B6%E6%80%81%E7%A0%81/"/>
      <url>2019/06/12/http-%E8%AF%B7%E6%B1%82%E7%8A%B6%E6%80%81%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h1 id="http-请求状态码-200"><a href="#http-请求状态码-200" class="headerlink" title="http 请求状态码 200"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/200" target="_blank" rel="noopener">http 请求状态码 200</a></h1><blockquote><p>请求成功，默认状态下 200 响应可以被缓存</p></blockquote><blockquote><ul><li>GET: 已经取得资源，并将资源添加到响应的消息体中。</li><li>HEAD: 响应的消息体为头部信息。</li><li>POST: 响应的消息体中包含此次请求的结果。</li><li>TRACE: 响应的消息体中包含服务器接收到的请求信息。</li><li>PUT 和 DELETE 的请求成功通常并不是响应 200 OK 的状态码，而是 204 No Content 表示无内容(或者 201 Created表示一个资源首次被创建成功)。</li></ul></blockquote><a id="more"></a><h1 id="http-请求状态码-206"><a href="#http-请求状态码-206" class="headerlink" title="http 请求状态码 206"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/206" target="_blank" rel="noopener">http 请求状态码 206</a></h1><blockquote><p>HTTP 206 Partial Content 成功状态响应代码表示请求已成功，并且主体包含所请求的数据区间，该数据区间是在请求的 Range 首部指定的。</p></blockquote><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; Response Headers</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; Accept-Encoding: identity;q=1, *;q=0</span><br><span class="line">&gt; Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">&gt; Connection: keep-alive</span><br><span class="line">&gt; Host: cktvideo-1252817906.cos.ap-guangzhou.myqcloud.com</span><br><span class="line">&gt; If-Range: &quot;640f0886f386c9c253a95c5d1c01ca16-163&quot;</span><br><span class="line">&gt; **`Range: bytes=9895936-170855393`**</span><br><span class="line">&gt; Referer: https://cktvideo-1252817906.cos.ap-guangzhou.myqcloud.com/gaokeyan1.mp4</span><br><span class="line">&gt; User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><blockquote><p>如果只包含一个数据区间，那么整个响应的 Content-Type 首部的值为所请求的文件的类型，同时包含 Content-Range 首部。</p></blockquote><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; Response Headers(10)</span><br><span class="line">&gt; Accept-Ranges: bytes</span><br><span class="line">&gt; Connection: keep-alive</span><br><span class="line">&gt; Content-Length: 170855394</span><br><span class="line">&gt; ** Content-Range: bytes 0-170855393/170855394</span><br><span class="line">&gt; ** Content-Type: video/mp4</span><br><span class="line">&gt; Date: Wed, 12 Jun 2019 02:34:48 GMT</span><br><span class="line">&gt; ETag: &quot;640f0886f386c9c253a95c5d1c01ca16-163&quot;</span><br><span class="line">&gt; Last-Modified: Sun, 30 Dec 2018 17:44:16 GMT</span><br><span class="line">&gt; Server: tencent-cos</span><br><span class="line">&gt; x-cos-request-id: NWQwMDY0YzhfMWNiMjk0MGFfNThlZl83YTg5NWY=</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><h1 id="http-请求状态响应码-304"><a href="#http-请求状态响应码-304" class="headerlink" title="http 请求状态响应码 304"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/304" target="_blank" rel="noopener">http 请求状态响应码 304</a></h1><blockquote><p>无需再次传输请求的内容，也就是说可以使用缓存的内容。这通常是在一些安全的方法（safe），例如 GET 或 HEAD 或 在请求中附带了头部信息： If-None-Match 或 If-Modified-Since。</p></blockquote><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3</span><br><span class="line">&gt; Accept-Encoding: gzip, deflate, br</span><br><span class="line">&gt; Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">&gt; Cache-Control: max-age=0</span><br><span class="line">&gt; Connection: keep-alive</span><br><span class="line">&gt; Host: cktvideo-1252817906.cos.ap-guangzhou.myqcloud.com</span><br><span class="line">&gt; ** If-Modified-Since: Sun, 30 Dec 2018 17:44:16 GMT</span><br><span class="line">&gt; ** If-None-Match: &quot;640f0886f386c9c253a95c5d1c01ca16-163&quot;</span><br><span class="line">&gt; Range: bytes=0-1048575</span><br><span class="line">&gt; Upgrade-Insecure-Requests: 1</span><br><span class="line">&gt; User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><h1 id="http-请求响应码-401"><a href="#http-请求响应码-401" class="headerlink" title="http 请求响应码 401"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/401" target="_blank" rel="noopener">http 请求响应码 401</a></h1><blockquote><p>状态码 401 Unauthorized(未授权)代表客户端错误，指的是由于缺乏目标资源要求的身份验证凭证，发送的请求未得到满足。 这个状态码会与 WWW-Authenticate 首部一起发送，其中包含有如何进行验证的信息。 这个状态类似于 403， 但是在该情况下，依然可以进行身份验证。</p></blockquote><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; Request URL: https://api.github.com/user</span><br><span class="line">&gt; Request Method: GET</span><br><span class="line">&gt; Status Code: 401 Unauthorized</span><br><span class="line">&gt; Remote Address: 54.169.195.247:443</span><br><span class="line">&gt; Referrer Policy: no-referrer-when-downgrade</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><h1 id="http-请求响应码-404"><a href="#http-请求响应码-404" class="headerlink" title="http 请求响应码 404"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/404" target="_blank" rel="noopener">http 请求响应码 404</a></h1><blockquote><p>状态码 404 Not Found 代表客户端错误，指的是服务器端无法找到所请求的资源。返回该响应的链接通常称为坏链（broken link）或死链（dead link），它们会导向链接出错处理(link rot)页面。 404 状态码并不能说明请求的资源是临时还是永久丢失。如果服务器知道该资源是永久丢失，那么应该返回 410 (Gone) 而不是 404 。</p></blockquote><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; Request URL: https://api.github.com/repos/helenzhanglp/blog/issues?client_id=8e7e6dda81936172806e&amp;client_secret=97f71b6bbdf731bc650ec39212061882b8f36e71&amp;labels=Gitalk,1863e4a8c0596ce3dfb3ee2f0c838431&amp;t=1560407734937</span><br><span class="line">&gt; Request Method: GET</span><br><span class="line">&gt; Status Code: 404 Not Found</span><br><span class="line">&gt; Remote Address: 54.169.195.247:443</span><br><span class="line">&gt; Referrer Policy: no-referrer-when-downgrade</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><h1 id="http-请求响应码-500"><a href="#http-请求响应码-500" class="headerlink" title="http 请求响应码 500"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/500" target="_blank" rel="noopener">http 请求响应码 500</a></h1><blockquote><p>服务器内部错误，是一个通用的全方位响应，有可能是权限或数据库链接错误。设置代理了，也会返回 500 错误</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> 网络请求 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git 坑</title>
      <link href="2019/06/03/%E5%B7%A5%E5%85%B7-%E4%BB%A3%E7%A0%81%E7%AE%A1%E7%90%86-git%E5%9D%91/"/>
      <url>2019/06/03/%E5%B7%A5%E5%85%B7-%E4%BB%A3%E7%A0%81%E7%AE%A1%E7%90%86-git%E5%9D%91/</url>
      
        <content type="html"><![CDATA[<h3 id="idea-gitignore-忽略问题"><a href="#idea-gitignore-忽略问题" class="headerlink" title=".idea gitignore 忽略问题"></a>.idea gitignore 忽略问题</h3><blockquote><p>.gitignore 中添加 .idea/ 没用</p></blockquote><p><a href="https://help.github.com/en/articles/ignoring-files" target="_blank" rel="noopener">原因参照 - 1</a><br><a href="https://git-scm.com/docs/gitignore" target="_blank" rel="noopener">原因参照 - 2</a><br>忽略所有目录下的 .idea -&gt; **/.idea/</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git rm --cached FILENAME</span><br></pre></td></tr></table></figure><h3 id="macos-升级后-git-编译错误"><a href="#macos-升级后-git-编译错误" class="headerlink" title="macos 升级后 git 编译错误"></a>macos 升级后 git 编译错误</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$&gt; git</span><br><span class="line">dyld: Symbol not found: _OBJC_IVAR_$_NSFont._fFlags</span><br><span class="line">  Referenced from: /Applications/Xcode.app/Contents/Frameworks/IDEFoundation.framework/Versions/A/../../../../SharedFrameworks/DVTKit.framework/Versions/A/DVTKit</span><br><span class="line">  Expected in: /System/Library/Frameworks/AppKit.framework/Versions/C/AppKit</span><br><span class="line"> in /Applications/Xcode.app/Contents/Frameworks/IDEFoundation.framework/Versions/A/../../../../SharedFrameworks/DVTKit.framework/Versions/A/DVTKit</span><br><span class="line">gcc: error: unable to locate xcodebuild, please make sure the path to the Xcode folder is set correctly!</span><br><span class="line">gcc: error: You can set the path to the Xcode folder using /usr/bin/xcode-select -switch</span><br></pre></td></tr></table></figure><blockquote><p>git: error: unable to locate xcodebuild, please make sure the path to the Xcode folder is set correctly!</p></blockquote><p><strong>解决办法</strong></p><blockquote><p>xcode-select –install<br>sudo /usr/bin/xcode-select –switch /Library/Developer/CommandLineTools/</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NodeJs 学习笔记</title>
      <link href="2019/05/31/NodeJs-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>2019/05/31/NodeJs-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h3 id="path"><a href="#path" class="headerlink" title="path"></a>path</h3><blockquote><p>提供用于处理文件路径和目录路径的实用工具</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br></pre></td></tr></table></figure><a id="more"></a><ul><li><input checked disabled type="checkbox"> <p>path.resolve()</p><blockquote><p>将路径或片断序列解析为绝对路径</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不传参</span></span><br><span class="line">path.resolve()  <span class="comment">// '/Users/lipingzhang/gitProject/blog'</span></span><br><span class="line">path.resolve(<span class="number">1</span>) <span class="comment">// TypeError [ERR_INVALID_ARG_TYPE]: The "path" argument must be of type string. Received type number</span></span><br><span class="line">path.resolve(<span class="string">'a'</span>,<span class="string">'b'</span>) <span class="comment">// '/Users/lipingzhang/gitProject/blog/a/b'</span></span><br><span class="line">path.resolve(<span class="string">'/temp'</span>,<span class="string">'new'</span>) <span class="comment">//  '/temp/new'</span></span><br><span class="line">path.resolve(<span class="string">'wwwroot'</span>, <span class="string">'static_files/png/'</span>, <span class="string">'../gif/image.gif'</span>) <span class="comment">// '/Users/lipingzhang/gitProject/blog/wwwroot/static_files/gif/image.gif'</span></span><br></pre></td></tr></table></figure></li><li><input checked disabled type="checkbox"> <p>path.join(<string>)</string></p><blockquote><p>使用平台特定分隔符将所有给定 path 片段连接在一起，规范化生成路径</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">path.join() <span class="comment">// '.' 表示当前目录</span></span><br><span class="line">path.join(process.cwd(), <span class="string">'hexo.json'</span>) <span class="comment">// '/Users/lipingzhang/Desktop/hexo-cli的副本/a.json'</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="process"><a href="#process" class="headerlink" title="process"></a>process</h3><blockquote><p>全局变量，提供有关当前 Node.js 进程信息，并对其进行控制，不需要 require</p></blockquote><h4 id="process-信号事件"><a href="#process-信号事件" class="headerlink" title="process - 信号事件"></a>process - 信号事件</h4><p>Interrupt from keyboard<br>SIGINT 在终端运行时，可以被所有平台支持，通常可以通过 <ctrl>+C 触发(虽然这个不能配置)。 当终端运行在raw模式，它不会被触发。</ctrl></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">process.on(<span class="string">'SIGINT'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// callback function</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> node </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>分析 hexo 脚手架</title>
      <link href="2019/05/21/%E5%88%86%E6%9E%90-hexo-%E8%84%9A%E6%89%8B%E6%9E%B6/"/>
      <url>2019/05/21/%E5%88%86%E6%9E%90-hexo-%E8%84%9A%E6%89%8B%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$: hexo</span><br><span class="line"></span><br><span class="line">Usage: hexo &lt;<span class="built_in">command</span>&gt;</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  <span class="built_in">help</span>     Get <span class="built_in">help</span> on a <span class="built_in">command</span>.</span><br><span class="line">  init     Create a new Hexo folder.</span><br><span class="line">  version  Display version information.</span><br><span class="line"></span><br><span class="line">Global Options:</span><br><span class="line">  --config  Specify config file instead of using _config.yml</span><br><span class="line">  --cwd     Specify the CWD</span><br><span class="line">  --debug   Display all verbose messages <span class="keyword">in</span> the terminal</span><br><span class="line">  --draft   Display draft posts</span><br><span class="line">  --safe    Disable all plugins and scripts</span><br><span class="line">  --silent  Hide output on console</span><br><span class="line"></span><br><span class="line">For more <span class="built_in">help</span>, you can use <span class="string">'hexo help [command]'</span> <span class="keyword">for</span> the detailed information</span><br><span class="line">or you can check the docs: http://hexo.io/docs/</span><br></pre></td></tr></table></figure><a id="more"></a><ol><li>help</li><li>init</li><li>version</li></ol><h3 id="引入依赖包"><a href="#引入依赖包" class="headerlink" title="引入依赖包"></a>引入依赖包</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> chalk = <span class="built_in">require</span>(<span class="string">'chalk'</span>); <span class="comment">// chalk 粉笔  "chalk": "^1.1.3",</span></span><br><span class="line"><span class="keyword">var</span> tildify = <span class="built_in">require</span>(<span class="string">'tildify'</span>); <span class="comment">// tildify 使变薄 "tildify": "^1.2.0" convert an absolute path to a tilde path 将绝对路径转换为 ~/路径</span></span><br><span class="line"><span class="keyword">var</span> <span class="built_in">Promise</span> = <span class="built_in">require</span>(<span class="string">'bluebird'</span>); <span class="comment">// bluebird 知更鸟 "bluebird": "^3.4.0",</span></span><br><span class="line"><span class="keyword">var</span> Context = <span class="built_in">require</span>(<span class="string">'./context'</span>);</span><br><span class="line"><span class="keyword">var</span> findPkg = <span class="built_in">require</span>(<span class="string">'./find_pkg'</span>);</span><br><span class="line"><span class="keyword">var</span> goodbye = <span class="built_in">require</span>(<span class="string">'./goodbye'</span>);</span><br><span class="line"><span class="keyword">var</span> minimist = <span class="built_in">require</span>(<span class="string">'minimist'</span>); <span class="comment">//minimist 参数解析</span></span><br><span class="line"><span class="keyword">var</span> resolve = <span class="built_in">require</span>(<span class="string">'resolve'</span>); <span class="comment">// 同步或异步解决方案</span></span><br><span class="line"><span class="keyword">var</span> camelCaseKeys = <span class="built_in">require</span>(<span class="string">'hexo-util/lib/camel_case_keys'</span>); <span class="comment">// 参数对象转换为驼峰命名 (?)</span></span><br></pre></td></tr></table></figure><h3 id="lib-hexo-js"><a href="#lib-hexo-js" class="headerlink" title="./lib/hexo.js"></a>./lib/hexo.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">entry</span>(<span class="params">cwd, args</span>) </span>&#123;</span><br><span class="line">  cwd = cwd || process.cwd();</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 返回 node 进程工作的当前目录    </span></span><br><span class="line"><span class="comment">   * '/Users/lipingzhang/Desktop/hexo-cli的副本'</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * process.argv</span></span><br><span class="line"><span class="comment">   * [ '/usr/local/bin/node', '/Users/lipingzhang/Desktop/hexo-cli的副本/bin/hexo', 'init' ]</span></span><br><span class="line"><span class="comment">   * 返回一个包含 node process 命令行启动时传入的参数数组</span></span><br><span class="line"><span class="comment">   * 第一个参数 process.execPath 启动 node 进程的可执行文件绝对路径</span></span><br><span class="line"><span class="comment">   * 第二个参数是将要执行的文件路径</span></span><br><span class="line"><span class="comment">   * 其它为所有其余命令行参数</span></span><br><span class="line"><span class="comment">   * process.argv.slice(2) [ 'init' ]</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * minimist minimist(process.argv.slice(2))</span></span><br><span class="line"><span class="comment">    * &#123; _: Array(1) &#125; &#123; _: [ 'init' ]&#125;</span></span><br><span class="line"><span class="comment">    * camelCaseKeys 参数对象转换为驼峰命名</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  args = camelCaseKeys(args || minimist(process.argv.slice(<span class="number">2</span>)));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> hexo = <span class="keyword">new</span> Context(cwd, args);</span><br><span class="line">  <span class="keyword">var</span> log = hexo.log;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Change the title in console</span></span><br><span class="line">  process.title = <span class="string">'hexo'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pathFn = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkPkg</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> pkgPath = pathFn.join(path, <span class="string">'package.json'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> fs.readFile(pkgPath).then(<span class="function"><span class="keyword">function</span>(<span class="params">content</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> json = <span class="built_in">JSON</span>.parse(content);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> json.hexo === <span class="string">'object'</span>) <span class="keyword">return</span> path;</span><br><span class="line">  &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err &amp;&amp; err.cause.code === <span class="string">'ENOENT'</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> parent = pathFn.dirname(path);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (parent === path) <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">return</span> checkPkg(parent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> err;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="context-js"><a href="#context-js" class="headerlink" title="./context.js"></a>./context.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> logger = <span class="built_in">require</span>(<span class="string">'hexo-log'</span>);</span><br><span class="line"><span class="keyword">var</span> chalk = <span class="built_in">require</span>(<span class="string">'chalk'</span>);</span><br><span class="line"><span class="keyword">var</span> EventEmitter = <span class="built_in">require</span>(<span class="string">'events'</span>).EventEmitter;</span><br><span class="line"><span class="keyword">var</span> <span class="built_in">Promise</span> = <span class="built_in">require</span>(<span class="string">'bluebird'</span>);</span><br><span class="line"><span class="keyword">var</span> ConsoleExtend = <span class="built_in">require</span>(<span class="string">'./extend/console'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Context</span>(<span class="params">base, args</span>) </span>&#123;</span><br><span class="line">  base = base || process.cwd();</span><br><span class="line">  args = args || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  EventEmitter.call(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.base_dir = base;</span><br><span class="line">  <span class="keyword">this</span>.log = logger(args);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.extend = &#123;</span><br><span class="line">    <span class="built_in">console</span>: <span class="keyword">new</span> ConsoleExtend()</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="extend-console-js"><a href="#extend-console-js" class="headerlink" title="./extend/console.js"></a>./extend/console.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> abbrev = <span class="built_in">require</span>(<span class="string">'abbrev'</span>); <span class="comment">// 速记短别名</span></span><br><span class="line"><span class="comment">// constructor Console  --&gt; Initialization parameters store &amp;&amp; alias</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Console</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.store = &#123;&#125;;</span><br><span class="line">  <span class="keyword">this</span>.alias = &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Console.prototype.get = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  name = name.toLowerCase(); <span class="comment">// 入参转换为小写</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.store[<span class="keyword">this</span>.alias[name]];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Console.prototype.list = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.store;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Console.prototype.register = <span class="function"><span class="keyword">function</span>(<span class="params">name, desc, options, fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!name) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'name is required'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!fn) &#123;</span><br><span class="line">    <span class="keyword">if</span> (options) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> options === <span class="string">'function'</span>) &#123;</span><br><span class="line">        fn = options;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> desc === <span class="string">'object'</span>) &#123; <span class="comment">// name, options, fn</span></span><br><span class="line">          options = desc;</span><br><span class="line">          desc = <span class="string">''</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// name, desc, fn</span></span><br><span class="line">          options = &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'fn must be a function'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// name, fn</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> desc === <span class="string">'function'</span>) &#123;</span><br><span class="line">        fn = desc;</span><br><span class="line">        options = &#123;&#125;;</span><br><span class="line">        desc = <span class="string">''</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'fn must be a function'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (fn.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">      fn = <span class="built_in">Promise</span>.promisify(fn);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      fn = <span class="built_in">Promise</span>.method(fn);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> c = <span class="keyword">this</span>.store[name.toLowerCase()] = fn;</span><br><span class="line">    c.options = options;</span><br><span class="line">    c.desc = desc;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.alias = abbrev(<span class="built_in">Object</span>.keys(<span class="keyword">this</span>.store));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="console-init"><a href="#console-init" class="headerlink" title="./console/init"></a>./console/init</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> assign = <span class="built_in">require</span>(<span class="string">'object-assign'</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initConsole</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">  args = assign(&#123;</span><br><span class="line">    install: <span class="literal">true</span>,</span><br><span class="line">    clone: <span class="literal">true</span></span><br><span class="line">  &#125;, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> node </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS display: none vs visibility: hidden</title>
      <link href="2019/05/13/CSS-display-none-vs-visibility-hidden/"/>
      <url>2019/05/13/CSS-display-none-vs-visibility-hidden/</url>
      
        <content type="html"><![CDATA[<h3 id="display-none-与-visibility-hidden-区别"><a href="#display-none-与-visibility-hidden-区别" class="headerlink" title="display:none 与 visibility:hidden 区别"></a>display:none 与 visibility:hidden 区别</h3><blockquote><p>display 指定元素显示框架的类型，none 隐藏不占文档流，不会影响布局<br>visibility 显示或隐藏元素而不更改文档的布局，hidden 相当于此元素变成透明并且 text-indent: -9999px，会影响布局</p></blockquote><a id="more"></a><h4 id="可以用以下实例进行验证"><a href="#可以用以下实例进行验证" class="headerlink" title="可以用以下实例进行验证"></a>可以用以下实例进行验证</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">'item-wrap'</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;li class="style1"&gt;</span></span><br><span class="line"><span class="comment">    &lt;img src="" alt=""&gt;</span></span><br><span class="line"><span class="comment">    &lt;div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="comment">  &lt;/li&gt; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"style2"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">""</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"style3"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">""</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>last dom<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><!-- more --><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.style1</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">'http://img0.fengqu-inc.com/cmsres/20190430/2f836f6d-91ed-4c5e-ae2a-81c32357786e.png'</span>);</span><br><span class="line">  <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.style2</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">'http://img0.fengqu-inc.com/cmsres/20190430/a8c73c89-6175-404a-b2b5-533c05d0f601.png'</span>);</span><br><span class="line">  <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.style3</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">'http://img0.fengqu-inc.com/cmsres/20190430/0e16b8ee-4251-456a-bf35-093bace3d252.png'</span>);</span><br><span class="line">  <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">  <span class="attribute">visibility</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="以上三张背景图是否下载-？-没有在官方文档中找到详细说明，以下仅代表个人实验结果"><a href="#以上三张背景图是否下载-？-没有在官方文档中找到详细说明，以下仅代表个人实验结果" class="headerlink" title="以上三张背景图是否下载 ？(没有在官方文档中找到详细说明，以下仅代表个人实验结果)"></a>以上三张背景图是否下载 ？(<code>没有在官方文档中找到详细说明，以下仅代表个人实验结果</code>)</h3><ul><li><input disabled type="checkbox"> 定义样式不引用，图片资源不会下载，其它形式不管是 display: none 还是 visibility: hidden 都会下载图片资源，如下图</li></ul><hr><iframe id="cp_embed_ewpVBp" src="//codepen.io/helenzhanglp|anonymous|anon/embed/ewpVBp?height=265&theme-id=0&slug-hash=ewpVBp&default-tab=result&embed-version=2" scrolling="no" frameborder="no" height="265" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" style="width: 100%; overflow: hidden;"></iframe><p><img src="https://s2.ax1x.com/2019/06/14/V4D334.png" alt="图片下载资源"></p>]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
            <tag> 面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>随笔</title>
      <link href="2019/05/09/%E9%9A%8F%E7%AC%94/"/>
      <url>2019/05/09/%E9%9A%8F%E7%AC%94/</url>
      
        <content type="html"><![CDATA[<h3 id="New-Question"><a href="#New-Question" class="headerlink" title="New Question"></a>New Question</h3><p>javaScript 中 function 与 object 的关系</p><h3 id="本地服务器"><a href="#本地服务器" class="headerlink" title="本地服务器"></a>本地服务器</h3><ul><li>liveServer</li><li>httpServer</li><li>WampServer</li></ul><h3 id="familiar-essay"><a href="#familiar-essay" class="headerlink" title="familiar essay"></a>familiar essay</h3><p>text-align 行内元素水平居中<br>inline-block 行内元素，没有宽高，用 padding + 文本撑开<br>inline-block 行内元素，设置 padding 会从父元素溢出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Request URL: https://app.zslb.xyz/api/order/add_refund?orderId=289&amp;amount=1</span><br><span class="line">Request Method: GET</span><br><span class="line">Status Code: 405</span><br><span class="line">Remote Address: 118.25.170.213:443</span><br><span class="line">Referrer Policy: no-referrer-when-downgrade</span><br></pre></td></tr></table></figure><p>服务器端请求为 post，与当前 request method get 冲突</p><blockquote><p>请求行中指定的请求方法不能被用于请求相应的资源。<br>  该响应必须返回一个Allow 头信息用以表示出当前资源能够接受的请求方法的列表。<br>  鉴于 PUT，DELETE 方法会对服务器上的资源进行写操作，因而绝大部分的网页服务器都不支持或者在默认配置下不允许上述请求方法，对于此类请求均会返回405错误。</p></blockquote><p>元素设置 position: absolute 或 float: left 会脱离文档流</p><h2 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h2><h3 id="tip-浏览器缓存功能"><a href="#tip-浏览器缓存功能" class="headerlink" title="tip: 浏览器缓存功能"></a><code>tip:</code> 浏览器缓存功能</h3><p>浏览网页时，浏览器会暂存网页静态资源，包括外部的 css、javascript、图片、影像等。当用户在同一浏览器浏览同一网页时，不会重新加载静态资源。优点是加快网页加载速度，减少服务器负担。缺点是当静态资源修改，缓存未到期，那么浏览器会显示缓存的旧数据。除非用户清缓存或 ctrl+f5 强制刷新重新加载。</p><blockquote><p><code>解决办法：</code>修改静态资源后，在外部链接的文件名后加上 ？+任意字符串，可以是版本号或日期，不同于旧片酬就可以。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...html</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;script src=&quot;./t.js?v20120929&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="tip-JavaScript-数值是采用-IEEE-754-双精度-64-位格式存储，IEEE-754-标准的浮点数并不能精确地表示小数，小数运算时需要小心。"><a href="#tip-JavaScript-数值是采用-IEEE-754-双精度-64-位格式存储，IEEE-754-标准的浮点数并不能精确地表示小数，小数运算时需要小心。" class="headerlink" title="tip: JavaScript 数值是采用 IEEE 754 双精度 64 位格式存储，IEEE 754 标准的浮点数并不能精确地表示小数，小数运算时需要小心。"></a><code>tip:</code> JavaScript 数值是采用 IEEE 754 双精度 64 位格式存储，IEEE 754 标准的浮点数并不能精确地表示小数，小数运算时需要小心。</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.1</span> + <span class="number">0.2</span></span><br><span class="line"><span class="comment">// 0.30000000000000004</span></span><br></pre></td></tr></table></figure><blockquote><p><code>解决办法：</code></p></blockquote><ol><li><p>将小数运算转换成整数</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">0.1</span> * <span class="number">10</span> + <span class="number">0.2</span> * <span class="number">10</span>)/<span class="number">10</span></span><br><span class="line"><span class="comment">// 0.3</span></span><br></pre></td></tr></table></figure></li><li><p>使用内建函数强制转换为指定位数的小数</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">0.1</span>+<span class="number">0.2</span>).toFixed(<span class="number">2</span>)</span><br><span class="line"><span class="comment">// "0.30"</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="tip：-null-amp-amp-undefined"><a href="#tip：-null-amp-amp-undefined" class="headerlink" title="tip： null &amp;&amp; undefined"></a><code>tip：</code> null &amp;&amp; undefined</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">null</span> == <span class="literal">undefined</span></span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"><span class="literal">null</span> === <span class="literal">undefined</span></span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure><h3 id="tip：-Garbage-Collection-会在变量超出作用域时回收，释放其占用的内存"><a href="#tip：-Garbage-Collection-会在变量超出作用域时回收，释放其占用的内存" class="headerlink" title="tip： Garbage Collection 会在变量超出作用域时回收，释放其占用的内存"></a><code>tip：</code> Garbage Collection 会在变量超出作用域时回收，释放其占用的内存</h3><h3 id="tip：-ECMAScript5-标准之后允许开发者通过属性描述器接口-PropertyDescriptor-来修改属性并且可以定义新属性。可设置-value-writable-enumerable-configurable-set-get-等。若-enumerable-设为-false，则不可枚举，for-in-时该属性不会显示。"><a href="#tip：-ECMAScript5-标准之后允许开发者通过属性描述器接口-PropertyDescriptor-来修改属性并且可以定义新属性。可设置-value-writable-enumerable-configurable-set-get-等。若-enumerable-设为-false，则不可枚举，for-in-时该属性不会显示。" class="headerlink" title="tip： ECMAScript5 标准之后允许开发者通过属性描述器接口 PropertyDescriptor 来修改属性并且可以定义新属性。可设置 value, writable, enumerable, configurable, set, get 等。若 enumerable 设为 false，则不可枚举，for in 时该属性不会显示。"></a><code>tip：</code> ECMAScript5 标准之后允许开发者通过属性描述器接口 PropertyDescriptor 来修改属性并且可以定义新属性。可设置 value, writable, enumerable, configurable, set, get 等。若 enumerable 设为 false，则不可枚举，for in 时该属性不会显示。</h3><h3 id="tip：-for…in-不仅遍历对象的实例属性，也包括原型属性。不同的浏览器遍历的顺序不同。ES6-规范中，for…of-兼容性有些问题-IE-不支持。使用时多加考虑。"><a href="#tip：-for…in-不仅遍历对象的实例属性，也包括原型属性。不同的浏览器遍历的顺序不同。ES6-规范中，for…of-兼容性有些问题-IE-不支持。使用时多加考虑。" class="headerlink" title="tip： for…in 不仅遍历对象的实例属性，也包括原型属性。不同的浏览器遍历的顺序不同。ES6 规范中，for…of 兼容性有些问题 IE 不支持。使用时多加考虑。"></a><code>tip：</code> for…in 不仅遍历对象的实例属性，也包括原型属性。不同的浏览器遍历的顺序不同。ES6 规范中，for…of 兼容性有些问题 IE 不支持。使用时多加考虑。</h3><h3 id="tip：-forEach-不能使用-break-指令中断循环。"><a href="#tip：-forEach-不能使用-break-指令中断循环。" class="headerlink" title="tip： forEach 不能使用 break 指令中断循环。"></a><code>tip：</code> forEach 不能使用 break 指令中断循环。</h3><p>JavaScript 为满足动态语言而诞生，由 Netscape 开发，嵌入 HTML 文件，基于对象和事件驱动的脚本语言<br>一 JavaScript 入门<br>sun 和 Netscape LiveScript -&gt; javascript<br>Microsoft JScript<br>1997 年 ECMA(Netscape, sun, Microsoft, Borland) 制定规范 ECMA-262 -&gt; ECMAScript</p><p>JavaScript 的组成</p><img src="http://www.plantuml.com/plantuml/svg/AyxEp2j8B4hCLKZEpot8pqlDAmakgSn9LIXAJIv9p4lFIUNYWZCLl1BB4eEJYp8BIXIgkHGKebsTVHqX_5WGryNV5qmxWUXQ0000"><p>ECMAScript 脚本语言的核心内容，定义了脚本语言的基本语法、基本语言<br>DOM（Document Object Model) 文档对象模型。HTML 和 XML 的编程接口。浏览器中的 DOM 把整个网页规划成由节点层级构成的树状结构文档<br>BOM(Browser Object Model)浏览器对象模型，描述了对浏览器窗口进行访问和操作的方法和接口</p><p>JavaScript 特点</p><ol><li>解释型：不需要编译，直接在浏览器中运行时进行解释</li><li>动态性：基于事件驱动的脚本语言，不需要通过 web 服务器就可以对用户的输入直接做出响应</li><li>跨平台：只要具有浏览器 JavaScript 引擎，就可以执行 JavaScript 代码</li><li>安全性，只能通过浏览器实现信息浏览器、交互</li><li>基于对象：许多功能可以来自于脚本环境中对象的方法与脚本相互作用</li></ol><p>JavaScript 应用场景</p><ol><li>开发各种动态交互效果</li><li>使用 Ajax 等技术与后端进行数据交互</li></ol><p>JavaScript 动态变化的原理以及执行顺序</p><ol><li>JavaScript 实现网页变化原理</li><li>JavaScript 执行顺序</li><li>JavaScript 调试</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> grocery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS 居中</title>
      <link href="2019/05/05/CSS-%E5%B1%85%E4%B8%AD/"/>
      <url>2019/05/05/CSS-%E5%B1%85%E4%B8%AD/</url>
      
        <content type="html"><![CDATA[<p>居中分为两种：一是水平居中，二是垂直居中。可借用不同的布局方式做多种实现。</p><h2 id="水平布局-Normal-flow"><a href="#水平布局-Normal-flow" class="headerlink" title="水平布局 + Normal flow"></a>水平布局 + Normal flow</h2><p>不进行任何布局，采用 html 默认布局方式</p><ol><li>行内元素，父容器设置 text-align: center;</li><li>块级元素：margin: 0 auto;</li></ol><a id="more"></a><h2 id="水平布局-Flexbox"><a href="#水平布局-Flexbox" class="headerlink" title="水平布局 + Flexbox"></a>水平布局 + Flexbox</h2><ol><li>父容器设置：display: flex; justify-content: center; align-items: start; // 垂直方向不要拉伸</li><li>父容器设置：display: flex; margin: 0 auto;</li></ol><h2 id="水平布局-grid-IE-浏览器不兼容"><a href="#水平布局-grid-IE-浏览器不兼容" class="headerlink" title="水平布局 + grid (IE 浏览器不兼容)"></a>水平布局 + grid (IE 浏览器不兼容)</h2><p>父容器：display: grid; 子容器 justify-self: center; align-self: center;</p><h2 id="水平布局-定位-position-absolute"><a href="#水平布局-定位-position-absolute" class="headerlink" title="水平布局 + 定位 position: absolute"></a>水平布局 + 定位 position: absolute</h2><p>这里有三种实现(假设 元素 width: 100px)：</p><ol><li>position: absolute; margin-left: 50%; transform: translateX(-50%);</li><li>position: absolute; margin-left: 50%; transform: translateX(-50px);</li><li>position: absolute; left: 50%; margin-left: 50px;</li><li>position: absolute; left: 0; right: 0; margin: auto;</li></ol><blockquote><p><code>注意：</code></p></blockquote><ol><li>absolute 相对于最近的非 ‘static’ 元素定位；如果该元素不存在，则相对于 initial container block 定位。<a href="https://helenzhanglp.github.io/2020/10/12/CSS-position-absolute/">详见</a></li><li>transform 属性兼容 IE10 以上浏览器</li><li><a href="https://helenzhanglp.github.io/2020/10/19/CSS-Margin-auto/">有关第4种实现方式的理解</a></li></ol><h2 id="水平布局-定位-position-relative"><a href="#水平布局-定位-position-relative" class="headerlink" title="水平布局 + 定位 position: relative"></a>水平布局 + 定位 position: relative</h2><p>需要居中的 block 元素上设置样式： position: relative; margin: auto;</p><h2 id="水平布局-table-cell"><a href="#水平布局-table-cell" class="headerlink" title="水平布局 + table-cell"></a>水平布局 + table-cell</h2><h3 id="demo-垂直布局-imgIcon-文案"><a href="#demo-垂直布局-imgIcon-文案" class="headerlink" title="demo 垂直布局 imgIcon + 文案"></a>demo 垂直布局 imgIcon + 文案</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"vote"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;voteImg&#125;</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleVote&#125;</span> /&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">"ml5"</span>&gt;</span>&#123;vote&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: auto;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item</span> <span class="selector-tag">span</span>,</span><br><span class="line"><span class="selector-class">.item</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: table-cell;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote></blockquote><hr><h2 id="垂直居中-Normal-Flow"><a href="#垂直居中-Normal-Flow" class="headerlink" title="垂直居中 + Normal Flow"></a>垂直居中 + Normal Flow</h2><ol><li>行内元素，父容器：line-height: height</li></ol><h2 id="垂直居中-flexbox"><a href="#垂直居中-flexbox" class="headerlink" title="垂直居中 + flexbox"></a>垂直居中 + flexbox</h2><ol><li>父容器：display: flex; 要实现居中的子容器：margin: auto 0(垂直水平居中 margin: auto)</li></ol><blockquote><h1 id="display-block"><a href="#display-block" class="headerlink" title="display: block"></a>display: block</h1></blockquote><h2 id="块级元素垂直居中-display-block-position-relative-margin-25px-auto-0"><a href="#块级元素垂直居中-display-block-position-relative-margin-25px-auto-0" class="headerlink" title="块级元素垂直居中 - display: block; position: relative; margin: -25px auto 0;"></a>块级元素垂直居中 - <code>display: block; position: relative; margin: -25px auto 0;</code></h2><blockquote><p>居中元素相对于父元素向下偏移父元素的 left: 50%；再向上偏移该元素的 margin-top: -50%<br>  <strong>* 必须 - 居中元素的高 *</strong></p></blockquote><img src="https://s2.ax1x.com/2019/05/10/ERVQnx.png" alt="块级元素垂直居中" width="300" hegiht="200" align="center"><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.db-vertical-center</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">margin</span>: -<span class="number">25px</span> auto <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="块级元素垂直居中-display-block-position-absolute-margin-auto"><a href="#块级元素垂直居中-display-block-position-absolute-margin-auto" class="headerlink" title="块级元素垂直居中 - display: block; position: absolute; margin: auto;"></a>块级元素垂直居中 - <code>display: block; position: absolute; margin: auto;</code></h2><blockquote><p>position: absolute; 脱离文档流<br>  margin-left + left + width + margin-right + right = view width<br>  margin: auto 浏览器计算 margin<br>  脱离文档流后 margin 根据原位置进行位移</p></blockquote><img src="https://s2.ax1x.com/2019/05/10/ERVlB6.png" alt="块级元素水平居中" width="300" hegiht="200" align="center"><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.wrap</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#efefef</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.db-center</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">margin</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="块级元素垂直居中-position-relative-left-amp-top-calc"><a href="#块级元素垂直居中-position-relative-left-amp-top-calc" class="headerlink" title="块级元素垂直居中 - position: relative; left &amp; top calc()"></a>块级元素垂直居中 - <code>position: relative; left &amp; top calc()</code></h2><blockquote><p>根据父元素定位，calc 计算 left , top 位置。 用父元素的 50% - 子元素的 50%<br>  <strong>* 必须 - 居中元素的宽高 *</strong></p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.db-center</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">left</span>: <span class="built_in">calc</span>(<span class="number">50%</span> - <span class="number">100px</span>);</span><br><span class="line">  <span class="attribute">top</span>: <span class="built_in">calc</span>(<span class="number">50%</span> - <span class="number">25px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="块级元素垂直居中-position-relative-top-50-transform-translateY-50"><a href="#块级元素垂直居中-position-relative-top-50-transform-translateY-50" class="headerlink" title="块级元素垂直居中 - position: relative; top: 50%; transform: translateY(-50%)"></a>块级元素垂直居中 - <code>position: relative; top: 50%; transform: translateY(-50%)</code></h2><blockquote><p>position: 相对于父元素的宽高进行计算<br>  translate 元素自身的 50%</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.db-center</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><h1 id="display-inline-block"><a href="#display-inline-block" class="headerlink" title="display: inline-block"></a>display: inline-block</h1></blockquote><h2 id="行内元素水平居中-text-align-center"><a href="#行内元素水平居中-text-align-center" class="headerlink" title="行内元素水平居中 - text-align: center"></a>行内元素水平居中 - <code>text-align: center</code></h2><blockquote><p>父容器为块状元素，子元素是为行内元素 display: inline-block;<br>  设置父元素的行内元素的水平居中</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.dib-horizontal-center</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="行内元素水平居中-line-height"><a href="#行内元素水平居中-line-height" class="headerlink" title="行内元素水平居中 - line-height"></a>行内元素水平居中 - <code>line-height</code></h2><blockquote><p>父容器为块状元素，子元素是为行内元素 display: inline-block;<br>  设置父元素的行内元素的垂直居中<br>  line-height: 值为父容器的高<br>  <strong>* 子容器为单行元素适用，如果是多行需要居中，就采用块级元素居中方案 *</strong></p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.dib-horizontal-center</span> &#123;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><h1 id="display-flex"><a href="#display-flex" class="headerlink" title="display: flex"></a>display: flex</h1></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.df-center</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><iframe id="cp_embed_byGwXx" src="//codepen.io/helenzhanglp|anonymous|anon/embed/byGwXx?height=265&theme-id=0&slug-hash=byGwXx&default-tab=result&embed-version=2" scrolling="no" frameborder="no" height="265" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" style="width: 100%; overflow: hidden;"></iframe><blockquote><h1 id="display-table-cell"><a href="#display-table-cell" class="headerlink" title="display: table-cell"></a>display: table-cell</h1></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.dtable-center</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: table-cell;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><h1 id="display-grid"><a href="#display-grid" class="headerlink" title="display: grid"></a>display: grid</h1></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.fatherWrap</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.son</span> &#123;</span><br><span class="line">    <span class="attribute">align-self</span>: center;</span><br><span class="line">    <span class="attribute">justify-self</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css </tag>
            
            <tag> 面试系列 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>由一个面试题引发的一系列事故</title>
      <link href="2019/04/04/Javascript-%E9%9D%A2%E8%AF%95%E9%A2%98-2/"/>
      <url>2019/04/04/Javascript-%E9%9D%A2%E8%AF%95%E9%A2%98-2/</url>
      
        <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">0</span>)</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="number">1</span>);&#125;)</span><br><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="number">2</span>)&#125;)</span><br><span class="line">promise.then(<span class="built_in">console</span>.log(<span class="number">3</span>))</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="number">4</span>)&#125;,<span class="number">0</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">5</span>)</span><br></pre></td></tr></table></figure><h3 id="Javascript-异步编程"><a href="#Javascript-异步编程" class="headerlink" title="Javascript 异步编程"></a>Javascript 异步编程</h3><p>Javascript 是单线程，同步方式运行代码。会出现阻塞进程的问题。</p><h4 id="Javascript-异步编程的实现"><a href="#Javascript-异步编程的实现" class="headerlink" title="Javascript 异步编程的实现"></a>Javascript 异步编程的实现</h4><p>主要分三类：回调函数、发布订阅、Promise 对象</p><p>** 回调函数 **</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++) &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 5, 5, 5, 5, 5</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      fn();</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'a'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'b'</span>);</span><br><span class="line">&#125;</span><br><span class="line">a(b);</span><br><span class="line"><span class="comment">// a b function a 相当于异步执行</span></span><br></pre></td></tr></table></figure><p>** PubSub Publish/Subscribe ** 发布、订阅模式，用以分发事件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> PubSub = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.handlers = &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">PubSub.prototype.subscribe = <span class="function"><span class="keyword">function</span>(<span class="params">eventType, handler</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(eventType <span class="keyword">in</span> <span class="keyword">this</span>.handlers)) &#123;</span><br><span class="line">    <span class="keyword">this</span>.handlers[eventType] = []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.handlers[eventType].push(handler); <span class="comment">// 添加事件监听器</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>; <span class="comment">// 返回上下文环境，实现链式调用</span></span><br><span class="line">&#125;</span><br><span class="line">PubSub.prototype.publish = <span class="function"><span class="keyword">function</span>(<span class="params">eventType</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>exports and module.exports</title>
      <link href="2019/03/26/exports-and-module-exports/"/>
      <url>2019/03/26/exports-and-module-exports/</url>
      
        <content type="html"><![CDATA[<h3 id="exports-和-module-exports"><a href="#exports-和-module-exports" class="headerlink" title="exports 和 module.exports"></a>exports 和 module.exports</h3><p><a href="http://nodejs.cn/api/modules.html#modules_exports_shortcut" target="_blank" rel="noopener">参考文档</a><br>nodeJS 官网中对 require() 有一段假设实现，如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="built_in">module</span> = &#123; <span class="attr">exports</span>: &#123;&#125; &#125;;</span><br><span class="line">  (<span class="function">(<span class="params"><span class="built_in">module</span>, exports</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">sFn</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    exports = sFn</span><br><span class="line">    <span class="built_in">module</span>.exports = sFn</span><br><span class="line">  &#125;)(<span class="built_in">module</span>, <span class="built_in">module</span>.exports);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="回过头来看定义"><a href="#回过头来看定义" class="headerlink" title="回过头来看定义"></a>回过头来看定义</h4><ol><li>exports<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils.js</span></span><br><span class="line">exports.cssLoaders = <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">  options = options || &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> cssLoader = &#123;</span><br><span class="line">    loader: <span class="string">'css-loader'</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">      minimize: process.env.NODE_ENV === <span class="string">'production'</span>,</span><br><span class="line">      sourceMap: options.sourceMap</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// vue.loader.config.js</span></span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">'./utils'</span>)</span><br><span class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">'../config'</span>)</span><br><span class="line"><span class="keyword">var</span> isProduction = process.env.NODE_ENV === <span class="string">'production'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  loaders: utils.cssLoaders(&#123;</span><br><span class="line">    sourceMap: isProduction</span><br><span class="line">      ? config.build.productionSourceMap</span><br><span class="line">      : config.dev.cssSourceMap,</span><br><span class="line">    extract: isProduction</span><br><span class="line">  &#125;),</span><br><span class="line">  postcss: [</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'autoprefixer'</span>)(&#123;</span><br><span class="line">      browsers: [<span class="string">'iOS &gt;= 7'</span>, <span class="string">'Android &gt;= 4.1'</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><blockquote><p>exports 导出的是函数，引入文件 require() 之后直接调用<br>module.exports 导出的是一个对象</p></blockquote><h3 id="export-amp-amp-export-default"><a href="#export-amp-amp-export-default" class="headerlink" title="export &amp;&amp; export default"></a>export &amp;&amp; export default</h3>]]></content>
      
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> node </tag>
            
            <tag> ES6 模块化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript 模块化</title>
      <link href="2019/03/26/Javascript-%E6%A8%A1%E5%9D%97%E5%8C%96/"/>
      <url>2019/03/26/Javascript-%E6%A8%A1%E5%9D%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<p>Javascript 起初只为了验证表单，后来加入了动画等。只需要在 html 中添加 <code>&lt;script&gt;&lt;/script&gt;</code> 标签即可。随着前端复杂度的提高，对于前端代码的<code>可读性、可扩展性</code>有较高的要求，就需要分多模块。这一阶段就是无模块化阶段：</p><h3 id="一、无模块化"><a href="#一、无模块化" class="headerlink" title="一、无模块化"></a>一、无模块化</h3><p>无模块化阶段代码如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"jquery_scroller.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"main.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><blockquote><ol><li>变量、对象、函数均绑在全局，<code>污染全局作用域</code> 会出现命名冲突的问题。</li><li><code>依赖关系不明显</code>，开发手动处理各模块依赖，维护成本加大。</li></ol></blockquote><a id="more"></a><h3 id="二、CommonJS规范"><a href="#二、CommonJS规范" class="headerlink" title="二、CommonJS规范"></a>二、CommonJS规范</h3><p>CommonJS 由 Javascript 社区 2009 年提出的包含模块、文件、IO、控制台在内的一系列标准。Node.js 的实现中采用了 CommonJS 标准的一部分，并在其基础上作了一些调整。<br><a href="http://Javascript.ruanyifeng.com/nodejs/module.html#toc0" target="_blank" rel="noopener">参考 CommonJS 规范</a></p><h4 id="1-概述认识-module-对象"><a href="#1-概述认识-module-对象" class="headerlink" title="1. 概述认识 module 对象"></a>1. 概述认识 <code>module</code> 对象</h4><blockquote><ol><li>每个文件为一个模块，每个模块有自己的作用域。该模块定义的变量、函数、类均为私有，其它模块不可见。不会污染全局作用域</li><li>CommonJS 规范规定，每个模块内部， <code>module</code> 代表当前模块。<code>module</code> 是一个对象，属性 <code>exports</code> 是对外接口。加载模块，则是加载 <code>module.exports</code> 属性。</li></ol></blockquote><p><code>Node</code> 内部提供一个 <code>Module</code> 构造函数，所有模块都是 <code>Module</code> 的实例</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Module</span>(<span class="params">id, parent</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.id = id; <span class="comment">// 模块识别符，即带有绝对路径的模块文件</span></span><br><span class="line">    <span class="keyword">this</span>.parent = parent; <span class="comment">// 返回是一个对象，为调用该模块的模块</span></span><br><span class="line">    <span class="keyword">this</span>.children = []; <span class="comment">// 返回一个数组，表示该模块需要调用哪些模块</span></span><br><span class="line">    <span class="keyword">this</span>.filename = <span class="string">'/filename'</span>; <span class="comment">// 带有绝对路径模块的文件名</span></span><br><span class="line">    <span class="keyword">this</span>.loaded = <span class="literal">true</span>; <span class="comment">// 返回一个布尔值，表示模块是否已经完成加载</span></span><br><span class="line">    <span class="keyword">this</span>.exports = &#123;&#125;; <span class="comment">// 表示该模块输出的值</span></span><br><span class="line">    <span class="keyword">this</span>.paths = [];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Node 环境中 <code>console.log(module)</code> 会看到以下结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Module &#123;</span><br><span class="line">  id: &apos;.&apos;,</span><br><span class="line">  path: &apos;/Users/zhangliping/Desktop/demo/demo/commonJs&apos;,</span><br><span class="line">  exports: &#123;&#125;,</span><br><span class="line">  parent: null,</span><br><span class="line">  filename: &apos;/Users/zhangliping/Desktop/demo/demo/commonJs/index.js&apos;,</span><br><span class="line">  loaded: false,</span><br><span class="line">  children: [],</span><br><span class="line">  paths: [</span><br><span class="line">    &apos;/Users/zhangliping/Desktop/demo/demo/commonJs/node_modules&apos;,</span><br><span class="line">    &apos;/Users/zhangliping/Desktop/demo/demo/node_modules&apos;,</span><br><span class="line">    &apos;/Users/zhangliping/Desktop/demo/node_modules&apos;,</span><br><span class="line">    &apos;/Users/zhangliping/Desktop/node_modules&apos;,</span><br><span class="line">    &apos;/Users/zhangliping/node_modules&apos;,</span><br><span class="line">    &apos;/Users/node_modules&apos;,</span><br><span class="line">    &apos;/node_modules&apos;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-导出"><a href="#2-导出" class="headerlink" title="2. 导出"></a>2. 导出</h4><p>CommonJS 中，通过 <code>module.exports</code> 导出模块中的内容</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example.js</span></span><br><span class="line"><span class="keyword">const</span> variable = <span class="string">'this is a variable'</span></span><br><span class="line"><span class="keyword">const</span> fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="string">'this is a function'</span> &#125;</span><br><span class="line"><span class="keyword">const</span> obj = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将以上变量、函数、对象，对过 module.exports 暴露出去</span></span><br><span class="line"><span class="built_in">module</span>.exports.variable = variable</span><br><span class="line">exports.fn = fn</span><br><span class="line"><span class="built_in">module</span>.exports.obj = obj</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#123; variable: 'this is a varialbe', fn: [Function: fn], obj: &#123;&#125; &#125;</span></span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  variable: <span class="string">'this is a variable'</span>,</span><br><span class="line">  fn: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="string">'this is a function'</span>&#125;,</span><br><span class="line">  obj: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// &#123; variable: 'this is a variable', fn: [Function: fn], obj: &#123;&#125; &#125;</span></span><br></pre></td></tr></table></figure><ul><li><p><strong><em><code>错误案例 demo 1</code></em></strong></p><blockquote><p>以下写法错误，会导致 exports 指向新的对象引用，module.exports 还是原对象引用，是个空对象，所以 name 属性并不会导出。</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">exports = &#123;</span><br><span class="line">  name: <span class="string">'new object'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// &#123;&#125;</span></span><br></pre></td></tr></table></figure></li><li><p><strong><em><code>错误案例 demo 2</code></em></strong></p><blockquote><p>以下 demo 将 <code>exports</code> 和 <code>module.exports</code> 混合使用，原因在于先导出了一个函数，然后 <code>module.exports</code> 重新赋值为另一个对象，之前的对象属性丢失。</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">exports.fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'this. is a function'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  variable: <span class="string">'this is a variable'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// &#123; variable: 'this is a variable' &#125;</span></span><br></pre></td></tr></table></figure></li><li><p><strong><em><code>错误案例 demo 3</code></em></strong></p><blockquote><p>先打印出 end, 再打印出 <code>exports</code> 的内容，说明这个 exports 之后的内容也会被执行，为提高代码可读性，<code>module.exports</code> 写在文件尾部</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">exports.fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'this. is a function'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'end'</span>)</span><br><span class="line"><span class="comment">// end</span></span><br><span class="line"><span class="comment">// &#123; fn: [Function] &#125;</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="3-导入"><a href="#3-导入" class="headerlink" title="3. 导入"></a>3. 导入</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'test the number of times the export file is executed'</span>)</span><br><span class="line">exports.hello = <span class="string">'instruction: export the function of hello'</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> example = <span class="built_in">require</span>(<span class="string">'./example'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'wait a moment..., require the js file of example again'</span>)</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./example'</span>)</span><br></pre></td></tr></table></figure><hr><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[@zhangliingdembp:demo (master)]$ node ./commonJs/index.js</span><br><span class="line">test the number of times the export file is executed</span><br><span class="line">wait a moment..., require the js file of export again</span><br><span class="line">[@zhangliingdembp:demo (master)]$ node ./commonJs/index.js</span><br></pre></td></tr></table></figure><ul><li><strong><em>error-1 Error: Cannot find module ‘export’</em></strong><blockquote><p><code>require(&#39;example&#39;)</code> 导致以上报错，导致入的文件要给出文件路径 <code>require(&#39;./example&#39;)</code></p></blockquote></li></ul><p><code>结论：</code></p><blockquote><ol><li>所有代码都运行在模块作用域，不会污染全局作用域。</li><li>模块可以多次加载，但是只会在第一次加载时运行一次，然后运行结果就被缓存了，以后再加载，就直接读取缓存结果。要想让模块再次运行，必须清除缓存。<code>module.loaded</code> 默认为 false，如果加载过的话，该值会被设置为 true，模块代码将不再执行。</li><li>模块加载的顺序，按照其在代码中出现的顺序。</li></ol></blockquote><p>require 函数接收表达式，可以利用该特性将动态加载模块到全局</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> needModules = [<span class="string">'moduleA'</span>,<span class="string">'moduleB'</span>,<span class="string">'moduleC'</span>,...]</span><br><span class="line">needModules.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">'./'</span>+item);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="三、AMD规范"><a href="#三、AMD规范" class="headerlink" title="三、AMD规范"></a>三、AMD规范</h3><h3 id="四、CMD规范"><a href="#四、CMD规范" class="headerlink" title="四、CMD规范"></a>四、CMD规范</h3><h3 id="五、ES6模块化"><a href="#五、ES6模块化" class="headerlink" title="五、ES6模块化"></a>五、ES6模块化</h3><p>2015 年 6 月，TC39 标准委员会正式发布 ES6(ECMAScript 6.0) 以后，Javascript 有了 <code>模块</code> 的概念。</p><ul><li>与 CommonJS 一样，ES6 Module 每个模块都有自身的作用域；</li><li>在 ES6 版本中，<code>import</code> 和 <code>export</code> 是保留关键字；</li><li>ES6 Module 自动采用严格模式（<code>use strict</code>）;</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> a = <span class="string">'this is a variable'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> fn = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'this is a arrow function'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;a,fn&#125; <span class="keyword">from</span> <span class="string">'./example'</span>;</span><br><span class="line"><span class="keyword">let</span> b = fn();</span><br><span class="line"><span class="built_in">console</span>.log(a, b);</span><br></pre></td></tr></table></figure><h4 id="node-index-js"><a href="#node-index-js" class="headerlink" title="node index.js"></a>node index.js</h4><blockquote><p><code>SyntaxError: Cannot use import statement outside a module</code><br>不支持 import，需要 babel 转义</p></blockquote><ol><li><p>浏览器环境解决办法（目前没有运行起来）</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/@babel/standalone/babel.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/babel"</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="comment">// Your ES6 code</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>引入依赖包处理<a href="https://wangdoc.com/es6/intro.html" target="_blank" rel="noopener">参考解决</a></p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> commonjs </tag>
            
            <tag> amd </tag>
            
            <tag> cmd </tag>
            
            <tag> es6 modules </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS 面试题</title>
      <link href="2019/03/25/CSS-%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
      <url>2019/03/25/CSS-%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<ul><li><input checked disabled type="checkbox"> <p>absolute 相对于最近的非 ‘static’ 元素定位；如果该元素不存在，则相对于 initial container block 定位。该定位方式脱离文档流，同样脱离文档流的还是 float</p></li><li><input checked disabled type="checkbox"> <p>margin/padding 设置百比时，根据父元素宽运算</p></li><li><input disabled type="checkbox"> <p>使用css实现一个自适应浏览器大小并且宽和高的比是2:1，有几种实现方法？</p><blockquote><ul><li>width 与 height 百分比是根据父元素计算的，<code>&lt;body&gt;</code> 是根据宽一般是浏览器的宽，高一般为 0，不同浏览器有所差异，这里不细说。</li><li>padding 百分比是相对于包含块的宽度,指定一个值时 该值指定四个边的内边距</li></ul></blockquote></li><li><input checked disabled type="checkbox"> <p>用 padding 撑 50% 的高</p></li></ul><a id="more"></a><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.father</span> &#123;</span><br><span class="line">  width: 100%; // 根据父元素计算</span><br><span class="line">  padding: 25% 0; // 高度根据父元素的宽计算</span><br><span class="line">  <span class="selector-tag">background-color</span>: <span class="selector-id">#f90</span>;</span><br><span class="line">  <span class="selector-tag">box-sizing</span>: <span class="selector-tag">border-box</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="supports、cacl-、-media-的用法和含义"><a href="#supports、cacl-、-media-的用法和含义" class="headerlink" title="@supports、cacl()、@media 的用法和含义"></a>@supports、cacl()、@media 的用法和含义</h3><hr><blockquote><ul><li>@supports 在这里卡了许久，想要找出当红 ui 框架中使用的案例，但最终一无所获。但是吧，既然有这样一道面试题，那就看看文档，整理整理<br>  <code>兼容性：移动端浏览器兼容较好，pc 端 IE 不兼容</code><br>  声明语法，如下 demo，包含 not, and, or 三种操作符  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">@supports</span> (<span class="attribute">transform-origin:</span> <span class="number">5%</span> <span class="number">5%</span>) &#123;&#125;</span><br></pre></td></tr></table></figure></li></ul></blockquote><pre><code>**总结一下**，@supports 是用来检验某个 css 属性是否支持。是一个判断条件。</code></pre><hr><blockquote><ul><li>@media 以下 demo 源自 bootstrap  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span>, <span class="selector-class">.h1</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="built_in">calc</span>(<span class="number">1.375rem</span> + <span class="number">1.5vw</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">min-width:</span> <span class="number">1200px</span>) &#123;</span><br><span class="line">  <span class="selector-tag">h1</span>, <span class="selector-class">.h1</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">2.5rem</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h2</span>, <span class="selector-class">.h2</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="built_in">calc</span>(<span class="number">1.325rem</span> + <span class="number">0.9vw</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">min-width:</span> <span class="number">1200px</span>) &#123;</span><br><span class="line">  <span class="selector-tag">h2</span>, <span class="selector-class">.h2</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">2rem</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></blockquote><pre><code>**总结一下**：根据不同的媒体类型，定义不同的样式，作响应式处理</code></pre><hr><blockquote><ul><li>cacl() 函数允许对 css 属性值进行一些 + - * / 的运算，如上例</li></ul></blockquote><ul><li><input disabled type="checkbox"> <p><a href="https://helenzhanglp.github.io/2019/05/05/%E5%B1%85%E4%B8%AD/">水平垂直居中</a></p></li><li><input checked disabled type="checkbox"> <p>使用 vw 为单位</p><blockquote><ul><li>vw: viewport width, 1vw = 视窗宽度的 1%</li><li>vh: viewport height, 1vh = 视窗高度的 1%</li><li>vmin: vh 与 vw 哪个小取哪个</li><li>vmax: vh 与 vw 哪个大取哪个</li></ul></blockquote></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.warp</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100vw</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50vw</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f90</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
            <tag> 面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript Class</title>
      <link href="2019/03/20/Javascript-Class/"/>
      <url>2019/03/20/Javascript-Class/</url>
      
        <content type="html"><![CDATA[<h3 id="定义类"><a href="#定义类" class="headerlink" title="定义类"></a>定义类</h3><h4 id="类声明"><a href="#类声明" class="headerlink" title="类声明"></a>类声明</h4><p>用带有 class 关键字的类名声明一个类</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mermaid</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name, age) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">    <span class="keyword">this</span>.age = age</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>类声明不会像函数声明一样会提升，需要先声明之后才可以访问。否则，报错：</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Mermaid();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mermaid</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name, age) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">    <span class="keyword">this</span>.age = age</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Uncaught ReferenceError: Mermaid is not defined</span></span><br></pre></td></tr></table></figure><h4 id="类表达式"><a href="#类表达式" class="headerlink" title="类表达式"></a>类表达式</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 匿名类 */</span></span><br><span class="line"><span class="keyword">let</span> Mermaid = <span class="class"><span class="keyword">class</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 命名类 */</span></span><br><span class="line"><span class="keyword">let</span> Everything = <span class="class"><span class="keyword">class</span> <span class="title">Everything</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Everything is posible'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>super 关键字调用父类构造函数</p></blockquote><h4 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h4><blockquote><p><code>static</code> 定义一个类的静态方法，静态方法通常用于为一个应用程序创建工具函数。调用静态方法不需要实例化，不能通过类实例调用静态方法。</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> es6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>react 整理</title>
      <link href="2019/03/19/react-%E6%95%B4%E7%90%86/"/>
      <url>2019/03/19/react-%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h2 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h2><h3 id="react-渲染实体字体-247-215"><a href="#react-渲染实体字体-247-215" class="headerlink" title="react 渲染实体字体 &#247; &#215;"></a>react 渲染实体字体 &#247; &#215;</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">key</span>: <span class="built_in">String</span>.fromCharCode(<span class="number">215</span>), <span class="attr">id</span>: <span class="string">'times'</span>&#125;,</span><br></pre></td></tr></table></figure><h2 id="React-列表渲染"><a href="#React-列表渲染" class="headerlink" title="React 列表渲染"></a>React 列表渲染</h2><h4 id="keys"><a href="#keys" class="headerlink" title="keys"></a>keys</h4><p>React 中使用 keys 标识列表中元素的删除、添加或移除。React Diff 算法中借助 key 标识同级元素是新增还是移动，避免不必要的渲染。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">items.map(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">  &lt;li key=&#123;item.id&#125;&gt;&#123;item.text&#125;&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">  &#123;/</span>* <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;item.text&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span> 没有 id 用索引赋 key *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br></pre></td></tr></table></figure><p><code>注意：</code>最好不要用索引（index）作 key 值，因为一旦有新增、删除或移动等变化，会导致大量元素失效。进而造成不必要的重新渲染，损耗性能。可以使用 item.id 作为 key 值</p><h3 id="React-state"><a href="#React-state" class="headerlink" title="React state"></a>React state</h3><p>React 中把组件看成一个状态机（state machines）。React 中，constructor 是最先执行，且执行一次。state 在 constructor 构造函数中初始化。其它地方采用 <code>this.setState()</code> 更新组件状态。<br>React 里，通过更新组件 state 重新渲染用户界面，不需要操作 DOM，类组件使用 props 调用基础构造函数。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(super) &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="comment">// 初始化 state</span></span><br><span class="line">    <span class="keyword">this</span>.state = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre class="mermaid">graph LR;    用户界面交互-->状态;    状态-->UI渲染;    UI渲染-->|用户界面与数据保持一致|数据;</pre><p>this.setState 之后发生了什么？<br>调用 setState 函数后，React 将 setState 参数与组件当前状态合并，触发调和过程（Reconciliation）. 经过调和过程，React 会以相对高效的方式构建 React Dom 树，得到 Dom 树后，React 会将新树与老树进行对比，找出差异节点，从而根据差异最小化渲染。</p><p>重新构造 dom ，并将新老状态进行对比，最小化渲染。</p><h3 id="React-生命周期渲染"><a href="#React-生命周期渲染" class="headerlink" title="React 生命周期渲染"></a>React 生命周期渲染</h3><pre class="mermaid">graph TM;  componentWillMount-->render;  render-->componentDidMount;  componentDidMount-->render</pre>]]></content>
      
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> react </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javascript prototype &amp;&amp; __proto__</title>
      <link href="2019/03/19/prototype-proto/"/>
      <url>2019/03/19/prototype-proto/</url>
      
        <content type="html"><![CDATA[<h2 id="原型和原型链"><a href="#原型和原型链" class="headerlink" title="原型和原型链"></a>原型和原型链</h2><p>Javascript 是基于原型的面向对象语言，对象默认有 prototype，可以将需要共享的实例方法绑在 prototype 上，达到方法共享的目的。对象每个实例都有各自 <code>__proto__</code> 属性，该属性指向对象的 prototype 属性上。这种原型链接的关系称为原型链，null 是原型链的最后一个链接。</p><p><a href="https://segmentfault.com/a/1190000015727237" target="_blank" rel="noopener">继承</a></p><h3 id="Javascript-继承"><a href="#Javascript-继承" class="headerlink" title="Javascript 继承"></a>Javascript 继承</h3><ul><li>原型链继承<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Super</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Son</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="comment">// 实现继承</span></span><br><span class="line">Son.prototype = <span class="keyword">new</span> Super()</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>只要把子类的原型指向父类的实例就可以了，再演示一个更丰满的例子</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Base</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.friends = [<span class="string">'lily'</span>, <span class="string">'lucy'</span>, <span class="string">'coco'</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Son</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.age = age</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 实现继承</span></span><br><span class="line">Son.prototype = <span class="keyword">new</span> Base()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> Audery = <span class="keyword">new</span> Son(<span class="string">'Audery'</span>, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">let</span> Gulu = <span class="keyword">new</span> Son(<span class="string">'Gulu'</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">Gulu.friends.push(<span class="string">'emily'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(Audery.friends)</span><br></pre></td></tr></table></figure><blockquote><p>引用类型会出现数组引用多实例因共享导致的相互污染的问题，考虑使用 ** 构造函数继承 ** 实现</p></blockquote><ul><li>构造函数继承<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Base</span>(<span class="params">female</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.sex = female</span><br><span class="line">  <span class="keyword">this</span>.friends = [<span class="string">'lily'</span>, <span class="string">'lucy'</span>, <span class="string">'coco'</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Son</span>(<span class="params">name, age, female</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 对象冒充调用父类方法</span></span><br><span class="line">  Base.call(<span class="keyword">this</span>, female); <span class="comment">// 子类冒充父类，子类调用父类构造函数。即，子类复制子父类代码</span></span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.age = age</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> Audery = <span class="keyword">new</span> Son(<span class="string">'Audery'</span>, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">let</span> Gulu = <span class="keyword">new</span> Son(<span class="string">'Gulu'</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">Gulu.friends.push(<span class="string">'emily'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(Audery.friends)</span><br><span class="line"><span class="built_in">console</span>.log(Gulu.friends)</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>上面说了，通过对象冒充调用父类构造方法，其实就是复制父类构造函数中的属性、方法，到子类构造函数中，原型方法无法继承</p></blockquote><ul><li>组合继承<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Base</span>(<span class="params">female</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.sex = female</span><br><span class="line">  <span class="keyword">this</span>.friends = [<span class="string">'lily'</span>, <span class="string">'lucy'</span>, <span class="string">'coco'</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Base.prototype.say = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'I have some friends, they are '</span> + <span class="keyword">this</span>.friends.join(<span class="string">'、'</span>)+<span class="string">' respectively!'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Son</span>(<span class="params">name, age, female</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 对象冒充调用父类方法</span></span><br><span class="line">  Base.call(<span class="keyword">this</span>, female); <span class="comment">// 子类冒充父类，子类调用父类构造函数。即，子类复制子父类代码</span></span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.age = age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原型继承父类实例指向子类原型</span></span><br><span class="line">Son.prototype = <span class="keyword">new</span> Base()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> Audery = <span class="keyword">new</span> Son(<span class="string">'Audery'</span>, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">let</span> Gulu = <span class="keyword">new</span> Son(<span class="string">'Gulu'</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">Gulu.friends.push(<span class="string">'emily'</span>)</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>组合继承实现了：</p></blockquote><ul><li><input disabled type="checkbox"> 属性私有化、方法共享、引用数组间不相互污染</li></ul><p>** 以上是原型链继承的周边，不使用 Object.create， 以下是使用 Object.create 方法相关继承的演生 **</p><ul><li><p>原型式继承</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">base</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">  F.prototype = o;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> F();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> baseObj = &#123;</span><br><span class="line">  name: <span class="string">'基类'</span>,</span><br><span class="line">  arr: [<span class="string">'array1'</span>,<span class="string">'array2'</span>,<span class="string">'array3'</span>],</span><br><span class="line">  fn: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name, <span class="keyword">this</span>.arr)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> baseInstance1 = base(baseObj)</span><br><span class="line"><span class="keyword">var</span> baseInstance2 = base(baseObj)</span><br><span class="line">baseInstance2.name = <span class="string">'修改属性值'</span></span><br><span class="line">baseInstance1.arr.push(<span class="string">'array4'</span>)</span><br><span class="line"><span class="comment">/* === baseInstance2 添加了一个实例属性 === */</span></span><br></pre></td></tr></table></figure></li><li><p>寄生式继承</p></li><li><p>寄生组合继承</p></li><li><p>Class extends</p><blockquote><p>如果子类中存在构造函数，则需要在使用 this 之前首先调用 super。 与寄生组合继承不同的是，ES6 先将父类实例对象的属性和方法加到 this 上，必须先调用 super 方法，然后再用的子类构造函数修改 this</p></blockquote></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">babel.min.js:<span class="number">2</span> Uncaught <span class="built_in">SyntaxError</span>: Inline Babel script: <span class="string">'this'</span> is not allowed before <span class="keyword">super</span>()</span><br><span class="line">  <span class="number">3</span> |   <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">  <span class="number">4</span> |     <span class="comment">// super(props);</span></span><br><span class="line">&gt; <span class="number">5</span> |     <span class="keyword">this</span>.state = &#123;<span class="attr">date</span>: <span class="keyword">new</span> <span class="built_in">Date</span>()&#125;;</span><br><span class="line">    |     ^</span><br><span class="line">  <span class="number">6</span> |   &#125;</span><br></pre></td></tr></table></figure><p>实现原理</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置一个指定的对象的原型 ( 即, 内部[[Prototype]]属性）到另一个对象或  null。</span></span><br><span class="line"><span class="built_in">Object</span>.setPrototypeOf = <span class="function"><span class="keyword">function</span> (<span class="params">obj, proto</span>) </span>&#123;</span><br><span class="line">  obj.__proto__ = proto;</span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// B 的实例继承 A 的实例</span></span><br><span class="line"><span class="built_in">Object</span>.setPrototypeOf(B.prototype, A.prototype);</span><br><span class="line"></span><br><span class="line"><span class="comment">// B 继承 A 的静态属性</span></span><br><span class="line"><span class="built_in">Object</span>.setPrototypeOf(B, A);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> object </tag>
            
            <tag> 对象继承 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>函数 bind call apply</title>
      <link href="2019/03/18/Javascript-%E5%87%BD%E6%95%B0-bind-call-apply/"/>
      <url>2019/03/18/Javascript-%E5%87%BD%E6%95%B0-bind-call-apply/</url>
      
        <content type="html"><![CDATA[<h3 id="bind、call、apply"><a href="#bind、call、apply" class="headerlink" title="bind、call、apply"></a>bind、call、apply</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/Javascript/Reference/Global_Objects/Function/bind" target="_blank" rel="noopener">bind</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/Javascript/Reference/Global_Objects/Function/call" target="_blank" rel="noopener">call</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/Javascript/Reference/Global_Objects/Function/apply" target="_blank" rel="noopener">apply</a></p><h4 id="从定义上对比看"><a href="#从定义上对比看" class="headerlink" title="从定义上对比看"></a>从定义上对比看</h4><ul><li>bind - 创建一个新的函数</li><li>call - call 与 apply 相似，仅传参不同</li><li>apply - 调用一个具有给定 this 值的函数<blockquote><p>func.apply(thisArg, [argsArray])</p></blockquote></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用一个具有给定 this 的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TempObj</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.tempArray = [<span class="number">1</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">2</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> tempObj = <span class="keyword">new</span> TempObj()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定作用域为 tempObj</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Math</span>.max.apply(tempObj, tempObj.tempArray))</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Math</span>.max.call(tempObj, ...tempObj.tempArray))</span><br></pre></td></tr></table></figure><p>** DEMO **</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组合并</span></span><br><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>,<span class="number">2</span>], b = [<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">a.push(b) <span class="comment">// 3，返回数组 length</span></span><br><span class="line">a.concat(b) <span class="comment">// [1, 2, 3, 4] 创建了一个新数组</span></span><br><span class="line">a.push.apply(a, b) <span class="comment">// 4</span></span><br><span class="line"><span class="built_in">console</span>.log(a) <span class="comment">// [1, 2, 3, 4]</span></span><br><span class="line">a.push.call(a, ...b) <span class="comment">// 6</span></span><br><span class="line"><span class="built_in">console</span>.log(a) <span class="comment">// [1, 2, 3, 4, 3, 4]</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> function </tag>
            
            <tag> 函数作用域 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>箭头函数</title>
      <link href="2019/03/18/Javascript-%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0/"/>
      <url>2019/03/18/Javascript-%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h3 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/Javascript/Reference/Functions/Arrow_functions" target="_blank" rel="noopener">Arrow Functions</a></p><blockquote><p>没有自己的 this、arguments、super、new.target，它不能用作构造函数，更适用于那些本来需要匿名函数的地方，函数简短，并且不绑定 this</p></blockquote><h4 id="从函数中认识-this"><a href="#从函数中认识-this" class="headerlink" title="从函数中认识 this"></a>从函数中认识 this</h4><h5 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.prop = <span class="number">1</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.prop, <span class="keyword">this</span>)</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    ++<span class="keyword">this</span>.prop</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.prop, <span class="keyword">this</span>)</span><br><span class="line">  &#125;,<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> construct = <span class="keyword">new</span> Construct()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1 Construct &#123;prop: 1&#125;prop: 1__proto__: Object</span></span><br><span class="line"><span class="comment">// NaN Window &#123;postMessage: ƒ, blur: ƒ, focus: ƒ, close: ƒ, parent: Window, …&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> es6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>immutableJS</title>
      <link href="2019/03/11/immutableJS/"/>
      <url>2019/03/11/immutableJS/</url>
      
        <content type="html"><![CDATA[<p>Facebook 工程师 Lee Byron 花费 3 年时间打造，与 React 同期出现，但没有被默认放到 React 工具集里（React 提供了简化的 Helper）</p><h3 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h3><p>Record() 可以创建一个新的 Record 类，类似于Javascript的Object，但是只接收特定字符串为key，具有默认值:</p><h3 id="setIn"><a href="#setIn" class="headerlink" title="setIn()"></a>setIn()</h3><p>setIn 设置深层结构中的某些属性</p><blockquote><p>setIn(keyPath: Iterable<any>, value: any): this</any></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> immutable </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redux</title>
      <link href="2019/03/11/redux/"/>
      <url>2019/03/11/redux/</url>
      
        <content type="html"><![CDATA[<h2 id="Redux-理解"><a href="#Redux-理解" class="headerlink" title="Redux 理解"></a>Redux 理解</h2><p>Redux 设计之初是为了更好的维护 Web 状态，React 框架实现了 State。React + Redux<br>Redux 设计的核心是 store 的概念。store 将 State/Action/Reducer 联系在一起。<font color="#911" face="黑体" size="3"><code>redux 中有且只有一个 store，store 是唯一的</code></font><br>Action 是负责把数据从应用传到 Store 的载体，是 Store 数据的唯一来源，通过 store 的 dispatch() 方法实现<br>Reducer 将 State 的变化和相应的 Action 发送到 store，然后返回新的 state 给 store<br>Reducer 本质上一个纯函数，接收 state and action，执行相应操作后，返回新的 state。但切忌做以下操作：</p><ul><li>修改传入参数；</li><li>执行有副作用的操作，如请求 API 和 路由跳转等；</li><li>调用非纯函数，如 Date.now()、Math.random() 等不确定值操作</li></ul><blockquote><p>Redux 负责状态管理、React 负责视图渲染，Redux 中 store 是核心对象，在管理 Reducer 与 State 的同时，还要处理 Dispath 存入的 Action，最终订阅 React 视图更新。</p></blockquote><img src="http://www.plantuml.com/plantuml/svg/bP5DIWD148NtVOh2MITRCO8WUeA81wXqlqaQsvgXfmOL2MJXCVGQRdAR87WDUtxYNvD5Q6YAudtrNdVPwhwk1AAqsxpEmLRfS_loiNtVRTw86-fRLz-YuXHdvy4BfewR5LnVpvOH41DXbMKPG2Vf9BPg5P6AiYn_8_HiY2n7HvTMVILKSF0MYz0Ydznt5OywL8dCNBp88PVHPmxNsavpbD48toWhZaJN9btZwoQJYvy0Yy3sRj36b756t8kc-bGZ8NjTnuo-6H6XRHGIF53JISpQ_DjHH--_DiElVLEpsfKPvW_f_guuOsvhbxHV"><a id="more"></a><blockquote><ol><li>Redux 其实是一个 <code>Javascript 状态容器</code>，可预测状态管理<ol start="2"><li>Redux 并不属于 React 框架，完全独立。可与大多数前端框架完美结合</li><li>/**<ul><li>reducer(state, action){}</li><li>state 状态，action 用户操作 action.type 用户操作类型</li><li>store 通过 Redux.createStore(reducer)</li><li>store.subscribe(render) 实现用户订阅功能，当状态发生变化时，自动渲染视图 render 通过 innerHTML 实现</li><li>操作不同，dispatch 触发不同的 action {type: ‘ACTIONTYPE’}</li></ul></li></ol></li></ol></blockquote><h2 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/babel"</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> root = <span class="built_in">document</span>.querySelector(<span class="string">'#root'</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// <span class="doctag">TODO:</span> define reducer</span></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">reducerCounter</span>(<span class="params">state, action</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (<span class="keyword">typeof</span> state === <span class="string">'undefined'</span>) <span class="keyword">return</span> <span class="number">0</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">switch</span> (action.type) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">case</span> <span class="string">'INCREMENT'</span>:</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> state + <span class="number">1</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">case</span> <span class="string">'DECREMENT'</span>:</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> state &lt; <span class="number">1</span> ? <span class="number">0</span> : state - <span class="number">1</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">default</span>:</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> state</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// <span class="doctag">TODO:</span> create store</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> store = Redux.createStore(reducerCounter)</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> counterNumber = <span class="built_in">document</span>.getElementById(<span class="string">'count-number'</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// <span class="doctag">TODO:</span> render</span></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line">    counterNumber.innerHTML = store.getState().toString()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render()</span><br><span class="line"><span class="javascript">  store.subscribe(render) <span class="comment">//监听一些变化</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// <span class="doctag">TODO:</span> dispatch</span></span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.getElementById(<span class="string">'increment'</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    store.dispatch(&#123;<span class="attr">type</span>: <span class="string">'INCREMENT'</span>&#125;)</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.getElementById(<span class="string">'decrement'</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    store.dispatch(&#123;<span class="attr">type</span>: <span class="string">'DECREMENT'</span>&#125;)</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.getElementById(<span class="string">'incrementIfOdd'</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line">    if (store.getState() % 2 !== 0) &#123;</span><br><span class="line"><span class="javascript">      store.dispatch(&#123;<span class="attr">type</span>: <span class="string">'INCREMENT'</span>&#125;)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.getElementById(<span class="string">'incrementAsync'</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">      store.dispatch(&#123;<span class="attr">type</span>: <span class="string">'INCREMENT'</span>&#125;)</span></span><br><span class="line">    &#125;,1000)</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>哈哈，请问你是要闹哪样？<br><code>import { connect } from &#39;@tarojs/redux&#39;;</code><br>redux 文档里查了没找着，原来是 tarojs 的方法，借机认识下这哥们。</p><h3 id="connect"><a href="#connect" class="headerlink" title="connect"></a>connect</h3><blockquote><p>tarojs/redux 提供的 connect 方法将 redux 与我们的页面进行连接<br>connect 方法接受两个参数<br><code>mapStateToProps</code> 与 <code>mapDispatchToProps</code></p></blockquote><ul><li>mapStateToProps，函数类型，接受最新的 state 作为参数，用于将 state 映射到组件的 props</li><li>mapDispatchToProps，函数类型，接收 dispatch() 方法并返回期望注入到展示组件的 props 中的回调方法</li></ul><h4 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'@tarojs/redux'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapStateToProps</span>(<span class="params">state</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    reducer: state.bindphoneReducer,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@connect(mapStateToProps)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript 面试题</title>
      <link href="2019/03/07/Javascript-%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
      <url>2019/03/07/Javascript-%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h2 id="变量声明-let-const-var"><a href="#变量声明-let-const-var" class="headerlink" title="变量声明 let const var"></a>变量声明 let const var</h2><table class="table table-striped"><thead><tr><th align="left">名称</th><th align="left">定义</th><th align="left">作用域</th><th align="left">赋初值</th></tr></thead><tbody><tr><td align="left">let</td><td align="left">声明变量</td><td align="left">块级作用域</td><td align="left">可以不赋初值<br>编译时声明并初始化为初值为 undefined</td></tr><tr><td align="left">const</td><td align="left">声明常量</td><td align="left">块级作用域</td><td align="left">必须赋初值</td></tr><tr><td align="left">var</td><td align="left">声明变量</td><td align="left">局部变量是函数作用域；<br>全局变量作用域为该程序</td><td align="left">不赋初值时，<br>变量提升，代码执行前创建 js 环境，声明变量，变量赋初值为 undefined</td></tr></tbody></table><p><em><code>notice:</code></em></p><ol><li>let 和 var 都是用来声明变量的，但作用域不同。</li><li>let 和 const 都是 ES6 开始正式加入 JavaScript 规范的</li><li>let 编译时执行声明初始化，未编译时处于 temporal dead zone，此时变量 is not defined;</li><li>const 声明常量必须赋初值(Uncaught SyntaxError: Missing initializer in const declaration)；</li><li>const 声明的常量值不能修改。</li></ol><h2 id="1-let"><a href="#1-let" class="headerlink" title="1.    let"></a>1.    let</h2><blockquote><p>   声明一个块级作用域的本地变量</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> C = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a) <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(b) <span class="comment">// Uncaught ReferenceError: b is not defined</span></span><br><span class="line"><span class="built_in">console</span>.log(C) <span class="comment">// Uncaught ReferenceError: C is not defined</span></span><br></pre></td></tr></table></figure><blockquote><p>let 声明变量可以不赋初值，默认值为 undefined</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a; <span class="comment">// undefined</span></span><br><span class="line"><span class="keyword">let</span> b; <span class="comment">// undefined</span></span><br><span class="line"><span class="keyword">const</span> c; <span class="comment">// Uncaught SyntaxError: Missing initializer in const declaration</span></span><br></pre></td></tr></table></figure><blockquote><p>let 声明的变量在定义编译执行时初始化。变量未声明之前不会初始化。这一时段称为暂存死区（Temporal Dead Zone, TDZ）。</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a; <span class="comment">// undefined</span></span><br><span class="line"><span class="keyword">let</span> b; <span class="comment">// Uncaught ReferenceError: b1 is not defined</span></span><br></pre></td></tr></table></figure><h2 id="2-const"><a href="#2-const" class="headerlink" title="2.    const"></a>2.    const</h2><blockquote><p><code>Uncaught SyntaxError: Missing initializer in const declaration</code> const 声明的变量必须赋初值<br>    <code>Uncaught ReferenceError: C is not defined</code> const 声明块级作用域变量</p></blockquote><h3 id="const-声明的变量值不能修改"><a href="#const-声明的变量值不能修改" class="headerlink" title="const 声明的变量值不能修改"></a>const 声明的变量值不能修改</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> variableTemplate = <span class="number">30</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  variableTemplate = <span class="number">22</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error) <span class="comment">// TypeError: Assignment to constant variable.</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(variableTemplate)</span><br></pre></td></tr></table></figure><h3 id="const-只读引用，只是变量的标识符不能重新分配"><a href="#const-只读引用，只是变量的标识符不能重新分配" class="headerlink" title="const 只读引用，只是变量的标识符不能重新分配"></a>const 只读引用，只是变量的标识符不能重新分配</h3><blockquote><p>只是变量标识符不能重新分配</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> VARIABLE = <span class="string">'assignment value'</span></span><br><span class="line">VARIABLE = <span class="string">'assignment value'</span> <span class="comment">// TypeError: Assignment to constant variable</span></span><br><span class="line"><span class="keyword">const</span> VARIABLE = <span class="string">'Assignment to constant variable'</span> <span class="comment">// Uncaught SyntaxError: Identifier 'VARIABLE' has alreay been declared</span></span><br><span class="line"><span class="keyword">const</span> EN_OBJECT = &#123;&#125;</span><br><span class="line">EN_OBJECT.ATTRIBUTE = <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="3-var"><a href="#3-var" class="headerlink" title="3.    var"></a>3.    var</h2><p>JavaScript 根据赋值自动转换数据类型;<br>JavaScript 中 <code>+</code> 可用来链接字符串，如果运算中涉及字符串，结果为字符串链接。其它运算符（-、*、/）正确计算数字字符串;<br>JavaScript 中，null 乘任何数为 0;<br>JavaScript 代码程序执行前会先创建执行环境，变量、函数等被创建。代码运行时赋初值。这就是 JavaScript 的提升机制（hoisting）。</p><blockquote><p>var 声明变量可以不赋初值，默认值为 undefined；<br>    var 声明的变量没有块级作用域</p></blockquote><h3 id="与-var-不同-let-与-const-在全局声明定义的变量不会绑定到全局对象上（如-浏览器的全局对象-window"><a href="#与-var-不同-let-与-const-在全局声明定义的变量不会绑定到全局对象上（如-浏览器的全局对象-window" class="headerlink" title="与 var 不同 let 与 const 在全局声明定义的变量不会绑定到全局对象上（如 浏览器的全局对象 window)"></a>与 var 不同 let 与 const 在全局声明定义的变量不会绑定到全局对象上（如 浏览器的全局对象 <code>window</code>)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="number">2</span></span><br><span class="line"><span class="keyword">const</span> c = <span class="number">3</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.a, <span class="built_in">window</span>.b, <span class="built_in">window</span>.c) <span class="comment">// 1 undefined undefined</span></span><br></pre></td></tr></table></figure><h3 id="let-和-var-定义的变量作用域不同"><a href="#let-和-var-定义的变量作用域不同" class="headerlink" title="let 和 var 定义的变量作用域不同"></a>let 和 var 定义的变量作用域不同</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testVarScope</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a, <span class="string">'var'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">testVarScope(); <span class="comment">// 2 "var"</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *var 声明的变量在同一函数作用域中为同一变量，所以值会修改</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testLetScope</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">let</span> a = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a, <span class="string">'let'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">testLetScope(); <span class="comment">// 1 "let"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *&#123;&#125; 为一个作用域，&#123;&#125; 中的 a 变量与 函数中首先声明的 a 为两个变量，值不会相互修改</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h3 id="三、-作用域-promise-amp-amp-promise-then"><a href="#三、-作用域-promise-amp-amp-promise-then" class="headerlink" title="三、 作用域 + promise &amp;&amp; promise.then"></a>三、 作用域 + promise &amp;&amp; promise.then</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> msg = <span class="number">1</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">let</span> msg = <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(msg)</span><br><span class="line"><span class="keyword">var</span> p1 =  <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">msg = <span class="number">3</span></span><br><span class="line">resolve(msg)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">4</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">var</span> p2 = p1.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line"><span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(p1 === p2)</span><br><span class="line"><span class="comment">// 1 4 5 false 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* p1 gng p2 不相等的原因 */</span></span><br><span class="line"><span class="comment">// [[PromiseStatus]]: "resolved"</span></span><br><span class="line"><span class="comment">// [[PromiseValue]]: 3</span></span><br><span class="line"><span class="built_in">console</span>.log(p2)</span><br><span class="line"><span class="built_in">console</span>.log(p1)</span><br><span class="line"><span class="comment">// [[PromiseStatus]]: "resolved"</span></span><br><span class="line"><span class="comment">// [[PromiseValue]]: undefined</span></span><br></pre></td></tr></table></figure><h3 id="四、-箭头函数作用域"><a href="#四、-箭头函数作用域" class="headerlink" title="四、 箭头函数作用域"></a>四、 箭头函数作用域</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">name: <span class="string">'fn'</span>,</span><br><span class="line">show: <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">'fun'</span></span><br><span class="line">fun().show()</span><br></pre></td></tr></table></figure><h3 id="五、正则相关-题目如下"><a href="#五、正则相关-题目如下" class="headerlink" title="五、正则相关 - 题目如下"></a>五、正则相关 - 题目如下</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> str=<span class="string">'version2.1 version2.2'</span>;</span><br><span class="line"><span class="keyword">const</span> regx = <span class="regexp">/(\w+)(\d)\.(\d)/g</span>;</span><br><span class="line"></span><br><span class="line">str.match(regx)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> [ 'version2.1', 'version2.2' ]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">regx.exec(str)</span><br><span class="line"><span class="comment">/** [ 'version2.1',</span></span><br><span class="line"><span class="comment">  'version',</span></span><br><span class="line"><span class="comment">  '2',</span></span><br><span class="line"><span class="comment">  '1',</span></span><br><span class="line"><span class="comment">  index: 0,</span></span><br><span class="line"><span class="comment">  input: 'version2.1 version2.2',</span></span><br><span class="line"><span class="comment">  groups: undefined ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><ol><li>console.log(str.match(regx)) 结果如上，因为有正则中有 <code>g</code> 全局搜索标识符。 所以结果如上代码。</li><li>console.log(regx.exec(str)) 结果如上。</li><li>match 和 exec 的区别：<ul><li>match 是 String(String.prototype.match()) 的原型方法；exec 是 RegExp（RegExp.prototype.exec()） 的原型方法。</li><li>在 regx 不加 <code>g</code> 标识符（global）时，他们的结果是相同的，返回一个数组。数组元素包括匹配字符串、匹配组、index 匹配的位置， input 原始字符串， groups;</li><li>在 regx 加 <code>g</code> 标识符（global)）时，结果如上。<code>str.match(regx)</code> 返回的是所有匹配的字符串数组；<code>regx.exec(str)</code> 返回的第一组匹配的数组，并记录 <code>lastIndex</code> 在 regx 中，再次执行 <code>regx.exec(str)</code> 会返回下一组匹配结果。以此类推，直到最后结果为 null。</li></ul></li></ol><h3 id="六、-数组排序"><a href="#六、-数组排序" class="headerlink" title="六、 数组排序"></a>六、 数组排序</h3><blockquote><p>对数组 [10, 20, 1, 2] 进行排序</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">10</span>, <span class="number">20</span>, <span class="number">1</span>, <span class="number">2</span>].sort(); <span class="comment">// [ 1, 10, 2, 20 ]</span></span><br></pre></td></tr></table></figure><h3 id="六、-在一个构造方法中可以使用super关键字来调用一个父类的构造方法。"><a href="#六、-在一个构造方法中可以使用super关键字来调用一个父类的构造方法。" class="headerlink" title="六、 在一个构造方法中可以使用super关键字来调用一个父类的构造方法。"></a>六、 在一个构造方法中可以使用super关键字来调用一个父类的构造方法。</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ReferenceError: Must call super constructor in derived class before accessing 'this' or returning from derived constructor</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> interview questions </tag>
            
            <tag> ES6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue 单向绑定 与 双向绑定</title>
      <link href="2019/03/03/Vue-%E5%8D%95%E5%90%91%E7%BB%91%E5%AE%9A-%E4%B8%8E-%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A/"/>
      <url>2019/03/03/Vue-%E5%8D%95%E5%90%91%E7%BB%91%E5%AE%9A-%E4%B8%8E-%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A/</url>
      
        <content type="html"><![CDATA[<p>在数据绑定这里纠结了有断日子了，一直想把这块好好梳理一下。则日不如撞日，就今天了！<br><a href="https://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000/001475449022563a6591e6373324d1abd93e0e3fa04397f000" target="_blank" rel="noopener">参考文档不能丢</a></p><h3 id="认识下-MVVM"><a href="#认识下-MVVM" class="headerlink" title="认识下 MVVM"></a>认识下 MVVM</h3><p>很讨论的一个概念，在它之前我只认识 MVC，曾经有一经面试就在它这里卡壳。那个时候我只认识 MVC.<br><a href="https://docs.microsoft.com/zh-cn/windows/uwp/data-binding/data-binding-and-mvvm" target="_blank" rel="noopener">哎呀，妈呀，不易啊，终于找到正主啦</a>文档中说的很清楚，mvvm 指的模型层（model）、视图层（View)及视图模型层（ViewModel)<br>正文还是有些枯燥的。其实廖老师的文档里其实已经很好的将jQuery 操作 Dom 与 MVVM 作了很好的对比，给出的实际案例，说明了<code>MVVM 是通过操作对象，从而自动更新 DOM 状态</code><br>以下是两个案例对比：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'Homer'</span>;</span><br><span class="line"><span class="keyword">var</span> age = <span class="number">51</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 回忆下原生 js</span></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'#name'</span>).innerText(<span class="string">'HTML'</span>)</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'#age'</span>).innerText(<span class="string">'51'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//jQuery</span></span><br><span class="line">$(<span class="string">'#name'</span>).text(name);</span><br><span class="line">$(<span class="string">'#age'</span>).text(age);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MVVM 中通过对象自动更新 DOM</span></span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    name: <span class="string">'Bart'</span>,</span><br><span class="line">    age: <span class="number">12</span></span><br><span class="line">&#125;;</span><br><span class="line">person.name = <span class="string">'HTML'</span></span><br><span class="line">person.age = <span class="number">51</span></span><br></pre></td></tr></table></figure><h3 id="数据绑定"><a href="#数据绑定" class="headerlink" title="数据绑定"></a>数据绑定</h3><p>模模糊糊中认为小程序是属于单向数据绑定，别人的博客中有说是双向绑定，为些还特意百度找盟友，结果发现我并不孤独。接下来分析分析数据绑定。</p>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> 小程序 </tag>
            
            <tag> 数据绑定 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>再看 node</title>
      <link href="2019/03/02/Node-%E5%86%8D%E7%9C%8B-node/"/>
      <url>2019/03/02/Node-%E5%86%8D%E7%9C%8B-node/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.ibm.com/developerworks/cn/opensource/os-nodejs/" target="_blank" rel="noopener">Node.js 究竟是什么？</a><br>Node 旨在提供一种简单构建可伸缩的网络程序方法</p><h3 id="认识-Node-交个朋友"><a href="#认识-Node-交个朋友" class="headerlink" title="认识 Node 交个朋友"></a>认识 Node 交个朋友</h3><p>Node 是服务器程序，特色就是处理多并发，处理方式则是每个连接会发射一个 Node 引擎进程中的运行事件，不使用锁，所以也不会有死锁的情况，也不生成 os 进程，它的服务器能支持上万并发。<br>Node 本身运行 V8 Javascript。V8 Javascript 引擎是 Google 用于其 Chrome 浏览器的底层 Javascript 引擎。</p><h3 id="Node-事件驱动编程"><a href="#Node-事件驱动编程" class="headerlink" title="Node 事件驱动编程"></a>Node 事件驱动编程</h3><p>没有过度设计，没有面向对象、没有接口，Javascript 是驱动编程语言。有闭包、可以使用匿名函数。它只需要监听事件，调用匿名函数回调，其它由系统处理。</p><h3 id="Node-的包管理工具-NPM"><a href="#Node-的包管理工具-NPM" class="headerlink" title="Node 的包管理工具 NPM"></a>Node 的包管理工具 NPM</h3><p>开发过程中通常需要依赖第三方框架，如 Jquery/element-ui 等一系列的第三方框架。这些第三方框架之间或许也是在相互依赖，直接下载、解压、处理相互间的引用似乎非常繁锁，顺应天意，包管理工具应用而生。而 Node 的包管理工具就是 NPM。</p><h3 id="简单说说-Node-安装"><a href="#简单说说-Node-安装" class="headerlink" title="简单说说 Node 安装"></a>简单说说 Node 安装</h3><p>两种方式：</p><ol><li><a href="http://nodejs.cn/download/" target="_blank" rel="noopener">Node 官网</a>下载自己系统相应的包，通过图型界面安装。</li><li><code>brew install node</code> 通过命令安装，但前题是你安装过 <code>HomeBrew</code></li></ol><p>检查是否安装成功：<code>node -v</code> &amp;&amp; <code>npm -v</code></p><h3 id="NODE-版本切换-n"><a href="#NODE-版本切换-n" class="headerlink" title="NODE 版本切换 n"></a>NODE 版本切换 n</h3><ol><li><p>n 的安装 <code>npm install -g n</code><br>查看 n 是否安装成功 <code>n -V</code></p></li><li><p>用 n 切换 node 版本时遇到的问题及解决办法</p><ul><li><p>问题描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pna.nextTick is not a function</span><br></pre></td></tr></table></figure></li><li><p>解决办法</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ n lts <span class="comment"># Install or activate the latest LTS node release</span></span><br><span class="line">$ npm install -g npm</span><br><span class="line">$ n stable <span class="comment"># Install or activate the latest stable  node release</span></span><br><span class="line">$ npm install -g @vue/cli</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="NODE-npm-install-报错"><a href="#NODE-npm-install-报错" class="headerlink" title="NODE npm install 报错"></a>NODE npm install 报错</h3><p><img src="/images/node/node_error_decies.png" alt="alt"></p><blockquote><p>关于这个报错，网络分析最多的原因是镜像引起的</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm config get registry # 获取当前系统设置的镜像</span><br><span class="line">https://registry.npmjs.com/</span><br></pre></td></tr></table></figure><blockquote><p>查看当前镜像 <a href="https://registry.npmjs.com/，可以换成" target="_blank" rel="noopener">https://registry.npmjs.com/，可以换成</a> <a href="http://registry.npm.taobao.org/；反之，亦然" target="_blank" rel="noopener">http://registry.npm.taobao.org/；反之，亦然</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm config set registry http://registry.npm.taobao.org/ # 设置当前系统的镜像为淘宝镜像</span><br></pre></td></tr></table></figure><blockquote><p>重置镜像 <a href="https://registry.npmjs.com/，可以换成" target="_blank" rel="noopener">https://registry.npmjs.com/，可以换成</a> <a href="http://registry.npm.taobao.org/；反之，亦然" target="_blank" rel="noopener">http://registry.npm.taobao.org/；反之，亦然</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rm -rf package.lock.json（或 yarn.lock） # 删除 lock 文件</span><br><span class="line">npm cache clean --force # 清除缓存</span><br><span class="line">npm cache verify # 验证缓存数据的有效性和完整性，清理垃圾数据。</span><br><span class="line">npm i # 重新安装</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Node </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue.use 与 vue.component</title>
      <link href="2019/02/25/vue-use-vue-component/"/>
      <url>2019/02/25/vue-use-vue-component/</url>
      
        <content type="html"><![CDATA[<p>Error - 1 弹层对象取自列表，列表数据在弹层编辑修改，编辑部分数据后，取消或关闭弹层，列表数据修改。<br>产生原因：vue 双向绑定<br>解决办法：copy Object, 对象重新 copy 一份</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">handlerUpdate(item) &#123;</span><br><span class="line">  <span class="comment">// 更新 item</span></span><br><span class="line">  <span class="keyword">this</span>.dialogVisible = !<span class="keyword">this</span>.dialogVisible</span><br><span class="line">  <span class="keyword">this</span>.dialogStatus = <span class="string">'edit'</span></span><br><span class="line">  <span class="keyword">this</span>.temp = <span class="built_in">Object</span>.assign(&#123;&#125;, item) <span class="comment">// copy obj</span></span><br><span class="line">  <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.$refs[<span class="string">'dataForm'</span>].clearValidate()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm: Component = <span class="keyword">this</span></span><br></pre></td></tr></table></figure><p>以上写是不是有点奇怪，是的。我没见过，它是 <a href="https://flow.org/" target="_blank" rel="noopener">flow.js</a></p>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前端框架 </tag>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端构建工具</title>
      <link href="2019/02/25/%E5%89%8D%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/"/>
      <url>2019/02/25/%E5%89%8D%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<p>公司之前的项目用的 grunt 构建项目的</p><h3 id="Grunt"><a href="#Grunt" class="headerlink" title="Grunt"></a>Grunt</h3><p>Grunt 首页中可用的 Grunt 插件列表吸引到了我</p><ul><li>coffeeScript</li><li>handlebas</li><li>jade</li><li>JShint</li><li>less</li><li>sass</li><li>require.js</li><li>stylus</li></ul><h4 id="Grunt-目前项目中使用到的插件"><a href="#Grunt-目前项目中使用到的插件" class="headerlink" title="Grunt - 目前项目中使用到的插件"></a>Grunt - 目前项目中使用到的插件</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"grunt"</span>: <span class="string">"^0.4.5"</span>,</span><br><span class="line"><span class="string">"grunt-autoprefixer"</span>: <span class="string">"^1.0.0"</span>,</span><br><span class="line"><span class="string">"grunt-concurrent"</span>: <span class="string">"^0.5.0"</span>,</span><br><span class="line"><span class="comment">// 清除打包生成的文件，删除 dist 目录下的文件</span></span><br><span class="line"><span class="string">"grunt-contrib-clean"</span>: <span class="string">"^0.6.0"</span>,</span><br><span class="line"><span class="string">"grunt-contrib-compress"</span>: <span class="string">"^0.13.0"</span>,</span><br><span class="line"><span class="string">"grunt-contrib-concat"</span>: <span class="string">"^0.5.0"</span>,</span><br><span class="line"><span class="string">"grunt-contrib-connect"</span>: <span class="string">"^0.8.0"</span>,</span><br><span class="line"><span class="string">"grunt-contrib-copy"</span>: <span class="string">"^0.5.0"</span>,</span><br><span class="line"><span class="string">"grunt-contrib-cssmin"</span>: <span class="string">"^0.10.0"</span>,</span><br><span class="line"><span class="string">"grunt-contrib-htmlmin"</span>: <span class="string">"^0.3.0"</span>,</span><br><span class="line"><span class="string">"grunt-contrib-imagemin"</span>: <span class="string">"^0.8.0"</span>,</span><br><span class="line"><span class="string">"grunt-contrib-jshint"</span>: <span class="string">"^0.10.0"</span>,</span><br><span class="line"><span class="string">"grunt-contrib-rename"</span>: <span class="string">"0.0.3"</span>,</span><br><span class="line"><span class="string">"grunt-contrib-uglify"</span>: <span class="string">"^0.5.1"</span>,</span><br><span class="line"><span class="string">"grunt-contrib-watch"</span>: <span class="string">"^0.6.1"</span>,</span><br><span class="line"><span class="comment">// 单元测试框架 Test-Driven Development</span></span><br><span class="line"><span class="string">"grunt-mocha"</span>: <span class="string">"^0.4.10"</span>,</span><br><span class="line"><span class="string">"grunt-newer"</span>: <span class="string">"^0.7.0"</span>,</span><br><span class="line"><span class="string">"grunt-rev"</span>: <span class="string">"^0.1.0"</span>,</span><br><span class="line"><span class="string">"grunt-svgmin"</span>: <span class="string">"^0.4.0"</span>,</span><br><span class="line"><span class="string">"grunt-usemin"</span>: <span class="string">"^2.3.0"</span>,</span><br><span class="line"><span class="string">"grunt-wiredep"</span>: <span class="string">"^1.7.0"</span></span><br></pre></td></tr></table></figure><h4 id="Grunt-API"><a href="#Grunt-API" class="headerlink" title="Grunt API"></a>Grunt API</h4><ul><li>grunt.task</li></ul><ul><li><input disabled type="checkbox"> 注册任务 - 别名任务<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grunt.registerTask(<span class="string">'create'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> done = <span class="keyword">this</span>.async();</span><br><span class="line">  generator.autogen(grunt, done);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>注册任务列表</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">task.registerTask(<span class="string">'default'</span>, [<span class="string">'jshint'</span>, <span class="string">'qunit'</span>, <span class="string">'concat'</span>, <span class="string">'uglify'</span>]);</span><br></pre></td></tr></table></figure><ul><li><input disabled type="checkbox"> 注册任务 - 任务函数<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">grunt.registerTask(<span class="string">'serve'</span>, <span class="string">'start the server and preview your app, --allow-remote for remote access'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">target</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (grunt.option(<span class="string">'allow-remote'</span>)) &#123;</span><br><span class="line">      grunt.config.set(<span class="string">'connect.options.hostname'</span>, <span class="string">'0.0.0.0'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (target === <span class="string">'dist'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> grunt.task.run([<span class="string">'build'</span>, <span class="string">'connect:dist:keepalive'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    grunt.task.run([</span><br><span class="line">      <span class="string">'clean:server'</span>,</span><br><span class="line">      <span class="string">'wiredep'</span>,</span><br><span class="line">      <span class="string">'concurrent:server'</span>,</span><br><span class="line">      <span class="string">'autoprefixer'</span>,</span><br><span class="line">      <span class="string">'connect:livereload'</span>,</span><br><span class="line">      <span class="string">'watch'</span></span><br><span class="line">    ]);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure></li></ul><ul><li>grunt.util<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grunt.registerTask(<span class="string">'create'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> done = <span class="keyword">this</span>.async();</span><br><span class="line">  generator.autogen(grunt, done);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><h4 id="bower-包管理工具"><a href="#bower-包管理工具" class="headerlink" title="bower 包管理工具"></a>bower 包管理工具</h4><h3 id="Gulp"><a href="#Gulp" class="headerlink" title="Gulp"></a>Gulp</h3><h3 id="Webpack"><a href="#Webpack" class="headerlink" title="Webpack"></a>Webpack</h3><p>proxy 解决跨域问题</p>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> grunt </tag>
            
            <tag> 工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>跨域</title>
      <link href="2019/02/22/%E8%B7%A8%E5%9F%9F/"/>
      <url>2019/02/22/%E8%B7%A8%E5%9F%9F/</url>
      
        <content type="html"><![CDATA[<p><code>同源，相同的协议 + 相同的域名 + 相同的端口号</code></p><p>不由的觉得很开心，“跨域”，百度输入“跨域”两个字，一大堆类标题“别再问我什么跨域”，哈哈，这是一种什么样的情感。me too.<br>我的对它的感情也很复杂，可不管怎么样，总想找个时间整理，有一定的体系。<br>切入正题</p><p>在页面中用 about:blank 或 Javascript: URL 执行的脚本会继承打开该 URL 的文档的源，因为这些类型的 URLs 没有明确包含有关原始服务器的信息。</p><p>例如，about:blank 通常作为父脚本写入内容的新的空白弹出窗口的 URL（例如，通过  Window.open()  机制）。 如果此弹出窗口也包含代码，则该代码将继承与创建它的脚本相同的源。</p><h3 id="浏览器的同源策略"><a href="#浏览器的同源策略" class="headerlink" title="浏览器的同源策略"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy" target="_blank" rel="noopener">浏览器的同源策略</a></h3><blockquote><ul><li><code>同源</code>策略是一种隔离恶意文件的安全机制。<br>* 对不同源之间的文档或脚本交互进行了限制。<br>* <code>不同源</code>是指两个页面的协议、端口、域名有一个不同</li></ul></blockquote><a id="more"></a><p><strong><em>与<code>https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy</code>对比是否同源</em></strong></p><table class="table table-striped"><thead><tr><th align="center">序号</th><th>link</th><th>协议</th><th>域名</th><th>端口</th><th>是否同源</th><th>原因</th></tr></thead><tbody><tr><td align="center">1</td><td><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy</a></td><td>https</td><td>developer.mozilla.org</td><td>80</td><td>是</td><td>路径不同</td></tr><tr><td align="center">2</td><td><a href="http://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy" target="_blank" rel="noopener">http://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy</a></td><td>http</td><td>developer.mozilla.org</td><td>80</td><td>否</td><td>协议不同</td></tr><tr><td align="center">3</td><td><a href="https://develop.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy" target="_blank" rel="noopener">https://develop.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy</a></td><td>https</td><td>develop.mozilla.org</td><td>80</td><td>否</td><td>域名不同</td></tr><tr><td align="center">4</td><td><a href="https://developer.mozilla.org:81/index.html" target="_blank" rel="noopener">https://developer.mozilla.org:81/index.html</a></td><td>https</td><td>developer.mozilla.org</td><td>81</td><td>否\是</td><td>端口不同（IE 中端口号不在同源策略中，固在IE 浏览器中，属同源）</td></tr><tr><td align="center">5</td><td><a href="https://new.developer.mozilla.org:81/index.html" target="_blank" rel="noopener">https://new.developer.mozilla.org:81/index.html</a></td><td>https</td><td>new.developer.mozilla.org</td><td>80</td><td>否</td><td>域名 new.developer.mozilla.org 不同</td></tr></tbody></table><h4 id="IE-是否同源略有差异"><a href="#IE-是否同源略有差异" class="headerlink" title="IE 是否同源略有差异"></a>IE 是否同源略有差异</h4><blockquote><ul><li><input checked disabled type="checkbox"> 在 IE 中，两个高度互信的域名不用遵守同源策略限制。<code>授信范围（Trust Zones）</code></li></ul></blockquote><ul><li><input checked disabled type="checkbox"> 在 IE 中，<code>端口</code>号不在同源策略中，即协议、域名相同则不受同源策略限制</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.domain = <span class="string">"company.com"</span>; <span class="comment">// 修改当前域名</span></span><br></pre></td></tr></table></figure><h4 id="跨域解决方案-document-domain-iframe"><a href="#跨域解决方案-document-domain-iframe" class="headerlink" title="跨域解决方案 - document.domain + iframe"></a>跨域解决方案 - document.domain + iframe</h4><p><code>共享数据的两个页面域名有共同的主域名或b域名是a域名的子域名</code></p><blockquote><p>上表 4、5 中，主域名相同，均为 ‘mozilla.org’<br>  <a href="https://developer.mozilla.org:81/index.html" target="_blank" rel="noopener">https://developer.mozilla.org:81/index.html</a> 中<br>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"https://new.developer.mozilla.org:81/index.html"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.domain = <span class="string">'mozilla.org'</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> user = <span class="string">'HelenZhanglp'</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p><a href="https://new.developer.mozilla.org:81/index.html" target="_blank" rel="noopener">https://new.developer.mozilla.org:81/index.html</a><br>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.domain = <span class="string">'mozilla.org'</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p><strong>* 如此，new.developer.mozilla.org 所以访问到 developer.mozilla.org 中的数据 *</strong></p></blockquote><h4 id="跨域解决方案-jsonp"><a href="#跨域解决方案-jsonp" class="headerlink" title="跨域解决方案 - jsonp"></a>跨域解决方案 - jsonp</h4><blockquote><p>jsonp 是 json 的使用模式，使用 jsonp 跨域，没有兼容方面问题<br><code>img,iframe,script</code> 三个标签可以通过 src 属性获取不同源的服务器资源<br>当使用 jsonp 模式发送请求时 <strong><em>需要服务端支持</em></strong> 需要用 callback 函数包裹 json 串</p></blockquote><h5 id="以下案例是用-node-启后端服务"><a href="#以下案例是用-node-启后端服务" class="headerlink" title="以下案例是用 node 启后端服务"></a>以下案例是用 node 启后端服务</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// localhost:4000/index.html</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> fn = <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(data.name, <span class="string">'jsonp'</span>)</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'http://localhost:8888/?callback=fn'</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node server.js</span></span><br><span class="line"><span class="keyword">let</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> urllib = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">  response.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;)</span><br><span class="line">  <span class="keyword">var</span> params = urllib.parse(request.url, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (params.query &amp;&amp; params.query.callback) &#123;</span><br><span class="line">    <span class="keyword">var</span> str =  params.query.callback + <span class="string">'('</span> + <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">      name: <span class="string">'HelenZhanglp'</span></span><br><span class="line">    &#125;) + <span class="string">')'</span>; <span class="comment">//jsonp</span></span><br><span class="line">    <span class="built_in">console</span>.log(str)</span><br><span class="line"></span><br><span class="line">    response.end(str);</span><br><span class="line">  &#125;</span><br><span class="line">  response.end(<span class="string">'localhost:8888'</span>)</span><br><span class="line">&#125;).listen(<span class="number">8888</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://127.0.0.1:8888/index.js'</span>);</span><br></pre></td></tr></table></figure><p>以上 Demo 二个注意点：</p><ol><li><a href="http://localhost:8888/?callback=fn" target="_blank" rel="noopener">http://localhost:8888/?callback=fn</a> 注意这个链接，参数以前加 <code>?</code>。如此，node 服务端可以通过 urllib.parse(request.url, true) 进入参数解析</li><li>函数 fn 是以变量赋值方式声明的，这里有个<a href>变量提升</a> 的概念，一定要先声明赋值后再引用，如 demo (localhost:4000/index.html)。顺序不能错。</li><li>注意：JSONP只支持GET请求，服务端可能在JSONP响应中夹带恶意代码，判断是否请求成功是困难的。</li></ol><h4 id="跨域资源共享（CORS）"><a href="#跨域资源共享（CORS）" class="headerlink" title="跨域资源共享（CORS）"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="noopener">跨域资源共享（CORS）</a></h4><ol><li><a href="https://developer.mozilla.org/zh-CN/docs/Glossary/CORS" target="_blank" rel="noopener">CORS</a> Cross-Origin Resource Sharing，跨域资源共享）是一个系统，它由一系列传输的HTTP头组成，这些<code>HTTP头决定浏览器是否阻止前端 JavaScript 代码获取跨域请求的响应</code>。同源安全策略 默认阻止“跨域”获取资源。但是 CORS 给了web服务器这样的权限，即服务器可以选择，允许跨域请求访问到它们的资源。</li><li>跨域资源共享(CORS) 是一种机制，它使用额外的 HTTP 头来告诉浏览器，让运行在一个 origin (domain) 上的Web应用被准许访问来自不同源服务器上的指定的资源。当一个资源从与该资源本身所在的服务器不同的域、协议或端口请求一个资源时，资源会发起一个跨域 HTTP 请求。比如，站点 <a href="http://domain-a.com" target="_blank" rel="noopener">http://domain-a.com</a> 的某 HTML 页面通过 <img> 的 src 请求 <a href="http://domain-b.com/image.jpg。网络上的许多页面都会加载来自不同域的CSS样式表，图像和脚本等资源。" target="_blank" rel="noopener">http://domain-b.com/image.jpg。网络上的许多页面都会加载来自不同域的CSS样式表，图像和脚本等资源。</a><br>出于安全原因，浏览器限制从脚本内发起的跨源HTTP请求。例如，XMLHttpRequest 和 Fetch API 遵循同源策略。这意味着使用这些 API的 Web 应用程序只能从加载应用程序的同一个域请求HTTP资源，除非响应报文包含了正确CORS响应头。</li></ol><h2 id="ERROR-——-Access-to-XMLHttpRequest-at-‘file-Users-…-jsx-jsx-basic-js’-from-origin-‘null’-has-been-blocked-by-CORS-policy-Cross-origin-requests-are-only-supported-for-protocol-schemes-http-data-chrome-chrome-extension-chrome-untrusted-https"><a href="#ERROR-——-Access-to-XMLHttpRequest-at-‘file-Users-…-jsx-jsx-basic-js’-from-origin-‘null’-has-been-blocked-by-CORS-policy-Cross-origin-requests-are-only-supported-for-protocol-schemes-http-data-chrome-chrome-extension-chrome-untrusted-https" class="headerlink" title="ERROR —— Access to XMLHttpRequest at ‘file://Users/…/jsx/jsx-basic.js’ from origin ‘null’ has been blocked by CORS policy: Cross origin requests are only supported for protocol schemes: http,data,chrome,chrome-extension,chrome-untrusted,https"></a>ERROR —— Access to XMLHttpRequest at ‘file://Users/…/jsx/jsx-basic.js’ from origin ‘null’ has been blocked by CORS policy: Cross origin requests are only supported for protocol schemes: http,data,chrome,chrome-extension,chrome-untrusted,https</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">dir</span>=<span class="string">"ltr"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- react core code when deploying, replace "development.js" with "production.min.js" --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/react@16/umd/react.development.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- react about dom's function --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/react-dom@16/umd/react-dom.development.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Don't use this in production  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/babel-standalone@6.15.0/babel.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/babel"</span> <span class="attr">src</span>=<span class="string">"./import.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>解决办法：<br>http-server 打开一个本地服务，通过本地服务请求</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Starting up http-server, serving ./</span><br><span class="line">Available on:</span><br><span class="line">  http://127.0.0.1:8080</span><br><span class="line">  http://192.168.5.10:8080</span><br><span class="line">Hit CTRL-C to stop the server</span><br><span class="line">[2021-03-03T04:44:16.576Z]  &quot;GET /jsx/jsx.html&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Geck</span><br><span class="line">o) Chrome/88.0.4324.192 Safari/537.36&quot;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 浏览器 </tag>
            
            <tag> 跨域 </tag>
            
            <tag> 同源策略 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS BFC</title>
      <link href="2019/02/20/CSS-BFC/"/>
      <url>2019/02/20/CSS-BFC/</url>
      
        <content type="html"><![CDATA[<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Block_formatting_context" target="_blank" rel="noopener">个人的官方是 MDN 文档，信得过，值得依赖</a><br>[同时借鉴 前端精选文摘：BFC 神奇背后的原理]（<a href="https://www.cnblogs.com/lhb25/p/inside-block-formatting-ontext.html）发现真正要理解" target="_blank" rel="noopener">https://www.cnblogs.com/lhb25/p/inside-block-formatting-ontext.html）发现真正要理解</a> BFC 不仅仅要清楚创建块级格式化上下文的方式，还要清楚一些它布局的规则。</p><p><strong>BFC - Block Formatting Context Web</strong> 页面可视化css渲染的一部分，是布局过程中生成块级盒子的区域，也是浮动元素与其它元素交互的区域。</p><h3 id="创建块级格式化上下文的方式（Block-Formatting-Context）"><a href="#创建块级格式化上下文的方式（Block-Formatting-Context）" class="headerlink" title="创建块级格式化上下文的方式（Block Formatting Context）"></a>创建块级格式化上下文的方式（Block Formatting Context）</h3><ul><li><code>绝对定位元素</code><strong>position: absolute/position: fixed</strong> 会创建块级上下文<blockquote><p>图标居定位右上角 <a href="https://github.com/HelenZhangLP/demo/blob/master/postionAbsoluteFixedBlock/index.html" target="_blank" rel="noopener">以下 demo 代码</a></p></blockquote></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>navigator1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>navigator2<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>navigator3<span class="tag">&lt;<span class="name">i</span>&gt;</span>vip icon<span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">i</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">margin</span>: -<span class="number">2px</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#f90</span>;</span><br><span class="line">  <span class="attribute">text-indent</span>: -<span class="number">9999px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">28px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">11px</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(http://img.mukewang.com/<span class="number">545304730001307300280011</span>.gif) no-repeat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/demo/positionAbsoluteFixedBlock/position-absolute-block-1.jpg" alt="position-absolute-block-1"><br>上图是一个注释掉<code>position: absolute</code>后的错误示例，如 <code>&lt;i&gt;</code> 非块级元素，<code>text-indent: -9999px</code> 不生效，<code>margin: -2px 0 0 1px</code>在垂直方向同样不生效。注释文本撑开，显示vip图片，若无<code>vip icon</code>，背影图同样不显示，因为 <code>width/height</code> 对非块级元素不生效。<code>放开position: absolute 注释后，BFC 化后，实现效果如下图</code></p><p><img src="/images/demo/positionAbsoluteFixedBlock/position-absolute-block-2.jpg" alt="position-absolute-block-2"></p><hr><ul><li>overflow 值不为 visible（default/visible）</li><li>浮动元素（float 不为 none）<blockquote><p>浮动实现两列表布局<br>盒子 .bfc1 与 盒子 .bfc2，左右布局，左侧盒子宽 100，左侧盒子根据父元素高自适应</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">'content'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">'bfc1'</span>&gt;</span>bfc<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">'bfc2'</span>&gt;</span>bfc<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.content</span> &#123;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line"><span class="attribute">border</span>: solid <span class="number">3px</span> <span class="number">#dd9</span>;</span><br><span class="line"><span class="attribute">background</span>: <span class="number">#ccc</span>;</span><br><span class="line"><span class="attribute">margin-left</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bfc1</span> &#123;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">150px</span>;</span><br><span class="line"><span class="attribute">background</span>: <span class="number">#f99</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bfc2</span> &#123;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line"><span class="attribute">background</span>: <span class="number">#fcc</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="http://audreyzhang.s3-cn-east-1.qiniucs.com/static/images/bfc-float-overflow-1.png"><blockquote><p>由图可以看出，块状元素布局是由上自下，每个元素与父元素左边框接触<br>左浮动实现两列表布局</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.content</span> &#123;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line"><span class="attribute">border</span>: solid <span class="number">3px</span> <span class="number">#dd9</span>;</span><br><span class="line"><span class="attribute">background</span>: <span class="number">#ccc</span>;</span><br><span class="line"><span class="attribute">margin-left</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bfc1</span> &#123;</span><br><span class="line">  float: left;  // 左浮动实现两列表布局</span><br><span class="line"><span class="selector-tag">width</span>: 100<span class="selector-tag">px</span>;</span><br><span class="line"><span class="selector-tag">height</span>: 150<span class="selector-tag">px</span>;</span><br><span class="line"><span class="selector-tag">background</span>: <span class="selector-id">#f99</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bfc2</span> &#123;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line"><span class="attribute">background</span>: <span class="number">#fcc</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="http://audreyzhang.s3-cn-east-1.qiniucs.com/static/images/bfc-float-overflow-2.png">]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前端 </tag>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS 盒模型</title>
      <link href="2019/02/20/CSS-%E7%9B%92%E6%A8%A1%E5%9E%8B/"/>
      <url>2019/02/20/CSS-%E7%9B%92%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>该文档整理基于<a href="https://www.ibm.com/developerworks/cn/web/1310_shatao_quirks/#N101C3" target="_blank" rel="noopener">怪异模式（Quirks Mode）对 HTML 页面的影响</a></p><p>切入正题，说说盒模型。通过上面那篇文章，我意识到了盒模型的差异源于浏览器的渲染解析差异。最突出的代表要数IE浏览器，在 IE 中，有四种标准模式（Standards Mode）- IE7/8/9/10 Standards Mode；两种怪异模式（Quirks Mode）IE5 Quirks 和 IE10 Quirks。这两类文档模式在盒模型的渲染上有所差异。</p><h3 id="话不多说，先上图"><a href="#话不多说，先上图" class="headerlink" title="话不多说，先上图"></a>话不多说，先上图</h3><p><img src="https://bkimg.cdn.bcebos.com/pic/a9d3fd1f4134970a37cf81a69fcad1c8a6865dfe?x-bce-process=image/watermark,image_d2F0ZXIvYmFpa2U4MA==,g_7,xp_5,yp_5" alt="W3C标准盒模型">;<br><strong><center>【W3C标准盒模型】</center></strong><br><img src="https://www.ibm.com/developerworks/cn/web/1310_shatao_quirks/image005.jpg" alt="IE盒模型"><br><strong><center>【IE盒模型】</center></strong></p><p>由上图可以看出：</p><blockquote><p>IE Quirks 怪异模式 盒模型  width = border + padding + content<br>  W3C 盒模型 width = content width</p></blockquote><a id="more"></a><h3 id="box-sizing（兼容-IE8-浏览器）"><a href="#box-sizing（兼容-IE8-浏览器）" class="headerlink" title="box-sizing（兼容 IE8+浏览器）"></a>box-sizing（兼容 <code>IE8+</code>浏览器）</h3><p>定义用户代理（user agent）计算元素总宽高计算方式的 css3 属性，文档定义如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">box-sizing ： content-box || border-box || inherit</span><br></pre></td></tr></table></figure><p>content-box: 默认值，W3C 盒模型，元素所占区域宽 = border+padding+（content=width）。<br>border-box: 元素渲染模式为 IE Quirks 渲染方式，即元素所占区域宽高 = width = border + padding + content</p>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前端 </tag>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript 之数据类型</title>
      <link href="2019/02/08/Javascript-%E4%B8%AD%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7%E4%B8%8E%E5%8E%9F%E5%9E%8B%E5%B1%9E%E6%80%A7/"/>
      <url>2019/02/08/Javascript-%E4%B8%AD%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7%E4%B8%8E%E5%8E%9F%E5%9E%8B%E5%B1%9E%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<p>想对 Promise 作一个深入了解，<code>console.dir(Promise)</code>，得出以下结果。</p><img src="http://audreyzhang.s3-cn-east-1.qiniucs.com/static/images/Javascript-property-instance.png?imageView2/2/w/500"><p>上图可以看到 Promise 即有实例属性、方法，又有原型属性方法。接下来，我要归整归整，Javascript 中的实例属性方法与原型属性方法。</p><a id="more"></a><p><a href="http://www.ruanyifeng.com/blog/2014/03/undefined-vs-null.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2014/03/undefined-vs-null.html</a></p><h3 id="Javascript-数据类型"><a href="#Javascript-数据类型" class="headerlink" title="Javascript 数据类型"></a>Javascript 数据类型</h3><p>纠结了多日，一直没能给出一个自己认为合理的表述方式，直到看到下图：</p><!--<img src="http://audreyzhang.s3-cn-east-1.qiniucs.com/static/images/jsDataTypes.jpg">--><p><img src="/images/Javascript/jsDataTypes.jpg" alt="alt"><br>与《Javascript高级程序设计》不同，这张图中没有 null。我这边先就图中的信息作一个解析，图中，将数据类型分为值类型与引用类型。</p><ul><li><input checked disabled type="checkbox"> <p>值类型或称基本数据类型，可用 <code>typeof</code> 判断值类型</p><ul><li><p>undefined</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; typeof undefined</span><br><span class="line">  <span class="string">'undefined'</span></span><br></pre></td></tr></table></figure></li><li><p>null</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; typeof null</span><br><span class="line"><span class="string">'object'</span></span><br></pre></td></tr></table></figure></li><li><p>number、boolean、string</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; typeof undefined</span><br><span class="line"><span class="string">'undefined'</span></span><br><span class="line">&gt; typeof 1</span><br><span class="line"><span class="string">'number'</span></span><br><span class="line">&gt; typeof <span class="string">''</span></span><br><span class="line"><span class="string">'string'</span></span><br><span class="line">&gt; typeof <span class="literal">true</span></span><br><span class="line"><span class="string">'boolean'</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>[-] 引用类型，用 <code>instanceof</code> 判断引用类型</p></li></ul><p>最新的 ECMAScript 标准定义了7种数据类型：</p><ul><li><input disabled type="checkbox"> <p>6 种基本数据类型</p><ul><li><p><strong>布尔值（Boolean）</strong>，有2个值分别是：true 和 false.</p></li><li><p><strong>null</strong>，一个表明 null 值的特殊关键字。 <code>Javascript 是大小写敏感的，因此 null 与 Null、NULL或变体完全不同</code>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; null</span><br><span class="line">  null</span><br><span class="line">&gt; Null</span><br><span class="line">  ReferenceError: Null is not defined</span><br><span class="line">&gt; NULL</span><br><span class="line">  ReferenceError: NULL is not defined</span><br></pre></td></tr></table></figure></li><li><p><strong>undefined</strong>，和 null 一样是一个特殊的关键字，undefined 表示变量未定义时的属性。</p></li><li><p><strong>数字（Number）</strong>，整数或浮点数，例如： 42 或者 3.14159。</p></li><li><p><strong>字符串（String）</strong>，字符串是一串表示文本值的字符序列，例如：”Howdy” 。</p></li><li><p><strong>代表（Symbol）</strong> ( 在 ECMAScript 6 中新添加的类型).。一种实例是唯一且不可改变的数据类型。</p></li></ul></li></ul><blockquote><p>除了 null 与 undefined 以外，其它基本类型都有相应的包装对象</p></blockquote><ul><li><input disabled type="checkbox"> 对象类型</li></ul><h3 id="对象类型"><a href="#对象类型" class="headerlink" title="对象类型"></a>对象类型</h3><p>Javascript 中的几乎所有事物都是对象：字符串、数值、数组、函数等，</p>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node 常用命令</title>
      <link href="2019/02/08/Node-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
      <url>2019/02/08/Node-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h4 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Usage: npm &lt;command&gt;</span><br><span class="line"></span><br><span class="line">where &lt;command&gt; is one of:</span><br><span class="line">    access, adduser, audit, bin, bugs, c, cache, ci, cit,</span><br><span class="line">    clean-install, clean-install-test, completion, config,</span><br><span class="line">    create, ddp, dedupe, deprecate, dist-tag, docs, doctor,</span><br><span class="line">    edit, explore, get, help, help-search, hook, i, init,</span><br><span class="line">    install, install-ci-test, install-test, it, link, list, ln,</span><br><span class="line">    login, logout, ls, org, outdated, owner, pack, ping, prefix,</span><br><span class="line">    profile, prune, publish, rb, rebuild, repo, restart, root,</span><br><span class="line">    run, run-script, s, se, search, set, shrinkwrap, star,</span><br><span class="line">    stars, start, stop, t, team, test, token, tst, un,</span><br><span class="line">    uninstall, unpublish, unstar, up, update, v, version, view,</span><br><span class="line"></span><br><span class="line">    whoami</span><br><span class="line">    npm &lt;command&gt; -h  quick help on &lt;command&gt;</span><br><span class="line">    npm -l            display full usage info</span><br><span class="line">    npm help &lt;term&gt;   search for help on &lt;term&gt;</span><br><span class="line">    npm help npm      involved overview</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Specify configs in the ini-formatted file:</span><br><span class="line">    /Users/lipingzhang/.npmrc</span><br><span class="line">or on the command line via: npm &lt;command&gt; --key value</span><br><span class="line">Config info can be viewed via: npm help config</span><br><span class="line"></span><br><span class="line">npm@6.8.0 /usr/local/lib/node_modules/npm</span><br></pre></td></tr></table></figure><blockquote><p>退出 node 环境</p></blockquote><ol><li>两次ctrl+C</li><li>一次ctrl+D</li><li><code>process.exit()</code></li><li>.exit</li></ol>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Node </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bluebird &amp;&amp; Promise</title>
      <link href="2019/02/08/bluebird-Promise/"/>
      <url>2019/02/08/bluebird-Promise/</url>
      
        <content type="html"><![CDATA[<p>本想看看 markdown 怎么通过 hexo 生成 html。结果被第一代码吸引了，发现呐，经常用的 Promise 竟然引入 bluebird，好吧。承认怎么跑偏了。不管了，捡到篮子的都是菜。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="built_in">Promise</span> = <span class="built_in">require</span>(<span class="string">'bluebird'</span>);</span><br></pre></td></tr></table></figure><h3 id="Javascript-Promise"><a href="#Javascript-Promise" class="headerlink" title="Javascript - Promise"></a>Javascript - Promise</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123; [<span class="built_in">Function</span>: <span class="built_in">Promise</span>]</span><br><span class="line">  [length]: <span class="number">1</span>,</span><br><span class="line">  [name]: <span class="string">'Promise'</span>,</span><br><span class="line">  [prototype]:</span><br><span class="line">   <span class="built_in">Promise</span> &#123;</span><br><span class="line">     [<span class="keyword">constructor</span>]: [Circular],</span><br><span class="line">     [then]: &#123; [<span class="built_in">Function</span>: then] [length]: <span class="number">2</span>, [name]: <span class="string">'then'</span> &#125;,</span><br><span class="line">     [<span class="keyword">catch</span>]: &#123; [<span class="built_in">Function</span>: <span class="keyword">catch</span>] [length]: <span class="number">1</span>, [name]: <span class="string">'catch'</span> &#125;,</span><br><span class="line">     [chain]: &#123; [<span class="built_in">Function</span>: chain] [length]: <span class="number">2</span>, [name]: <span class="string">'chain'</span> &#125;,</span><br><span class="line"></span><br><span class="line">     [<span class="built_in">Symbol</span>(<span class="built_in">Symbol</span>.toStringTag)]: <span class="string">'Promise'</span> &#125;,</span><br><span class="line">  [reject]: &#123; [<span class="built_in">Function</span>: reject] [length]: <span class="number">1</span>, [name]: <span class="string">'reject'</span> &#125;,</span><br><span class="line">  [all]: &#123; [<span class="built_in">Function</span>: all] [length]: <span class="number">1</span>, [name]: <span class="string">'all'</span> &#125;,</span><br><span class="line">  [race]: &#123; [<span class="built_in">Function</span>: race] [length]: <span class="number">1</span>, [name]: <span class="string">'race'</span> &#125;,</span><br><span class="line">  [resolve]: &#123; [<span class="built_in">Function</span>: resolve] [length]: <span class="number">1</span>, [name]: <span class="string">'resolve'</span> &#125;,</span><br><span class="line">  [defer]: &#123; [<span class="built_in">Function</span>: defer] [length]: <span class="number">0</span>, [name]: <span class="string">'defer'</span> &#125;,</span><br><span class="line">  [accept]: &#123; [<span class="built_in">Function</span>: accept] [length]: <span class="number">1</span>, [name]: <span class="string">'accept'</span> &#125;,</span><br><span class="line">  [<span class="built_in">Symbol</span>(<span class="built_in">Symbol</span>.species)]: [Getter] &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Promise-method"><a href="#Promise-method" class="headerlink" title="Promise.method"></a>Promise.method</h3><h3 id="Promise-promisify"><a href="#Promise-promisify" class="headerlink" title="Promise.promisify"></a>Promise.promisify</h3><blockquote><p>NodeJS 的函数风格转换为 Promise 方法，可以认为是一种语法粮。<br><a href="https://segmentfault.com/a/1190000008479644" target="_blank" rel="noopener">Promisify 的源码解析</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>express</title>
      <link href="2019/02/06/express/"/>
      <url>2019/02/06/express/</url>
      
        <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%- partial(<span class="string">'_partial/ocean'</span>) %&gt;</span><br></pre></td></tr></table></figure><p>ejs 引发的一系列问题<br><code>partial()</code> 是 express 框架方法，先了解下 express。<br><a href="http://www.expressjs.com.cn/" target="_blank" rel="noopener">expressjs 官网</a>是这样介绍的，它是 Web 应用程序<br>Express 是一个保持最小规模的灵活的 Node.js Web 应用程序开发框架，为 Web 和移动应用程序提供一组强大的功能。<br>在官网中没有找到 <code>partial()</code> 方法，只能看看野史了。<br>百度找到了<a href="http://yijiebuyi.com/blog/e503a402ffac43ca1cbaba9d4317b54d.html" target="_blank" rel="noopener">NodeJS - Express 3.0下ejs模板使用 partial展现 片段视图</a></p><a id="more"></a><p><a href="https://github.com/expressjs/express/wiki/Migrating-from-2.x-to-3.x" target="_blank" rel="noopener">github 发现</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;%- partial(<span class="string">'_partial/ocean'</span>) %&gt; <span class="comment">// 在 3.x 中该方法已经移除</span></span><br><span class="line">&lt;%- include <span class="string">'_partial/ocean'</span> %&gt; <span class="comment">// 用 include 替代</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> node </tag>
            
            <tag> express </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo 安装图片插件 ~ hexo + 七牛云</title>
      <link href="2019/02/03/hexo-%E5%AE%89%E8%A3%85%E5%9B%BE%E7%89%87%E6%8F%92%E4%BB%B6/"/>
      <url>2019/02/03/hexo-%E5%AE%89%E8%A3%85%E5%9B%BE%E7%89%87%E6%8F%92%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>想要一块地盘，想要保存宝宝的照片，点点滴<br>想要宝宝成长开辟地盘<br>于是。。。<br>七牛云<br>hexo</p><img title="龙猫" alt="七牛云" src="http://audreyzhang.s3-cn-east-1.qiniucs.com/static/images/longmao.jpeg?imageView2/2/w/225"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 语法</span></span><br><span class="line">&#123;% qnimg longmao.jpeg title:龙猫 at 七牛云 logo alt:七牛云 <span class="string">'class:'</span> extend:?imageView2/2/w/550 %&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="hexo-中安装七年云插件"><a href="#hexo-中安装七年云插件" class="headerlink" title="hexo 中安装七年云插件"></a>hexo 中安装七年云插件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-qiniu-sync --save</span><br></pre></td></tr></table></figure><blockquote><p>hexo 七牛同步插件 hexo-qiniu-sync<br>git 地址（<a href="https://github.com/gyk001/hexo-qiniu-sync.git）" target="_blank" rel="noopener">https://github.com/gyk001/hexo-qiniu-sync.git）</a><br>赞挖井人</p></blockquote><h2 id="hexo-中配置七牛云"><a href="#hexo-中配置七牛云" class="headerlink" title="hexo 中配置七牛云"></a>hexo 中配置七牛云</h2><p>在 <code>_config.yml</code> 中配置 qiniu 插件，具体每个参数怎么配置、代表什么在（<a href="https://github.com/gyk001/hexo-qiniu-sync.git）中有详细说明，以下是个人配置的" target="_blank" rel="noopener">https://github.com/gyk001/hexo-qiniu-sync.git）中有详细说明，以下是个人配置的</a> demo</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">qiniu:</span><br><span class="line">  offline: <span class="literal">false</span></span><br><span class="line">  sync: <span class="literal">true</span></span><br><span class="line">  bucket: audreyzhang</span><br><span class="line">  secret_file: a/qn.json <span class="comment"># 该配置与 access_key &amp;&amp; secret_key 取其一即可</span></span><br><span class="line">  <span class="comment"># access_key: 3***i</span></span><br><span class="line">  <span class="comment"># secret_key: s**d</span></span><br><span class="line">  dirPrefix: static</span><br><span class="line">  <span class="comment"># 外链前缀</span></span><br><span class="line">  urlPrefix: http://***.bkt.clouddn.com/static</span><br><span class="line">  <span class="comment"># 使用默认配置即可</span></span><br><span class="line">  up_host: http://upload.qiniu.com</span><br><span class="line">  <span class="comment"># 本地目录</span></span><br><span class="line">  local_dir: static</span><br><span class="line">  <span class="comment"># 是否更新已经上传过的文件(仅文件大小不同或在上次上传后进行更新的才会重新上传)</span></span><br><span class="line">  update_exist: <span class="literal">true</span></span><br><span class="line">  image:</span><br><span class="line">    folder: images</span><br><span class="line">    extend:</span><br><span class="line">  js:</span><br><span class="line">    folder: js</span><br><span class="line">  css:</span><br><span class="line">    folder: css</span><br></pre></td></tr></table></figure><h3 id="hexo-中配置七牛插件-ERROR"><a href="#hexo-中配置七牛插件-ERROR" class="headerlink" title="hexo 中配置七牛插件 - ERROR"></a>hexo 中配置七牛插件 - ERROR</h3><h4 id="ERROR-1-port-has-been-used"><a href="#ERROR-1-port-has-been-used" class="headerlink" title="ERROR - 1 - port has been used"></a>ERROR - 1 - port has been used</h4><blockquote><p>每次新增图片，不会自动上传到七牛云服务器，需要重新执行 <code>hexo s</code>，于是遇见以下错误</p></blockquote><img src="http://audreyzhang.s3-cn-east-1.qiniucs.com/static/images/portHasBeenUsed.png"><p><strong>这个很明显，就是端口被占用了。找出启服务的 terminal <code>ctrl + c</code> 停止当前服务，<code>hexo s</code> 重新启动</strong></p><h4 id="ERROR-2-get-file-stat-err"><a href="#ERROR-2-get-file-stat-err" class="headerlink" title="ERROR - 2 - get file stat err"></a>ERROR - 2 - get file stat err</h4><blockquote><p>添加图片，执行 <code>hexo g</code> 报错： <em>get file stat err</em> 如下图</p><img src="http://audreyzhang.s3-cn-east-1.qiniucs.com/static/images/getFileStatErr.png"><p>逐一排查，发现是 secret_key &amp;&amp; access_key 未设置导致的，排查结果如下图</p><img src="http://audreyzhang.s3-cn-east-1.qiniucs.com/static/images/getFileStatErr-badToken401.png"><p>*<em><code>_config.yml</code> 中添加 access_key &amp;&amp; secret_key，有两种方式： *</em></p></blockquote><ol><li>直接添加<br>access_key: 3<strong>*i<br>secret_key: s</strong>d</li><li>新增加 <code>sec.json</code>，将 <code>access_key: 3***i &amp;&amp; secret_key: s**d</code> 写入 json 文件，然后 <code>_config.yml，qiniu</code> 插件中，添加 <code>secret_file: a/qn.json</code></li></ol><p><strong>(具体如上 demo，选其一即可。AccessKey/SecretKey 可至 七牛云 个人中心 -&gt; 密钥管理 中查看)</strong></p><h4 id="ERROR-3-token-not-specified-图片不展示"><a href="#ERROR-3-token-not-specified-图片不展示" class="headerlink" title="ERROR - 3 - token not specified 图片不展示"></a>ERROR - 3 - token not specified 图片不展示</h4><blockquote><p>可能是因为当前空间是私有空间造成的，具体原因可看文档<br>  <a href="https://developer.qiniu.com/fusion/kb/3885/through-the-http-status-code-download-failure-reason" target="_blank" rel="noopener">https://developer.qiniu.com/fusion/kb/3885/through-the-http-status-code-download-failure-reason</a><br>  <a href="https://developer.qiniu.com/kodo/kb/4054/matters-needing-attention-of-private-space" target="_blank" rel="noopener">https://developer.qiniu.com/kodo/kb/4054/matters-needing-attention-of-private-space</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图片 </tag>
            
            <tag> 七牛云 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EN Dash</title>
      <link href="2019/02/01/EN-Dash/"/>
      <url>2019/02/01/EN-Dash/</url>
      
        <content type="html"><![CDATA[<h2 id="EN-Dash-破折号、连字符"><a href="#EN-Dash-破折号、连字符" class="headerlink" title="EN Dash - 破折号、连字符"></a>EN Dash - 破折号、连字符</h2><blockquote><p>英语中连字符的两大功能</p></blockquote><ol><li><p>用于移行，把不在同一行的某个单词连接起来；</p></li><li><p>把两个或两个以上的单词连接起来，构成新的形容词</p><a id="more"></a></li></ol><h3 id="由连字符-构成的形容词性的合成词"><a href="#由连字符-构成的形容词性的合成词" class="headerlink" title="由连字符 -  构成的形容词性的合成词"></a>由连字符 -  构成的形容词性的合成词</h3><ol><li><p>由形容词 + （名词 + ed) 构成的合成形容词</p><blockquote><p>a kind-hearted woman 一个心地善良的人<br>a simple-minded young man 一个头脑简单的年轻人<br>a left-handed person 一个左撇子<br>有时,数词或名词+（名词+ed）,也能构成合成形容词,如：<br>a two-faced fellow 一个两面派的家伙<br>a three-cornered hat 一顶三角帽</p></blockquote></li><li><p>由形容词或副词 + 分词构成的合成形容词</p><blockquote><p>a new-born baby 一个新生婴儿<br>a badly-lighted room 一间光线昏暗的房间<br>a well-meaning proposal 一条善意的建议<br>有时,名词+分词也能构成合成形容词,如：<br>peace-loving people 热爱和平的人民<br>a man-eating society 一个吃人的社会</p></blockquote></li><li><p>由名词、形容词或副词 + 形容词合成的形容词</p><blockquote><p>a snow-white wall 一堵雪白的墙<br>dark-blue ink 深蓝色墨水<br>ever-green bushes 常青灌木林</p></blockquote></li><li><p>由形容词、数词 + 名词合成的形容词</p><blockquote><p>a first－rate teacher 一位一流的教师<br>an eight－cylinder engine 一台八汽缸发动机</p></blockquote></li><li><p>由不同短语构成的合成形容词</p><blockquote><p>out-of-the-way 偏僻<br>face-to-face talk 面对面谈话<br>an out-and-out lie 彻头彻尾的谎言</p></blockquote></li><li><p>作者在表达一个意思时不拘形式,比较随便.他可以把句子中的一个短语,甚至是一个句子,其间用连字符一一连接起来,构成多词性合成形容词.</p><blockquote><p>With your nothing－can－be-done attitude,you can’t hope to accomplish<br>anything．你抱这种无所作为的态度,你就一事无成<br>never-to-be-forgotten 令人难忘<br>difficult-to-operate 难以操作</p></blockquote></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">### mobile-enabled</span><br><span class="line">名词 + 分词合成的形容词</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> English </category>
          
      </categories>
      
      
        <tags>
            
            <tag> English </tag>
            
            <tag> 词法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>atom 插件</title>
      <link href="2019/01/31/%E5%B7%A5%E5%85%B7-atom-%E6%8F%92%E4%BB%B6/"/>
      <url>2019/01/31/%E5%B7%A5%E5%85%B7-atom-%E6%8F%92%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h3 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a><a href="https://blog.csdn.net/qq_40963664/article/details/79250424" target="_blank" rel="noopener">快捷键</a></h3><table><thead><tr><th>keyName</th><th>description</th></tr></thead><tbody><tr><td>ctrl+G</td><td>快速跳转到某一行</td></tr></tbody></table><h4 id="markdown-preview-plus"><a href="#markdown-preview-plus" class="headerlink" title="markdown-preview-plus"></a>markdown-preview-plus</h4><ol><li>command + shift + p</li><li>markdown preview toggle</li></ol><h4 id="platformio-ide-terminal"><a href="#platformio-ide-terminal" class="headerlink" title="platformio-ide-terminal"></a>platformio-ide-terminal</h4><ol><li>command + shift + p</li><li>terminal new / terminal close<blockquote><p>安装 Installation Failure platformio-atom-ide-terminal #925<br>install “terminus” it is a fork of platformio-ide-terminal</p></blockquote></li></ol><h4 id="docblockr"><a href="#docblockr" class="headerlink" title="docblockr"></a><a href="https://atom.io/packages/docblockr" target="_blank" rel="noopener">docblockr</a></h4><p>用于自动生成注释（annotation）</p><h4 id="authcompletePaths"><a href="#authcompletePaths" class="headerlink" title="authcompletePaths"></a>authcompletePaths</h4><p>自动补全 path</p><a id="more"></a><h4 id="emmet"><a href="#emmet" class="headerlink" title="emmet"></a>emmet</h4><p>高效编写 html/css，按约定编写代码，自动扩展补全，<a href="https://emmet.io/" target="_blank" rel="noopener">具体见文档</a></p><h3 id="Codeigniter-Atom"><a href="#Codeigniter-Atom" class="headerlink" title="Codeigniter Atom"></a>Codeigniter Atom</h3><p>代码补全、高亮</p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> develop tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo 坑</title>
      <link href="2019/01/31/hexo-%E5%9D%91/"/>
      <url>2019/01/31/hexo-%E5%9D%91/</url>
      
        <content type="html"><![CDATA[<h2 id="hexo-deploy-没有反应"><a href="#hexo-deploy-没有反应" class="headerlink" title="hexo deploy 没有反应"></a>hexo deploy 没有反应</h2><p><code>检查</code> _config.yml 中 deploy 配置</p><h2 id="访问页面空白"><a href="#访问页面空白" class="headerlink" title="访问页面空白"></a>访问页面空白</h2><p><code>检查</code> themes</p><h2 id="断行，在首页展示缩略信息，该方法能被-hexo-更好识别"><a href="#断行，在首页展示缩略信息，该方法能被-hexo-更好识别" class="headerlink" title="断行，在首页展示缩略信息，该方法能被 hexo 更好识别"></a>断行，在首页展示缩略信息，该方法能被 hexo 更好识别</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--more--&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">auto_excerpt:</span><br><span class="line">  enable: true</span><br><span class="line">  length: 150</span><br></pre></td></tr></table></figure><h2 id="ERROR-No-layout-index-html"><a href="#ERROR-No-layout-index-html" class="headerlink" title="ERROR - No layout: index.html"></a>ERROR - No layout: index.html</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ hexo s</span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Hexo is running at http://localhost:4000 . Press Ctrl+C to stop.</span><br><span class="line">WARN  No layout: index.html</span><br></pre></td></tr></table></figure><a id="more"></a><p><code>解决办法：</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/zhwangart/hexo-theme-ocean.git themes/ocean</span><br></pre></td></tr></table></figure><blockquote><p>Modify theme setting in _config.yml to ocean<br><code>theme: ocean</code></p></blockquote><h2 id="ERROR-发布到-git-服务器访问出现空白页或无主题样式"><a href="#ERROR-发布到-git-服务器访问出现空白页或无主题样式" class="headerlink" title="ERROR - 发布到 git 服务器访问出现空白页或无主题样式"></a>ERROR - 发布到 git 服务器访问出现空白页或无主题样式</h2><blockquote><p>原因是发布到 github 上的项目名称要与个人github的用户名一致，且加后缀 .github.io，如 ‘helenzhanglp.github.io’</p></blockquote><h2 id="ERROR-博客中添加-gitalk"><a href="#ERROR-博客中添加-gitalk" class="headerlink" title="ERROR - 博客中添加 gitalk"></a>ERROR - 博客中添加 gitalk</h2><blockquote><p><em>## Error Error: Not Found. ##</em><br><code>解决办法：</code></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gitalk:</span><br><span class="line">  enable: true</span><br><span class="line">  clientID: 8e7e6dda81936172806e # GitHub Application Client ID</span><br><span class="line">  clientSecret: 97f71b6bbdf731bc650ec39212061882b8f36e71 # Client Secret</span><br><span class="line">  repo: &apos;blog&apos; # Repository name 仓库不能为私有仓库 Private Repository</span><br><span class="line">  owner: HelenZhangLP  # GitHub ID</span><br><span class="line">  admin: HelenZhangLP # GitHub ID</span><br></pre></td></tr></table></figure><h2 id="ERROR-theme-样式修改，先需要先提交至-github，再-deploy"><a href="#ERROR-theme-样式修改，先需要先提交至-github，再-deploy" class="headerlink" title="ERROR - theme 样式修改，先需要先提交至 github，再 deploy"></a>ERROR - theme 样式修改，先需要先提交至 github，再 deploy</h2><h2 id="Error-Spawn-failed"><a href="#Error-Spawn-failed" class="headerlink" title="Error: Spawn failed"></a>Error: Spawn failed</h2><blockquote><p>fatal: unable to access ‘<a href="https://github.com/HelenZhangLP/helenzhanglp.github.io.git/&#39;" target="_blank" rel="noopener">https://github.com/HelenZhangLP/helenzhanglp.github.io.git/&#39;</a>: Received HTTP code 502 from<br> proxy after CONNECT<br>FATAL Something’s wrong. Maybe you can find the solution here: <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">https://hexo.io/docs/troubleshooting.html</a></p></blockquote><p><code>解决办法：</code><br>_config.yml 中 修改 deploy，https 链接换成 ssh<br>deploy:<br>  type: git<br>  repo: <a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>:<em>/</em>.github.io.git</p><h2 id="hexo-中加入-sequence-diagram，安装-hexo-filter-sequence-后不显示"><a href="#hexo-中加入-sequence-diagram，安装-hexo-filter-sequence-后不显示" class="headerlink" title="hexo 中加入 sequence diagram，安装 hexo-filter-sequence 后不显示"></a>hexo 中加入 sequence diagram，安装 hexo-filter-sequence 后不显示</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sequence-diagram.js:792 Uncaught ReferenceError: Raphael is not defined</span><br><span class="line">    at sequence-diagram.js:792</span><br><span class="line">    at sequence-diagram.js:1468</span><br><span class="line">(anonymous) @ sequence-diagram.js:792</span><br><span class="line">(anonymous) @ sequence-diagram.js:1468</span><br><span class="line">(index):93 Uncaught ReferenceError: Diagram is not defined</span><br><span class="line">    at (index):93</span><br><span class="line">(anonymous) @ (index):93</span><br></pre></td></tr></table></figure><p><code>解决办法：</code><br>临时在头部加入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;% if(config.sequence) &#123;%&gt;</span><br><span class="line">&lt;script src=&quot;https://cdn.bootcdn.net/ajax/libs/lodash.js/4.17.20/lodash.core.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;https://cdn.bootcdn.net/ajax/libs/raphael/2.3.0/raphael.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>taro 坑系列</title>
      <link href="2019/01/25/taro/"/>
      <url>2019/01/25/taro/</url>
      
        <content type="html"><![CDATA[<h3 id="taro-坑"><a href="#taro-坑" class="headerlink" title="taro 坑"></a>taro 坑</h3><h4 id="坑-1"><a href="#坑-1" class="headerlink" title="坑 - 1"></a>坑 - 1</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/Users/lipingzhang/Project<span class="comment">/**/**/</span>src/pages/order/detail/index编译失败！</span><br><span class="line"><span class="built_in">TypeError</span> [ERR_INVALID_ARG_TYPE]: The <span class="string">"path"</span> argument must be <span class="keyword">of</span> type string</span><br><span class="line">    at assertPath (path.js:<span class="number">28</span>:<span class="number">11</span>)</span><br><span class="line">    at <span class="built_in">Object</span>.relative (path.js:<span class="number">1265</span>:<span class="number">5</span>)</span><br><span class="line">    at pageDepComponents.forEach.depComponent (<span class="regexp">/Users/</span>lipingzhang/.nvm/versions/node/v9<span class="number">.2</span><span class="number">.0</span>/lib/node_modules/@tarojs/cli/src/weapp.js:<span class="number">1326</span>:<span class="number">64</span>)</span><br><span class="line">    at <span class="built_in">Array</span>.forEach (<span class="xml"><span class="tag">&lt;<span class="name">anonymous</span>&gt;</span>)</span></span><br><span class="line"><span class="xml">    at componentMap.forEach.component (/Users/lipingzhang/.nvm/versions/node/v9.2.0/lib/node_modules/@tarojs/cli/src/weapp.js:1320:31)</span></span><br><span class="line">    at Array.forEach (&lt;anonymous&gt;)</span><br><span class="line">    at realComponentsPathList.forEach.component (/Users/lipingzhang/.nvm/versions/node/v9.2.0/lib/node_modules/@tarojs/cli/src/weapp.js:1319:24)</span><br><span class="line">    at Array.forEach (&lt;anonymous&gt;)</span><br><span class="line">    at buildSinglePage (/Users/jo32/.nvm/versions/lipingzhang/v9.2.0/lib/node_modules/@tarojs/cli/src/weapp.js:1316:30)</span><br><span class="line">    at &lt;anonymous&gt;</span><br></pre></td></tr></table></figure><a id="more"></a><h4 id="for-坑-1-原因"><a href="#for-坑-1-原因" class="headerlink" title="for 坑 - 1 - 原因"></a>for 坑 - 1 - 原因</h4><blockquote><p>组件 render 方法返回 null 时会引起编译错误<br><code>/order/detail/index</code> 该页面使用了组件 atCountDown，该组件编译错误</p></blockquote><h3 id="for-坑-1-解决方法"><a href="#for-坑-1-解决方法" class="headerlink" title="for 坑 - 1 - 解决方法"></a>for 坑 - 1 - 解决方法</h3><p>** 升级 tarojs tarojs-cli 为 1.8 **</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* npm install @tarojs@1.8 *</span><br><span class="line">* npm install @tarojs-cli@1.8 *</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前端 </tag>
            
            <tag> 框架 </tag>
            
            <tag> taro </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
