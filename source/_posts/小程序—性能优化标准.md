---
title: 小程序——性能优化
tags:
- 小程序
- 性能
---

### 性能标准
- [ ] 是否使用废弃接口
- [ ] 过大的 WXML 节点
    *   节点数 1000， 节点树深度少于 30 层，子节点数不大于 60 个 **节点会增加内存使用，样式<u>重排时间</u>也会增长**
- [ ] 避免使用 `:active` 实现点击态，易触发，滚动滑动时点击态不会消失，体验差。**使用小程序内置组件 `hover-*`**来实现
```html
<button
	  hover-class="van-action-sheet__item--hover">
  hover-class
</button>
```
- [ ] 避免执行脚本的耗时过长，卡顿
- [ ] 避免首屏时间太长的情况
  * 首屏时间太长会导致用户长时间看到的都是白屏，会一直等待有意义的内容展示出来。出现这一情况，应仔细检查这个过程都有哪个操作，一般来说，可能是**请求数据的时间太长**，或者是一次**渲染的数据太大**导致渲染时间太长。
  
- [ ] 网络图片资源应开启 HTTP 缓存控制，加载同样的图片，会直接从缓存读取，提升加载速度
- [ ] 应让图片按原图宽高比例显示 —— 可根据情况设置 image 组件的 mode 属性，以保持原图宽高比
- [ ] 底部的可交互组件如果渲染在iPhone X的安全区域外，容易误触Home Indicator
- [ ] 避免出现任何 JavaScript 异常
- [ ] 避免存在图片太大而有效显示区域较小 —— 图片太大会增加下载时间和内存的消耗，应根据显示区域大小合理控制图片大小
- [ ] 滚动区域可开启惯性滚动以增强体验 —— 惯性滚动会使滚动比较顺畅，在安卓下默认有惯性滚动，而在 iOS 下需要额外设置 `-webkit-overflow-scrolling: touch` 的样式
- [ ] 避免渲染界面的耗时过长的情况 —— 渲染界面的耗时过长会让用户觉得卡顿，体验较差，出现这一情况时，需要校验下是否同时渲染的区域太大
- [ ] 对网络请求做必要的缓存以避免多余的请求 —— 尽量避免多余的请求，比如对同样的请求进行缓存
- [ ] 所有请求的耗时不应太久 —— 优化好服务器处理时间、减小回包大小，让请求快速响应
- [ ] 避免 setData 的调用过于频繁
  * setData接口的调用涉及逻辑层与渲染层间的线程通过，通信过于频繁可能导致处理队列阻塞，界面渲染不及时而导致卡顿，应避免无用的频繁调用
- [ ] 避免 setData 的数据过大 —— 由于小程序运行逻辑线程与渲染线程之上，setData的调用会把数据从逻辑层传到渲染层，数据太大会增加通信时间
- [ ] 避免将未绑定在 WXML 的变量传入 setData —— setData操作会引起框架处理一些渲染界面相关的工作，一个未绑定的变量意味着与界面渲染无关，传入setData会造成不必要的性能消耗
- [ ] 避免定时器未跟随页面回收 —— 定时器是全局的，并不是跟页面绑定的，当小程序从一个页面路由到另一个页面之后，前一个页面定时器应注意手动回收
- [ ] 避免短时间内发起太多的图片请求 —— 短时间内发起太多图片请求会触发浏览器并行加载的限制，可能导致图片加载慢，用户一直处理等待。应该合理控制数量，可考虑使用雪碧图技术、拆分域名或在屏幕外的图片使用懒加载
- [ ] 避免短时间内发起太多的请求 —— 短时间内发起太多请求会触发小程序并行请求数量的限制，同时太多请求也可能导致加载慢等问题，应合理控制请求数量，甚至做请求的合并等
- [ ] 所有资源请求都建议使用 HTTPS —— 使用 HTTPS，可以让你的小程序更加安全，而 HTTP 是明文传输的，存在可能被篡改内容的风险
- [ ] 避免引入大量未被使用的样式 —— 我们应该按需引入 wxss 资源，如果小程序中存在大量未使用的样式，会增加小程序包体积大小，从而在一定程度上影响加载速度
- [ ] 避免将不可能被访问到的页面打包在小程序包里 - 小程序的包大小会影响加载时间，应该尽量控制包体积大小，避免将不会被使用的文件打包进去
